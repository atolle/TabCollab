function $CombineDelegates(n,t){var r,i;if(n==null)return t;if(t==null)return n;if(r=$CreateMulticastDelegateFunction(),r.delegates=[],n.isMulticastDelegate)for(i=0;i<n.delegates.length;i++)r.delegates.push(n.delegates[i]);else r.delegates.push(n);if(t.isMulticastDelegate)for(i=0;i<t.delegates.length;i++)r.delegates.push(t.delegates[i]);else r.delegates.push(t);return r}function $CreateMulticastDelegateFunction(){var n=null,t=function(){for(var r,i=undefined,t=0;t<n.delegates.length;t++)r=n.delegates[t],i=r.apply(null,arguments);return i};return t.isMulticastDelegate=!0,n=t,t}function $RemoveDelegate(n,t){var i,r,u;if(t==null||n==null)return n;if(n.isMulticastDelegate){if(t.isMulticastDelegate)throw new Error("Multicast to multicast delegate removal is not implemented yet");for(i=$CreateMulticastDelegateFunction(),r=0;r<n.delegates.length;r++)u=n.delegates[r],u!=t&&(i.delegates==null&&(i.delegates=[]),i.delegates.push(u));return i.delegates==null?null:i.delegates.length==1?i.delegates[0]:i}if(t.isMulticastDelegate)throw new Error("single to multicast delegate removal is not supported");return n==t?null:n}function $CombineDelegates(n,t){var r,i;if(n==null)return t;if(t==null)return n;if(r=$CreateMulticastDelegateFunction(),r.delegates=[],n.isMulticastDelegate)for(i=0;i<n.delegates.length;i++)r.delegates.push(n.delegates[i]);else r.delegates.push(n);if(t.isMulticastDelegate)for(i=0;i<t.delegates.length;i++)r.delegates.push(t.delegates[i]);else r.delegates.push(t);return r}function $CreateMulticastDelegateFunction(){var n=null,t=function(){for(var r,i=undefined,t=0;t<n.delegates.length;t++)r=n.delegates[t],i=r.apply(null,arguments);return i};return t.isMulticastDelegate=!0,n=t,t}function $RemoveDelegate(n,t){var i,r,u;if(t==null||n==null)return n;if(n.isMulticastDelegate){if(t.isMulticastDelegate)throw new Error("Multicast to multicast delegate removal is not implemented yet");for(i=$CreateMulticastDelegateFunction(),r=0;r<n.delegates.length;r++)u=n.delegates[r],u!=t&&(i.delegates==null&&(i.delegates=[]),i.delegates.push(u));return i.delegates==null?null:i.delegates.length==1?i.delegates[0]:i}if(t.isMulticastDelegate)throw new Error("single to multicast delegate removal is not supported");return n==t?null:n}var $StaticConstructors=[],$StaticConstructor=function(n){$StaticConstructors.push(n)},AlphaTab,$Inherit,$CreateException,$iKey,$pKey,$CreateDelegate,$CreateAnonymousDelegate,Float32Array,AlphaSynth,i;typeof $Inherit=="undefined"&&($Inherit=function(n,t){var u,r,i;if(typeof Object.getOwnPropertyNames=="undefined"){for(i in t.prototype)(typeof n.prototype[i]=="undefined"||n.prototype[i]==Object.prototype[i])&&(n.prototype[i]=t.prototype[i]);for(i in t)typeof n[i]=="undefined"&&(n[i]=t[i]);n.$baseCtor=t}else{for(u=Object.getOwnPropertyNames(t.prototype),r=0;r<u.length;r++)typeof Object.getOwnPropertyDescriptor(n.prototype,u[r])=="undefined"&&Object.defineProperty(n.prototype,u[r],Object.getOwnPropertyDescriptor(t.prototype,u[r]));for(i in t)typeof n[i]=="undefined"&&(n[i]=t[i]);n.$baseCtor=t}});typeof $CreateException=="undefined"&&($CreateException=function(n,t){t==null&&(t=new Error);n==null&&(n=new System.Exception.ctor);t.message=n.message;t.exception=n;for(var i in n)t[i]=n[i];return t});typeof $CreateAnonymousDelegate=="undefined"&&($CreateAnonymousDelegate=function(n,t){if(n==null||t==null)return t;var i=function(){return t.apply(n,arguments)};return i.func=t,i.target=n,i.isDelegate=!0,i});typeof $CreateDelegate=="undefined"&&(typeof $iKey=="undefined"&&($iKey=0),typeof $pKey=="undefined"&&($pKey=String.fromCharCode(1)),$CreateDelegate=function(n,t){if(n==null||t==null||t.target==n&&t.func==t)return t;n.$delegateCache==null&&(n.$delegateCache={});t.$key==null&&(t.$key=$pKey+String(++$iKey));var i;return n.$delegateCache!=null&&(i=n.$delegateCache[t.$key]),i==null&&(i=function(){return t.apply(n,arguments)},i.func=t,i.target=n,i.isDelegate=!0,n.$delegateCache!=null&&(n.$delegateCache[t.$key]=i)),i});var Int32Array=Int32Array||Array,Uint8Array=Uint8Array||Array,Float32Array=Float32Array||Array;for(AlphaTab=AlphaTab||{},AlphaTab.Environment=function(){},AlphaTab.Environment.PlatformInit=function(){var t,i,n;if(AlphaTab.Environment.RenderEngines.svg=function(){return new AlphaTab.Platform.Svg.FontSvgCanvas},AlphaTab.Environment.RenderEngines["default"]=function(){return new AlphaTab.Platform.Svg.FontSvgCanvas},AlphaTab.Environment.RenderEngines.html5=function(){return new AlphaTab.Platform.JavaScript.Html5Canvas},AlphaTab.Environment.FileLoaders["default"]=function(){return new AlphaTab.Platform.JavaScript.JsFileLoader},AlphaTab.Environment.CheckFontLoad(),Math.log2=Math.log2||function(n){return Math.log(n)*Math.LOG2E},self.document){if(t=document.currentScript,!t)try{if(i=new Error,n=i.stack,!n)throw $CreateException(i,new Error);AlphaTab.Environment.ScriptFile=AlphaTab.Environment.ScriptFileFromStack(n)}catch(r){n=r.stack;n?AlphaTab.Environment.ScriptFile=AlphaTab.Environment.ScriptFileFromStack(n):t=document.querySelector("script[data-alphatab]")}(AlphaTab.Environment.ScriptFile==null||AlphaTab.Environment.ScriptFile.length==0)&&(t?AlphaTab.Environment.ScriptFile=t.src:console.warn("Could not automatically find alphaTab script file for worker, please add the data-alphatab attribute to the script tag that includes alphaTab or provide it when initializing alphaTab"))}},AlphaTab.Environment.ScriptFileFromStack=function(n){var t=n.match("(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?");return!t&&(t=n.match("^(?:|[^:@]*@|.+\\)@(?=data:text\\/javascript|blob|http[s]?|file)|.+?\\s+(?: at |@)(?:[^:\\(]+ )*[\\(]?)(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"),!t&&(t=n.match("\\)@(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"),!t))?null:t[1]},AlphaTab.Environment.CheckFontLoad=function(){var r=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope,t,i,n;if(r){AlphaTab.Environment.IsFontLoaded=!1;return}t=!!document.fonts&&!!document.fonts.load;t?(i=function(){return AlphaTab.Environment.IsFontLoaded=!0,!0},document.fonts.load("1em alphaTab").then(i)):(n=null,n=function(){var t=document.getElementById("alphaTabFontChecker"),i;t==null&&(t=document.createElement("div"),t.setAttribute("id","alphaTabFontChecker"),t.style.opacity="0",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.fontSize="100px",t.classList.add("at"),t.innerHTML="&#57424;",document.body.appendChild(t));i=t.offsetWidth;i>30&&i<100?(AlphaTab.Environment.IsFontLoaded=!0,document.body.removeChild(t)):window.setTimeout(function(){n()},1e3)},window.addEventListener("DOMContentLoaded",function(){n()}))},$StaticConstructor(function(){AlphaTab.Environment.RenderEngines=null;AlphaTab.Environment.FileLoaders=null;AlphaTab.Environment.LayoutEngines=null;AlphaTab.Environment.StaveProfiles=null;AlphaTab.Environment.ScriptFile=null;AlphaTab.Environment.IsFontLoaded=!1;AlphaTab.Environment.RenderEngines={};AlphaTab.Environment.FileLoaders={};AlphaTab.Environment.LayoutEngines={};AlphaTab.Environment.StaveProfiles={};AlphaTab.Environment.PlatformInit();AlphaTab.Environment.LayoutEngines["default"]=function(n){return new AlphaTab.Rendering.Layout.PageViewLayout(n)};AlphaTab.Environment.LayoutEngines.page=function(n){return new AlphaTab.Rendering.Layout.PageViewLayout(n)};AlphaTab.Environment.LayoutEngines.horizontal=function(n){return new AlphaTab.Rendering.Layout.HorizontalScreenLayout(n)};AlphaTab.Environment.StaveProfiles["default"]=AlphaTab.Environment.StaveProfiles["score-tab"]=[new AlphaTab.Rendering.EffectBarRendererFactory("score-effects",[new AlphaTab.Rendering.Effects.TempoEffectInfo,new AlphaTab.Rendering.Effects.TripletFeelEffectInfo,new AlphaTab.Rendering.Effects.MarkerEffectInfo,new AlphaTab.Rendering.Effects.TextEffectInfo,new AlphaTab.Rendering.Effects.ChordsEffectInfo,new AlphaTab.Rendering.Effects.TrillEffectInfo,new AlphaTab.Rendering.Effects.BeatVibratoEffectInfo,new AlphaTab.Rendering.Effects.NoteVibratoEffectInfo,new AlphaTab.Rendering.Effects.AlternateEndingsEffectInfo]),new AlphaTab.Rendering.ScoreBarRendererFactory,new AlphaTab.Rendering.EffectBarRendererFactory("tab-effects",[new AlphaTab.Rendering.Effects.CrescendoEffectInfo,new AlphaTab.Rendering.Effects.DynamicsEffectInfo,new AlphaTab.Rendering.Effects.TrillEffectInfo,new AlphaTab.Rendering.Effects.BeatVibratoEffectInfo,new AlphaTab.Rendering.Effects.NoteVibratoEffectInfo,new AlphaTab.Rendering.Effects.TapEffectInfo,new AlphaTab.Rendering.Effects.FadeInEffectInfo,new AlphaTab.Rendering.Effects.HarmonicsEffectInfo,new AlphaTab.Rendering.Effects.LetRingEffectInfo,new AlphaTab.Rendering.Effects.CapoEffectInfo,new AlphaTab.Rendering.Effects.PalmMuteEffectInfo,new AlphaTab.Rendering.Effects.PickStrokeEffectInfo]),new AlphaTab.Rendering.TabBarRendererFactory];AlphaTab.Environment.StaveProfiles.score=[new AlphaTab.Rendering.EffectBarRendererFactory("score-effects",[new AlphaTab.Rendering.Effects.TempoEffectInfo,new AlphaTab.Rendering.Effects.TripletFeelEffectInfo,new AlphaTab.Rendering.Effects.MarkerEffectInfo,new AlphaTab.Rendering.Effects.TextEffectInfo,new AlphaTab.Rendering.Effects.ChordsEffectInfo,new AlphaTab.Rendering.Effects.TrillEffectInfo,new AlphaTab.Rendering.Effects.BeatVibratoEffectInfo,new AlphaTab.Rendering.Effects.NoteVibratoEffectInfo,new AlphaTab.Rendering.Effects.FadeInEffectInfo,new AlphaTab.Rendering.Effects.LetRingEffectInfo,new AlphaTab.Rendering.Effects.PalmMuteEffectInfo,new AlphaTab.Rendering.Effects.PickStrokeEffectInfo,new AlphaTab.Rendering.Effects.AlternateEndingsEffectInfo]),new AlphaTab.Rendering.ScoreBarRendererFactory,new AlphaTab.Rendering.EffectBarRendererFactory("score-bottom-effects",[new AlphaTab.Rendering.Effects.CrescendoEffectInfo,new AlphaTab.Rendering.Effects.DynamicsEffectInfo])];AlphaTab.Environment.StaveProfiles.tab=[new AlphaTab.Rendering.EffectBarRendererFactory("tab-effects",[new AlphaTab.Rendering.Effects.TempoEffectInfo,new AlphaTab.Rendering.Effects.TripletFeelEffectInfo,new AlphaTab.Rendering.Effects.MarkerEffectInfo,new AlphaTab.Rendering.Effects.TextEffectInfo,new AlphaTab.Rendering.Effects.ChordsEffectInfo,new AlphaTab.Rendering.Effects.TripletFeelEffectInfo,new AlphaTab.Rendering.Effects.TrillEffectInfo,new AlphaTab.Rendering.Effects.BeatVibratoEffectInfo,new AlphaTab.Rendering.Effects.NoteVibratoEffectInfo,new AlphaTab.Rendering.Effects.TapEffectInfo,new AlphaTab.Rendering.Effects.FadeInEffectInfo,new AlphaTab.Rendering.Effects.HarmonicsEffectInfo,new AlphaTab.Rendering.Effects.LetRingEffectInfo,new AlphaTab.Rendering.Effects.CapoEffectInfo,new AlphaTab.Rendering.Effects.PalmMuteEffectInfo,new AlphaTab.Rendering.Effects.PickStrokeEffectInfo,new AlphaTab.Rendering.Effects.AlternateEndingsEffectInfo]),new AlphaTab.Rendering.TabBarRendererFactory]}),AlphaTab.Model=AlphaTab.Model||{},AlphaTab.Model.JsonConverter=function(){},AlphaTab.Model.JsonConverter.prototype={ScoreToJsObject:function(n){var s={},f,r,v,o,i,et,ht,p,w,ot,b,k,c,d,g,l,nt,e,u,tt,st,it,rt,a,t,h;for(AlphaTab.Model.Score.CopyTo(n,s),s.MasterBars=[],s.Tracks=[],t=0;t<n.MasterBars.length;t++)f=n.MasterBars[t],r={},AlphaTab.Model.MasterBar.CopyTo(f,r),f.TempoAutomation!=null&&(r.TempoAutomation={},AlphaTab.Model.Automation.CopyTo(f.TempoAutomation,r.TempoAutomation)),f.VolumeAutomation!=null&&(r.VolumeAutomation={},AlphaTab.Model.Automation.CopyTo(f.VolumeAutomation,r.VolumeAutomation)),f.Section!=null&&(r.Section={},AlphaTab.Model.Section.CopyTo(f.Section,r.Section)),s.MasterBars.push(r);for(v=0;v<n.Tracks.length;v++){o=n.Tracks[v];i={};i.Color={};AlphaTab.Model.Track.CopyTo(o,i);i.PlaybackInfo={};AlphaTab.Model.PlaybackInformation.CopyTo(o.PlaybackInfo,i.PlaybackInfo);i.Chords={};for(var y=0,ut=Object.keys(o.Chords),ct=ut.length,ft=ut[y];y<ct;y++,ft=ut[y])et=o.Chords[ft],ht={},AlphaTab.Model.Chord.CopyTo(et,ht),i.Chords[ft]=et;for(i.Staves=[],p=0;p<o.Staves.length;p++){for(w=o.Staves[p],ot={},ot.Bars=[],b=0;b<w.Bars.length;b++){for(k=w.Bars[b],c={},AlphaTab.Model.Bar.CopyTo(k,c),c.Voices=[],d=0;d<k.Voices.length;d++){for(g=k.Voices[d],l={},AlphaTab.Model.Voice.CopyTo(g,l),l.Beats=[],nt=0;nt<g.Beats.length;nt++){for(e=g.Beats[nt],u={},AlphaTab.Model.Beat.CopyTo(e,u),u.Automations=[],tt=0;tt<e.Automations.length;tt++)st={},AlphaTab.Model.Automation.CopyTo(e.Automations[tt],st),u.Automations.push(st);for(u.WhammyBarPoints=[],t=0;t<e.WhammyBarPoints.length;t++)h={},AlphaTab.Model.BendPoint.CopyTo(e.WhammyBarPoints[t],h),u.WhammyBarPoints.push(h);for(u.Notes=[],it=0;it<e.Notes.length;it++){for(rt=e.Notes[it],a={},AlphaTab.Model.Note.CopyTo(rt,a),a.BendPoints=[],t=0;t<rt.BendPoints.length;t++)h={},AlphaTab.Model.BendPoint.CopyTo(rt.BendPoints[t],h),a.BendPoints.push(h);u.Notes.push(a)}l.Beats.push(u)}c.Voices.push(l)}ot.Bars.push(c)}i.Staves.push(w)}s.Tracks.push(i)}return s},JsObjectToScore:function(n){var h=new AlphaTab.Model.Score,r,i,l,u,e,st,ft,c,et,v,y,p,w,b,k,d,f,o,g,ot,nt,tt,it,t,s;for(AlphaTab.Model.Score.CopyTo(n,h),t=0;t<n.MasterBars.length;t++)r=n.MasterBars[t],i=new AlphaTab.Model.MasterBar,AlphaTab.Model.MasterBar.CopyTo(r,i),r.TempoAutomation!=null&&(i.TempoAutomation=new AlphaTab.Model.Automation,AlphaTab.Model.Automation.CopyTo(r.TempoAutomation,i.TempoAutomation)),r.VolumeAutomation!=null&&(i.VolumeAutomation=new AlphaTab.Model.Automation,AlphaTab.Model.Automation.CopyTo(r.VolumeAutomation,i.VolumeAutomation)),r.Section!=null&&(i.Section=new AlphaTab.Model.Section,AlphaTab.Model.Section.CopyTo(r.Section,i.Section)),h.AddMasterBar(i);for(l=0;l<n.Tracks.length;l++){u=n.Tracks[l];e=new AlphaTab.Model.Track(u.Staves.length);AlphaTab.Model.Track.CopyTo(u,e);h.AddTrack(e);AlphaTab.Model.PlaybackInformation.CopyTo(u.PlaybackInfo,e.PlaybackInfo);for(var a=0,rt=Object.keys(u.Chords),ht=rt.length,ut=rt[a];a<ht;a++,ut=rt[a])st=u.Chords[ut],ft=new AlphaTab.Model.Chord,AlphaTab.Model.Chord.CopyTo(st,ft),e.Chords[ut]=ft;for(c=0;c<u.Staves.length;c++)for(et=u.Staves[c],v=0;v<et.Bars.length;v++)for(y=et.Bars[v],p=new AlphaTab.Model.Bar,AlphaTab.Model.Bar.CopyTo(y,p),e.AddBarToStaff(c,p),w=0;w<y.Voices.length;w++)for(b=y.Voices[w],k=new AlphaTab.Model.Voice,AlphaTab.Model.Voice.CopyTo(b,k),p.AddVoice(k),d=0;d<b.Beats.length;d++){for(f=b.Beats[d],o=new AlphaTab.Model.Beat,AlphaTab.Model.Beat.CopyTo(f,o),k.AddBeat(o),g=0;g<f.Automations.length;g++)ot=new AlphaTab.Model.Automation,AlphaTab.Model.Automation.CopyTo(f.Automations[g],ot),o.Automations.push(ot);for(t=0;t<f.WhammyBarPoints.length;t++)s=new AlphaTab.Model.BendPoint(0,0),AlphaTab.Model.BendPoint.CopyTo(f.WhammyBarPoints[t],s),o.WhammyBarPoints.push(s);for(nt=0;nt<f.Notes.length;nt++)for(tt=f.Notes[nt],it=new AlphaTab.Model.Note,AlphaTab.Model.Note.CopyTo(tt,it),o.AddNote(it),t=0;t<tt.BendPoints.length;t++)s=new AlphaTab.Model.BendPoint(0,0),AlphaTab.Model.BendPoint.CopyTo(tt.BendPoints[t],s),it.AddBendPoint(s)}}return h.Finish(),h}},AlphaTab.Platform=AlphaTab.Platform||{},AlphaTab.Platform.JavaScript=AlphaTab.Platform.JavaScript||{},AlphaTab.Platform.JavaScript.ResizeEventArgs=function(){this.OldWidth=0;this.NewWidth=0;this.Settings=null},AlphaTab.Platform.JavaScript.JsApiBase=function(n,t){var r,i,s,f,e,u,o;this.Element=null;this.CanvasElement=null;this.Settings=null;this.TrackIndexes=null;this.AutoSize=!1;this._visibilityCheckerInterval=0;this._visibilityCheckerIntervalId=0;this._renderResults=null;this._totalResultCount=0;this.Renderer=null;this.Score=null;this.Element=n;r=this.Element.dataset;i=this.Settings=AlphaTab.Settings.FromJson(t);s=t!=null&&t.tracks?t.tracks:n!=null&&n.dataset!=null&&r.tracks!=null?r.tracks:0;this.SetTracks(s,!1);f="";n!=null&&(n.dataset!=null&&r.tex!=null&&n.innerText&&(f=n.innerHTML.trim(),n.innerHTML=""),this.CanvasElement=document.createElement("div"),this.CanvasElement.className="alphaTabSurface",this.CanvasElement.style.fontSize="0",this.CanvasElement.style.overflow="hidden",this.CanvasElement.style.lineHeight="0",n.appendChild(this.CanvasElement),(i.Engine=="default"||i.Engine=="svg")&&(window.addEventListener("scroll",$CreateAnonymousDelegate(this,function(){this.ShowSvgsInViewPort()})),window.addEventListener("resize",$CreateAnonymousDelegate(this,function(){this.ShowSvgsInViewPort()}))),this.AutoSize=i.Width<0,this.AutoSize&&(i.Width=n.offsetWidth,e=0,window.addEventListener("resize",$CreateAnonymousDelegate(this,function(){clearTimeout(e);e=setTimeout($CreateAnonymousDelegate(this,function(){n.offsetWidth!=i.Width&&this.TriggerResize()}),1)}))));this.CreateStyleElement(i);n!=null&&this.AutoSize&&(u=new AlphaTab.Platform.JavaScript.ResizeEventArgs,u.OldWidth=0,u.NewWidth=n.offsetWidth,u.Settings=i,this.TriggerEvent("resize",u),i.Width=u.NewWidth);this.Renderer=this.CreateScoreRenderer(i);this.Renderer.add_RenderFinished($CreateAnonymousDelegate(this,function(){this.TriggerEvent("rendered",null)}));this.Renderer.add_PostRenderFinished($CreateAnonymousDelegate(this,function(){this.TriggerEvent("post-rendered",null)}));this.Renderer.add_PreRender($CreateAnonymousDelegate(this,function(n){this._renderResults=[];this._totalResultCount=0;this.AppendRenderResult(n)}));this.Renderer.add_PartialRenderFinished($CreateDelegate(this,this.AppendRenderResult));this.Renderer.add_RenderFinished($CreateAnonymousDelegate(this,function(n){this.AppendRenderResult(n);this.AppendRenderResult(null)}));o=$CreateAnonymousDelegate(this,function(){this.AutoSize&&(this.Settings.Width=this.Element.offsetWidth,this.Renderer.UpdateSettings(i));f==null||f.length==0?t&&t.file?this.Load(t.file):this.Element==null||this.Element.dataset==null||r.file==null||r.file.length==0?this.Element==null||this.Element.getAttribute("data-file")==null||this.Element.getAttribute("data-file").length==0||this.Load(this.Element.getAttribute("data-file")):this.Load(r.file):this.Tex(f)});this._visibilityCheckerInterval=t&&t.visibilityCheckInterval||500;this.get_IsElementVisible()?o():(AlphaTab.Util.Logger.Warning("Rendering","AlphaTab container is invisible, checking for element visibility in "+this._visibilityCheckerInterval+"ms intervals"),this._visibilityCheckerIntervalId=setInterval($CreateAnonymousDelegate(this,function(){this.get_IsElementVisible()&&(AlphaTab.Util.Logger.Info("Rendering","AlphaTab container became visible, triggering initial rendering"),o(),clearInterval(this._visibilityCheckerIntervalId),this._visibilityCheckerIntervalId=0)}),this._visibilityCheckerInterval))},AlphaTab.Platform.JavaScript.JsApiBase.prototype={get_IsElementVisible:function(){return!!(this.Element.offsetWidth||this.Element.offsetHeight||this.Element.getClientRects().length)},TriggerResize:function(){if(this.get_IsElementVisible()){this._visibilityCheckerIntervalId!=0&&(AlphaTab.Util.Logger.Info("Rendering","AlphaTab container became visible again, doing autosizing"),clearInterval(this._visibilityCheckerIntervalId),this._visibilityCheckerIntervalId=0);var n=new AlphaTab.Platform.JavaScript.ResizeEventArgs;n.OldWidth=this.Settings.Width;n.NewWidth=this.Element.offsetWidth;n.Settings=this.Settings;this.TriggerEvent("resize",n);this.Settings.Width=n.NewWidth;this.Renderer.UpdateSettings(this.Settings);this.Renderer.Resize(this.Element.offsetWidth)}else this._visibilityCheckerIntervalId==0&&(AlphaTab.Util.Logger.Warning("Rendering","AlphaTab container was invisible while autosizing, checking for element visibility in "+this._visibilityCheckerInterval+"ms intervals"),this._visibilityCheckerIntervalId=setInterval($CreateDelegate(this,this.TriggerResize),this._visibilityCheckerInterval))},ShowSvgsInViewPort:function(){for(var t,i=this.CanvasElement.querySelectorAll("[data-lazy=true]"),n=0,u=i.length,r=i[n];n<u;n++,r=i[n])t=r,AlphaTab.Platform.JavaScript.JsApiBase.IsElementInViewPort(t)&&(t.outerHTML=t.svg)},AppendRenderResult:function(n){n!=null&&(this.CanvasElement.style.width=n.TotalWidth+"px",this.CanvasElement.style.height=n.TotalHeight+"px");(n==null||n.RenderResult!=null)&&(this._renderResults.push(n),setTimeout($CreateAnonymousDelegate(this,function(){for(var t,i,n;this._renderResults.length>0;)if(t=this._renderResults[0],this._renderResults.splice(0,1),t==null)while(this.CanvasElement.childElementCount>this._totalResultCount)this.CanvasElement.removeChild(this.CanvasElement.lastChild);else i=t.RenderResult,typeof i=="string"?(this._totalResultCount<this.CanvasElement.childElementCount?n=this.CanvasElement.children[this._totalResultCount]:(n=document.createElement("div"),this.CanvasElement.appendChild(n)),n.style.width=t.Width+"px",n.style.height=t.Height+"px",n.style.display="inline-block",AlphaTab.Platform.JavaScript.JsApiBase.IsElementInViewPort(n)?n.outerHTML=i:(n.svg=i,n.setAttribute("data-lazy","true"))):this._totalResultCount<this.CanvasElement.childElementCount?this.CanvasElement.replaceChild(t.RenderResult,this.CanvasElement.children[this._totalResultCount]):this.CanvasElement.appendChild(t.RenderResult),this._totalResultCount++}),1))},CreateStyleElement:function(n){var i=document.getElementById("alphaTabStyle"),r,t;i==null&&(r=n.ScriptFile,r=r.substr(0,r.lastIndexOf("/"))+"/Font/",i=document.createElement("style"),i.id="alphaTabStyle",i.type="text/css",t=new String,t+="@font-face {\r\n",t+="    font-family: 'alphaTab';\r\n",t+="     src: url('../../fonts/Bravura.eot');\r\n",t+="     src: url('../../fonts/Bravura.eot?#iefix') format('embedded-opentype')\r\n",t+="          , url('../../fonts/Bravura.woff') format('woff')\r\n",t+="          , url('../../fonts/Bravura.otf') format('opentype')\r\n",t+="          , url('../../fonts/Bravura.svg#Bravura') format('svg');\r\n",t+="     font-weight: normal;\r\n",t+="     font-style: normal;\r\n",t+="}\r\n",t+=".alphaTabSurface * {\r\n",t+="    cursor: default;\r\n",t+="}\r\n",t+=".at {\r\n",t+="     font-family: 'alphaTab';\r\n",t+="     speak: none;\r\n",t+="     font-style: normal;\r\n",t+="     font-weight: normal;\r\n",t+="     font-variant: normal;\r\n",t+="     text-transform: none;\r\n",t+="     line-height: 1;\r\n",t+="     line-height: 1;\r\n",t+="     -webkit-font-smoothing: antialiased;\r\n",t+="     -moz-osx-font-smoothing: grayscale;\r\n",t+="     font-size: 34px;\r\n",t+="     overflow: visible !important;\r\n",t+="}\r\n",i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i))},get_Tracks:function(){for(var n=[],t=0,r=this.TrackIndexes,u=r.length,i=r[t];t<u;t++,i=r[t])i>=0&&i<this.Score.Tracks.length&&n.push(this.Score.Tracks[i]);return n.length==0&&this.Score.Tracks.length>0&&n.push(this.Score.Tracks[0]),n.slice(0)},SetTracks:function(n,t){var r=[],i,u;if(typeof n=="string")try{n=JSON.parse(n)}catch(f){n=new Int32Array([0])}if(typeof n=="number")r.push(n);else if(n.length)for(i=0;i<n.length;i++)u=typeof n[i]=="number"?n[i]:AlphaTab.Platform.Std.ParseInt(n[i].ToString()),u>=0&&r.push(u);this.TrackIndexes=r.slice(0);t&&this.Render()},ScoreLoaded:function(n,t){this.Score=n;this.TriggerEvent("loaded",n);t&&this.Render()},TriggerEvent:function(n,t){if(this.Element!=null){var i=document.createEvent("CustomEvent");i.initCustomEvent(n,!1,!1,t);this.Element.dispatchEvent(i)}}},AlphaTab.Platform.JavaScript.JsApiBase.IsElementInViewPort=function(n){var t=n.getBoundingClientRect();return t.top+t.height>=0&&t.top<=window.innerHeight&&t.left+t.width>=0&&t.left<=window.innerWidth},AlphaTab.Platform.JavaScript.JsWorkerApi=function(n,t){AlphaTab.Platform.JavaScript.JsApiBase.call(this,n,t)},AlphaTab.Platform.JavaScript.JsWorkerApi.prototype={CreateScoreRenderer:function(n){var t=new AlphaTab.Platform.JavaScript.WorkerScoreRenderer(n);return t.add_ScoreLoaded($CreateAnonymousDelegate(this,function(n){this.ScoreLoaded(n,!1)})),t.add_PostRenderFinished($CreateAnonymousDelegate(this,function(){this.Element.className=this.Element.className.replace(" loading","").replace(" rendering","")})),t},Load:function(n){if(this.Element.className+=" loading",typeof n=="string"){var t=new AlphaTab.Platform.JavaScript.JsFileLoader;t.LoadBinaryAsync(n,$CreateAnonymousDelegate(this,function(n){this.Renderer.Load(n,this.TrackIndexes)}),$CreateAnonymousDelegate(this,function(n){console.error(n)}))}else this.Renderer.Load(n,this.TrackIndexes)},Render:function(){this.Renderer!=null&&(this.Element.className+=" rendering",this.Renderer.RenderMultiple(this.TrackIndexes))},Tex:function(n){this.Element.className+=" loading";this.Renderer.Tex(n)}},$Inherit(AlphaTab.Platform.JavaScript.JsWorkerApi,AlphaTab.Platform.JavaScript.JsApiBase),AlphaTab.Platform.JavaScript.JsWorker=function(n,t){this._renderer=null;this._main=null;this._trackIndexes=null;this.Score=null;this._main=n;this._main.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1);var i=AlphaTab.Settings.FromJson(t);this._renderer=new AlphaTab.Rendering.ScoreRenderer(i);this._renderer.add_PartialRenderFinished($CreateAnonymousDelegate(this,function(n){this._main.postMessage({cmd:"partialRenderFinished",result:n})}));this._renderer.add_RenderFinished($CreateAnonymousDelegate(this,function(n){this._main.postMessage({cmd:"renderFinished",result:n})}));this._renderer.add_PostRenderFinished($CreateAnonymousDelegate(this,function(){this._main.postMessage({cmd:"postRenderFinished",boundsLookup:this._renderer.BoundsLookup.ToJson()})}));this._renderer.add_PreRender($CreateAnonymousDelegate(this,function(n){this._main.postMessage({cmd:"preRender",result:n})}))},AlphaTab.Platform.JavaScript.JsWorker.prototype={get_Tracks:function(){for(var n=[],t=0,r=this._trackIndexes,u=r.length,i=r[t];t<u;t++,i=r[t])i>=0&&i<this.Score.Tracks.length&&n.push(this.Score.Tracks[i]);return n.length==0&&this.Score.Tracks.length>0&&n.push(this.Score.Tracks[0]),n.slice(0)},HandleMessage:function(n){var t=n.data,i=t.cmd;switch(i){case"load":this.Load(t.data,t.indexes);break;case"invalidate":this._renderer.Invalidate();break;case"resize":this._renderer.Resize(t.width);break;case"tex":this.Tex(t.data);break;case"renderMultiple":this.RenderMultiple(t.data);break;case"updateSettings":this.UpdateSettings(t.settings)}},UpdateSettings:function(n){this._renderer.UpdateSettings(AlphaTab.Settings.FromJson(n))},RenderMultiple:function(n){this._trackIndexes=n;this.Render()},Tex:function(n){try{var t=new AlphaTab.Importer.AlphaTexImporter,i=AlphaTab.IO.ByteBuffer.FromBuffer(AlphaTab.Platform.Std.StringToByteArray(n));t.Init(i);this._trackIndexes=new Int32Array([0]);this.ScoreLoaded(t.ReadScore())}catch(r){this.Error(r)}},Load:function(n,t){try{this._trackIndexes=t;n instanceof ArrayBuffer?this.ScoreLoaded(AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(new Uint8Array(n))):n instanceof Uint8Array?this.ScoreLoaded(AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(n)):typeof n=="string"&&AlphaTab.Importer.ScoreLoader.LoadScoreAsync(n,$CreateDelegate(this,this.ScoreLoaded),$CreateDelegate(this,this.Error))}catch(i){this.Error(i)}},Error:function(n){this._main.postMessage({cmd:"error",exception:n})},ScoreLoaded:function(n){this.Score=n;var t=new AlphaTab.Model.JsonConverter;this._main.postMessage({cmd:"loaded",score:t.ScoreToJsObject(n)});this.Render()},Render:function(){this._renderer.RenderMultiple(this.get_Tracks())}},AlphaTab.Platform.JavaScript.Html5Canvas=function(){var n,t;this._canvas=null;this._context=null;this._color=null;this._font=null;this._musicFont=null;this._Resources=null;this._color=new AlphaTab.Platform.Model.Color(0,0,0,255);n=document.createElement("span");n.classList.add("at");document.body.appendChild(n);t=window.getComputedStyle(n,null);this._musicFont=new AlphaTab.Platform.Model.Font(t.fontFamily,AlphaTab.Platform.Std.ParseFloat(t.fontSize),AlphaTab.Platform.Model.FontStyle.Plain)},AlphaTab.Platform.JavaScript.Html5Canvas.prototype={get_Resources:function(){return this._Resources},set_Resources:function(n){this._Resources=n},OnPreRender:function(){return null},OnRenderFinished:function(){return null},BeginRender:function(n,t){this._canvas=document.createElement("canvas");this._canvas.width=n|0;this._canvas.height=t|0;this._canvas.style.width=n+"px";this._canvas.style.height=t+"px";this._context=this._canvas.getContext("2d");this._context.textBaseline="top"},EndRender:function(){var n=this._canvas;return this._canvas=null,n},get_Color:function(){return this._color},set_Color:function(n){this._color.RGBA!=n.RGBA&&(this._color=n,this._context.strokeStyle=n.RGBA,this._context.fillStyle=n.RGBA)},get_LineWidth:function(){return this._context.lineWidth},set_LineWidth:function(n){this._context.lineWidth=n},FillRect:function(n,t,i,r){i>0&&this._context.fillRect(n|0-.5,t|0-.5,i,r)},StrokeRect:function(n,t,i,r){this._context.strokeRect(n-.5,t-.5,i,r)},BeginPath:function(){this._context.beginPath()},ClosePath:function(){this._context.closePath()},MoveTo:function(n,t){this._context.moveTo(n-.5,t-.5)},LineTo:function(n,t){this._context.lineTo(n-.5,t-.5)},QuadraticCurveTo:function(n,t,i,r){this._context.quadraticCurveTo(n,t,i,r)},BezierCurveTo:function(n,t,i,r,u,f){this._context.bezierCurveTo(n,t,i,r,u,f)},FillCircle:function(n,t,i){this._context.beginPath();this._context.arc(n,t,i,0,6.28318530717959,!0);this.Fill()},Fill:function(){this._context.fill()},Stroke:function(){this._context.stroke()},get_Font:function(){return this._font},set_Font:function(n){this._font=n;this._context.font=n.ToCssString(1)},get_TextAlign:function(){switch(this._context.textAlign){case"left":return AlphaTab.Platform.Model.TextAlign.Left;case"center":return AlphaTab.Platform.Model.TextAlign.Center;case"right":return AlphaTab.Platform.Model.TextAlign.Right;default:return AlphaTab.Platform.Model.TextAlign.Left}},set_TextAlign:function(n){switch(n){case AlphaTab.Platform.Model.TextAlign.Left:this._context.textAlign="left";break;case AlphaTab.Platform.Model.TextAlign.Center:this._context.textAlign="center";break;case AlphaTab.Platform.Model.TextAlign.Right:this._context.textAlign="right"}},get_TextBaseline:function(){switch(this._context.textBaseline){case"top":return AlphaTab.Platform.Model.TextBaseline.Top;case"middle":return AlphaTab.Platform.Model.TextBaseline.Middle;case"bottom":return AlphaTab.Platform.Model.TextBaseline.Bottom;default:return AlphaTab.Platform.Model.TextBaseline.Top}},set_TextBaseline:function(n){switch(n){case AlphaTab.Platform.Model.TextBaseline.Top:this._context.textBaseline="top";break;case AlphaTab.Platform.Model.TextBaseline.Middle:this._context.textBaseline="middle";break;case AlphaTab.Platform.Model.TextBaseline.Bottom:this._context.textBaseline="bottom"}},BeginGroup:function(){},EndGroup:function(){},FillText:function(n,t,i){this._context.fillText(n,t,i)},MeasureText:function(n){return this._context.measureText(n).width},FillMusicFontSymbol:function(n,t,i,r){if(r!=AlphaTab.Rendering.Glyphs.MusicFontSymbol.None){var u=this._context.textBaseline,f=this._context.font;this._context.font=this._musicFont.ToCssString(i);this._context.textBaseline="middle";this._context.fillText(String.fromCharCode(r),n,t);this._context.textBaseline=u;this._context.font=f}}},AlphaTab.Platform.JavaScript.JsApi=function(n,t){AlphaTab.Platform.JavaScript.JsApiBase.call(this,n,t)},AlphaTab.Platform.JavaScript.JsApi.prototype={CreateScoreRenderer:function(n){return new AlphaTab.Rendering.ScoreRenderer(n)},Load:function(n){n instanceof ArrayBuffer?this.ScoreLoaded(AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(new Uint8Array(n)),!0):n instanceof Uint8Array?this.ScoreLoaded(AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(n),!0):typeof n=="string"&&AlphaTab.Importer.ScoreLoader.LoadScoreAsync(n,$CreateAnonymousDelegate(this,function(n){this.ScoreLoaded(n,!0)}),$CreateAnonymousDelegate(this,function(n){console.error(n)}))},Tex:function(n){var t=new AlphaTab.Importer.AlphaTexImporter,i=AlphaTab.IO.ByteBuffer.FromBuffer(AlphaTab.Platform.Std.StringToByteArray(n));t.Init(i);this.ScoreLoaded(t.ReadScore(),!0)},Render:function(){var t,n;this.Renderer!=null&&(t=this.Renderer.Canvas,t instanceof AlphaTab.Platform.JavaScript.Html5Canvas?(n=null,n=$CreateAnonymousDelegate(this,function(){AlphaTab.Environment.IsFontLoaded?this.Renderer.RenderMultiple(this.get_Tracks()):window.setTimeout($CreateAnonymousDelegate(this,function(){n()}),1e3)}),n()):this.Renderer.RenderMultiple(this.get_Tracks()))}},$Inherit(AlphaTab.Platform.JavaScript.JsApi,AlphaTab.Platform.JavaScript.JsApiBase),AlphaTab.Platform.JavaScript.JsFileLoader=function(){},AlphaTab.Platform.JavaScript.JsFileLoader.prototype={LoadBinary:function(n){var t=new XMLHttpRequest,e;if(t.open("GET",n,!1),t.responseType="arraybuffer",t.responseType!="arraybuffer"){for(var f=VbAjaxLoader("GET",n),r=f.toArray(),u=new String,i=0;i<r.length-1;)u+=String.fromCharCode(r[i]),i++;return AlphaTab.Platform.JavaScript.JsFileLoader.GetBytesFromString(u)}if(t.send(),t.status==200)return new Uint8Array(t.response);if(t.status==0)throw $CreateException(new AlphaTab.IO.FileLoadException("You are offline!!\n Please Check Your Network."),new Error);if(t.status==404)throw $CreateException(new AlphaTab.IO.FileLoadException("Requested URL not found."),new Error);if(t.status==500)throw $CreateException(new AlphaTab.IO.FileLoadException("Internel Server Error."),new Error);if(t.statusText=="parsererror")throw $CreateException(new AlphaTab.IO.FileLoadException("Error.\nParsing JSON Request failed."),new Error);if(t.statusText=="timeout")throw $CreateException(new AlphaTab.IO.FileLoadException("Request Time out."),new Error);throw $CreateException(new AlphaTab.IO.FileLoadException("Unknow Error: "+t.responseText),new Error);},LoadBinaryAsync:function(n,t,i){var r=new XMLHttpRequest,o;if(r.open("GET",n),r.responseType="arraybuffer",r.onreadystatechange=$CreateAnonymousDelegate(this,function(){if(r.readyState==4)if(r.status==200){var n=new Uint8Array(r.response);t(n)}else r.status==0?i(new AlphaTab.IO.FileLoadException("You are offline!!\n Please Check Your Network.")):r.status==404?i(new AlphaTab.IO.FileLoadException("Requested URL not found.")):r.status==500?i(new AlphaTab.IO.FileLoadException("Internel Server Error.")):r.statusText=="parsererror"?i(new AlphaTab.IO.FileLoadException("Error.\nParsing JSON Request failed.")):r.statusText=="timeout"?i(new AlphaTab.IO.FileLoadException("Request Time out.")):i(new AlphaTab.IO.FileLoadException("Unknow Error: "+r.responseText))}),r.open("GET",n,!0),r.responseType="arraybuffer",r.responseType!="arraybuffer"){for(var s=VbAjaxLoader("GET",n),f=s.toArray(),e=new String,u=0;u<f.length-1;)e+=f[u],u++;o=AlphaTab.Platform.JavaScript.JsFileLoader.GetBytesFromString(e);t(o);return}r.send()}},AlphaTab.Platform.JavaScript.JsFileLoader.GetIEVersion=function(){var t=-1,r=navigator.appName,u=navigator.userAgent,i,n;return r=="Microsoft Internet Explorer"&&(i=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),n=i.exec(u),n!=null&&(t=AlphaTab.Platform.Std.ParseFloat(n[1]))),t},AlphaTab.Platform.JavaScript.JsFileLoader.GetBytesFromString=function(n){for(var i=new Uint8Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i},AlphaTab.Platform.JavaScript.WorkerScoreRenderer=function(n){this._worker=null;this.PreRender=null;this.PartialRenderFinished=null;this.RenderFinished=null;this.PostRenderFinished=null;this.ScoreLoaded=null;this.BoundsLookup=null;this.Score=null;this._worker=new Worker(this.CreateWorkerUrl());this._worker.postMessage({cmd:"initialize",settings:n.ToJson()});this._worker.addEventListener("message",$CreateDelegate(this,this.HandleWorkerMessage),!1)},AlphaTab.Platform.JavaScript.WorkerScoreRenderer.prototype={CreateWorkerUrl:function(){var i="self.onmessage = function(e) {\r\n                if(e.data.cmd == 'initialize') {\r\n                    importScripts(e.data.settings.atRoot);\r\n                    new AlphaTab.Platform.JavaScript.JsWorker(self, e.data.settings);\r\n                }\r\n            }",n,t;window.URL=window.URL||window.webkitURL;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;try{n=new Blob([i],{type:"application/javascript"})}catch(r){t=new BlobBuilder;t.append(i);n=t.getBlob()}return URL.createObjectURL(n)},UpdateSettings:function(n){this._worker.postMessage({cmd:"updateSettings",settings:n.ToJson()})},Invalidate:function(){this._worker.postMessage({cmd:"invalidate"})},Resize:function(n){this._worker.postMessage({cmd:"resize",width:n})},Load:function(n,t){this._worker.postMessage({cmd:"load",data:n,indexes:t})},HandleWorkerMessage:function(n){var t=n.data,u=t.cmd,i,r;switch(u){case"preRender":this.OnPreRender(t.result);break;case"partialRenderFinished":this.OnPartialRenderFinished(t.result);break;case"renderFinished":this.OnRenderFinished(t.result);break;case"postRenderFinished":this.BoundsLookup=AlphaTab.Rendering.Utils.BoundsLookup.FromJson(t.boundsLookup,this.Score);this.OnPostRenderFinished();break;case"error":console.error(t.exception);break;case"loaded":i=t.score;i&&(r=new AlphaTab.Model.JsonConverter,i=r.JsObjectToScore(i));this.Score=i;this.OnLoaded(i)}},RenderMultiple:function(n){this._worker.postMessage({cmd:"renderMultiple",data:n})},add_PreRender:function(n){this.PreRender=$CombineDelegates(this.PreRender,n)},remove_PreRender:function(n){this.PreRender=$RemoveDelegate(this.PreRender,n)},OnPreRender:function(n){var t=this.PreRender;t!=null&&t(n)},add_PartialRenderFinished:function(n){this.PartialRenderFinished=$CombineDelegates(this.PartialRenderFinished,n)},remove_PartialRenderFinished:function(n){this.PartialRenderFinished=$RemoveDelegate(this.PartialRenderFinished,n)},OnPartialRenderFinished:function(n){var t=this.PartialRenderFinished;t!=null&&t(n)},add_RenderFinished:function(n){this.RenderFinished=$CombineDelegates(this.RenderFinished,n)},remove_RenderFinished:function(n){this.RenderFinished=$RemoveDelegate(this.RenderFinished,n)},OnRenderFinished:function(n){var t=this.RenderFinished;t!=null&&t(n)},add_PostRenderFinished:function(n){this.PostRenderFinished=$CombineDelegates(this.PostRenderFinished,n)},remove_PostRenderFinished:function(n){this.PostRenderFinished=$RemoveDelegate(this.PostRenderFinished,n)},OnPostRenderFinished:function(){var n=this.PostRenderFinished;n!=null&&n()},add_ScoreLoaded:function(n){this.ScoreLoaded=$CombineDelegates(this.ScoreLoaded,n)},remove_ScoreLoaded:function(n){this.ScoreLoaded=$RemoveDelegate(this.ScoreLoaded,n)},OnLoaded:function(n){var t=this.ScoreLoaded;t!=null&&t(n)},Tex:function(n){this._worker.postMessage({cmd:"tex",data:n})}},AlphaTab.Platform.Std=function(){},$StaticConstructor(function(){AlphaTab.Platform.Std._parseXml=null}),AlphaTab.Platform.Std.ParseFloat=function(n){return parseFloat(n)},AlphaTab.Platform.Std.Log=function(n,t){switch(t){case AlphaTab.Util.LogLevel.Debug:console.debug(n);break;case AlphaTab.Util.LogLevel.Info:console.info(n);break;case AlphaTab.Util.LogLevel.Warning:console.warn(n);break;case AlphaTab.Util.LogLevel.Error:console.err(n)}},AlphaTab.Platform.Std.ParseInt=function(n){var t=parseInt(n);return isNaN(t)?-2147483648:t},AlphaTab.Platform.Std.CloneArray=function(){return new Int32Array(0)},AlphaTab.Platform.Std.BlockCopy=function(){},AlphaTab.Platform.Std.IsNullOrWhiteSpace=function(n){return n==null||n.trim().length==0},AlphaTab.Platform.Std.StringFromCharCode=function(){return""},AlphaTab.Platform.Std.LoadXml=function(n){if(AlphaTab.Platform.Std._parseXml==null){var t=null;if(typeof DOMParser!="undefined")t=function(n){return(new window.DOMParser).parseFromString(n,"text/xml")};else if(typeof ActiveXObject!="undefined"&&new window.ActiveXObject("Microsoft.XMLDOM"))t=function(n){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(n),t};else throw new Error("No XML parser found");AlphaTab.Platform.Std._parseXml=t}return AlphaTab.Platform.Std._parseXml(n)},AlphaTab.Platform.Std.ReadSignedByte=function(n){var t=n.ReadByte();return t>=128?t-256:t},AlphaTab.Platform.Std.ToString=function(n){for(var r=new String,i=0,t,u;i<n.length;)if(t=n[i++],t<128){if(t==0)break;r+=String.fromCharCode(t)}else t<224?r+=String.fromCharCode((t&63)<<6|n[i++]&127):t<240?r+=String.fromCharCode((t&31)<<12|(n[i++]&127)<<6|n[i++]&127):(u=(t&15)<<18|(n[i++]&127)<<12|(n[i++]&127)<<6|n[i++]&127,r+=String.fromCharCode((u>>18)+55232),r+=String.fromCharCode(u&1023|56320));return r},AlphaTab.Platform.Std.StringToByteArray=function(n){for(var i=new Uint8Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i},AlphaTab.Platform.Std.S4=function(){var n=Math.floor((1+Math.random())*65536);return n.toString(16).substring(1)},AlphaTab.Platform.Std.NewGuid=function(){return AlphaTab.Platform.Std.S4()+AlphaTab.Platform.Std.S4()+"-"+AlphaTab.Platform.Std.S4()+"-"+AlphaTab.Platform.Std.S4()+"-"+AlphaTab.Platform.Std.S4()+"-"+AlphaTab.Platform.Std.S4()+AlphaTab.Platform.Std.S4()+AlphaTab.Platform.Std.S4()},AlphaTab.Platform.Std.IsException=function(){return!1},AlphaTab.Platform.Std.Random=function(n){return Math.random()*n},AlphaTab.Platform.Std.IsStringNumber=function(n,t){if(n.length==0)return!1;var i=n.charCodeAt(0);return AlphaTab.Platform.Std.IsCharNumber(i,t)},AlphaTab.Platform.Std.IsCharNumber=function(n,t){return t&&n==45||n>=48&&n<=57},AlphaTab.Platform.Std.IsWhiteSpace=function(n){return n==32||n==11||n==13||n==10},AlphaTab.Platform.Std.ToHexString=function(n,t){var i="";do i=String.fromCharCode("0123456789ABCDEF".charCodeAt(n&15))+i,n>>=4;while(n>0);while(i.length<t)i="0"+i;return i},AlphaTab.Platform.Std.GetNodeValue=function(n){if(n==null)return"";if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element||n.nodeType==AlphaTab.Xml.XmlNodeType.Document){var t=new String;return AlphaTab.Platform.Std.IterateChildren(n,function(n){t+=AlphaTab.Platform.Std.GetNodeValue(n)}),t.trim()}return n.nodeValue},AlphaTab.Platform.Std.IterateChildren=function(n,t){for(var i=0;i<n.childNodes.length;i++)t(n.childNodes[i])},AlphaTab.Rendering=AlphaTab.Rendering||{},AlphaTab.Rendering.Utils=AlphaTab.Rendering.Utils||{},AlphaTab.Rendering.Utils.BoundsLookup=function(){this._beatLookup=null;this._currentStaveGroup=null;this.StaveGroups=null;this.IsFinished=!1;this.StaveGroups=[];this._beatLookup={}},AlphaTab.Rendering.Utils.BoundsLookup.prototype={ToJson:function(){var w={},b=[],i,r,u,n;w.StaveGroups=b;for(var f=0,a=this.StaveGroups,k=a.length,e=a[f];f<k;f++,e=a[f]){i={};i.VisualBounds=this.BoundsToJson(e.VisualBounds);i.RealBounds=this.BoundsToJson(e.RealBounds);i.Bars=[];for(var o=0,v=e.Bars,d=v.length,s=v[o];o<d;o++,s=v[o]){r={};r.VisualBounds=this.BoundsToJson(s.VisualBounds);r.RealBounds=this.BoundsToJson(s.RealBounds);r.Bars=[];for(var h=0,y=s.Bars,g=y.length,c=y[h];h<g;h++,c=y[h]){u={};u.VisualBounds=this.BoundsToJson(c.VisualBounds);u.RealBounds=this.BoundsToJson(c.RealBounds);u.Beats=[];for(var l=0,p=c.Beats,nt=p.length,t=p[l];l<nt;l++,t=p[l])n={},n.VisualBounds=this.BoundsToJson(t.VisualBounds),n.RealBounds=this.BoundsToJson(t.RealBounds),n.BeatIndex=t.Beat.Index,n.VoiceIndex=t.Beat.Voice.Index,n.BarIndex=t.Beat.Voice.Bar.Index,n.StaffIndex=t.Beat.Voice.Bar.Staff.Index,n.TrackIndex=t.Beat.Voice.Bar.Staff.Track.Index,u.Beats.push(n);r.Bars.push(u)}i.Bars.push(r)}b.push(i)}return w},BoundsToJson:function(n){var t={};return t.X=n.X,t.Y=n.Y,t.W=n.W,t.H=n.H,t},Finish:function(){for(var n=0;n<this.StaveGroups.length;n++)this.StaveGroups[n].Finish();this.IsFinished=!0},AddStaveGroup:function(n){n.Index=this.StaveGroups.length;n.BoundsLookup=this;this.StaveGroups.push(n);this._currentStaveGroup=n},AddMasterBar:function(n){n.StaveGroupBounds=this._currentStaveGroup;this._currentStaveGroup.AddBar(n)},AddBeat:function(n){this._beatLookup[n.Beat.Id]=n},FindBeat:function(n){var t=n.Id;return this._beatLookup.hasOwnProperty(t)?this._beatLookup[t]:null},GetBeatAtPos:function(n,t){for(var u=0,f=this.StaveGroups.length-1,e=-1,i,r,s,o;u<=f;){if(i=(f+u)/2|0,r=this.StaveGroups[i],t>=r.RealBounds.Y&&t<=r.RealBounds.Y+r.RealBounds.H){e=i;break}t<r.RealBounds.Y?f=i-1:u=i+1}return e==-1?null:(s=this.StaveGroups[e],o=s.FindBarAtPos(n),o!=null)?o.FindBeatAtPos(n,t):null}},AlphaTab.Rendering.Utils.BoundsLookup.FromJson=function(n,t){for(var u,r,e,o,k=new AlphaTab.Rendering.Utils.BoundsLookup,y=n.StaveGroups,s=0,d=y.length,h=y[s];s<d;s++,h=y[s]){u=new AlphaTab.Rendering.Utils.StaveGroupBounds;u.VisualBounds=h.VisualBounds;u.RealBounds=h.RealBounds;k.AddStaveGroup(u);for(var c=0,p=h.Bars,g=p.length,f=p[c];c<g;c++,f=p[c]){r=new AlphaTab.Rendering.Utils.MasterBarBounds;r.IsFirstOfLine=f.IsFirstOfLine;r.VisualBounds=f.VisualBounds;r.RealBounds=f.RealBounds;u.AddBar(r);for(var l=0,w=f.Bars,nt=w.length,a=w[l];l<nt;l++,a=w[l]){e=new AlphaTab.Rendering.Utils.BarBounds;e.VisualBounds=a.VisualBounds;e.RealBounds=a.RealBounds;r.AddBar(e);for(var v=0,b=a.Beats,tt=b.length,i=b[v];v<tt;v++,i=b[v])o=new AlphaTab.Rendering.Utils.BeatBounds,o.VisualBounds=i.VisualBounds,o.RealBounds=i.RealBounds,o.Beat=t.Tracks[i.TrackIndex].Staves[i.StaffIndex].Bars[i.BarIndex].Voices[i.VoiceIndex].Beats[i.BeatIndex],e.AddBeat(o)}}}return k},AlphaTab.Settings=function(){this.ScriptFile=null;this.Scale=0;this.Width=0;this.Height=0;this.Engine=null;this.Layout=null;this.StretchForce=0;this.ForcePianoFingering=!1;this.Staves=null},AlphaTab.Settings.prototype={ToJson:function(){var n={},t,i;n.scale=this.Scale;n.width=this.Width;n.height=this.Height;n.engine=this.Engine;n.stretchForce=this.StretchForce;n.forcePianoFingering=this.ForcePianoFingering;n.atRoot=this.ScriptFile;n.layout={};n.layout.mode=this.Layout.Mode;n.layout.additionalSettings={};for(t in this.Layout.AdditionalSettings)n.layout.additionalSettings[t]=this.Layout.AdditionalSettings[t];n.staves={};n.staves.id=this.Staves.Id;n.staves.additionalSettings={};for(i in this.Staves.AdditionalSettings)n.staves.additionalSettings[i]=this.Staves.AdditionalSettings[i];return n}},AlphaTab.Settings.FromJson=function(n){if(n instanceof AlphaTab.Settings)return n;var t=AlphaTab.Settings.get_Defaults();return t.ScriptFile=AlphaTab.Environment.ScriptFile,AlphaTab.Settings.FillFromJson(t,n),t},AlphaTab.Settings.FillFromJson=function(n,t){var i,u,r,h,e;if(t){if("scale"in t&&(n.Scale=t.scale),"width"in t&&(n.Width=t.width),"height"in t&&(n.Height=t.height),"engine"in t&&(n.Engine=t.engine),"stretchForce"in t&&(n.StretchForce=t.stretchForce),"forcePianoFingering"in t&&(n.ForcePianoFingering=t.forcePianoFingering),"atRoot"in t?(n.ScriptFile=t.atRoot,n.ScriptFile.lastIndexOf(".js")==n.ScriptFile.length-3||(n.ScriptFile.lastIndexOf("/")==n.ScriptFile.length-1||(n.ScriptFile+="/"),n.ScriptFile+="AlphaTab.js"),!n.ScriptFile.indexOf("http")==0&&!n.ScriptFile.indexOf("https")==0&&(i=new String,i+=window.location.protocol,i+="//",i+=window.location.hostname,window.location.port&&(i+=":",i+=window.location.port),i+=n.ScriptFile,n.ScriptFile=i)):n.ScriptFile=AlphaTab.Environment.ScriptFile,"layout"in t)if(typeof t.layout=="string")n.Layout.Mode=t.layout;else if(t.layout.mode&&(n.Layout.Mode=t.layout.mode),t.layout.additionalSettings){u=Object.keys(t.layout.additionalSettings);for(var f=0,l=u.length,s=u[f];f<l;f++,s=u[f])n.Layout.AdditionalSettings[s]=t.layout.additionalSettings[s]}if("staves"in t)if(r=t.staves,typeof r=="string")n.Staves=new AlphaTab.StaveSettings(r);else if(r.id){if(h=new AlphaTab.StaveSettings(r.id),r.additionalSettings){e=Object.keys(r.additionalSettings);for(var o=0,a=e.length,c=e[o];o<a;o++,c=e[o])h.AdditionalSettings[c]=r.additionalSettings[c]}n.Staves=h}}},AlphaTab.Settings.get_Defaults=function(){var n=new AlphaTab.Settings;return n.Scale=1,n.StretchForce=1,n.Width=950,n.Height=200,n.Engine="default",n.Layout=AlphaTab.LayoutSettings.get_Defaults(),n.Staves=new AlphaTab.StaveSettings("default"),n},AlphaTab.Audio=AlphaTab.Audio||{},AlphaTab.Audio.GeneralMidi=function(){},$StaticConstructor(function(){AlphaTab.Audio.GeneralMidi._values=null}),AlphaTab.Audio.GeneralMidi.GetValue=function(n){return AlphaTab.Audio.GeneralMidi._values==null&&(AlphaTab.Audio.GeneralMidi._values={},AlphaTab.Audio.GeneralMidi._values.acousticgrandpiano=0,AlphaTab.Audio.GeneralMidi._values.brightacousticpiano=1,AlphaTab.Audio.GeneralMidi._values.electricgrandpiano=2,AlphaTab.Audio.GeneralMidi._values.honkytonkpiano=3,AlphaTab.Audio.GeneralMidi._values.electricpiano1=4,AlphaTab.Audio.GeneralMidi._values.electricpiano2=5,AlphaTab.Audio.GeneralMidi._values.harpsichord=6,AlphaTab.Audio.GeneralMidi._values.clavinet=7,AlphaTab.Audio.GeneralMidi._values.celesta=8,AlphaTab.Audio.GeneralMidi._values.glockenspiel=9,AlphaTab.Audio.GeneralMidi._values.musicbox=10,AlphaTab.Audio.GeneralMidi._values.vibraphone=11,AlphaTab.Audio.GeneralMidi._values.marimba=12,AlphaTab.Audio.GeneralMidi._values.xylophone=13,AlphaTab.Audio.GeneralMidi._values.tubularbells=14,AlphaTab.Audio.GeneralMidi._values.dulcimer=15,AlphaTab.Audio.GeneralMidi._values.drawbarorgan=16,AlphaTab.Audio.GeneralMidi._values.percussiveorgan=17,AlphaTab.Audio.GeneralMidi._values.rockorgan=18,AlphaTab.Audio.GeneralMidi._values.churchorgan=19,AlphaTab.Audio.GeneralMidi._values.reedorgan=20,AlphaTab.Audio.GeneralMidi._values.accordion=21,AlphaTab.Audio.GeneralMidi._values.harmonica=22,AlphaTab.Audio.GeneralMidi._values.tangoaccordion=23,AlphaTab.Audio.GeneralMidi._values.acousticguitarnylon=24,AlphaTab.Audio.GeneralMidi._values.acousticguitarsteel=25,AlphaTab.Audio.GeneralMidi._values.electricguitarjazz=26,AlphaTab.Audio.GeneralMidi._values.electricguitarclean=27,AlphaTab.Audio.GeneralMidi._values.electricguitarmuted=28,AlphaTab.Audio.GeneralMidi._values.overdrivenguitar=29,AlphaTab.Audio.GeneralMidi._values.distortionguitar=30,AlphaTab.Audio.GeneralMidi._values.guitarharmonics=31,AlphaTab.Audio.GeneralMidi._values.acousticbass=32,AlphaTab.Audio.GeneralMidi._values.electricbassfinger=33,AlphaTab.Audio.GeneralMidi._values.electricbasspick=34,AlphaTab.Audio.GeneralMidi._values.fretlessbass=35,AlphaTab.Audio.GeneralMidi._values.slapbass1=36,AlphaTab.Audio.GeneralMidi._values.slapbass2=37,AlphaTab.Audio.GeneralMidi._values.synthbass1=38,AlphaTab.Audio.GeneralMidi._values.synthbass2=39,AlphaTab.Audio.GeneralMidi._values.violin=40,AlphaTab.Audio.GeneralMidi._values.viola=41,AlphaTab.Audio.GeneralMidi._values.cello=42,AlphaTab.Audio.GeneralMidi._values.contrabass=43,AlphaTab.Audio.GeneralMidi._values.tremolostrings=44,AlphaTab.Audio.GeneralMidi._values.pizzicatostrings=45,AlphaTab.Audio.GeneralMidi._values.orchestralharp=46,AlphaTab.Audio.GeneralMidi._values.timpani=47,AlphaTab.Audio.GeneralMidi._values.stringensemble1=48,AlphaTab.Audio.GeneralMidi._values.stringensemble2=49,AlphaTab.Audio.GeneralMidi._values.synthstrings1=50,AlphaTab.Audio.GeneralMidi._values.synthstrings2=51,AlphaTab.Audio.GeneralMidi._values.choiraahs=52,AlphaTab.Audio.GeneralMidi._values.voiceoohs=53,AlphaTab.Audio.GeneralMidi._values.synthvoice=54,AlphaTab.Audio.GeneralMidi._values.orchestrahit=55,AlphaTab.Audio.GeneralMidi._values.trumpet=56,AlphaTab.Audio.GeneralMidi._values.trombone=57,AlphaTab.Audio.GeneralMidi._values.tuba=58,AlphaTab.Audio.GeneralMidi._values.mutedtrumpet=59,AlphaTab.Audio.GeneralMidi._values.frenchhorn=60,AlphaTab.Audio.GeneralMidi._values.brasssection=61,AlphaTab.Audio.GeneralMidi._values.synthbrass1=62,AlphaTab.Audio.GeneralMidi._values.synthbrass2=63,AlphaTab.Audio.GeneralMidi._values.sopranosax=64,AlphaTab.Audio.GeneralMidi._values.altosax=65,AlphaTab.Audio.GeneralMidi._values.tenorsax=66,AlphaTab.Audio.GeneralMidi._values.baritonesax=67,AlphaTab.Audio.GeneralMidi._values.oboe=68,AlphaTab.Audio.GeneralMidi._values.englishhorn=69,AlphaTab.Audio.GeneralMidi._values.bassoon=70,AlphaTab.Audio.GeneralMidi._values.clarinet=71,AlphaTab.Audio.GeneralMidi._values.piccolo=72,AlphaTab.Audio.GeneralMidi._values.flute=73,AlphaTab.Audio.GeneralMidi._values.recorder=74,AlphaTab.Audio.GeneralMidi._values.panflute=75,AlphaTab.Audio.GeneralMidi._values.blownbottle=76,AlphaTab.Audio.GeneralMidi._values.shakuhachi=77,AlphaTab.Audio.GeneralMidi._values.whistle=78,AlphaTab.Audio.GeneralMidi._values.ocarina=79,AlphaTab.Audio.GeneralMidi._values.lead1square=80,AlphaTab.Audio.GeneralMidi._values.lead2sawtooth=81,AlphaTab.Audio.GeneralMidi._values.lead3calliope=82,AlphaTab.Audio.GeneralMidi._values.lead4chiff=83,AlphaTab.Audio.GeneralMidi._values.lead5charang=84,AlphaTab.Audio.GeneralMidi._values.lead6voice=85,AlphaTab.Audio.GeneralMidi._values.lead7fifths=86,AlphaTab.Audio.GeneralMidi._values.lead8bassandlead=87,AlphaTab.Audio.GeneralMidi._values.pad1newage=88,AlphaTab.Audio.GeneralMidi._values.pad2warm=89,AlphaTab.Audio.GeneralMidi._values.pad3polysynth=90,AlphaTab.Audio.GeneralMidi._values.pad4choir=91,AlphaTab.Audio.GeneralMidi._values.pad5bowed=92,AlphaTab.Audio.GeneralMidi._values.pad6metallic=93,AlphaTab.Audio.GeneralMidi._values.pad7halo=94,AlphaTab.Audio.GeneralMidi._values.pad8sweep=95,AlphaTab.Audio.GeneralMidi._values.fx1rain=96,AlphaTab.Audio.GeneralMidi._values.fx2soundtrack=97,AlphaTab.Audio.GeneralMidi._values.fx3crystal=98,AlphaTab.Audio.GeneralMidi._values.fx4atmosphere=99,AlphaTab.Audio.GeneralMidi._values.fx5brightness=100,AlphaTab.Audio.GeneralMidi._values.fx6goblins=101,AlphaTab.Audio.GeneralMidi._values.fx7echoes=102,AlphaTab.Audio.GeneralMidi._values.fx8scifi=103,AlphaTab.Audio.GeneralMidi._values.sitar=104,AlphaTab.Audio.GeneralMidi._values.banjo=105,AlphaTab.Audio.GeneralMidi._values.shamisen=106,AlphaTab.Audio.GeneralMidi._values.koto=107,AlphaTab.Audio.GeneralMidi._values.kalimba=108,AlphaTab.Audio.GeneralMidi._values.bagpipe=109,AlphaTab.Audio.GeneralMidi._values.fiddle=110,AlphaTab.Audio.GeneralMidi._values.shanai=111,AlphaTab.Audio.GeneralMidi._values.tinklebell=112,AlphaTab.Audio.GeneralMidi._values.agogo=113,AlphaTab.Audio.GeneralMidi._values.steeldrums=114,AlphaTab.Audio.GeneralMidi._values.woodblock=115,AlphaTab.Audio.GeneralMidi._values.taikodrum=116,AlphaTab.Audio.GeneralMidi._values.melodictom=117,AlphaTab.Audio.GeneralMidi._values.synthdrum=118,AlphaTab.Audio.GeneralMidi._values.reversecymbal=119,AlphaTab.Audio.GeneralMidi._values.guitarfretnoise=120,AlphaTab.Audio.GeneralMidi._values.breathnoise=121,AlphaTab.Audio.GeneralMidi._values.seashore=122,AlphaTab.Audio.GeneralMidi._values.birdtweet=123,AlphaTab.Audio.GeneralMidi._values.telephonering=124,AlphaTab.Audio.GeneralMidi._values.helicopter=125,AlphaTab.Audio.GeneralMidi._values.applause=126,AlphaTab.Audio.GeneralMidi._values.gunshot=127),n=n.toLowerCase().replace(" ",""),AlphaTab.Audio.GeneralMidi._values.hasOwnProperty(n)?AlphaTab.Audio.GeneralMidi._values[n]:0},AlphaTab.Audio.GeneralMidi.IsPiano=function(n){return n<=8||n>=17&&n<=24},AlphaTab.Audio.Generator=AlphaTab.Audio.Generator||{},AlphaTab.Audio.Generator.MidiFileGenerator=function(n,t,i){this._score=null;this._handler=null;this._currentTempo=0;this.GenerateMetronome=!1;this.TickLookup=null;this._score=n;this._currentTempo=this._score.Tempo;this._handler=t;this.GenerateMetronome=i;this.TickLookup=new AlphaTab.Audio.Model.MidiTickLookup},AlphaTab.Audio.Generator.MidiFileGenerator.prototype={Generate:function(){for(var t,u,e,r,c,o,n=0,i=this._score.Tracks.length;n<i;n++)this.GenerateTrack(this._score.Tracks[n]);for(t=new AlphaTab.Audio.Generator.MidiPlaybackController(this._score),u=null;!t.get_Finished();){var f=t.Index,s=this._score.MasterBars[f],h=t.CurrentTick;if(t.ProcessCurrent(),t.ShouldPlay)for(this.GenerateMasterBar(s,u,h),n=0,i=this._score.Tracks.length;n<i;n++)for(e=this._score.Tracks[n],r=0,c=e.Staves.length;r<c;r++)o=e.Staves[r],f<o.Bars.length&&this.GenerateBar(o.Bars[f],h);t.MoveNext();u=s}for(n=0,i=this._score.Tracks.length;n<i;n++)this._handler.FinishTrack(this._score.Tracks[n].Index,t.CurrentTick);this.TickLookup.Finish()},GenerateTrack:function(n){this.GenerateChannel(n,n.PlaybackInfo.PrimaryChannel,n.PlaybackInfo);n.PlaybackInfo.PrimaryChannel!=n.PlaybackInfo.SecondaryChannel&&this.GenerateChannel(n,n.PlaybackInfo.SecondaryChannel,n.PlaybackInfo)},GenerateChannel:function(n,t,i){var r=AlphaTab.Audio.Generator.MidiFileGenerator.ToChannelShort(i.Volume),u=AlphaTab.Audio.Generator.MidiFileGenerator.ToChannelShort(i.Balance);this._handler.AddControlChange(n.Index,0,t,7,r);this._handler.AddControlChange(n.Index,0,t,10,u);this._handler.AddControlChange(n.Index,0,t,11,127);this._handler.AddControlChange(n.Index,0,t,100,0);this._handler.AddControlChange(n.Index,0,t,101,0);this._handler.AddControlChange(n.Index,0,t,38,0);this._handler.AddControlChange(n.Index,0,t,6,12);this._handler.AddProgramChange(n.Index,0,t,i.Program)},GenerateMasterBar:function(n,t,i){var u,f,e,r;if((t==null||t.TimeSignatureDenominator!=n.TimeSignatureDenominator||t.TimeSignatureNumerator!=n.TimeSignatureNumerator)&&this._handler.AddTimeSignature(i,n.TimeSignatureNumerator,n.TimeSignatureDenominator),t==null?(this._handler.AddTempo(i,n.Score.Tempo),this._currentTempo=n.Score.Tempo):n.TempoAutomation!=null&&(this._handler.AddTempo(i,n.TempoAutomation.Value|0),this._currentTempo=n.TempoAutomation.Value|0),this.GenerateMetronome)for(u=i,f=AlphaTab.Audio.MidiUtils.ValueToTicks(n.TimeSignatureDenominator),e=0;e<n.TimeSignatureNumerator;e++)this._handler.AddMetronome(u,f),u+=f;r=new AlphaTab.Audio.Model.MasterBarTickLookup;r.MasterBar=n;r.Start=i;r.Tempo=this._currentTempo;r.End=r.Start+n.CalculateDuration();this.TickLookup.AddMasterBar(r)},GenerateBar:function(n,t){for(var i=0,r=n.Voices.length;i<r;i++)this.GenerateVoice(n.Voices[i],t)},GenerateVoice:function(n,t){if(!n.IsEmpty)for(var i=0,r=n.Beats.length;i<r;i++)this.GenerateBeat(n.Beats[i],t)},GenerateBeat:function(n,t){var r=n.Start,o=n.CalculateDuration(),u=new AlphaTab.Audio.Model.BeatTickLookup,e,s,i,f,h,c,l;for(u.Start=t+r,u.End=t+r+o,u.Beat=n,this.TickLookup.AddBeat(u),e=n.Voice.Bar.Staff.Track,i=0,f=n.Automations.length;i<f;i++)this.GenerateAutomation(n,n.Automations[i],t);if(n.get_IsRest())this._handler.AddRest(e.Index,t+r,e.PlaybackInfo.PrimaryChannel);else for(s=this.GetBrushInfo(n),i=0,f=n.Notes.length;i<f;i++)h=n.Notes[i],this.GenerateNote(h,t+r,o,s);n.Vibrato!=AlphaTab.Model.VibratoType.None&&(c=240,l=3,this.GenerateVibratorWithParams(n.Voice.Bar.Staff.Track,t+r,n.CalculateDuration(),c,l))},GenerateNote:function(n,t,i,r){var s=n.Beat.Voice.Bar.Staff.Track,f=n.get_RealValue(),h=n.get_IsStringed()&&n.String<=r.length?r[n.String-1]:0,u=t+h,e=this.GetNoteDuration(n,i)-h,o=this.GetDynamicValue(n);if(n.get_HasBend()||this._handler.AddBend(s.Index,u,s.PlaybackInfo.PrimaryChannel,64),n.Beat.FadeIn&&this.GenerateFadeIn(n,u,e,f,o),n.get_IsTrill()&&!s.IsPercussion){this.GenerateTrill(n,u,e,f,o);return}if(n.Beat.get_IsTremolo()){this.GenerateTremoloPicking(n,u,e,f,o);return}n.get_HasBend()?this.GenerateBend(n,u,e,f,o):n.Beat.get_HasWhammyBar()?this.GenerateWhammyBar(n,u,e,f,o):n.SlideType!=AlphaTab.Model.SlideType.None?this.GenerateSlide(n,u,e,f,o):n.Vibrato!=AlphaTab.Model.VibratoType.None&&this.GenerateVibrato(n,u,e,f,o);n.HarmonicType!=AlphaTab.Model.HarmonicType.None&&this.GenerateHarmonic(n,u,e,f,o);n.IsTieDestination||this._handler.AddNote(s.Index,u,e,f,o,s.PlaybackInfo.PrimaryChannel)},GetNoteDuration:function(n,t){return this.ApplyDurationEffects(n,t)},ApplyDurationEffects:function(n,t){var i,r,u;return n.IsDead?this.ApplyStaticDuration(30,t):n.IsPalmMute?this.ApplyStaticDuration(80,t):n.IsStaccato?t/2|0:n.IsTieOrigin?(i=n.TieDestination,n.IsTieDestination?t+this.GetNoteDuration(i,i.Beat.CalculateDuration()):(r=n.Beat.get_AbsoluteStart(),u=i.Beat.get_AbsoluteStart()+this.GetNoteDuration(i,i.Beat.CalculateDuration()),u-r)):t},ApplyStaticDuration:function(n,t){var i=this._currentTempo*n/60|0;return Math.min(i,t)},GetDynamicValue:function(n){var t=n.Dynamic;n.Beat.Voice.Bar.Staff.Track.IsPercussion||n.HammerPullOrigin==null||t--;n.IsGhost&&t--;switch(n.Accentuated){case AlphaTab.Model.AccentuationType.Normal:t++;break;case AlphaTab.Model.AccentuationType.Heavy:t+=2}return t},GenerateFadeIn:function(n,t,i){for(var e,u,r=n.Beat.Voice.Bar.Staff.Track,h=AlphaTab.Audio.Generator.MidiFileGenerator.ToChannelShort(r.PlaybackInfo.Volume),c=h/i,o=120,s=i/o|0,l=t+i,f=s-1;f>=0;f--)e=l-f*o,u=(e-t)*c,f==s-1&&(this._handler.AddControlChange(r.Index,t,r.PlaybackInfo.PrimaryChannel,7,u),this._handler.AddControlChange(r.Index,t,r.PlaybackInfo.SecondaryChannel,7,u)),this._handler.AddControlChange(r.Index,e,r.PlaybackInfo.PrimaryChannel,7,u),this._handler.AddControlChange(r.Index,e,r.PlaybackInfo.SecondaryChannel,7,u)},GenerateHarmonic:function(){},GenerateVibrato:function(n,t,i){var r=n.Beat.Voice.Bar.Staff.Track;this.GenerateVibratorWithParams(r,t,i,480,2)},GenerateVibratorWithParams:function(n,t,i,r,u){var h=r/2|0,e,f,o,s;for(t+=r,e=t+i;t<e;){for(f=0,o=t+r<e?r:e-t;f<o;)s=u*Math.sin(f*3.14159265358979/h),this._handler.AddBend(n.Index,t+f,n.PlaybackInfo.PrimaryChannel,64+s),f+=16;t+=r}},GenerateSlide:function(){},GenerateWhammyBar:function(){},GenerateBend:function(n,t,i){for(var f=n.Beat.Voice.Bar.Staff.Track,h=i/60,e=0;e<n.BendPoints.length-1;e++){var s=n.BendPoints[e],c=n.BendPoints[e+1],r=64+s.Value*2.75,u=64+c.Value*2.75,a=h*(c.Offset-s.Offset),l=a/Math.abs(u-r),o=t+h*s.Offset;if(r<u)while(r<=u)this._handler.AddBend(f.Index,o|0,f.PlaybackInfo.PrimaryChannel,Math.round(r)),r++,o+=l;else if(r>u)while(r>=u)this._handler.AddBend(f.Index,o|0,f.PlaybackInfo.PrimaryChannel,Math.round(r)),r--,o+=l}},GenerateTrill:function(n,t,i,r,u){for(var s=n.Beat.Voice.Bar.Staff.Track,h=n.get_StringTuning()+n.get_TrillFret(),e=AlphaTab.Audio.MidiUtils.ToTicks(n.TrillSpeed),o=!0,f=t;f+10<t+i;)f+e>=t+i&&(e=t+i-f),this._handler.AddNote(s.Index,f,e,o?h:r,u,s.PlaybackInfo.PrimaryChannel),o=!o,f+=e},GenerateTremoloPicking:function(n,t,i,r,u){for(var o=n.Beat.Voice.Bar.Staff.Track,e=AlphaTab.Audio.MidiUtils.ToTicks(n.Beat.TremoloSpeed),f=t;f+10<t+i;)f+e>=t+i&&(e=t+i-f),this._handler.AddNote(o.Index,f,e,r,u,o.PlaybackInfo.PrimaryChannel),f+=e},GetBrushInfo:function(n){var r=new Int32Array(n.Voice.Bar.Staff.Track.Tuning.length),u,f,e,s,t,i,o;if(n.BrushType!=AlphaTab.Model.BrushType.None){for(u=0,t=0,i=n.Notes.length;t<i;t++)(f=n.Notes[t],f.IsTieDestination)||(u|=1<<f.String-1);if(n.Notes.length>0)for(e=0,s=this.GetBrushIncrement(n),t=0,i=n.Voice.Bar.Staff.Track.Tuning.length;t<i;t++)o=n.BrushType==AlphaTab.Model.BrushType.ArpeggioDown||n.BrushType==AlphaTab.Model.BrushType.BrushDown?t:r.length-1-t,(u&1<<o)!=0&&(r[o]=e,e=s)}return r},GetBrushIncrement:function(n){if(n.BrushDuration==0)return 0;var t=n.CalculateDuration();return t==0?0:t/8*(4/n.BrushDuration)|0},GenerateAutomation:function(n,t,i){switch(t.Type){case AlphaTab.Model.AutomationType.Instrument:this._handler.AddProgramChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.PrimaryChannel,t.Value);this._handler.AddProgramChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.SecondaryChannel,t.Value);break;case AlphaTab.Model.AutomationType.Balance:this._handler.AddControlChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.PrimaryChannel,10,t.Value);this._handler.AddControlChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.SecondaryChannel,10,t.Value);break;case AlphaTab.Model.AutomationType.Volume:this._handler.AddControlChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.PrimaryChannel,7,t.Value);this._handler.AddControlChange(n.Voice.Bar.Staff.Track.Index,n.Start+i,n.Voice.Bar.Staff.Track.PlaybackInfo.SecondaryChannel,7,t.Value)}}},$StaticConstructor(function(){AlphaTab.Audio.Generator.MidiFileGenerator.DefaultBend=64;AlphaTab.Audio.Generator.MidiFileGenerator.DefaultBendSemitone=2.75}),AlphaTab.Audio.Generator.MidiFileGenerator.GenerateMidiFile=function(n,t){for(var f,r,i=new AlphaTab.Audio.Model.MidiFile,u=0,e=n.Tracks.length;u<e;u++)i.CreateTrack();return i.InfoTrack=0,f=new AlphaTab.Audio.Generator.MidiFileHandler(i),r=new AlphaTab.Audio.Generator.MidiFileGenerator(n,f,t),r.Generate(),i.TickLookup=r.TickLookup,i},AlphaTab.Audio.Generator.MidiFileGenerator.ToChannelShort=function(n){var t=Math.max(-32768,Math.min(32767,n*8-1));return Math.max(t,-1)+1},AlphaTab.Audio.Generator.MidiFileHandler=function(n){this._midiFile=null;this._metronomeTrack=0;this._midiFile=n;this._metronomeTrack=-1},AlphaTab.Audio.Generator.MidiFileHandler.prototype={AddEvent:function(n,t,i){this._midiFile.Tracks[n].AddEvent(new AlphaTab.Audio.Model.MidiEvent(t,i))},MakeCommand:function(n,t){return n&240|t&15},AddTimeSignature:function(n,t,i){for(var r=0;(i=i>>1)>0;)r++;this.AddEvent(this._midiFile.InfoTrack,n,AlphaTab.Audio.Generator.MidiFileHandler.BuildMetaMessage(88,new Uint8Array([t&255,r&255,48,8])))},AddRest:function(n,t){this.AddEvent(n,t,AlphaTab.Audio.Generator.MidiFileHandler.BuildSysExMessage(new Uint8Array([0])))},AddNote:function(n,t,i,r,u,f){var e=AlphaTab.Audio.MidiUtils.DynamicToVelocity(u);this.AddEvent(n,t,new AlphaTab.Audio.Model.MidiMessage(new Uint8Array([this.MakeCommand(144,f),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(r),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(e)])));this.AddEvent(n,t+i,new AlphaTab.Audio.Model.MidiMessage(new Uint8Array([this.MakeCommand(128,f),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(r),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(e)])))},AddControlChange:function(n,t,i,r,u){this.AddEvent(n,t,new AlphaTab.Audio.Model.MidiMessage(new Uint8Array([this.MakeCommand(176,i),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(r),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(u)])))},AddProgramChange:function(n,t,i,r){this.AddEvent(n,t,new AlphaTab.Audio.Model.MidiMessage(new Uint8Array([this.MakeCommand(192,i),AlphaTab.Audio.Generator.MidiFileHandler.FixValue(r)])))},AddTempo:function(n,t){var i=6e7/t|0;this.AddEvent(this._midiFile.InfoTrack,n,AlphaTab.Audio.Generator.MidiFileHandler.BuildMetaMessage(81,new Uint8Array([i>>16&255,i>>8&255,i&255])))},FinishTrack:function(n,t){this.AddEvent(this._midiFile.InfoTrack,t,AlphaTab.Audio.Generator.MidiFileHandler.BuildMetaMessage(47,new Uint8Array(0)))},AddBend:function(n,t,i,r){this.AddEvent(n,t,new AlphaTab.Audio.Model.MidiMessage(new Uint8Array([this.MakeCommand(224,i),0,AlphaTab.Audio.Generator.MidiFileHandler.FixValue(r)])))},AddMetronome:function(n,t){this._metronomeTrack==-1&&(this._midiFile.CreateTrack(),this._metronomeTrack=this._midiFile.Tracks.length-1);this.AddNote(this._metronomeTrack,n,t,37,AlphaTab.Model.DynamicValue.F,9)}},$StaticConstructor(function(){AlphaTab.Audio.Generator.MidiFileHandler.DefaultMetronomeKey=37;AlphaTab.Audio.Generator.MidiFileHandler.DefaultDurationDead=30;AlphaTab.Audio.Generator.MidiFileHandler.DefaultDurationPalmMute=80;AlphaTab.Audio.Generator.MidiFileHandler.RestMessage=0}),AlphaTab.Audio.Generator.MidiFileHandler.FixValue=function(n){return n>127?127:n},AlphaTab.Audio.Generator.MidiFileHandler.BuildMetaMessage=function(n,t){var i=AlphaTab.IO.ByteBuffer.Empty();return i.WriteByte(255),i.WriteByte(n&255),AlphaTab.Audio.Generator.MidiFileHandler.WriteVarInt(i,t.length),i.Write(t,0,t.length),new AlphaTab.Audio.Model.MidiMessage(i.ToArray())},AlphaTab.Audio.Generator.MidiFileHandler.WriteVarInt=function(n,t){var i=0,r=new Uint8Array(4);do r[i++]=t&127,t>>=7;while(t>0);while(i>0)i--,i>0?n.WriteByte((r[i]|128)&255):n.WriteByte(r[i])},AlphaTab.Audio.Generator.MidiFileHandler.BuildSysExMessage=function(n){var t=AlphaTab.IO.ByteBuffer.Empty();return t.WriteByte(240),AlphaTab.Audio.Generator.MidiFileHandler.WriteVarInt(t,n.length+2),t.WriteByte(0),t.Write(n,0,n.length),t.WriteByte(247),new AlphaTab.Audio.Model.MidiMessage(t.ToArray())},AlphaTab.Audio.Generator.MidiPlaybackController=function(n){this._score=null;this._repeatStartIndex=0;this._repeatNumber=0;this._repeatOpen=!1;this.ShouldPlay=!1;this.Index=0;this.CurrentTick=0;this._score=n;this.ShouldPlay=!0;this.Index=0;this.CurrentTick=0},AlphaTab.Audio.Generator.MidiPlaybackController.prototype={get_Finished:function(){return this.Index>=this._score.MasterBars.length},ProcessCurrent:function(){var n=this._score.MasterBars[this.Index],t=n.AlternateEndings;n.RepeatGroup.IsClosed||n.RepeatGroup.Openings[n.RepeatGroup.Openings.length-1]!=n||(this._repeatNumber=0,this._repeatOpen=!1);(n.IsRepeatStart||n.Index==0)&&this._repeatNumber==0?(this._repeatStartIndex=this.Index,this._repeatOpen=!0):n.IsRepeatStart&&(this.ShouldPlay=!0);this._repeatOpen&&t>0&&(this.ShouldPlay=(t&1<<this._repeatNumber)==0?!1:!0);this.ShouldPlay&&(this.CurrentTick+=n.CalculateDuration())},MoveNext:function(){var t=this._score.MasterBars[this.Index],n=t.RepeatCount-1;this._repeatOpen&&n>0?this._repeatNumber<n?(this.Index=this._repeatStartIndex,this._repeatNumber++):(this._repeatNumber=0,this._repeatOpen=!1,this.ShouldPlay=!0,this.Index++):this.Index++}},AlphaTab.Audio.MidiUtils=function(){},$StaticConstructor(function(){AlphaTab.Audio.MidiUtils.QuarterTime=960;AlphaTab.Audio.MidiUtils.PercussionChannel=9;AlphaTab.Audio.MidiUtils.MinVelocity=15;AlphaTab.Audio.MidiUtils.VelocityIncrement=16}),AlphaTab.Audio.MidiUtils.TicksToMillis=function(n,t){return n*(6e4/(t*960))|0},AlphaTab.Audio.MidiUtils.ToTicks=function(n){return AlphaTab.Audio.MidiUtils.ValueToTicks(n)},AlphaTab.Audio.MidiUtils.ValueToTicks=function(n){var t=n;return t<0&&(t=1/-t),3840/t|0},AlphaTab.Audio.MidiUtils.ApplyDot=function(n,t){return t?n+(n/4|0)*3:n+n/2|0},AlphaTab.Audio.MidiUtils.ApplyTuplet=function(n,t,i){return n*i/t|0},AlphaTab.Audio.MidiUtils.DynamicToVelocity=function(n){return 15+n*16},AlphaTab.Audio.Model=AlphaTab.Audio.Model||{},AlphaTab.Audio.Model.MidiController={DataEntryCoarse:6,VolumeCoarse:7,PanCoarse:10,ExpressionControllerCoarse:11,DataEntryFine:38,RegisteredParameterFine:100,RegisteredParameterCourse:101},AlphaTab.Audio.Model.MidiEvent=function(n,t){this.Track=null;this.Tick=0;this.Message=null;this.NextEvent=null;this.PreviousEvent=null;this.Tick=n;this.Message=t},AlphaTab.Audio.Model.MidiEvent.prototype={get_DeltaTicks:function(){return this.PreviousEvent==null?0:this.Tick-this.PreviousEvent.Tick},WriteTo:function(n){this.WriteVariableInt(n,this.get_DeltaTicks());this.Message.WriteTo(n)},WriteVariableInt:function(n,t){var r=new Uint8Array(4),i=0;do r[i++]=t&127,t>>=7;while(t>0);while(i>0)i--,i>0?n.WriteByte(r[i]|128):n.WriteByte(r[i])}},AlphaTab.Audio.Model.MidiFile=function(){this.TickLookup=null;this.Tracks=null;this.InfoTrack=0;this.Tracks=[]},AlphaTab.Audio.Model.MidiFile.prototype={CreateTrack:function(){var n=new AlphaTab.Audio.Model.MidiTrack;return n.Index=this.Tracks.length,n.File=this,this.Tracks.push(n),n},WriteTo:function(n){var t=new Uint8Array([77,84,104,100]),i,r,u;for(n.Write(t,0,t.length),t=new Uint8Array([0,0,0,6]),n.Write(t,0,t.length),t=new Uint8Array([0,1]),n.Write(t,0,t.length),i=this.Tracks.length|0,t=new Uint8Array([i>>8&255,i&255]),n.Write(t,0,t.length),i=960,t=new Uint8Array([i>>8&255,i&255]),n.Write(t,0,t.length),r=0,u=this.Tracks.length;r<u;r++)this.Tracks[r].WriteTo(n)}},AlphaTab.Audio.Model.MidiMessage=function(n){this.Event=null;this.Data=null;this.Data=n},AlphaTab.Audio.Model.MidiMessage.prototype={WriteTo:function(n){n.Write(this.Data,0,this.Data.length)}},AlphaTab.Audio.Model.BeatTickLookup=function(){this.Start=0;this.End=0;this.Beat=null},AlphaTab.Audio.Model.MasterBarTickLookup=function(){this.Start=0;this.End=0;this.Tempo=0;this.MasterBar=null;this.Beats=null;this.Beats=[]},AlphaTab.Audio.Model.MasterBarTickLookup.prototype={Finish:function(){this.Beats.sort($CreateAnonymousDelegate(this,function(n,t){return n.Start-t.Start}))},AddBeat:function(n){this.Beats.push(n)}},AlphaTab.Audio.Model.MidiTickLookupFindBeatResult=function(){this.CurrentBeat=null;this.NextBeat=null;this.Duration=0},AlphaTab.Audio.Model.MidiTickLookup=function(){this._currentMasterBar=null;this.MasterBarLookup=null;this.MasterBars=null;this.MasterBars=[];this.MasterBarLookup={}},AlphaTab.Audio.Model.MidiTickLookup.prototype={Finish:function(){for(var n=0;n<this.MasterBars.length;n++)this.MasterBars[n].Finish()},FindBeat:function(n,t){var o=this.FindMasterBar(t),s,e,v,i,r,h;if(o==null)return null;s={};for(var c=0,y=n.length,l=n[c];c<y;c++,l=n[c])s[l.Index]=!0;var f=null,a=0,u=o.Beats;for(i=0;i<u.length;i++)if(r=u[i],s.hasOwnProperty(r.Beat.Voice.Bar.Staff.Track.Index))if(r.Start<=t&&t<r.End)(f==null||f.Start<r.Start)&&(f=u[i],a=i);else if(r.End>t)break;if(f==null)return null;for(e=null,i=a+1;i<u.length;i++)if(r=u[i],s.hasOwnProperty(r.Beat.Voice.Bar.Staff.Track.Index)){e=r;break}if(e==null&&o.MasterBar.NextMasterBar!=null)for(v=this.GetMasterBar(o.MasterBar.NextMasterBar),u=v.Beats,i=0;i<u.length;i++)if(r=u[i],s.hasOwnProperty(r.Beat.Voice.Bar.Staff.Track.Index)){e=r;break}return h=new AlphaTab.Audio.Model.MidiTickLookupFindBeatResult,h.CurrentBeat=f.Beat,h.NextBeat=e==null?null:e.Beat,h.Duration=AlphaTab.Audio.MidiUtils.TicksToMillis(f.End-f.Start,o.Tempo),h},FindMasterBar:function(n){for(var f=this.MasterBars,r=0,u=f.length-1,i,t;r<=u;){if(i=(u+r)/2|0,t=f[i],n>=t.Start&&n<t.End)return t;n<t.Start?u=i-1:r=i+1}return null},GetMasterBar:function(n){return this.MasterBarLookup.hasOwnProperty(n.Index)?this.MasterBarLookup[n.Index]:function(){var t=new AlphaTab.Audio.Model.MasterBarTickLookup;return t.Start=0,t.End=0,t.Beats=[],t.MasterBar=n,t}.call(this)},GetMasterBarStart:function(n){return this.MasterBarLookup.hasOwnProperty(n.Index)?this.MasterBarLookup[n.Index].Start:0},AddMasterBar:function(n){this.MasterBars.push(n);this._currentMasterBar=n;this.MasterBarLookup.hasOwnProperty(n.MasterBar.Index)||(this.MasterBarLookup[n.MasterBar.Index]=n)},AddBeat:function(n){this._currentMasterBar.AddBeat(n)}},AlphaTab.Audio.Model.MidiTrack=function(){this.Index=0;this.File=null;this.FirstEvent=null;this.LastEvent=null},AlphaTab.Audio.Model.MidiTrack.prototype={AddEvent:function(n){var r,u,i,t;if(n.Track=this,this.FirstEvent==null)this.FirstEvent=n,this.LastEvent=n;else if(this.LastEvent.Tick<=n.Tick)this.LastEvent.NextEvent=n,n.PreviousEvent=this.LastEvent,this.LastEvent=n;else if(this.FirstEvent.Tick>n.Tick)n.NextEvent=this.FirstEvent,this.FirstEvent.PreviousEvent=n,this.FirstEvent=n;else if(r=n.Tick-this.FirstEvent.Tick,u=this.LastEvent.Tick-n.Tick,r<u){for(t=this.FirstEvent;t!=null&&t.NextEvent!=null&&t.NextEvent.Tick<=n.Tick;)t=t.NextEvent;if(t==null)return;i=t.NextEvent;t.NextEvent=n;n.PreviousEvent=t;n.NextEvent=i;i!=null&&(i.PreviousEvent=n)}else{for(i=this.LastEvent;i!=null&&i.PreviousEvent!=null&&i.PreviousEvent.Tick>n.Tick;)i=i.PreviousEvent;if(i==null)return;t=i.PreviousEvent;i.PreviousEvent=n;n.NextEvent=i;n.PreviousEvent=t;t!=null?t.NextEvent=n:this.FirstEvent=n}},WriteTo:function(n){for(var f=AlphaTab.IO.ByteBuffer.Empty(),r=this.FirstEvent,e=0,t,u,i;r!=null;)r.WriteTo(f),r=r.NextEvent,e++;t=new Uint8Array([77,84,114,107]);n.Write(t,0,t.length);u=f.ToArray();i=u.length;t=new Uint8Array([i>>24&255,i>>16&255,i>>8&255,i>>0&255]);n.Write(t,0,t.length);n.Write(u,0,u.length)}},AlphaTab.Exporter=AlphaTab.Exporter||{},AlphaTab.Exporter.AlphaTexExporter=function(){this._builder=null;this._builder=new String},AlphaTab.Exporter.AlphaTexExporter.prototype={Export:function(n){this.Score(n)},Score:function(n){this.MetaData(n);this.Bars(n)},ToTex:function(){return this._builder},MetaData:function(n){var t=n.Score,i;for(this.StringMetaData("title",t.Title),this.StringMetaData("subtitle",t.SubTitle),this.StringMetaData("artist",t.Artist),this.StringMetaData("album",t.Album),this.StringMetaData("words",t.Words),this.StringMetaData("music",t.Music),this.StringMetaData("copyright",t.Copyright),this._builder+="\\tempo ",this._builder+=t.Tempo,this._builder+="\r\n",n.Capo>0&&(this._builder+="\\capo ",this._builder+=n.Capo,this._builder+="\r\n"),this._builder+="\\tuning",i=0;i<n.Tuning.length;i++)this._builder+=" ",this._builder+=AlphaTab.Model.Tuning.GetTextForTuning(n.Tuning[i],!0);this._builder+="\\instrument ";this._builder+=n.PlaybackInfo.Program;this._builder+="\r\n";this._builder+=".";this._builder+="\r\n"},StringMetaData:function(n,t){AlphaTab.Platform.Std.IsNullOrWhiteSpace(t)||(this._builder+="\\",this._builder+=n,this._builder+=' "',this._builder+=t.replace('"','\\"'),this._builder+='"',this._builder+="\r\n")},Bars:function(n){for(var i,t=0;t<1;t++)for(i=0;i<n.Staves[t].Bars.length;i++)t>0&&(this._builder+=" |",this._builder+="\r\n"),this.Bar(n.Staves[t].Bars[i])},Bar:function(n){this.BarMeta(n);this.Voice(n.Voices[0])},Voice:function(n){for(var t=0;t<n.Beats.length;t++)this.Beat(n.Beats[t])},Beat:function(n){if(n.get_IsRest())this._builder+="r";else{n.Notes.length>1&&(this._builder+="(");for(var t=0;t<n.Notes.length;t++)this.Note(n.Notes[t]);n.Notes.length>1&&(this._builder+=")")}this._builder+=".";this._builder+=n.Duration;this._builder+=" ";this.BeatEffects(n)},Note:function(n){this._builder+=n.IsDead?"x":n.IsTieDestination?"-":n.Fret;this._builder+=".";this._builder+=n.Beat.Voice.Bar.Staff.Track.Tuning.length-n.String+1;this._builder+=" ";this.NoteEffects(n)},NoteEffects:function(n){var t=!1,i;if(n.get_HasBend()){for(t=this.EffectOpen(t),this._builder+="be (",i=0;i<n.BendPoints.length;i++)this._builder+=n.BendPoints[i].Offset,this._builder+=" ",this._builder+=n.BendPoints[i].Value,this._builder+=" ";this._builder+=")"}switch(n.HarmonicType){case AlphaTab.Model.HarmonicType.Natural:t=this.EffectOpen(t);this._builder+="nh ";break;case AlphaTab.Model.HarmonicType.Artificial:t=this.EffectOpen(t);this._builder+="ah ";break;case AlphaTab.Model.HarmonicType.Tap:t=this.EffectOpen(t);this._builder+="th ";break;case AlphaTab.Model.HarmonicType.Pinch:t=this.EffectOpen(t);this._builder+="ph ";break;case AlphaTab.Model.HarmonicType.Semi:t=this.EffectOpen(t);this._builder+="sh "}if(n.get_IsTrill()){t=this.EffectOpen(t);this._builder+="tr ";this._builder+=n.get_TrillFret();this._builder+=" ";switch(n.TrillSpeed){case AlphaTab.Model.Duration.Sixteenth:this._builder+="16 ";break;case AlphaTab.Model.Duration.ThirtySecond:this._builder+="32 ";break;case AlphaTab.Model.Duration.SixtyFourth:this._builder+="64 "}}n.Vibrato!=AlphaTab.Model.VibratoType.None&&(t=this.EffectOpen(t),this._builder+="v ");n.SlideType==AlphaTab.Model.SlideType.Legato&&(t=this.EffectOpen(t),this._builder+="sl ");n.SlideType==AlphaTab.Model.SlideType.Shift&&(t=this.EffectOpen(t),this._builder+="ss ");n.IsHammerPullOrigin&&(t=this.EffectOpen(t),this._builder+="h ");n.IsGhost&&(t=this.EffectOpen(t),this._builder+="g ");n.Accentuated==AlphaTab.Model.AccentuationType.Normal?(t=this.EffectOpen(t),this._builder+="ac "):n.Accentuated==AlphaTab.Model.AccentuationType.Heavy&&(t=this.EffectOpen(t),this._builder+="hac ");n.IsPalmMute&&(t=this.EffectOpen(t),this._builder+="pm ");n.IsStaccato&&(t=this.EffectOpen(t),this._builder+="st ");n.IsLetRing&&(t=this.EffectOpen(t),this._builder+="lr ");switch(n.LeftHandFinger){case AlphaTab.Model.Fingers.Thumb:t=this.EffectOpen(t);this._builder+="1 ";break;case AlphaTab.Model.Fingers.IndexFinger:t=this.EffectOpen(t);this._builder+="2 ";break;case AlphaTab.Model.Fingers.MiddleFinger:t=this.EffectOpen(t);this._builder+="3 ";break;case AlphaTab.Model.Fingers.AnnularFinger:t=this.EffectOpen(t);this._builder+="4 ";break;case AlphaTab.Model.Fingers.LittleFinger:t=this.EffectOpen(t);this._builder+="5 "}switch(n.RightHandFinger){case AlphaTab.Model.Fingers.Thumb:t=this.EffectOpen(t);this._builder+="1 ";break;case AlphaTab.Model.Fingers.IndexFinger:t=this.EffectOpen(t);this._builder+="2 ";break;case AlphaTab.Model.Fingers.MiddleFinger:t=this.EffectOpen(t);this._builder+="3 ";break;case AlphaTab.Model.Fingers.AnnularFinger:t=this.EffectOpen(t);this._builder+="4 ";break;case AlphaTab.Model.Fingers.LittleFinger:t=this.EffectOpen(t);this._builder+="5 "}this.EffectClose(t)},EffectOpen:function(n){return n||(this._builder+="{"),!0},EffectClose:function(n){n&&(this._builder+="}")},BeatEffects:function(n){var t=!1,i,r;n.FadeIn&&(t=this.EffectOpen(t),this._builder+="f ");switch(n.GraceType){case AlphaTab.Model.GraceType.OnBeat:this._builder+="gr ob ";break;case AlphaTab.Model.GraceType.BeforeBeat:this._builder+="gr "}if(n.Vibrato!=AlphaTab.Model.VibratoType.None&&(t=this.EffectOpen(t),this._builder+="v "),n.Slap&&(t=this.EffectOpen(t),this._builder+="s "),n.Pop&&(t=this.EffectOpen(t),this._builder+="p "),n.Dots==2?(t=this.EffectOpen(t),this._builder+="dd "):n.Dots==1&&(t=this.EffectOpen(t),this._builder+="d "),n.PickStroke==AlphaTab.Model.PickStrokeType.Up?(t=this.EffectOpen(t),this._builder+="su "):n.PickStroke==AlphaTab.Model.PickStrokeType.Down&&(t=this.EffectOpen(t),this._builder+="sd "),n.get_HasTuplet()&&(i=0,n.TupletDenominator==3&&n.TupletNumerator==2?i=3:n.TupletDenominator==5&&n.TupletNumerator==4?i=5:n.TupletDenominator==6&&n.TupletNumerator==4?i=6:n.TupletDenominator==7&&n.TupletNumerator==4?i=7:n.TupletDenominator==9&&n.TupletNumerator==8?i=9:n.TupletDenominator==10&&n.TupletNumerator==8?i=10:n.TupletDenominator==11&&n.TupletNumerator==8?i=11:n.TupletDenominator==12&&n.TupletNumerator==8&&(i=12),i!=0&&(t=this.EffectOpen(t),this._builder+="tu ",this._builder+=i,this._builder+=" ")),n.get_HasWhammyBar()){for(t=this.EffectOpen(t),this._builder+="tbe (",r=0;r<n.WhammyBarPoints.length;r++)this._builder+=n.WhammyBarPoints[r].Offset,this._builder+=" ",this._builder+=n.WhammyBarPoints[r].Value,this._builder+=" ";this._builder+=")"}n.get_IsTremolo()&&(t=this.EffectOpen(t),this._builder+="tp ",this._builder+=n.TremoloSpeed==AlphaTab.Model.Duration.Eighth?"8 ":n.TremoloSpeed==AlphaTab.Model.Duration.Sixteenth?"16 ":n.TremoloSpeed==AlphaTab.Model.Duration.ThirtySecond?"32 ":"8 ");this.EffectClose(t)},BarMeta:function(n){var t=n.get_MasterBar(),i,r;if(t.Index>0){if(i=t.PreviousMasterBar,r=n.PreviousBar,(i.TimeSignatureDenominator!=t.TimeSignatureDenominator||i.TimeSignatureNumerator!=t.TimeSignatureNumerator)&&(this._builder+="\\ts ",this._builder+=t.TimeSignatureNumerator,this._builder+=" ",this._builder+=t.TimeSignatureDenominator,this._builder+="\r\n"),i.KeySignature!=t.KeySignature){this._builder+="\\ks ";switch(t.KeySignature){case-7:this._builder+="cb";break;case-6:this._builder+="gb";break;case-5:this._builder+="db";break;case-4:this._builder+="ab";break;case-3:this._builder+="eb";break;case-2:this._builder+="bb";break;case-1:this._builder+="f";break;case 0:this._builder+="c";break;case 1:this._builder+="g";break;case 2:this._builder+="d";break;case 3:this._builder+="a";break;case 4:this._builder+="e";break;case 5:this._builder+="b";break;case 6:this._builder+="f#";break;case 7:this._builder+="c#"}this._builder+="\r\n"}if(n.Clef!=r.Clef){this._builder+="\\clef ";switch(n.Clef){case AlphaTab.Model.Clef.Neutral:this._builder+="n";break;case AlphaTab.Model.Clef.C3:this._builder+="c3";break;case AlphaTab.Model.Clef.C4:this._builder+="c4";break;case AlphaTab.Model.Clef.F4:this._builder+="f4";break;case AlphaTab.Model.Clef.G2:this._builder+="g2"}this._builder+="\r\n"}t.TempoAutomation!=null&&(this._builder+="\\tempo ",this._builder+=t.TempoAutomation.Value,this._builder+="\r\n")}t.IsRepeatStart&&(this._builder+="\\ro ",this._builder+="\r\n");t.get_IsRepeatEnd()&&(this._builder+="\\rc ",this._builder+=t.RepeatCount+1,this._builder+="\r\n")}},AlphaTab.Importer=AlphaTab.Importer||{},AlphaTab.Importer.AlphaTexException=function(n,t,i,r,u){this.Position=0;this.NonTerm=null;this.Expected=AlphaTab.Importer.AlphaTexSymbols.No;this.Symbol=AlphaTab.Importer.AlphaTexSymbols.No;this.SymbolData=null;this.Position=n;this.NonTerm=t;this.Expected=i;this.Symbol=r;this.SymbolData=u},AlphaTab.Importer.AlphaTexException.prototype={get_Message:function(){return this.SymbolData==null?"MalFormed AlphaTex: @"+this.Position+": Error on block "+this.NonTerm+", expected a "+this.Expected+" found a "+this.Symbol:"MalFormed AlphaTex: @"+this.Position+": Error on block "+this.NonTerm+", invalid value: "+this.SymbolData}},AlphaTab.Importer.ScoreImporter=function(){this.Data=null},AlphaTab.Importer.ScoreImporter.prototype={Init:function(n){this.Data=n}},AlphaTab.Importer.ScoreImporter.BuildImporters=function(){return[new AlphaTab.Importer.Gp3To5Importer,new AlphaTab.Importer.GpxImporter,new AlphaTab.Importer.AlphaTexImporter,new AlphaTab.Importer.MusicXmlImporter]},AlphaTab.Importer.AlphaTexImporter=function(){this._score=null;this._track=null;this._ch=0;this._curChPos=0;this._sy=AlphaTab.Importer.AlphaTexSymbols.No;this._syData=null;this._allowNegatives=!1;this._currentDuration=AlphaTab.Model.Duration.QuadrupleWhole;AlphaTab.Importer.ScoreImporter.call(this)},AlphaTab.Importer.AlphaTexImporter.prototype={get_Name:function(){return"AlphaTex"},ReadScore:function(){try{return this.CreateDefaultScore(),this._curChPos=0,this._currentDuration=AlphaTab.Model.Duration.Quarter,this.NextChar(),this.NewSy(),this.Score(),this._score.Finish(),this._score}catch(n){if(n.exception instanceof AlphaTab.Importer.AlphaTexException)throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(n.get_Message()),new Error);throw $CreateException(n,new Error);}},Error:function(n,t,i){var r;r=i?new AlphaTab.Importer.AlphaTexException(this._curChPos,n,t,this._sy,null):new AlphaTab.Importer.AlphaTexException(this._curChPos,n,t,t,this._syData);AlphaTab.Util.Logger.Error(this.get_Name(),r.get_Message());throw $CreateException(r,new Error);},CreateDefaultScore:function(){this._score=new AlphaTab.Model.Score;this._score.Tempo=120;this._score.TempoLabel="";this._track=new AlphaTab.Model.Track(1);this._track.PlaybackInfo.Program=25;this._track.PlaybackInfo.PrimaryChannel=AlphaTab.Importer.AlphaTexImporter.TrackChannels[0];this._track.PlaybackInfo.SecondaryChannel=AlphaTab.Importer.AlphaTexImporter.TrackChannels[1];this._track.Tuning=AlphaTab.Model.Tuning.GetDefaultTuningFor(6).Tunings;this._score.AddTrack(this._track)},ParseClef:function(n){switch(n.toLowerCase()){case"g2":case"treble":return AlphaTab.Model.Clef.G2;case"f4":case"bass":return AlphaTab.Model.Clef.F4;case"c3":case"tenor":return AlphaTab.Model.Clef.C3;case"c4":case"alto":return AlphaTab.Model.Clef.C4;case"n":case"neutral":return AlphaTab.Model.Clef.Neutral;default:return AlphaTab.Model.Clef.G2}},ParseKeySignature:function(n){switch(n.toLowerCase()){case"cb":return-7;case"gb":return-6;case"db":return-5;case"ab":return-4;case"eb":return-3;case"bb":return-2;case"f":return-1;case"c":return 0;case"g":return 1;case"d":return 2;case"a":return 3;case"e":return 4;case"b":return 5;case"f#":return 6;case"c#":return 7;default:return 0}},ParseTuning:function(n){var t=AlphaTab.Model.TuningParser.GetTuningForText(n);return t<0&&this.Error("tuning-value",AlphaTab.Importer.AlphaTexSymbols.String,!1),t},NextChar:function(){var n=this.Data.ReadByte();n==-1?this._ch=0:(this._ch=n,this._curChPos++)},NewSy:function(){var i,t,n;this._sy=AlphaTab.Importer.AlphaTexSymbols.No;do if(this._ch==0)this._sy=AlphaTab.Importer.AlphaTexSymbols.Eof;else if(AlphaTab.Platform.Std.IsWhiteSpace(this._ch))this.NextChar();else if(this._ch==47)if(this.NextChar(),this._ch==47)while(this._ch!=13&&this._ch!=10&&this._ch!=0)this.NextChar();else if(this._ch==42)while(this._ch!=0)if(this._ch==42){if(this.NextChar(),this._ch==47){this.NextChar();break}}else this.NextChar();else this.Error("symbol",AlphaTab.Importer.AlphaTexSymbols.String,!1);else if(this._ch==34||this._ch==39){for(this.NextChar(),i=new String,this._sy=AlphaTab.Importer.AlphaTexSymbols.String;this._ch!=34&&this._ch!=39&&this._ch!=0;)i+=String.fromCharCode(this._ch),this.NextChar();this._syData=i;this.NextChar()}else this._ch==45?this._allowNegatives&&this.IsDigit(this._ch)?(t=this.ReadNumber(),this._sy=AlphaTab.Importer.AlphaTexSymbols.Number,this._syData=t):(this._sy=AlphaTab.Importer.AlphaTexSymbols.String,this._syData=this.ReadName()):this._ch==46?(this._sy=AlphaTab.Importer.AlphaTexSymbols.Dot,this.NextChar()):this._ch==58?(this._sy=AlphaTab.Importer.AlphaTexSymbols.DoubleDot,this.NextChar()):this._ch==40?(this._sy=AlphaTab.Importer.AlphaTexSymbols.LParensis,this.NextChar()):this._ch==92?(this.NextChar(),n=this.ReadName(),this._sy=AlphaTab.Importer.AlphaTexSymbols.MetaCommand,this._syData=n):this._ch==41?(this._sy=AlphaTab.Importer.AlphaTexSymbols.RParensis,this.NextChar()):this._ch==123?(this._sy=AlphaTab.Importer.AlphaTexSymbols.LBrace,this.NextChar()):this._ch==125?(this._sy=AlphaTab.Importer.AlphaTexSymbols.RBrace,this.NextChar()):this._ch==124?(this._sy=AlphaTab.Importer.AlphaTexSymbols.Pipe,this.NextChar()):this._ch==42?(this._sy=AlphaTab.Importer.AlphaTexSymbols.Multiply,this.NextChar()):this.IsDigit(this._ch)?(t=this.ReadNumber(),this._sy=AlphaTab.Importer.AlphaTexSymbols.Number,this._syData=t):AlphaTab.Importer.AlphaTexImporter.IsLetter(this._ch)?(n=this.ReadName(),AlphaTab.Model.TuningParser.IsTuning(n)?(this._sy=AlphaTab.Importer.AlphaTexSymbols.Tuning,this._syData=n.toLowerCase()):(this._sy=AlphaTab.Importer.AlphaTexSymbols.String,this._syData=n)):this.Error("symbol",AlphaTab.Importer.AlphaTexSymbols.String,!1);while(this._sy==AlphaTab.Importer.AlphaTexSymbols.No)},IsDigit:function(n){return n>=48&&n<=57||n==45&&this._allowNegatives},ReadName:function(){var n=new String;do n+=String.fromCharCode(this._ch),this.NextChar();while(AlphaTab.Importer.AlphaTexImporter.IsLetter(this._ch)||this.IsDigit(this._ch));return n},ReadNumber:function(){var n=new String;do n+=String.fromCharCode(this._ch),this.NextChar();while(this.IsDigit(this._ch));return AlphaTab.Platform.Std.ParseInt(n)},Score:function(){this.MetaData();this.Bars()},MetaData:function(){for(var n=!1,t,i,r,u;this._sy==AlphaTab.Importer.AlphaTexSymbols.MetaCommand;)if(t=this._syData.toString().toLowerCase(),t=="title")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Title=this._syData.toString():this.Error("title",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="subtitle")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.SubTitle=this._syData.toString():this.Error("subtitle",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="artist")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Artist=this._syData.toString():this.Error("artist",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="album")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Album=this._syData.toString():this.Error("album",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="words")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Words=this._syData.toString():this.Error("words",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="music")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Music=this._syData.toString():this.Error("music",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="copyright")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.String?this._score.Copyright=this._syData.toString():this.Error("copyright",AlphaTab.Importer.AlphaTexSymbols.String,!0),this.NewSy(),n=!0;else if(t=="tempo")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.Number?this._score.Tempo=this._syData:this.Error("tempo",AlphaTab.Importer.AlphaTexSymbols.Number,!0),this.NewSy(),n=!0;else if(t=="capo")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.Number?this._track.Capo=this._syData:this.Error("capo",AlphaTab.Importer.AlphaTexSymbols.Number,!0),this.NewSy(),n=!0;else if(t=="tuning"){if(this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.Tuning){i=[];do i.push(this.ParseTuning(this._syData.toString().toLowerCase())),this.NewSy();while(this._sy==AlphaTab.Importer.AlphaTexSymbols.Tuning);this._track.Tuning=i.slice(0)}else this.Error("tuning",AlphaTab.Importer.AlphaTexSymbols.Tuning,!0);n=!0}else if(t=="instrument")this.NewSy(),this._sy==AlphaTab.Importer.AlphaTexSymbols.Number?(r=this._syData,r>=0&&r<=128?this._track.PlaybackInfo.Program=this._syData:this.Error("instrument",AlphaTab.Importer.AlphaTexSymbols.Number,!1)):this._sy==AlphaTab.Importer.AlphaTexSymbols.String?(u=this._syData.toString().toLowerCase(),this._track.PlaybackInfo.Program=AlphaTab.Audio.GeneralMidi.GetValue(u)):this.Error("instrument",AlphaTab.Importer.AlphaTexSymbols.Number,!0),this.NewSy(),n=!0;else if(n)this.Error("metaDataTags",AlphaTab.Importer.AlphaTexSymbols.String,!1);else break;n?(this._sy!=AlphaTab.Importer.AlphaTexSymbols.Dot&&this.Error("song",AlphaTab.Importer.AlphaTexSymbols.Dot,!0),this.NewSy()):this._sy==AlphaTab.Importer.AlphaTexSymbols.Dot&&this.NewSy()},Bars:function(){for(this.Bar();this._sy!=AlphaTab.Importer.AlphaTexSymbols.Eof;)this._sy!=AlphaTab.Importer.AlphaTexSymbols.Pipe&&this.Error("bar",AlphaTab.Importer.AlphaTexSymbols.Pipe,!0),this.NewSy(),this.Bar()},Bar:function(){var n=new AlphaTab.Model.MasterBar,t,i,r;for(this._score.AddMasterBar(n),t=new AlphaTab.Model.Bar,this._track.AddBarToStaff(0,t),n.Index>0&&(n.KeySignature=n.PreviousMasterBar.KeySignature,n.TimeSignatureDenominator=n.PreviousMasterBar.TimeSignatureDenominator,n.TimeSignatureNumerator=n.PreviousMasterBar.TimeSignatureNumerator,t.Clef=t.PreviousBar.Clef),this.BarMeta(t),i=new AlphaTab.Model.Voice,t.AddVoice(i);this._sy!=AlphaTab.Importer.AlphaTexSymbols.Pipe&&this._sy!=AlphaTab.Importer.AlphaTexSymbols.Eof;)this.Beat(i);i.Beats.length==0&&(r=new AlphaTab.Model.Beat,r.IsEmpty=!0,i.AddBeat(r))},Beat:function(n){var t,i,r;if(this._sy==AlphaTab.Importer.AlphaTexSymbols.DoubleDot){this._allowNegatives=!0;this.NewSy();this._allowNegatives=!1;this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("duration",AlphaTab.Importer.AlphaTexSymbols.Number,!0);this._currentDuration=this.ParseDuration(this._syData);this.NewSy();return}if(t=new AlphaTab.Model.Beat,n.AddBeat(t),n.Bar.get_MasterBar().TempoAutomation!=null&&n.Beats.length==1&&t.Automations.push(n.Bar.get_MasterBar().TempoAutomation),this._sy==AlphaTab.Importer.AlphaTexSymbols.LParensis){for(this.NewSy(),this.Note(t);this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis&&this._sy!=AlphaTab.Importer.AlphaTexSymbols.Eof;)this.Note(t);this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis&&this.Error("note-list",AlphaTab.Importer.AlphaTexSymbols.RParensis,!0);this.NewSy()}else this._sy==AlphaTab.Importer.AlphaTexSymbols.String&&this._syData.toString().toLowerCase()=="r"?this.NewSy():this.Note(t);for(this._sy==AlphaTab.Importer.AlphaTexSymbols.Dot&&(this._allowNegatives=!0,this.NewSy(),this._allowNegatives=!1,this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("duration",AlphaTab.Importer.AlphaTexSymbols.Number,!0),this._currentDuration=this.ParseDuration(this._syData),this.NewSy()),t.Duration=this._currentDuration,i=1,this._sy==AlphaTab.Importer.AlphaTexSymbols.Multiply&&(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number?this.Error("multiplier",AlphaTab.Importer.AlphaTexSymbols.Number,!0):i=this._syData,this.NewSy()),this.BeatEffects(t),r=0;r<i-1;r++)n.AddBeat(t.Clone())},BeatEffects:function(n){if(this._sy==AlphaTab.Importer.AlphaTexSymbols.LBrace){for(this.NewSy();this._sy==AlphaTab.Importer.AlphaTexSymbols.String;)this._syData=this._syData.toString().toLowerCase(),this.ApplyBeatEffect(n)||this.Error("beat-effects",AlphaTab.Importer.AlphaTexSymbols.String,!1);this._sy!=AlphaTab.Importer.AlphaTexSymbols.RBrace&&this.Error("beat-effects",AlphaTab.Importer.AlphaTexSymbols.RBrace,!0);this.NewSy()}},ApplyBeatEffect:function(n){var t=this._syData.toString().toLowerCase(),o,u,f,e,i;if(t=="f")return n.FadeIn=!0,this.NewSy(),!0;if(t=="v")return n.Vibrato=AlphaTab.Model.VibratoType.Slight,this.NewSy(),!0;if(t=="s")return n.Slap=!0,this.NewSy(),!0;if(t=="p")return n.Pop=!0,this.NewSy(),!0;if(t=="dd")return n.Dots=2,this.NewSy(),!0;if(t=="d")return n.Dots=1,this.NewSy(),!0;if(t=="su")return n.PickStroke=AlphaTab.Model.PickStrokeType.Up,this.NewSy(),!0;if(t=="sd")return n.PickStroke=AlphaTab.Model.PickStrokeType.Down,this.NewSy(),!0;if(t=="tu"){if(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number)return this.Error("tuplet",AlphaTab.Importer.AlphaTexSymbols.Number,!0),!1;o=this._syData;switch(o){case 3:n.TupletNumerator=3;n.TupletDenominator=2;break;case 5:n.TupletNumerator=5;n.TupletDenominator=4;break;case 6:n.TupletNumerator=6;n.TupletDenominator=4;break;case 7:n.TupletNumerator=7;n.TupletDenominator=4;break;case 9:n.TupletNumerator=9;n.TupletDenominator=8;break;case 10:n.TupletNumerator=10;n.TupletDenominator=8;break;case 11:n.TupletNumerator=11;n.TupletDenominator=8;break;case 12:n.TupletNumerator=12;n.TupletNumerator=8;n.TupletDenominator=8}return this.NewSy(),!0}if(t=="tb"||t=="tbe"){if(u=t=="tbe",this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.LParensis)return this.Error("tremolobar-effect",AlphaTab.Importer.AlphaTexSymbols.LParensis,!0),!1;for(this._allowNegatives=!0,this.NewSy();this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis&&this._sy!=AlphaTab.Importer.AlphaTexSymbols.Eof;){if(u){if(this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number||(f=this._syData,this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number))return this.Error("tremolobar-effect",AlphaTab.Importer.AlphaTexSymbols.Number,!0),!1;e=this._syData}else{if(this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number)return this.Error("tremolobar-effect",AlphaTab.Importer.AlphaTexSymbols.Number,!0),!1;f=0;e=this._syData}n.AddWhammyBarPoint(new AlphaTab.Model.BendPoint(f,e));this.NewSy()}while(n.WhammyBarPoints.length>60)n.RemoveWhammyBarPoint(n.WhammyBarPoints.length-1);if(u)n.WhammyBarPoints.sort($CreateAnonymousDelegate(this,function(n,t){return n.Offset-t.Offset}));else for(var s=n.WhammyBarPoints.length,h=60/s|0,r=0;r<s;)n.WhammyBarPoints[r].Offset=Math.min(60,r*h),r++;return(this._allowNegatives=!1,this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis)?(this.Error("tremolobar-effect",AlphaTab.Importer.AlphaTexSymbols.RParensis,!0),!1):(this.NewSy(),!0)}if(t=="gr")return this.NewSy(),this._syData.toString().toLowerCase()=="ob"?(n.GraceType=AlphaTab.Model.GraceType.OnBeat,this.NewSy()):n.GraceType=AlphaTab.Model.GraceType.BeforeBeat,!0;if(t=="tp"){if(this.NewSy(),i=AlphaTab.Model.Duration.Eighth,this._sy==AlphaTab.Importer.AlphaTexSymbols.Number){switch(this._syData){case 8:i=AlphaTab.Model.Duration.Eighth;break;case 16:i=AlphaTab.Model.Duration.Sixteenth;break;case 32:i=AlphaTab.Model.Duration.ThirtySecond;break;default:i=AlphaTab.Model.Duration.Eighth}this.NewSy()}return n.TremoloSpeed=i,!0}return!1},Note:function(n){var i=this._syData.toString().toLowerCase(),r,t;this._sy==AlphaTab.Importer.AlphaTexSymbols.Number||this._sy==AlphaTab.Importer.AlphaTexSymbols.String&&(i=="x"||i=="-")||this.Error("note-fret",AlphaTab.Importer.AlphaTexSymbols.Number,!0);var f=i=="x",u=i=="-",e=f||u?0:this._syData;this.NewSy();this._sy!=AlphaTab.Importer.AlphaTexSymbols.Dot&&this.Error("note",AlphaTab.Importer.AlphaTexSymbols.Dot,!0);this.NewSy();this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("note-string",AlphaTab.Importer.AlphaTexSymbols.Number,!0);r=this._syData;(r<1||r>this._track.Tuning.length)&&this.Error("note-string",AlphaTab.Importer.AlphaTexSymbols.Number,!1);this.NewSy();t=new AlphaTab.Model.Note;n.AddNote(t);t.String=this._track.Tuning.length-(r-1);t.IsDead=f;t.IsTieDestination=u;u||(t.Fret=e);this.NoteEffects(t)},NoteEffects:function(n){var t,e,o,u,h,i,r;if(this._sy==AlphaTab.Importer.AlphaTexSymbols.LBrace){for(this.NewSy();this._sy==AlphaTab.Importer.AlphaTexSymbols.String;)if(t=this._syData.toString().toLowerCase(),this._syData=t,t=="b"||t=="be"){for(e=this._syData=="be",this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.LParensis&&this.Error("bend-effect",AlphaTab.Importer.AlphaTexSymbols.LParensis,!0),this.NewSy();this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis&&this._sy!=AlphaTab.Importer.AlphaTexSymbols.Eof;)o=0,u=0,e?(this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("bend-effect-value",AlphaTab.Importer.AlphaTexSymbols.Number,!0),o=this._syData,this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("bend-effect-value",AlphaTab.Importer.AlphaTexSymbols.Number,!0),u=this._syData):(this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("bend-effect-value",AlphaTab.Importer.AlphaTexSymbols.Number,!0),u=this._syData),n.AddBendPoint(new AlphaTab.Model.BendPoint(o,u)),this.NewSy();while(n.BendPoints.length>60)n.BendPoints.splice(n.BendPoints.length-1,1);if(e)n.BendPoints.sort($CreateAnonymousDelegate(this,function(n,t){return n.Offset-t.Offset}));else for(var s=n.BendPoints.length,c=60/(s-1)|0,f=0;f<s;)n.BendPoints[f].Offset=Math.min(60,f*c),f++;this._sy!=AlphaTab.Importer.AlphaTexSymbols.RParensis&&this.Error("bend-effect",AlphaTab.Importer.AlphaTexSymbols.RParensis,!0);this.NewSy()}else if(t=="nh")n.HarmonicType=AlphaTab.Model.HarmonicType.Natural,this.NewSy();else if(t=="ah")n.HarmonicType=AlphaTab.Model.HarmonicType.Artificial,this.NewSy();else if(t=="th")n.HarmonicType=AlphaTab.Model.HarmonicType.Tap,this.NewSy();else if(t=="ph")n.HarmonicType=AlphaTab.Model.HarmonicType.Pinch,this.NewSy();else if(t=="sh")n.HarmonicType=AlphaTab.Model.HarmonicType.Semi,this.NewSy();else if(t=="tr"){if(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("trill-effect",AlphaTab.Importer.AlphaTexSymbols.Number,!0),h=this._syData,this.NewSy(),i=AlphaTab.Model.Duration.Sixteenth,this._sy==AlphaTab.Importer.AlphaTexSymbols.Number){switch(this._syData){case 16:i=AlphaTab.Model.Duration.Sixteenth;break;case 32:i=AlphaTab.Model.Duration.ThirtySecond;break;case 64:i=AlphaTab.Model.Duration.SixtyFourth;break;default:i=AlphaTab.Model.Duration.Sixteenth}this.NewSy()}n.TrillValue=h+n.get_StringTuning();n.TrillSpeed=i}else t=="v"?(this.NewSy(),n.Vibrato=AlphaTab.Model.VibratoType.Slight):t=="sl"?(this.NewSy(),n.SlideType=AlphaTab.Model.SlideType.Legato):t=="ss"?(this.NewSy(),n.SlideType=AlphaTab.Model.SlideType.Shift):t=="h"?(this.NewSy(),n.IsHammerPullOrigin=!0):t=="g"?(this.NewSy(),n.IsGhost=!0):t=="ac"?(this.NewSy(),n.Accentuated=AlphaTab.Model.AccentuationType.Normal):t=="hac"?(this.NewSy(),n.Accentuated=AlphaTab.Model.AccentuationType.Heavy):t=="pm"?(this.NewSy(),n.IsPalmMute=!0):t=="st"?(this.NewSy(),n.IsStaccato=!0):t=="lr"?(this.NewSy(),n.IsLetRing=!0):t=="x"?(this.NewSy(),n.Fret=0,n.IsDead=!0):t=="lf"?(this.NewSy(),r=AlphaTab.Model.Fingers.Thumb,this._sy==AlphaTab.Importer.AlphaTexSymbols.Number&&(r=this.ToFinger(this._syData),this.NewSy()),n.LeftHandFinger=r):t=="rf"?(this.NewSy(),r=AlphaTab.Model.Fingers.Thumb,this._sy==AlphaTab.Importer.AlphaTexSymbols.Number&&(r=this.ToFinger(this._syData),this.NewSy()),n.RightHandFinger=r):this.ApplyBeatEffect(n.Beat)||this.Error(t,AlphaTab.Importer.AlphaTexSymbols.String,!1);this._sy!=AlphaTab.Importer.AlphaTexSymbols.RBrace&&this.Error("note-effect",AlphaTab.Importer.AlphaTexSymbols.RBrace,!1);this.NewSy()}},ToFinger:function(n){switch(n){case 1:return AlphaTab.Model.Fingers.Thumb;case 2:return AlphaTab.Model.Fingers.IndexFinger;case 3:return AlphaTab.Model.Fingers.MiddleFinger;case 4:return AlphaTab.Model.Fingers.AnnularFinger;case 5:return AlphaTab.Model.Fingers.LittleFinger}return AlphaTab.Model.Fingers.Thumb},ParseDuration:function(n){switch(n){case-4:return AlphaTab.Model.Duration.QuadrupleWhole;case-2:return AlphaTab.Model.Duration.DoubleWhole;case 1:return AlphaTab.Model.Duration.Whole;case 2:return AlphaTab.Model.Duration.Half;case 4:return AlphaTab.Model.Duration.Quarter;case 8:return AlphaTab.Model.Duration.Eighth;case 16:return AlphaTab.Model.Duration.Sixteenth;case 32:return AlphaTab.Model.Duration.ThirtySecond;case 64:return AlphaTab.Model.Duration.SixtyFourth;case 128:return AlphaTab.Model.Duration.OneHundredTwentyEighth;default:return AlphaTab.Model.Duration.Quarter}},BarMeta:function(n){for(var i=n.get_MasterBar(),t,r;this._sy==AlphaTab.Importer.AlphaTexSymbols.MetaCommand;)t=this._syData.toString().toLowerCase(),t=="ts"?(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("timesignature-numerator",AlphaTab.Importer.AlphaTexSymbols.Number,!0),i.TimeSignatureNumerator=this._syData,this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("timesignature-denominator",AlphaTab.Importer.AlphaTexSymbols.Number,!0),i.TimeSignatureDenominator=this._syData):t=="ro"?i.IsRepeatStart=!0:t=="rc"?(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("repeatclose",AlphaTab.Importer.AlphaTexSymbols.Number,!0),i.RepeatCount=this._syData-1):t=="ks"?(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.String&&this.Error("keysignature",AlphaTab.Importer.AlphaTexSymbols.String,!0),i.KeySignature=this.ParseKeySignature(this._syData.toString().toLowerCase())):t=="clef"?(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.String&&this._sy!=AlphaTab.Importer.AlphaTexSymbols.Tuning&&this.Error("clef",AlphaTab.Importer.AlphaTexSymbols.String,!0),n.Clef=this.ParseClef(this._syData.toString().toLowerCase())):t=="tempo"?(this.NewSy(),this._sy!=AlphaTab.Importer.AlphaTexSymbols.Number&&this.Error("tempo",AlphaTab.Importer.AlphaTexSymbols.Number,!0),r=new AlphaTab.Model.Automation,r.IsLinear=!0,r.Type=AlphaTab.Model.AutomationType.Tempo,r.Value=this._syData,i.TempoAutomation=r):this.Error("measure-effects",AlphaTab.Importer.AlphaTexSymbols.String,!1),this.NewSy()}},$StaticConstructor(function(){AlphaTab.Importer.AlphaTexImporter.Eof=0;AlphaTab.Importer.AlphaTexImporter.TrackChannels=new Int32Array([0,1])}),AlphaTab.Importer.AlphaTexImporter.IsLetter=function(n){return!AlphaTab.Importer.AlphaTexImporter.IsTerminal(n)&&(n>=33&&n<=47||n>=58&&n<=126||n>128)},AlphaTab.Importer.AlphaTexImporter.IsTerminal=function(n){return n==46||n==123||n==125||n==91||n==93||n==40||n==41||n==124||n==39||n==34||n==92},$Inherit(AlphaTab.Importer.AlphaTexImporter,AlphaTab.Importer.ScoreImporter),AlphaTab.Importer.AlphaTexSymbols={No:0,Eof:1,Number:2,DoubleDot:3,Dot:4,String:5,Tuning:6,LParensis:7,RParensis:8,LBrace:9,RBrace:10,Pipe:11,MetaCommand:12,Multiply:13},AlphaTab.Importer.Gp3To5Importer=function(){this._versionNumber=0;this._score=null;this._globalTripletFeel=AlphaTab.Model.TripletFeel.NoTripletFeel;this._lyricsIndex=null;this._lyrics=null;this._barCount=0;this._trackCount=0;this._playbackInfos=null;AlphaTab.Importer.ScoreImporter.call(this)},AlphaTab.Importer.Gp3To5Importer.prototype={get_Name:function(){return"Guitar Pro 3-5"},ReadScore:function(){return this.ReadVersion(),this._score=new AlphaTab.Model.Score,this.ReadScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=this.ReadBool()?AlphaTab.Model.TripletFeel.Triplet8th:AlphaTab.Model.TripletFeel.NoTripletFeel),this._versionNumber>=400&&this.ReadLyrics(),this._versionNumber>=510&&this.Data.Skip(19),this._versionNumber>=500&&(this.ReadPageSetup(),this._score.TempoLabel=this.ReadStringIntByte()),this._score.Tempo=this.ReadInt32(),this._versionNumber>=510&&this.ReadBool(),this.ReadInt32(),this._versionNumber>=400&&this.Data.ReadByte(),this.ReadPlaybackInfos(),this._versionNumber>=500&&(this.Data.Skip(38),this.Data.Skip(4)),this._barCount=this.ReadInt32(),this._trackCount=this.ReadInt32(),this.ReadMasterBars(),this.ReadTracks(),this.ReadBars(),this._score.Finish(),this._score},ReadVersion:function(){var n=this.ReadStringByteLength(30),t;if(!n.indexOf("FICHIER GUITAR PRO ")==0)throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(""),new Error);n=n.substr(20);t=n.indexOf(".");this._versionNumber=100*AlphaTab.Platform.Std.ParseInt(n.substr(0,t))+AlphaTab.Platform.Std.ParseInt(n.substr(t+1));AlphaTab.Util.Logger.Info(this.get_Name(),"Guitar Pro version "+n+" detected")},ReadScoreInformation:function(){var i,n,t;for(this._score.Title=this.ReadStringIntUnused(),this._score.SubTitle=this.ReadStringIntUnused(),this._score.Artist=this.ReadStringIntUnused(),this._score.Album=this.ReadStringIntUnused(),this._score.Words=this.ReadStringIntUnused(),this._score.Music=this._versionNumber>=500?this.ReadStringIntUnused():this._score.Words,this._score.Copyright=this.ReadStringIntUnused(),this._score.Tab=this.ReadStringIntUnused(),this._score.Instructions=this.ReadStringIntUnused(),i=this.ReadInt32(),n=new String,t=0;t<i;t++)t>0&&(n+="\r\n"),n+=this.ReadStringIntUnused();this._score.Notices=n},ReadLyrics:function(){this._lyrics=[];this._lyricsIndex=[];this.ReadInt32();for(var n=0;n<5;n++)this._lyricsIndex.push(this.ReadInt32()-1),this._lyrics.push(this.ReadStringInt())},ReadPageSetup:function(){this.Data.Skip(30);for(var n=0;n<10;n++)this.ReadStringIntByte()},ReadPlaybackInfos:function(){var t,n;for(this._playbackInfos=[],t=0;t<64;t++)n=new AlphaTab.Model.PlaybackInformation,n.PrimaryChannel=t,n.SecondaryChannel=t,n.Program=this.ReadInt32(),n.Volume=this.Data.ReadByte(),n.Balance=this.Data.ReadByte(),this.Data.Skip(6),this._playbackInfos.push(n)},ReadMasterBars:function(){for(var n=0;n<this._barCount;n++)this.ReadMasterBar()},ReadMasterBar:function(){var i=null,n,t,r,e,o,h,u,s,f,c;if(this._score.MasterBars.length>0&&(i=this._score.MasterBars[this._score.MasterBars.length-1]),n=new AlphaTab.Model.MasterBar,t=this.Data.ReadByte(),(t&1)!=0?n.TimeSignatureNumerator=this.Data.ReadByte():i!=null&&(n.TimeSignatureNumerator=i.TimeSignatureNumerator),(t&2)!=0?n.TimeSignatureDenominator=this.Data.ReadByte():i!=null&&(n.TimeSignatureDenominator=i.TimeSignatureDenominator),n.IsRepeatStart=(t&4)!=0,(t&8)!=0&&(n.RepeatCount=this.Data.ReadByte()+(this._versionNumber>=500?0:1)),(t&16)!=0)if(this._versionNumber<500){for(r=i,e=0;r!=null;){if(r.get_IsRepeatEnd()&&r!=i)break;if(r.IsRepeatStart)break;e|=r.AlternateEndings;r=r.PreviousMasterBar}for(o=0,h=this.Data.ReadByte(),u=0;u<8;u++)s=1<<u,h>u&&(e&s)==0&&(o|=s);n.AlternateEndings=o}else n.AlternateEndings=this.Data.ReadByte();if((t&32)!=0&&(f=new AlphaTab.Model.Section,f.Text=this.ReadStringIntByte(),f.Marker="",this.ReadColor(),n.Section=f),(t&64)!=0?(n.KeySignature=AlphaTab.Platform.Std.ReadSignedByte(this.Data),n.KeySignatureType=this.Data.ReadByte()):i!=null&&(n.KeySignature=i.KeySignature,n.KeySignatureType=i.KeySignatureType),this._versionNumber>=500&&(t&3)!=0&&this.Data.Skip(4),this._versionNumber>=500&&(t&16)==0&&(n.AlternateEndings=this.Data.ReadByte()),this._versionNumber>=500){c=this.Data.ReadByte();switch(c){case 1:n.TripletFeel=AlphaTab.Model.TripletFeel.Triplet8th;break;case 2:n.TripletFeel=AlphaTab.Model.TripletFeel.Triplet16th}this.Data.ReadByte()}else n.TripletFeel=this._globalTripletFeel;n.IsDoubleBar=(t&128)!=0;this._score.AddMasterBar(n)},ReadTracks:function(){for(var n=0;n<this._trackCount;n++)this.ReadTrack()},ReadTrack:function(){var n=new AlphaTab.Model.Track(1),i,e,u,r,o,t;for(this._score.AddTrack(n),i=this.Data.ReadByte(),n.Name=this.ReadStringByteLength(40),n.IsPercussion=(i&1)!=0,e=this.ReadInt32(),u=[],r=0;r<7;r++)o=this.ReadInt32(),e>r&&u.push(o);n.Tuning=u.slice(0);var s=this.ReadInt32(),f=this.ReadInt32()-1,h=this.ReadInt32()-1;this.Data.Skip(4);f>=0&&f<this._playbackInfos.length&&(t=this._playbackInfos[f],t.Port=s,t.IsSolo=(i&16)!=0,t.IsMute=(i&32)!=0,t.SecondaryChannel=h,n.PlaybackInfo=t);n.Capo=this.ReadInt32();n.Color=this.ReadColor();this._versionNumber>=500&&(this.Data.ReadByte(),this.Data.ReadByte(),this.Data.Skip(43));this._versionNumber>=510&&(this.Data.Skip(4),this.ReadStringIntByte(),this.ReadStringIntByte())},ReadBars:function(){for(var n,t=0;t<this._barCount;t++)for(n=0;n<this._trackCount;n++)this.ReadBar(this._score.Tracks[n])},ReadBar:function(n){var t=new AlphaTab.Model.Bar,i,r;for(n.IsPercussion&&(t.Clef=AlphaTab.Model.Clef.Neutral),n.AddBarToStaff(0,t),i=1,this._versionNumber>=500&&(this.Data.ReadByte(),i=2),r=0;r<i;r++)this.ReadVoice(n,t)},ReadVoice:function(n,t){var u=this.ReadInt32(),i,r;if(u!=0)for(i=new AlphaTab.Model.Voice,t.AddVoice(i),r=0;r<u;r++)this.ReadBeat(n,t,i)},ReadBeat:function(n,t,i){var r=new AlphaTab.Model.Beat,u=this.Data.ReadByte(),e,o,s,f,h;(u&1)!=0&&(r.Dots=1);(u&64)!=0&&(e=this.Data.ReadByte(),r.IsEmpty=(e&2)==0);i.AddBeat(r);o=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(o){case-2:r.Duration=AlphaTab.Model.Duration.Whole;break;case-1:r.Duration=AlphaTab.Model.Duration.Half;break;case 0:r.Duration=AlphaTab.Model.Duration.Quarter;break;case 1:r.Duration=AlphaTab.Model.Duration.Eighth;break;case 2:r.Duration=AlphaTab.Model.Duration.Sixteenth;break;case 3:r.Duration=AlphaTab.Model.Duration.ThirtySecond;break;case 4:r.Duration=AlphaTab.Model.Duration.SixtyFourth;break;default:r.Duration=AlphaTab.Model.Duration.Quarter}if((u&32)!=0){r.TupletNumerator=this.ReadInt32();switch(r.TupletNumerator){case 1:r.TupletDenominator=1;break;case 3:r.TupletDenominator=2;break;case 5:case 6:case 7:r.TupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:r.TupletDenominator=8;break;case 2:case 4:case 8:break;default:r.TupletNumerator=1;r.TupletDenominator=1}}for((u&2)!=0&&this.ReadChord(r),(u&4)!=0&&(r.Text=this.ReadStringIntUnused()),(u&8)!=0&&this.ReadBeatEffects(r),(u&16)!=0&&this.ReadMixTableChange(r),s=this.Data.ReadByte(),f=6;f>=0;f--)(s&1<<f)!=0&&6-f<n.Tuning.length&&this.ReadNote(n,t,i,r,6-f);this._versionNumber>=500&&(this.Data.ReadByte(),h=this.Data.ReadByte(),(h&8)!=0&&this.Data.ReadByte())},ReadChord:function(n){var i=new AlphaTab.Model.Chord,o=AlphaTab.Platform.Std.NewGuid(),f,u,e,t,r;if(this._versionNumber>=500){for(this.Data.Skip(17),i.Name=this.ReadStringByteLength(21),this.Data.Skip(4),i.FirstFret=this.ReadInt32(),t=0;t<7;t++)r=this.ReadInt32(),t<n.Voice.Bar.Staff.Track.Tuning.length&&i.Strings.push(r);for(f=this.Data.ReadByte(),u=new Uint8Array(5),this.Data.Read(u,0,u.length),t=0;t<f;t++)i.BarreFrets.push(u[t]);this.Data.Skip(26)}else if(this.Data.ReadByte()!=0)if(this._versionNumber>=400){for(this.Data.Skip(16),i.Name=this.ReadStringByteLength(21),this.Data.Skip(4),i.FirstFret=this.ReadInt32(),t=0;t<7;t++)r=this.ReadInt32(),t<n.Voice.Bar.Staff.Track.Tuning.length&&i.Strings.push(r);for(f=this.Data.ReadByte(),u=new Uint8Array(5),this.Data.Read(u,0,u.length),t=0;t<f;t++)i.BarreFrets.push(u[t]);this.Data.Skip(26)}else{for(this.Data.Skip(25),i.Name=this.ReadStringByteLength(34),i.FirstFret=this.ReadInt32(),t=0;t<6;t++)r=this.ReadInt32(),t<n.Voice.Bar.Staff.Track.Tuning.length&&i.Strings.push(r);this.Data.Skip(36)}else if(e=this._versionNumber>=406?7:6,i.Name=this.ReadStringIntByte(),i.FirstFret=this.ReadInt32(),i.FirstFret>0)for(t=0;t<e;t++)r=this.ReadInt32(),t<n.Voice.Bar.Staff.Track.Tuning.length&&i.Strings.push(r);i.Name==null||i.Name.length==0||(n.ChordId=o,n.Voice.Bar.Staff.Track.Chords[n.ChordId]=i)},ReadBeatEffects:function(n){var t=this.Data.ReadByte(),i=0,r,u,f;if(this._versionNumber>=400&&(i=this.Data.ReadByte()),n.FadeIn=(t&16)!=0,(this._versionNumber<400&&(t&1)!=0||(t&2)!=0)&&(n.Vibrato=AlphaTab.Model.VibratoType.Slight),n.HasRasgueado=(i&1)!=0,(t&32)!=0&&this._versionNumber>=400){r=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(r){case 1:n.Tap=!0;break;case 2:n.Slap=!0;break;case 3:n.Pop=!0}}else if((t&32)!=0){r=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(r){case 1:n.Tap=!0;break;case 2:n.Slap=!0;break;case 3:n.Pop=!0}this.Data.Skip(4)}if((i&4)!=0&&this.ReadTremoloBarEffect(n),(t&64)!=0&&(this._versionNumber<500?(f=this.Data.ReadByte(),u=this.Data.ReadByte()):(u=this.Data.ReadByte(),f=this.Data.ReadByte()),u>0?(n.BrushType=AlphaTab.Model.BrushType.BrushUp,n.BrushDuration=AlphaTab.Importer.Gp3To5Importer.ToStrokeValue(u)):f>0&&(n.BrushType=AlphaTab.Model.BrushType.BrushDown,n.BrushDuration=AlphaTab.Importer.Gp3To5Importer.ToStrokeValue(f))),(i&2)!=0)switch(AlphaTab.Platform.Std.ReadSignedByte(this.Data)){case 0:n.PickStroke=AlphaTab.Model.PickStrokeType.None;break;case 1:n.PickStroke=AlphaTab.Model.PickStrokeType.Up;break;case 2:n.PickStroke=AlphaTab.Model.PickStrokeType.Down}},ReadTremoloBarEffect:function(n){var i,r,t;if(this.Data.ReadByte(),this.ReadInt32(),i=this.ReadInt32(),i>0)for(r=0;r<i;r++)t=new AlphaTab.Model.BendPoint(0,0),t.Offset=this.ReadInt32(),t.Value=this.ReadInt32()/25|0,this.ReadBool(),n.AddWhammyBarPoint(t)},ReadMixTableChange:function(n){var t=new AlphaTab.Importer.MixTableChange,r,u,f,i;t.Instrument=AlphaTab.Platform.Std.ReadSignedByte(this.Data);this._versionNumber>=500&&this.Data.Skip(16);t.Volume=AlphaTab.Platform.Std.ReadSignedByte(this.Data);t.Balance=AlphaTab.Platform.Std.ReadSignedByte(this.Data);var e=AlphaTab.Platform.Std.ReadSignedByte(this.Data),o=AlphaTab.Platform.Std.ReadSignedByte(this.Data),s=AlphaTab.Platform.Std.ReadSignedByte(this.Data),h=AlphaTab.Platform.Std.ReadSignedByte(this.Data);this._versionNumber>=500&&(t.TempoName=this.ReadStringIntByte());t.Tempo=this.ReadInt32();t.Volume>=0&&this.Data.ReadByte();t.Balance>=0&&this.Data.ReadByte();e>=0&&this.Data.ReadByte();o>=0&&this.Data.ReadByte();s>=0&&this.Data.ReadByte();h>=0&&this.Data.ReadByte();t.Tempo>=0&&(t.Duration=AlphaTab.Platform.Std.ReadSignedByte(this.Data),this._versionNumber>=510&&this.Data.ReadByte());this._versionNumber>=400&&this.Data.ReadByte();this._versionNumber>=500&&this.Data.ReadByte();this._versionNumber>=510&&(this.ReadStringIntByte(),this.ReadStringIntByte());t.Volume>=0&&(r=new AlphaTab.Model.Automation,r.IsLinear=!0,r.Type=AlphaTab.Model.AutomationType.Volume,r.Value=t.Volume,n.Automations.push(r));t.Balance>=0&&(u=new AlphaTab.Model.Automation,u.IsLinear=!0,u.Type=AlphaTab.Model.AutomationType.Balance,u.Value=t.Balance,n.Automations.push(u));t.Instrument>=0&&(f=new AlphaTab.Model.Automation,f.IsLinear=!0,f.Type=AlphaTab.Model.AutomationType.Instrument,f.Value=t.Instrument,n.Automations.push(f));t.Tempo>=0&&(i=new AlphaTab.Model.Automation,i.IsLinear=!0,i.Type=AlphaTab.Model.AutomationType.Tempo,i.Value=t.Tempo,n.Automations.push(i),n.Voice.Bar.get_MasterBar().TempoAutomation=i)},ReadNote:function(n,t,i,r,u){var f=new AlphaTab.Model.Note,e,o,s,h;f.String=n.Tuning.length-u;e=this.Data.ReadByte();(e&2)!=0?f.Accentuated=AlphaTab.Model.AccentuationType.Heavy:(e&64)!=0&&(f.Accentuated=AlphaTab.Model.AccentuationType.Normal);f.IsGhost=(e&4)!=0;(e&32)!=0&&(o=this.Data.ReadByte(),o==3?f.IsDead=!0:o==2&&(f.IsTieDestination=!0));(e&1)!=0&&this._versionNumber<500&&(this.Data.ReadByte(),this.Data.ReadByte());(e&16)!=0&&(s=AlphaTab.Platform.Std.ReadSignedByte(this.Data),f.Dynamic=this.ToDynamicValue(s),r.Dynamic=f.Dynamic);(e&32)!=0&&(f.Fret=AlphaTab.Platform.Std.ReadSignedByte(this.Data));(e&128)!=0&&(f.LeftHandFinger=AlphaTab.Platform.Std.ReadSignedByte(this.Data),f.RightHandFinger=AlphaTab.Platform.Std.ReadSignedByte(this.Data),f.IsFingering=!0);this._versionNumber>=500&&((e&1)!=0&&(f.DurationPercent=this.ReadDouble()),h=this.Data.ReadByte(),f.AccidentalMode=(h&2)!=0?AlphaTab.Model.NoteAccidentalMode.SwapAccidentals:AlphaTab.Model.NoteAccidentalMode.Default);r.AddNote(f);(e&8)!=0&&this.ReadNoteEffects(n,i,r,f)},ToDynamicValue:function(n){switch(n){case 1:return AlphaTab.Model.DynamicValue.PPP;case 2:return AlphaTab.Model.DynamicValue.PP;case 3:return AlphaTab.Model.DynamicValue.P;case 4:return AlphaTab.Model.DynamicValue.MP;case 5:return AlphaTab.Model.DynamicValue.MF;case 6:return AlphaTab.Model.DynamicValue.F;case 7:return AlphaTab.Model.DynamicValue.FF;case 8:return AlphaTab.Model.DynamicValue.FFF;default:return AlphaTab.Model.DynamicValue.F}},ReadNoteEffects:function(n,t,i,r){var f=this.Data.ReadByte(),u=0;this._versionNumber>=400&&(u=this.Data.ReadByte());(f&1)!=0&&this.ReadBend(r);(f&16)!=0&&this.ReadGrace(t,r);(u&4)!=0&&this.ReadTremoloPicking(i);(u&8)!=0?this.ReadSlide(r):this._versionNumber<400&&(f&4)!=0&&(r.SlideType=AlphaTab.Model.SlideType.Shift);(u&16)!=0?this.ReadArtificialHarmonic(r):this._versionNumber<400&&((f&4)!=0&&(r.HarmonicType=AlphaTab.Model.HarmonicType.Natural,r.HarmonicValue=this.DeltaFretToHarmonicValue(r.Fret)),(f&8)!=0&&(r.HarmonicType=AlphaTab.Model.HarmonicType.Artificial));(u&32)!=0&&this.ReadTrill(r);r.IsLetRing=(f&8)!=0;r.IsHammerPullOrigin=(f&2)!=0;(u&64)!=0&&(r.Vibrato=AlphaTab.Model.VibratoType.Slight);r.IsPalmMute=(u&2)!=0;r.IsStaccato=(u&1)!=0},ReadBend:function(n){var i,r,t;if(this.Data.ReadByte(),this.ReadInt32(),i=this.ReadInt32(),i>0)for(r=0;r<i;r++)t=new AlphaTab.Model.BendPoint(0,0),t.Offset=this.ReadInt32(),t.Value=this.ReadInt32()/25|0,this.ReadBool(),n.AddBendPoint(t)},ReadGrace:function(n,t){var r=new AlphaTab.Model.Beat,i=new AlphaTab.Model.Note,f,u;i.String=t.String;i.Fret=AlphaTab.Platform.Std.ReadSignedByte(this.Data);r.Duration=AlphaTab.Model.Duration.ThirtySecond;r.Dynamic=this.ToDynamicValue(AlphaTab.Platform.Std.ReadSignedByte(this.Data));f=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(f){case 1:i.SlideType=AlphaTab.Model.SlideType.Legato;i.SlideTarget=t;break;case 3:i.IsHammerPullOrigin=!0}i.Dynamic=r.Dynamic;this.Data.Skip(1);this._versionNumber<500?r.GraceType=AlphaTab.Model.GraceType.BeforeBeat:(u=this.Data.ReadByte(),i.IsDead=(u&1)!=0,r.GraceType=(u&2)!=0?AlphaTab.Model.GraceType.OnBeat:AlphaTab.Model.GraceType.BeforeBeat);r.AddNote(i);n.AddGraceBeat(r)},ReadTremoloPicking:function(n){var t=this.Data.ReadByte();switch(t){case 1:n.TremoloSpeed=AlphaTab.Model.Duration.Eighth;break;case 2:n.TremoloSpeed=AlphaTab.Model.Duration.Sixteenth;break;case 3:n.TremoloSpeed=AlphaTab.Model.Duration.ThirtySecond}},ReadSlide:function(n){var t;if(this._versionNumber>=500){t=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(t){case 1:n.SlideType=AlphaTab.Model.SlideType.Shift;break;case 2:n.SlideType=AlphaTab.Model.SlideType.Legato;break;case 4:n.SlideType=AlphaTab.Model.SlideType.OutDown;break;case 8:n.SlideType=AlphaTab.Model.SlideType.OutUp;break;case 16:n.SlideType=AlphaTab.Model.SlideType.IntoFromBelow;break;case 32:n.SlideType=AlphaTab.Model.SlideType.IntoFromAbove;break;default:n.SlideType=AlphaTab.Model.SlideType.None}}else{t=AlphaTab.Platform.Std.ReadSignedByte(this.Data);switch(t){case 1:n.SlideType=AlphaTab.Model.SlideType.Shift;break;case 2:n.SlideType=AlphaTab.Model.SlideType.Legato;break;case 3:n.SlideType=AlphaTab.Model.SlideType.OutDown;break;case 4:n.SlideType=AlphaTab.Model.SlideType.OutUp;break;case-1:n.SlideType=AlphaTab.Model.SlideType.IntoFromBelow;break;case-2:n.SlideType=AlphaTab.Model.SlideType.IntoFromAbove;break;default:n.SlideType=AlphaTab.Model.SlideType.None}}},ReadArtificialHarmonic:function(n){var t=this.Data.ReadByte();if(this._versionNumber>=500)switch(t){case 1:n.HarmonicType=AlphaTab.Model.HarmonicType.Natural;n.HarmonicValue=this.DeltaFretToHarmonicValue(n.Fret);break;case 2:var i=this.Data.ReadByte(),r=this.Data.ReadByte(),u=this.Data.ReadByte();n.HarmonicType=AlphaTab.Model.HarmonicType.Artificial;break;case 3:n.HarmonicType=AlphaTab.Model.HarmonicType.Tap;n.HarmonicValue=this.DeltaFretToHarmonicValue(this.Data.ReadByte());break;case 4:n.HarmonicType=AlphaTab.Model.HarmonicType.Pinch;n.HarmonicValue=12;break;case 5:n.HarmonicType=AlphaTab.Model.HarmonicType.Semi;n.HarmonicValue=12}else if(this._versionNumber>=400)switch(t){case 1:n.HarmonicType=AlphaTab.Model.HarmonicType.Natural;break;case 3:n.HarmonicType=AlphaTab.Model.HarmonicType.Tap;break;case 4:n.HarmonicType=AlphaTab.Model.HarmonicType.Pinch;break;case 5:n.HarmonicType=AlphaTab.Model.HarmonicType.Semi;break;case 15:n.HarmonicType=AlphaTab.Model.HarmonicType.Artificial;break;case 17:n.HarmonicType=AlphaTab.Model.HarmonicType.Artificial;break;case 22:n.HarmonicType=AlphaTab.Model.HarmonicType.Artificial}},DeltaFretToHarmonicValue:function(n){switch(n){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return n;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}},ReadTrill:function(n){n.TrillValue=this.Data.ReadByte()+n.get_StringTuning();switch(this.Data.ReadByte()){case 1:n.TrillSpeed=AlphaTab.Model.Duration.Sixteenth;break;case 2:n.TrillSpeed=AlphaTab.Model.Duration.ThirtySecond;break;case 3:n.TrillSpeed=AlphaTab.Model.Duration.SixtyFourth}},ReadDouble:function(){var n=new Uint8Array(8);this.Data.Read(n,0,n.length);var r=1-(n[0]>>7<<1),t=(n[0]<<4&2047|n[1]>>4)-1023,i=this.GetDoubleSig(n);return i==0&&t==-1023?0:r*(1+Math.pow(2,-52)*i)*Math.pow(2,t)},GetDoubleSig:function(n){return((n[1]&15)<<16|n[2]<<8|n[3])*4294967296+(n[4]>>7)*2147483648+((n[4]&127)<<24|n[5]<<16|n[6]<<8|n[7])|0},ReadColor:function(){var n=this.Data.ReadByte(),t=this.Data.ReadByte(),i=this.Data.ReadByte();return this.Data.Skip(1),new AlphaTab.Platform.Model.Color(n,t,i,255)},ReadBool:function(){return this.Data.ReadByte()!=0},ReadInt32:function(){var n=new Uint8Array(4);return this.Data.Read(n,0,4),n[0]|n[1]<<8|n[2]<<16|n[3]<<24},ReadStringIntUnused:function(){return this.Data.Skip(4),this.ReadString(this.Data.ReadByte())},ReadStringInt:function(){return this.ReadString(this.ReadInt32())},ReadStringIntByte:function(){var n=this.ReadInt32()-1;return this.Data.ReadByte(),this.ReadString(n)},ReadString:function(n){var t=new Uint8Array(n);return this.Data.Read(t,0,t.length),AlphaTab.Platform.Std.ToString(t)},ReadStringByteLength:function(n){var t=this.Data.ReadByte(),i=this.ReadString(t);return t<n&&this.Data.Skip(n-t),i}},$StaticConstructor(function(){AlphaTab.Importer.Gp3To5Importer.VersionString="FICHIER GUITAR PRO ";AlphaTab.Importer.Gp3To5Importer.BendStep=25}),AlphaTab.Importer.Gp3To5Importer.ToStrokeValue=function(n){switch(n){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}},$Inherit(AlphaTab.Importer.Gp3To5Importer,AlphaTab.Importer.ScoreImporter),AlphaTab.Importer.GpxFile=function(){this.FileName=null;this.FileSize=0;this.Data=null},AlphaTab.Importer.GpxFileSystem=function(){this.FileFilter=null;this.Files=null;this.Files=[];this.FileFilter=$CreateAnonymousDelegate(this,function(){return!0})},AlphaTab.Importer.GpxFileSystem.prototype={Load:function(n){var t=new AlphaTab.IO.BitReader(n);this.ReadBlock(t)},ReadHeader:function(n){return this.GetString(n.ReadBytes(4),0,4)},Decompress:function(n,t){var i=AlphaTab.IO.ByteBuffer.Empty(),r,a=this.GetInteger(n.ReadBytes(4),0),o,u,f;try{while(i.get_Length()<a)if(o=n.ReadBits(1),o==1){var s=n.ReadBits(4),h=n.ReadBitsReversed(s),u=n.ReadBitsReversed(s),v=i.get_Length()-h,y=Math.min(h,u);r=i.GetBuffer();i.Write(r,v|0,y)}else for(u=n.ReadBitsReversed(2),f=0;f<u;f++)i.WriteByte(n.ReadByte())}catch(p){}r=i.GetBuffer();var e=t?4:0,c=i.get_Length()-e,l=new Uint8Array(c|0);return l.set(r.subarray(e,e+c|0),0),l},ReadBlock:function(n){var t=this.ReadHeader(n);if(t=="BCFZ")this.ReadUncompressedBlock(this.Decompress(n,!0));else if(t=="BCFS")this.ReadUncompressedBlock(n.ReadAll());else throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(""),new Error);},ReadUncompressedBlock:function(n){for(var u=4096,i=u,e,t,r,s;i+3<n.length;){if(e=this.GetInteger(n,i),e==2){t=new AlphaTab.Importer.GpxFile;t.FileName=this.GetString(n,i+4,127);t.FileSize=this.GetInteger(n,i+140);r=this.FileFilter==null||this.FileFilter(t.FileName);r&&this.Files.push(t);for(var h=i+148,o=0,c=0,f=r?AlphaTab.IO.ByteBuffer.WithCapactiy(t.FileSize):null;(o=this.GetInteger(n,h+4*c++))!=0;)i=o*u,r&&f.Write(n,i,u);r&&(t.Data=new Uint8Array(Math.min(t.FileSize,f.get_Length())|0),s=f.ToArray(),t.Data.set(s.subarray(0,0+t.Data.length),0))}i+=u}},GetString:function(n,t,i){for(var u,f=new String,r=0;r<i;r++){if(u=n[t+r]&255,u==0)break;f+=String.fromCharCode(u)}return f},GetInteger:function(n,t){return n[t+3]<<24|n[t+2]<<16|n[t+1]<<8|n[t]}},$StaticConstructor(function(){AlphaTab.Importer.GpxFileSystem.HeaderBcFs="BCFS";AlphaTab.Importer.GpxFileSystem.HeaderBcFz="BCFZ";AlphaTab.Importer.GpxFileSystem.ScoreGpif="score.gpif"}),AlphaTab.Importer.GpxImporter=function(){AlphaTab.Importer.ScoreImporter.call(this)},AlphaTab.Importer.GpxImporter.prototype={get_Name:function(){return"Guitar Pro 6"},ReadScore:function(){var n,i,r,t;return AlphaTab.Util.Logger.Info(this.get_Name(),"Loading GPX filesystem"),n=new AlphaTab.Importer.GpxFileSystem,n.FileFilter=$CreateAnonymousDelegate(this,function(n){return n=="score.gpif"}),n.Load(this.Data),AlphaTab.Util.Logger.Info(this.get_Name(),"GPX filesystem loaded"),i=n.Files[0].Data,r=AlphaTab.Platform.Std.ToString(i),n.Files=null,n=null,AlphaTab.Util.Logger.Info(this.get_Name(),"Start Parsing score.gpif"),t=new AlphaTab.Importer.GpxParser,t.ParseXml(r),t.Score.Finish(),AlphaTab.Util.Logger.Info(this.get_Name(),"score.gpif parsed"),t.Score}},$Inherit(AlphaTab.Importer.GpxImporter,AlphaTab.Importer.ScoreImporter),AlphaTab.Importer.GpxRhythm=function(){this.Dots=0;this.TupletDenominator=0;this.TupletNumerator=0;this.Value=AlphaTab.Model.Duration.QuadrupleWhole;this.TupletDenominator=-1;this.TupletNumerator=-1;this.Value=AlphaTab.Model.Duration.Quarter},AlphaTab.Importer.GpxParser=function(){this._masterTrackAutomations=null;this._tracksMapping=null;this._tracksById=null;this._masterBars=null;this._barsOfMasterBar=null;this._barsById=null;this._voicesOfBar=null;this._voiceById=null;this._beatsOfVoice=null;this._rhythmOfBeat=null;this._beatById=null;this._rhythmById=null;this._noteById=null;this._notesOfBeat=null;this._tappedNotes=null;this.Score=null},AlphaTab.Importer.GpxParser.prototype={ParseXml:function(n){this._masterTrackAutomations={};this._tracksMapping=new Array(0);this._tracksById={};this._masterBars=[];this._barsOfMasterBar=[];this._voicesOfBar={};this._barsById={};this._voiceById={};this._beatsOfVoice={};this._beatById={};this._rhythmOfBeat={};this._rhythmById={};this._notesOfBeat={};this._noteById={};this._tappedNotes={};this.ParseDom(AlphaTab.Platform.Std.LoadXml(n))},ParseDom:function(n){var t=n.documentElement;if(t!=null){if(t.localName=="GPIF")this.Score=new AlphaTab.Model.Score,AlphaTab.Platform.Std.IterateChildren(t,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Score":this.ParseScoreNode(n);break;case"MasterTrack":this.ParseMasterTrackNode(n);break;case"Tracks":this.ParseTracksNode(n);break;case"MasterBars":this.ParseMasterBarsNode(n);break;case"Bars":this.ParseBars(n);break;case"Voices":this.ParseVoices(n);break;case"Beats":this.ParseBeats(n);break;case"Notes":this.ParseNotes(n);break;case"Rhythms":this.ParseRhythms(n)}}));else throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(""),new Error);this.BuildModel()}},ParseScoreNode:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Title":this.Score.Title=this.GetValue(n.firstChild);break;case"SubTitle":this.Score.SubTitle=this.GetValue(n.firstChild);break;case"Artist":this.Score.Artist=this.GetValue(n.firstChild);break;case"Album":this.Score.Album=this.GetValue(n.firstChild);break;case"Words":this.Score.Words=this.GetValue(n.firstChild);break;case"Music":this.Score.Music=this.GetValue(n.firstChild);break;case"WordsAndMusic":if(n.firstChild!=null&&n.firstChild.toString()!=""){var t=this.GetValue(n.firstChild);t==null||t.length==0||this.Score.Words!=null&&this.Score.Words.length!=0||(this.Score.Words=t);t==null||t.length==0||this.Score.Music!=null&&this.Score.Music.length!=0||(this.Score.Music=t)}break;case"Copyright":this.Score.Copyright=this.GetValue(n.firstChild);break;case"Tabber":this.Score.Tab=this.GetValue(n.firstChild);break;case"Instructions":this.Score.Instructions=this.GetValue(n.firstChild);break;case"Notices":this.Score.Notices=this.GetValue(n.firstChild)}}))},ParseMasterTrackNode:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Automations":this.ParseAutomations(n,this._masterTrackAutomations);break;case"Tracks":this._tracksMapping=this.GetValue(n).split(" ")}}))},ParseAutomations:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Automation":this.ParseAutomation(n,t)}}))},ParseAutomation:function(n,t){var u=null,f=!1,i=null,e=0,o=0,s=0,h=null,r;if(AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Type":u=this.GetValue(n);break;case"Linear":f=this.GetValue(n).toLowerCase()=="true";break;case"Bar":i=this.GetValue(n);break;case"Position":e=AlphaTab.Platform.Std.ParseFloat(this.GetValue(n));break;case"Value":var t=this.GetValue(n).split(" ");o=AlphaTab.Platform.Std.ParseFloat(t[0]);s=AlphaTab.Platform.Std.ParseInt(t[1]);break;case"Text":h=this.GetValue(n)}})),u!=null){r=null;switch(u){case"Tempo":r=AlphaTab.Model.Automation.BuildTempoAutomation(f,e,o,s)}r!=null&&(r.Text=h);i!=null&&(t.hasOwnProperty(i)||(t[i]=[]),t[i].push(r))}},ParseTracksNode:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Track":this.ParseTrack(n)}}))},ParseTrack:function(n){var t=new AlphaTab.Model.Track(1),i=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var i,r;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Name":t.Name=this.GetValue(n);break;case"Instrument":i=n.getAttribute("ref");(i.lastIndexOf("-gs")==i.length-3||i.lastIndexOf("GrandStaff")==i.length-10)&&t.EnsureStaveCount(2);break;case"ShortName":t.ShortName=this.GetValue(n);break;case"Properties":this.ParseTrackProperties(t,n);break;case"GeneralMidi":this.ParseGeneralMidi(t,n);break;case"PlaybackState":r=this.GetValue(n);t.PlaybackInfo.IsSolo=r=="Solo";t.PlaybackInfo.IsMute=r=="Mute"}}));this._tracksById[i]=t},ParseDiagramCollection:function(n,t){var i=this.FindChildElement(t,"Items");AlphaTab.Platform.Std.IterateChildren(i,$CreateAnonymousDelegate(this,function(t){if(t.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(t.localName){case"Item":this.ParseDiagramItem(n,t)}}))},ParseDiagramItem:function(n,t){var i=new AlphaTab.Model.Chord,o=t.getAttribute("id"),f;i.Name=t.getAttribute("name");n.Chords[o]=i;var r=this.FindChildElement(t,"Diagram"),e=AlphaTab.Platform.Std.ParseInt(r.getAttribute("stringCount")),u=AlphaTab.Platform.Std.ParseInt(r.getAttribute("baseFret"));for(i.FirstFret=u+1,f=0;f<e;f++)i.Strings.push(-1);AlphaTab.Platform.Std.IterateChildren(r,$CreateAnonymousDelegate(this,function(n){var r,t;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Fret":r=AlphaTab.Platform.Std.ParseInt(n.getAttribute("string"));i.Strings[e-r-1]=u+AlphaTab.Platform.Std.ParseInt(n.getAttribute("fret"));break;case"Fingering":t={};AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Position":var r=AlphaTab.Model.Fingers.Unknown,f=u+AlphaTab.Platform.Std.ParseInt(n.getAttribute("fret"));switch(n.getAttribute("finger")){case"Index":r=AlphaTab.Model.Fingers.IndexFinger;break;case"Middle":r=AlphaTab.Model.Fingers.MiddleFinger;break;case"Rank":r=AlphaTab.Model.Fingers.AnnularFinger;break;case"Pinky":r=AlphaTab.Model.Fingers.LittleFinger;break;case"Thumb":r=AlphaTab.Model.Fingers.Thumb}r!=AlphaTab.Model.Fingers.Unknown&&(t.hasOwnProperty(r)?i.BarreFrets.push(f):t[r]=!0)}}))}}))},FindChildElement:function(n,t){for(var i,r=0;r<n.childNodes.length;r++)if(i=n.childNodes[r],i!=null&&i.nodeType==AlphaTab.Xml.XmlNodeType.Element&&i.localName==t)return i;return null},ParseTrackProperties:function(n,t){AlphaTab.Platform.Std.IterateChildren(t,$CreateAnonymousDelegate(this,function(t){if(t.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(t.localName){case"Property":this.ParseTrackProperty(n,t)}}))},ParseTrackProperty:function(n,t){var f=t.getAttribute("name"),u,i,r;switch(f){case"Tuning":for(u=this.GetValue(this.FindChildElement(t,"Pitches")).split(" "),i=new Int32Array(u.length),r=0;r<i.length;r++)i[i.length-1-r]=AlphaTab.Platform.Std.ParseInt(u[r]);n.Tuning=i;break;case"DiagramCollection":case"ChordCollection":this.ParseDiagramCollection(n,t);break;case"CapoFret":n.Capo=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(t,"Fret")))}},ParseGeneralMidi:function(n,t){n.PlaybackInfo.Port=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(t,"Port")));n.PlaybackInfo.Program=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(t,"Program")));n.PlaybackInfo.PrimaryChannel=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(t,"PrimaryChannel")));n.PlaybackInfo.SecondaryChannel=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(t,"SecondaryChannel")));n.IsPercussion=t.getAttribute("table")=="Percussion"},ParseMasterBarsNode:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"MasterBar":this.ParseMasterBar(n)}}))},ParseMasterBar:function(n){var t=new AlphaTab.Model.MasterBar;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var r,u,f,i,e;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Time":r=this.GetValue(n).split("/");t.TimeSignatureNumerator=AlphaTab.Platform.Std.ParseInt(r[0]);t.TimeSignatureDenominator=AlphaTab.Platform.Std.ParseInt(r[1]);break;case"DoubleBar":t.IsDoubleBar=!0;break;case"Section":t.Section=new AlphaTab.Model.Section;t.Section.Marker=this.GetValue(this.FindChildElement(n,"Letter"));t.Section.Text=this.GetValue(this.FindChildElement(n,"Text"));break;case"Repeat":n.getAttribute("start").toLowerCase()=="true"&&(t.IsRepeatStart=!0);n.getAttribute("end").toLowerCase()=="true"&&n.getAttribute("count")!=null&&(t.RepeatCount=AlphaTab.Platform.Std.ParseInt(n.getAttribute("count")));break;case"AlternateEndings":for(u=this.GetValue(n).split(" "),f=0,i=0;i<u.length;i++)f|=1<<-1+AlphaTab.Platform.Std.ParseInt(u[i]);t.AlternateEndings=f;break;case"Bars":this._barsOfMasterBar.push(this.GetValue(n).split(" "));break;case"TripletFeel":switch(this.GetValue(n)){case"NoTripletFeel":t.TripletFeel=AlphaTab.Model.TripletFeel.NoTripletFeel;break;case"Triplet8th":t.TripletFeel=AlphaTab.Model.TripletFeel.Triplet8th;break;case"Triplet16th":t.TripletFeel=AlphaTab.Model.TripletFeel.Triplet16th;break;case"Dotted8th":t.TripletFeel=AlphaTab.Model.TripletFeel.Dotted8th;break;case"Dotted16th":t.TripletFeel=AlphaTab.Model.TripletFeel.Dotted16th;break;case"Scottish8th":t.TripletFeel=AlphaTab.Model.TripletFeel.Scottish8th;break;case"Scottish16th":t.TripletFeel=AlphaTab.Model.TripletFeel.Scottish16th}break;case"Key":if(t.KeySignature=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"AccidentalCount"))),e=this.FindChildElement(n,"Mode"),e!=null)switch(this.GetValue(e).toLowerCase()){case"major":t.KeySignatureType=AlphaTab.Model.KeySignatureType.Major;break;case"minor":t.KeySignatureType=AlphaTab.Model.KeySignatureType.Minor}}}));this._masterBars.push(t)},ParseBars:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Bar":this.ParseBar(n)}}))},ParseBar:function(n){var t=new AlphaTab.Model.Bar,i=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Voices":this._voicesOfBar[i]=this.GetValue(n).split(" ");break;case"Clef":switch(this.GetValue(n)){case"Neutral":t.Clef=AlphaTab.Model.Clef.Neutral;break;case"G2":t.Clef=AlphaTab.Model.Clef.G2;break;case"F4":t.Clef=AlphaTab.Model.Clef.F4;break;case"C4":t.Clef=AlphaTab.Model.Clef.C4;break;case"C3":t.Clef=AlphaTab.Model.Clef.C3}break;case"Ottavia":switch(this.GetValue(n)){case"8va":t.ClefOttavia=AlphaTab.Model.ClefOttavia._8va;break;case"15ma":t.ClefOttavia=AlphaTab.Model.ClefOttavia._15ma;break;case"8vb":t.ClefOttavia=AlphaTab.Model.ClefOttavia._8vb;break;case"15mb":t.ClefOttavia=AlphaTab.Model.ClefOttavia._15mb}}}));this._barsById[i]=t},ParseVoices:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Voice":this.ParseVoice(n)}}))},ParseVoice:function(n){var i=new AlphaTab.Model.Voice,t=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Beats":this._beatsOfVoice[t]=this.GetValue(n).split(" ")}}));this._voiceById[t]=i},ParseBeats:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Beat":this.ParseBeat(n)}}))},ParseBeat:function(n){var t=new AlphaTab.Model.Beat,i=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Notes":this._notesOfBeat[i]=this.GetValue(n).split(" ");break;case"Rhythm":this._rhythmOfBeat[i]=n.getAttribute("ref");break;case"Fadding":this.GetValue(n)=="FadeIn"&&(t.FadeIn=!0);break;case"Tremolo":switch(this.GetValue(n)){case"1/2":t.TremoloSpeed=AlphaTab.Model.Duration.Eighth;break;case"1/4":t.TremoloSpeed=AlphaTab.Model.Duration.Sixteenth;break;case"1/8":t.TremoloSpeed=AlphaTab.Model.Duration.ThirtySecond}break;case"Chord":t.ChordId=this.GetValue(n);break;case"Hairpin":switch(this.GetValue(n)){case"Crescendo":t.Crescendo=AlphaTab.Model.CrescendoType.Crescendo;break;case"Decrescendo":t.Crescendo=AlphaTab.Model.CrescendoType.Decrescendo}break;case"Arpeggio":t.BrushType=this.GetValue(n)=="Up"?AlphaTab.Model.BrushType.ArpeggioUp:AlphaTab.Model.BrushType.ArpeggioDown;break;case"Properties":this.ParseBeatProperties(n,t);break;case"XProperties":this.ParseBeatXProperties(n,t);break;case"FreeText":t.Text=this.GetValue(n);break;case"Dynamic":switch(this.GetValue(n)){case"PPP":t.Dynamic=AlphaTab.Model.DynamicValue.PPP;break;case"PP":t.Dynamic=AlphaTab.Model.DynamicValue.PP;break;case"P":t.Dynamic=AlphaTab.Model.DynamicValue.P;break;case"MP":t.Dynamic=AlphaTab.Model.DynamicValue.MP;break;case"MF":t.Dynamic=AlphaTab.Model.DynamicValue.MF;break;case"F":t.Dynamic=AlphaTab.Model.DynamicValue.F;break;case"FF":t.Dynamic=AlphaTab.Model.DynamicValue.FF;break;case"FFF":t.Dynamic=AlphaTab.Model.DynamicValue.FFF}break;case"GraceNotes":switch(this.GetValue(n)){case"OnBeat":t.GraceType=AlphaTab.Model.GraceType.OnBeat;break;case"BeforeBeat":t.GraceType=AlphaTab.Model.GraceType.BeforeBeat}break;case"Legato":n.getAttribute("origin")=="true"&&(t.IsLegatoOrigin=!0)}}));this._beatById[i]=t},ParseBeatXProperties:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var i,r;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"XProperty":i=n.getAttribute("id");switch(i){case"1124204545":r=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Int")));t.InvertBeamDirection=r==1}}}))},ParseBeatProperties:function(n,t){var s=!1,i=null,u=null,e=null,o=null,r=null,f;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Property":var f=n.getAttribute("name");switch(f){case"Brush":t.BrushType=this.GetValue(this.FindChildElement(n,"Direction"))=="Up"?AlphaTab.Model.BrushType.BrushUp:AlphaTab.Model.BrushType.BrushDown;break;case"PickStroke":t.PickStroke=this.GetValue(this.FindChildElement(n,"Direction"))=="Up"?AlphaTab.Model.PickStrokeType.Up:AlphaTab.Model.PickStrokeType.Down;break;case"Slapped":this.FindChildElement(n,"Enable")!=null&&(t.Slap=!0);break;case"Popped":this.FindChildElement(n,"Enable")!=null&&(t.Pop=!0);break;case"VibratoWTremBar":switch(this.GetValue(this.FindChildElement(n,"Strength"))){case"Wide":t.Vibrato=AlphaTab.Model.VibratoType.Wide;break;case"Slight":t.Vibrato=AlphaTab.Model.VibratoType.Slight}break;case"WhammyBar":s=!0;break;case"WhammyBarOriginValue":i==null&&(i=new AlphaTab.Model.BendPoint(0,0));i.Value=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarOriginOffset":i==null&&(i=new AlphaTab.Model.BendPoint(0,0));i.Offset=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarMiddleValue":u=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarMiddleOffset1":e=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarMiddleOffset2":o=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarDestinationValue":r==null&&(r=new AlphaTab.Model.BendPoint(60,0));r.Value=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"WhammyBarDestinationOffset":r==null&&(r=new AlphaTab.Model.BendPoint(0,0));r.Offset=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))))}}}));s&&(i==null&&(i=new AlphaTab.Model.BendPoint(0,0)),r==null&&(r=new AlphaTab.Model.BendPoint(60,0)),f=[],f.push(i),e!=null&&u!=null&&f.push(new AlphaTab.Model.BendPoint(e,u)),o!=null&&u!=null&&f.push(new AlphaTab.Model.BendPoint(o,u)),e==null&&o==null&&u!=null&&f.push(new AlphaTab.Model.BendPoint(30,u)),f.push(r),t.WhammyBarPoints=f)},ParseNotes:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Note":this.ParseNote(n)}}))},ParseNote:function(n){var t=new AlphaTab.Model.Note,i=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Properties":this.ParseNoteProperties(n,t,i);break;case"AntiAccent":this.GetValue(n).toLowerCase()=="normal"&&(t.IsGhost=!0);break;case"LetRing":t.IsLetRing=!0;break;case"Trill":t.TrillValue=AlphaTab.Platform.Std.ParseInt(this.GetValue(n));t.TrillSpeed=AlphaTab.Model.Duration.Sixteenth;break;case"Accent":var r=AlphaTab.Platform.Std.ParseInt(this.GetValue(n));(r&1)!=0&&(t.IsStaccato=!0);(r&4)!=0&&(t.Accentuated=AlphaTab.Model.AccentuationType.Heavy);(r&8)!=0&&(t.Accentuated=AlphaTab.Model.AccentuationType.Normal);break;case"Tie":n.getAttribute("origin").toLowerCase()=="true"&&(t.IsTieOrigin=!0);n.getAttribute("destination").toLowerCase()=="true"&&(t.IsTieDestination=!0);break;case"Vibrato":switch(this.GetValue(n)){case"Slight":t.Vibrato=AlphaTab.Model.VibratoType.Slight;break;case"Wide":t.Vibrato=AlphaTab.Model.VibratoType.Wide}break;case"LeftFingering":t.IsFingering=!0;switch(this.GetValue(n)){case"P":t.LeftHandFinger=AlphaTab.Model.Fingers.Thumb;break;case"I":t.LeftHandFinger=AlphaTab.Model.Fingers.IndexFinger;break;case"M":t.LeftHandFinger=AlphaTab.Model.Fingers.MiddleFinger;break;case"A":t.LeftHandFinger=AlphaTab.Model.Fingers.AnnularFinger;break;case"C":t.LeftHandFinger=AlphaTab.Model.Fingers.LittleFinger}break;case"RightFingering":t.IsFingering=!0;switch(this.GetValue(n)){case"P":t.RightHandFinger=AlphaTab.Model.Fingers.Thumb;break;case"I":t.RightHandFinger=AlphaTab.Model.Fingers.IndexFinger;break;case"M":t.RightHandFinger=AlphaTab.Model.Fingers.MiddleFinger;break;case"A":t.RightHandFinger=AlphaTab.Model.Fingers.AnnularFinger;break;case"C":t.RightHandFinger=AlphaTab.Model.Fingers.LittleFinger}}}));this._noteById[i]=t},ParseNoteProperties:function(n,t,i){var s=!1,r=null,f=null,e=null,o=null,u=null;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var a,c,l,h;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Property":a=n.getAttribute("name");switch(a){case"String":t.String=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"String")))+1;break;case"Fret":t.Fret=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Fret")));break;case"Element":t.Element=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Element")));break;case"Variation":t.Variation=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Variation")));break;case"Tapped":this._tappedNotes[i]=!0;break;case"HarmonicType":if(c=this.FindChildElement(n,"HType"),c!=null)switch(this.GetValue(c)){case"NoHarmonic":t.HarmonicType=AlphaTab.Model.HarmonicType.None;break;case"Natural":t.HarmonicType=AlphaTab.Model.HarmonicType.Natural;break;case"Artificial":t.HarmonicType=AlphaTab.Model.HarmonicType.Artificial;break;case"Pinch":t.HarmonicType=AlphaTab.Model.HarmonicType.Pinch;break;case"Tap":t.HarmonicType=AlphaTab.Model.HarmonicType.Tap;break;case"Semi":t.HarmonicType=AlphaTab.Model.HarmonicType.Semi;break;case"Feedback":t.HarmonicType=AlphaTab.Model.HarmonicType.Feedback}break;case"HarmonicFret":l=this.FindChildElement(n,"HFret");l!=null&&(t.HarmonicValue=AlphaTab.Platform.Std.ParseFloat(this.GetValue(l)));break;case"Muted":this.FindChildElement(n,"Enable")!=null&&(t.IsDead=!0);break;case"PalmMuted":this.FindChildElement(n,"Enable")!=null&&(t.IsPalmMute=!0);break;case"Octave":t.Octave=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Number")))-1;break;case"Tone":t.Tone=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Step")));break;case"Bended":s=!0;break;case"BendOriginValue":r==null&&(r=new AlphaTab.Model.BendPoint(0,0));r.Value=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendOriginOffset":r==null&&(r=new AlphaTab.Model.BendPoint(0,0));r.Offset=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendMiddleValue":f=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendMiddleOffset1":e=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendMiddleOffset2":o=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendDestinationValue":u==null&&(u=new AlphaTab.Model.BendPoint(60,0));u.Value=this.ToBendValue(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"BendDestinationOffset":u==null&&(u=new AlphaTab.Model.BendPoint(0,0));u.Offset=this.ToBendOffset(AlphaTab.Platform.Std.ParseFloat(this.GetValue(this.FindChildElement(n,"Float"))));break;case"HopoOrigin":this.FindChildElement(n,"Enable")!=null&&(t.IsHammerPullOrigin=!0);break;case"Slide":h=AlphaTab.Platform.Std.ParseInt(this.GetValue(this.FindChildElement(n,"Flags")));(h&1)!=0&&(t.SlideType=AlphaTab.Model.SlideType.Shift);(h&2)!=0&&(t.SlideType=AlphaTab.Model.SlideType.Legato);(h&4)!=0&&(t.SlideType=AlphaTab.Model.SlideType.OutDown);(h&8)!=0&&(t.SlideType=AlphaTab.Model.SlideType.OutUp);(h&16)!=0&&(t.SlideType=AlphaTab.Model.SlideType.IntoFromBelow);(h&32)!=0&&(t.SlideType=AlphaTab.Model.SlideType.IntoFromAbove)}}}));s&&(r==null&&(r=new AlphaTab.Model.BendPoint(0,0)),u==null&&(u=new AlphaTab.Model.BendPoint(60,0)),t.AddBendPoint(r),e!=null&&f!=null&&t.AddBendPoint(new AlphaTab.Model.BendPoint(e,f)),o!=null&&f!=null&&t.AddBendPoint(new AlphaTab.Model.BendPoint(o,f)),e==null&&o==null&&f!=null&&t.AddBendPoint(new AlphaTab.Model.BendPoint(30,f)),t.AddBendPoint(u))},ToBendValue:function(n){var t=n*.04;return t|0},ToBendOffset:function(n){var t=n*.6;return t|0},ParseRhythms:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"Rhythm":this.ParseRhythm(n)}}))},ParseRhythm:function(n){var t=new AlphaTab.Importer.GpxRhythm,i=n.getAttribute("id");AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"NoteValue":switch(this.GetValue(n)){case"Long":t.Value=AlphaTab.Model.Duration.QuadrupleWhole;break;case"DoubleWhole":t.Value=AlphaTab.Model.Duration.DoubleWhole;break;case"Whole":t.Value=AlphaTab.Model.Duration.Whole;break;case"Half":t.Value=AlphaTab.Model.Duration.Half;break;case"Quarter":t.Value=AlphaTab.Model.Duration.Quarter;break;case"Eighth":t.Value=AlphaTab.Model.Duration.Eighth;break;case"16th":t.Value=AlphaTab.Model.Duration.Sixteenth;break;case"32nd":t.Value=AlphaTab.Model.Duration.ThirtySecond;break;case"64th":t.Value=AlphaTab.Model.Duration.SixtyFourth;break;case"128th":t.Value=AlphaTab.Model.Duration.OneHundredTwentyEighth;break;case"256th":t.Value=AlphaTab.Model.Duration.TwoHundredFiftySixth}break;case"PrimaryTuplet":t.TupletNumerator=AlphaTab.Platform.Std.ParseInt(n.getAttribute("num"));t.TupletDenominator=AlphaTab.Platform.Std.ParseInt(n.getAttribute("den"));break;case"AugmentationDot":t.Dots=AlphaTab.Platform.Std.ParseInt(n.getAttribute("count"))}}));this._rhythmById[i]=t},GetValue:function(n){return AlphaTab.Platform.Std.GetNodeValue(n)},BuildModel:function(){for(var w,et,s,i,h,u,o,c,n,l,yt,v,e,t=0,a=this._masterBars.length;t<a;t++)v=this._masterBars[t],this.Score.AddMasterBar(v);for(var y=0,ft=this._tracksMapping,pt=ft.length,p=ft[y];y<pt;y++,p=ft[y])p!=null&&p.length!=0&&(o=this._tracksById[p],this.Score.AddTrack(o));for(w=0;w<this._barsOfMasterBar.length;w++)for(et=this._barsOfMasterBar[w],s=0,i=0,h=0;i<et.length&&h<this.Score.Tracks.length;i++)u=et[i],u!="-1"?(c=this._barsById[u],o=this.Score.Tracks[h],o.AddBarToStaff(s,c),s==o.Staves.length-1?(h++,s=0):s++):h++;for(var b=0,ot=Object.keys(this._barsById),wt=ot.length,u=ot[b];b<wt;b++,u=ot[b])if(c=this._barsById[u],this._voicesOfBar.hasOwnProperty(u))for(var k=0,st=this._voicesOfBar[u],bt=st.length,f=st[k];k<bt;k++,f=st[k])f!="-1"?c.AddVoice(this._voiceById[f]):(l=new AlphaTab.Model.Voice,c.AddVoice(l),n=new AlphaTab.Model.Beat,n.IsEmpty=!0,n.Duration=AlphaTab.Model.Duration.Quarter,l.AddBeat(n));for(var d=0,ht=Object.keys(this._beatById),kt=ht.length,r=ht[d];d<kt;d++,r=ht[d]){var n=this._beatById[r],dt=this._rhythmOfBeat[r],g=this._rhythmById[dt];if(n.Duration=g.Value,n.Dots=g.Dots,n.TupletNumerator=g.TupletNumerator,n.TupletDenominator=g.TupletDenominator,this._notesOfBeat.hasOwnProperty(r))for(var nt=0,ct=this._notesOfBeat[r],gt=ct.length,tt=ct[nt];nt<gt;nt++,tt=ct[nt])tt!="-1"&&(n.AddNote(this._noteById[tt]),this._tappedNotes.hasOwnProperty(tt)&&(n.Tap=!0))}for(var it=0,lt=Object.keys(this._voiceById),ni=lt.length,f=lt[it];it<ni;it++,f=lt[it])if(l=this._voiceById[f],this._beatsOfVoice.hasOwnProperty(f))for(var rt=0,at=this._beatsOfVoice[f],ti=at.length,r=at[rt];rt<ti;rt++,r=at[rt])r!="-1"&&l.AddBeat(this._beatById[r].Clone());for(var ut=0,vt=Object.keys(this._masterTrackAutomations),ii=vt.length,i=vt[ut];ut<ii;ut++,i=vt[ut])for(yt=this._masterTrackAutomations[i],v=this.Score.MasterBars[AlphaTab.Platform.Std.ParseInt(i)],t=0,a=yt.length;t<a;t++)e=yt[t],e.Type==AlphaTab.Model.AutomationType.Tempo&&(i=="0"&&(this.Score.Tempo=e.Value|0,e.Text!=null&&(this.Score.TempoLabel=e.Text)),v.TempoAutomation=e)}},$StaticConstructor(function(){AlphaTab.Importer.GpxParser.InvalidId="-1";AlphaTab.Importer.GpxParser.BendPointPositionFactor=.6;AlphaTab.Importer.GpxParser.BendPointValueFactor=.04}),AlphaTab.Importer.MixTableChange=function(){this.Volume=0;this.Balance=0;this.Instrument=0;this.TempoName=null;this.Tempo=0;this.Duration=0;this.Volume=-1;this.Balance=-1;this.Instrument=-1;this.TempoName=null;this.Tempo=-1;this.Duration=0},AlphaTab.Importer.MusicXmlImporter=function(){this._score=null;this._trackById=null;this._trackFirstMeasureNumber=0;this._maxVoices=0;this._currentChord=null;this._divisionsPerQuarterNote=0;this._voiceOfStaff={};this._isBeamContinue=!1;this._previousBeatWasPulled=!1;this._previousBeat=null;AlphaTab.Importer.ScoreImporter.call(this)},AlphaTab.Importer.MusicXmlImporter.prototype={get_Name:function(){return"MusicXML"},ReadScore:function(){this._trackById={};var t=AlphaTab.Platform.Std.ToString(this.Data.ReadAll()),n;try{n=AlphaTab.Platform.Std.LoadXml(t)}catch(i){throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(""),new Error);}return this._score=new AlphaTab.Model.Score,this._score.Tempo=120,this.ParseDom(n),this._score.Finish(),this._score},ParseDom:function(n){var t=n.documentElement;if(t!=null)switch(t.localName){case"score-partwise":this.ParsePartwise(t);break;case"score-timewise":break;default:throw $CreateException(new AlphaTab.Importer.UnsupportedFormatException(""),new Error);}},ParsePartwise:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"movement-title":this._score.Title=AlphaTab.Platform.Std.GetNodeValue(n.firstChild);break;case"identification":this.ParseIdentification(n);break;case"part-list":this.ParsePartList(n);break;case"part":this.ParsePart(n)}}))},ParsePart:function(n){var i=n.getAttribute("id"),r,t;this._trackById.hasOwnProperty(i)&&(r=this._trackById[i],t=!0,AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"measure":this.ParseMeasure(n,r,t)&&(t=!1)}})))},ParseMeasure:function(n,t,i){var u,s,h,y,f,e,c,r,o,p,l,a,w,v;if(n.getAttribute("implicit")=="yes"&&n.getElementsByTagName("note").length==0)return!1;if(u=0,i)this._divisionsPerQuarterNote=0,this._trackFirstMeasureNumber=AlphaTab.Platform.Std.ParseInt(n.getAttribute("number")),this._trackFirstMeasureNumber==-2147483648&&(this._trackFirstMeasureNumber=0),u=0;else{if(u=AlphaTab.Platform.Std.ParseInt(n.getAttribute("number")),u==-2147483648)return!1;u-=this._trackFirstMeasureNumber}for(i&&(s=n.getElementsByTagName("attributes"),s.length>0&&(h=s[0].getElementsByTagName("staves"),h.length>0&&(y=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(h[0])),t.EnsureStaveCount(y)))),f=new Array(t.Staves.length),e=null,c=t.Staves[0].Bars.length;c<=u;c++)for(r=0;r<t.Staves.length;r++)for(o=f[r]=new AlphaTab.Model.Bar,t.Staves[r].Bars.length>0&&(p=t.Staves[r].Bars[t.Staves[r].Bars.length-1],o.Clef=p.Clef),e=this.GetOrCreateMasterBar(u),t.AddBarToStaff(r,o),l=0;l<this._maxVoices;l++)a=new AlphaTab.Model.Voice,o.AddVoice(a),w=function(){var n=new AlphaTab.Model.Beat;return n.IsEmpty=!0,n}.call(this),a.AddBeat(w);return v=!1,AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"note":this.ParseNoteBeat(n,f);break;case"forward":this.ParseForward(n,f);break;case"direction":this.ParseDirection(n,e);break;case"attributes":v||(this.ParseAttributes(n,f,e),v=!0);break;case"harmony":this.ParseHarmony(n,t);break;case"barline":this.ParseBarline(n,e)}})),!0},GetOrCreateBeat:function(n,t,i){var e=0,h=n.getElementsByTagName("voice"),c,s,r,o,l,f,u;return h.length>0&&(e=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(h[0]))-1),c=this._previousBeatWasPulled,this._previousBeatWasPulled=!1,s=n.getElementsByTagName("staff"),r=1,s.length>0&&(r=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(s[0])),(this._isBeamContinue||c)&&this._previousBeat.Voice.Bar.Staff.Index!=r-1&&(r=this._previousBeat.Voice.Bar.Staff.Index+1,this._previousBeatWasPulled=!0),o=t[0].Staff.Track.Index+"-"+r,this._voiceOfStaff.hasOwnProperty(o)||(this._voiceOfStaff[o]=e),e-=this._voiceOfStaff[o]),l=t[r-1],u=this.GetOrCreateVoice(l,e),i||u.Beats.length==1&&u.IsEmpty?f=u.Beats[u.Beats.length-1]:(f=new AlphaTab.Model.Beat,u.AddBeat(f)),this._isBeamContinue=!1,this._previousBeat=f,f},ParseForward:function(n,t){for(var e=this.GetOrCreateBeat(n,t,!1),o=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n.getElementsByTagName("duration")[0])),u=o*4/this._divisionsPerQuarterNote,f=new Int32Array([64,32,16,8,4,2,1]),i=0,s=f.length,r=f[i];i<s;i++,r=f[i])if(u>=r){e.Duration=r;u-=r;break}u>0;e.IsEmpty=!1},ParseStaffDetails:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"staff-lines":t.Tuning=new Int32Array(AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n)));break;case"staff-tuning":this.ParseStaffTuning(n,t)}}));this.IsEmptyTuning(t.Tuning)&&(t.Tuning=new Int32Array(0))},ParseStaffTuning:function(n,t){var f=AlphaTab.Platform.Std.ParseInt(n.getAttribute("line")),i="C",r="",u=0;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"tuning-step":i=AlphaTab.Platform.Std.GetNodeValue(n);break;case"tuning-alter":u=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"tuning-octave":r=AlphaTab.Platform.Std.GetNodeValue(n)}}));t.Tuning[t.Tuning.length-f]=AlphaTab.Model.TuningParser.GetTuningForText(i+r)+u},ParseHarmony:function(n,t){var r=n.getElementsByTagName("root")[0],u=AlphaTab.Platform.Std.GetNodeValue(r.getElementsByTagName("root-step")[0]),f=AlphaTab.Platform.Std.GetNodeValue(n.getElementsByTagName("kind")[0]),i=new AlphaTab.Model.Chord;i.Name=u;this._currentChord=AlphaTab.Platform.Std.NewGuid();t.Chords[this._currentChord]=i},ParseBarline:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"repeat":this.ParseRepeat(n,t);break;case"ending":this.ParseEnding(n,t)}}))},ParseEnding:function(n,t){var i=AlphaTab.Platform.Std.ParseInt(n.getAttribute("number"));i>0&&(--i,t.AlternateEndings|=1<<i)},ParseRepeat:function(n,t){var r=n.getAttribute("direction"),i=AlphaTab.Platform.Std.ParseInt(n.getAttribute("times"));i<0&&(i=2);r=="backward"?t.RepeatCount=i:r=="forward"&&(t.IsRepeatStart=!0)},ParseNoteBeat:function(n,t){var f=n.getElementsByTagName("chord").length>0,i=this.GetOrCreateBeat(n,t,f),r,u;if(i.ChordId=this._currentChord,this._currentChord=null,r=new AlphaTab.Model.Note,i.AddNote(r),i.IsEmpty=!1,i.Dots=0,AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var t,u;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"grace":i.GraceType=AlphaTab.Model.GraceType.BeforeBeat;i.Duration=AlphaTab.Model.Duration.ThirtySecond;break;case"duration":if(i.get_IsRest()){t=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));switch(t){case 1:i.Duration=AlphaTab.Model.Duration.Whole;break;case 2:i.Duration=AlphaTab.Model.Duration.Half;break;case 4:i.Duration=AlphaTab.Model.Duration.Quarter;break;case 8:i.Duration=AlphaTab.Model.Duration.Eighth;break;case 16:i.Duration=AlphaTab.Model.Duration.Sixteenth;break;case 32:i.Duration=AlphaTab.Model.Duration.ThirtySecond;break;case 64:i.Duration=AlphaTab.Model.Duration.SixtyFourth;break;default:i.Duration=AlphaTab.Model.Duration.Quarter}}break;case"tie":AlphaTab.Importer.MusicXmlImporter.ParseTied(n,r);break;case"type":switch(AlphaTab.Platform.Std.GetNodeValue(n)){case"256th":case"128th":case"64th":i.Duration=AlphaTab.Model.Duration.SixtyFourth;break;case"32nd":i.Duration=AlphaTab.Model.Duration.ThirtySecond;break;case"16th":i.Duration=AlphaTab.Model.Duration.Sixteenth;break;case"eighth":i.Duration=AlphaTab.Model.Duration.Eighth;break;case"quarter":i.Duration=AlphaTab.Model.Duration.Quarter;break;case"half":i.Duration=AlphaTab.Model.Duration.Half;break;case"long":case"breve":case"whole":i.Duration=AlphaTab.Model.Duration.Whole}i.GraceType!=AlphaTab.Model.GraceType.None&&i.Duration<AlphaTab.Model.Duration.Sixteenth&&(i.Duration=AlphaTab.Model.Duration.Eighth);break;case"dot":i.Dots++;break;case"accidental":this.ParseAccidental(n,r);break;case"time-modification":this.ParseTimeModification(n,i);break;case"notehead":n.getAttribute("parentheses")=="yes"&&(r.IsGhost=!0);break;case"beam":u=AlphaTab.Platform.Std.GetNodeValue(n);u=="continue"&&(this._isBeamContinue=!0);break;case"notations":this.ParseNotations(n,i,r);break;case"lyric":this.ParseLyric(n,i);break;case"pitch":this.ParsePitch(n,r);break;case"unpitched":this.ParseUnpitched(n,r);break;case"rest":i.IsEmpty=!1;i.Notes=[]}})),r.get_IsStringed())for(u=0;u<i.Notes.length;u++)if(i.Notes[u].String==r.String&&i.Notes[u]!=r){i.RemoveNote(r);break}},ParseLyric:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"text":t.Text==null||t.Text.length==0?t.Text=AlphaTab.Platform.Std.GetNodeValue(n):t.Text+=" "+AlphaTab.Platform.Std.GetNodeValue(n)}}))},ParseAccidental:function(n,t){switch(AlphaTab.Platform.Std.GetNodeValue(n)){case"sharp":t.AccidentalMode=AlphaTab.Model.NoteAccidentalMode.ForceSharp;break;case"natural":t.AccidentalMode=AlphaTab.Model.NoteAccidentalMode.ForceNatural;break;case"flat":t.AccidentalMode=AlphaTab.Model.NoteAccidentalMode.ForceFlat}},ParseNotations:function(n,t,i){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"articulations":this.ParseArticulations(n,i);break;case"tied":AlphaTab.Importer.MusicXmlImporter.ParseTied(n,i);break;case"slide":case"glissando":n.getAttribute("type")=="start"&&(i.SlideType=AlphaTab.Model.SlideType.Shift);break;case"dynamics":this.ParseDynamics(n,t);break;case"technical":this.ParseTechnical(n,i);break;case"ornaments":this.ParseOrnaments(n,i);break;case"slur":n.getAttribute("type")=="start"&&(t.IsLegatoOrigin=!0)}}))},ParseOrnaments:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"tremolo":var i=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));switch(i){case 1:t.Beat.TremoloSpeed=AlphaTab.Model.Duration.Eighth;break;case 2:t.Beat.TremoloSpeed=AlphaTab.Model.Duration.Sixteenth;break;case 3:t.Beat.TremoloSpeed=AlphaTab.Model.Duration.ThirtySecond}}}))},ParseTechnical:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"string":t.String=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));t.String!=-2147483648&&(t.String=t.Beat.Voice.Bar.Staff.Track.Tuning.length-t.String+1);break;case"fret":t.Fret=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n))}}));(t.String==-2147483648||t.Fret==-2147483648)&&(t.String=-1,t.Fret=-1)},ParseArticulations:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){switch(n.localName){case"accent":t.Accentuated=AlphaTab.Model.AccentuationType.Normal;break;case"strong-accent":t.Accentuated=AlphaTab.Model.AccentuationType.Heavy;break;case"staccato":case"detached-legato":t.IsStaccato=!0}}))},ParseDynamics:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"p":t.Dynamic=AlphaTab.Model.DynamicValue.P;break;case"pp":t.Dynamic=AlphaTab.Model.DynamicValue.PP;break;case"ppp":t.Dynamic=AlphaTab.Model.DynamicValue.PPP;break;case"f":t.Dynamic=AlphaTab.Model.DynamicValue.F;break;case"ff":t.Dynamic=AlphaTab.Model.DynamicValue.FF;break;case"fff":t.Dynamic=AlphaTab.Model.DynamicValue.FFF;break;case"mp":t.Dynamic=AlphaTab.Model.DynamicValue.MP;break;case"mf":t.Dynamic=AlphaTab.Model.DynamicValue.MF}}))},ParseTimeModification:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"actual-notes":t.TupletNumerator=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"normal-notes":t.TupletDenominator=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n))}}))},ParseUnpitched:function(n,t){var r=null,u=0,f=0,i;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"display-step":r=AlphaTab.Platform.Std.GetNodeValue(n);break;case"display-alter":u=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"display-octave":f=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n))}}));i=f*12+AlphaTab.Model.TuningParser.GetToneForText(r)+u;t.Octave=i/12|0;t.Tone=i-t.Octave*12},ParsePitch:function(n,t){var u=null,i=0,f=0,r;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"step":u=AlphaTab.Platform.Std.GetNodeValue(n);break;case"alter":i=AlphaTab.Platform.Std.ParseFloat(AlphaTab.Platform.Std.GetNodeValue(n));System.Single.IsNaN(i)&&(i=0);break;case"octave":f=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n))}}));r=f*12+AlphaTab.Model.TuningParser.GetToneForText(u)+i|0;t.Octave=r/12|0;t.Tone=r-t.Octave*12},GetOrCreateVoice:function(n,t){if(t<n.Voices.length)return n.Voices[t];for(var i=n.Voices.length;i<=t;i++)n.AddVoice(new AlphaTab.Model.Voice);return this._maxVoices=Math.max(this._maxVoices,n.Voices.length),n.Voices[t]},ParseDirection:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){var r,i,u;if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"sound":r=n.getAttribute("tempo");r==null||r.length==0||(i=new AlphaTab.Model.Automation,i.IsLinear=!0,i.Type=AlphaTab.Model.AutomationType.Tempo,i.Value=AlphaTab.Platform.Std.ParseInt(r),t.TempoAutomation=i);break;case"direction-type":u=n.firstChild;switch(u.localName){case"words":t.Section=new AlphaTab.Model.Section;t.Section.Text=AlphaTab.Platform.Std.GetNodeValue(u)}}}))},ParseAttributes:function(n,t,i){var r,u=!1;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"divisions":this._divisionsPerQuarterNote=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"key":this.ParseKey(n,i);break;case"time":this.ParseTime(n,i);u=!0;break;case"clef":r=AlphaTab.Platform.Std.ParseInt(n.getAttribute("number"));r==-2147483648&&(r=1);this.ParseClef(n,t[r-1]);break;case"staff-details":r=AlphaTab.Platform.Std.ParseInt(n.getAttribute("number"));r==-2147483648&&(r=1);this.ParseStaffDetails(n,t[r-1].Staff.Track)}}));u||(i.TimeSignatureCommon=!0)},ParseClef:function(n,t){var i=null,r=0;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"sign":i=AlphaTab.Platform.Std.GetNodeValue(n);break;case"line":r=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"clef-octave-change":switch(AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n))){case-2:t.ClefOttavia=AlphaTab.Model.ClefOttavia._15mb;break;case-1:t.ClefOttavia=AlphaTab.Model.ClefOttavia._8vb;break;case 1:t.ClefOttavia=AlphaTab.Model.ClefOttavia._8va;break;case 2:t.ClefOttavia=AlphaTab.Model.ClefOttavia._15mb}}}));switch(i){case"G":t.Clef=AlphaTab.Model.Clef.G2;break;case"F":t.Clef=AlphaTab.Model.Clef.F4;break;case"C":t.Clef=r==3?AlphaTab.Model.Clef.C3:AlphaTab.Model.Clef.C4;break;case"percussion":t.Clef=AlphaTab.Model.Clef.Neutral;break;default:t.Clef=AlphaTab.Model.Clef.G2}},ParseTime:function(n,t){n.getAttribute("symbol")=="common"&&(t.TimeSignatureCommon=!0);var i=!1,r=!1;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element){var u=AlphaTab.Platform.Std.GetNodeValue(n);switch(n.localName){case"beats":i||(t.TimeSignatureNumerator=!u.indexOf("+")!=-1?AlphaTab.Platform.Std.ParseInt(u):4,i=!0);break;case"beat-type":r||(t.TimeSignatureDenominator=!u.indexOf("+")!=-1?AlphaTab.Platform.Std.ParseInt(u):4,r=!0)}}}))},ParseKey:function(n,t){var i=-2147483648,u=-2147483648,f=-2147483648,r=null;AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"fifths":i=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"key-step":u=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"key-alter":f=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n));break;case"mode":r=AlphaTab.Platform.Std.GetNodeValue(n)}}));t.KeySignature=-7<=i&&i<=7?i:0;t.KeySignatureType=r=="minor"?AlphaTab.Model.KeySignatureType.Minor:AlphaTab.Model.KeySignatureType.Major},GetOrCreateMasterBar:function(n){var r,t,i;if(n<this._score.MasterBars.length)return this._score.MasterBars[n];for(r=this._score.MasterBars.length;r<=n;r++)t=new AlphaTab.Model.MasterBar,this._score.MasterBars.length>0&&(i=this._score.MasterBars[this._score.MasterBars.length-1],t.TimeSignatureDenominator=i.TimeSignatureDenominator,t.TimeSignatureNumerator=i.TimeSignatureNumerator,t.KeySignature=i.KeySignature,t.KeySignatureType=i.KeySignatureType),this._score.AddMasterBar(t);return this._score.MasterBars[n]},ParseIdentification:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"creator":n.getAttribute("type")=="composer"&&(this._score.Words=AlphaTab.Platform.Std.GetNodeValue(n.firstChild));break;case"rights":this._score.Copyright==null||this._score.Copyright.length==0||(this._score.Copyright+="\n");this._score.Copyright+=AlphaTab.Platform.Std.GetNodeValue(n.firstChild)}}))},ParsePartList:function(n){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"score-part":this.ParseScorePart(n)}}))},ParseScorePart:function(n){var i=n.getAttribute("id"),t=new AlphaTab.Model.Track(1);this._trackById[i]=t;this._score.AddTrack(t);AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"part-name":t.Name=AlphaTab.Platform.Std.GetNodeValue(n.firstChild);break;case"part-abbreviation":t.ShortName=AlphaTab.Platform.Std.GetNodeValue(n.firstChild);break;case"midi-instrument":this.ParseMidiInstrument(n,t)}}));this.IsEmptyTuning(t.Tuning)&&(t.Tuning=new Int32Array(0))},IsEmptyTuning:function(n){if(n==null)return!0;for(var t=0;t<n.length;t++)if(n[t]!=0)return!1;return!0},ParseMidiInstrument:function(n,t){AlphaTab.Platform.Std.IterateChildren(n,$CreateAnonymousDelegate(this,function(n){if(n.nodeType==AlphaTab.Xml.XmlNodeType.Element)switch(n.localName){case"midi-channel":t.PlaybackInfo.PrimaryChannel=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n.firstChild));break;case"midi-program":t.PlaybackInfo.Program=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n.firstChild));break;case"midi-volume":t.PlaybackInfo.Volume=AlphaTab.Platform.Std.ParseInt(AlphaTab.Platform.Std.GetNodeValue(n.firstChild))}}))}},AlphaTab.Importer.MusicXmlImporter.ParseTied=function(n,t){t.Beat.GraceType==AlphaTab.Model.GraceType.None&&(n.getAttribute("type")=="start"?t.IsTieOrigin=!0:t.IsTieDestination=!0)},$Inherit(AlphaTab.Importer.MusicXmlImporter,AlphaTab.Importer.ScoreImporter),AlphaTab.Importer.NoCompatibleReaderFoundException=function(){},AlphaTab.Importer.ScoreLoader=function(){},AlphaTab.Importer.ScoreLoader.LoadScoreAsync=function(n,t,i){var r=AlphaTab.Environment.FileLoaders["default"]();AlphaTab.Util.Logger.Info("ScoreLoader","Loading score from '"+n+"'");r.LoadBinaryAsync(n,function(n){var r=null;try{r=AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(n)}catch(u){i(u)}r!=null&&t(r)},i)},AlphaTab.Importer.ScoreLoader.LoadScore=function(n){var t=AlphaTab.Environment.FileLoaders["default"](),i=t.LoadBinary(n);return AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes(i)},AlphaTab.Importer.ScoreLoader.LoadScoreFromBytes=function(n){var i=AlphaTab.Importer.ScoreImporter.BuildImporters(),r,f;AlphaTab.Util.Logger.Info("ScoreLoader","Loading score from "+n.length+" bytes using "+i.length+" importers");r=null;f=AlphaTab.IO.ByteBuffer.FromBuffer(n);for(var u=0,o=i.length,t=i[u];u<o;u++,t=i[u]){f.Reset();try{AlphaTab.Util.Logger.Info("ScoreLoader","Importing using importer "+t.get_Name());t.Init(f);r=t.ReadScore();AlphaTab.Util.Logger.Info("ScoreLoader","Score imported using "+t.get_Name());break}catch(e){if(e.exception instanceof AlphaTab.Importer.UnsupportedFormatException)AlphaTab.Util.Logger.Info("ScoreLoader",t.get_Name()+" does not support the file");else{AlphaTab.Util.Logger.Info("ScoreLoader","Score import failed due to unexpected error: "+e.get_Message());throw $CreateException(e,new Error);}}}if(r!=null)return r;AlphaTab.Util.Logger.Info("ScoreLoader","No compatible importer found for file");throw $CreateException(new AlphaTab.Importer.NoCompatibleReaderFoundException,new Error);},AlphaTab.Importer.UnsupportedFormatException=function(){},AlphaTab.IO=AlphaTab.IO||{},AlphaTab.IO.BitReader=function(n){this._currentByte=0;this._position=0;this._source=null;this._source=n;this._position=8},AlphaTab.IO.BitReader.prototype={ReadByte:function(){return this.ReadBits(8)},ReadBytes:function(n){for(var i=new Uint8Array(n),t=0;t<n;t++)i[t]=this.ReadByte();return i},ReadBits:function(n){for(var i=0,t=n-1;t>=0;)i|=this.ReadBit()<<t,t--;return i},ReadBitsReversed:function(n){for(var i=0,t=0;t<n;t++)i|=this.ReadBit()<<t;return i},ReadBit:function(){if(this._position>=8){if(this._currentByte=this._source.ReadByte(),this._currentByte==-1)throw $CreateException(new AlphaTab.IO.EndOfReaderException,new Error);this._position=0}var n=this._currentByte>>7-this._position&1;return this._position++,n},ReadAll:function(){var n=AlphaTab.IO.ByteBuffer.Empty();try{for(;;)n.WriteByte(this.ReadByte())}catch(t){}return n.ToArray()}},$StaticConstructor(function(){AlphaTab.IO.BitReader.ByteSize=8}),AlphaTab.IO.FileLoadException=function(){},AlphaTab.IO.EndOfReaderException=function(){},AlphaTab.IO.ByteBuffer=function(){this._buffer=null;this._position=0;this._length=0;this._capacity=0},AlphaTab.IO.ByteBuffer.prototype={get_Length:function(){return this._length},GetBuffer:function(){return this._buffer},Reset:function(){this._position=0},Skip:function(n){this._position+=n},SetCapacity:function(n){if(n!=this._capacity){if(n>0){var t=new Uint8Array(n);this._length>0&&t.set(this._buffer.subarray(0,0+this._length),0);this._buffer=t}else this._buffer=null;this._capacity=n}},ReadByte:function(){var n=this._length-this._position;return n<=0?-1:this._buffer[this._position++]},Read:function(n,t,i){var r=this._length-this._position,u;if(r>i&&(r=i),r<=0)return 0;if(r<=8)for(u=r;--u>=0;)n[t+u]=this._buffer[this._position+u];else n.set(this._buffer.subarray(this._position,this._position+r),t);return this._position+=r,r},WriteByte:function(n){var t=new Uint8Array(1);t[0]=n;this.Write(t,0,1)},Write:function(n,t,i){var r=this._position+i,u;if(r>this._length&&(r>this._capacity&&this.EnsureCapacity(r),this._length=r),i<=8&&n!=this._buffer)for(u=i;--u>=0;)this._buffer[this._position+u]=n[t+u];else this._buffer.set(n.subarray(t,t+Math.min(i,n.length-t)),this._position);this._position=r},EnsureCapacity:function(n){if(n>this._capacity){var t=n;t<256&&(t=256);t<this._capacity*2&&(t=this._capacity*2);this.SetCapacity(t)}},ReadAll:function(){return this.ToArray()},ToArray:function(){var n=new Uint8Array(this._length);return n.set(this._buffer.subarray(0,0+this._length),0),n}},AlphaTab.IO.ByteBuffer.Empty=function(){return AlphaTab.IO.ByteBuffer.WithCapactiy(0)},AlphaTab.IO.ByteBuffer.WithCapactiy=function(n){var t=new AlphaTab.IO.ByteBuffer;return t._buffer=new Uint8Array(n),t._capacity=n,t},AlphaTab.IO.ByteBuffer.FromBuffer=function(n){var t=new AlphaTab.IO.ByteBuffer;return t._buffer=n,t._capacity=t._length=n.length,t},AlphaTab.Model.AccentuationType={None:0,Normal:1,Heavy:2},AlphaTab.Model.AccidentalType={None:0,Natural:1,Sharp:2,Flat:3},AlphaTab.Model.Automation=function(){this.IsLinear=!1;this.Type=AlphaTab.Model.AutomationType.Tempo;this.Value=0;this.RatioPosition=0;this.Text=null},AlphaTab.Model.Automation.prototype={Clone:function(){var n=new AlphaTab.Model.Automation;return AlphaTab.Model.Automation.CopyTo(this,n),n}},AlphaTab.Model.Automation.BuildTempoAutomation=function(n,t,i,r){(r<1||r>5)&&(r=2);var f=new Float32Array([1,.5,1,1.5,2,3]),u=new AlphaTab.Model.Automation;return u.Type=AlphaTab.Model.AutomationType.Tempo,u.IsLinear=n,u.RatioPosition=t,u.Value=i*f[r],u},AlphaTab.Model.Automation.CopyTo=function(n,t){t.IsLinear=n.IsLinear;t.RatioPosition=n.RatioPosition;t.Text=n.Text;t.Type=n.Type;t.Value=n.Value},AlphaTab.Model.AutomationType={Tempo:0,Volume:1,Instrument:2,Balance:3},AlphaTab.Model.Bar=function(){this.Id=0;this.Index=0;this.NextBar=null;this.PreviousBar=null;this.Clef=AlphaTab.Model.Clef.Neutral;this.ClefOttavia=AlphaTab.Model.ClefOttavia._15ma;this.Staff=null;this.Voices=null;this.Id=AlphaTab.Model.Bar.GlobalBarId++;this.Voices=[];this.Clef=AlphaTab.Model.Clef.G2;this.ClefOttavia=AlphaTab.Model.ClefOttavia.Regular},AlphaTab.Model.Bar.prototype={AddVoice:function(n){n.Bar=this;n.Index=this.Voices.length;this.Voices.push(n)},get_MasterBar:function(){return this.Staff.Track.Score.MasterBars[this.Index]},get_IsEmpty:function(){for(var n=0,t=this.Voices.length;n<t;n++)if(!this.Voices[n].IsEmpty)return!1;return!0},Finish:function(){for(var i,n=0,t=this.Voices.length;n<t;n++)i=this.Voices[n],i.Finish()}},$StaticConstructor(function(){AlphaTab.Model.Bar.GlobalBarId=0}),AlphaTab.Model.Bar.CopyTo=function(n,t){t.Id=n.Id;t.Index=n.Index;t.Clef=n.Clef;t.ClefOttavia=n.ClefOttavia},AlphaTab.Model.Beat=function(){this._minNote=null;this._maxNote=null;this._maxStringNote=null;this._minStringNote=null;this.PreviousBeat=null;this.NextBeat=null;this.Id=0;this.Index=0;this.Voice=null;this.Notes=null;this.IsEmpty=!1;this.IsLegatoOrigin=!1;this.Duration=AlphaTab.Model.Duration.QuadrupleWhole;this.Automations=null;this.Dots=0;this.FadeIn=!1;this.Lyrics=null;this.Pop=!1;this.HasRasgueado=!1;this.Slap=!1;this.Tap=!1;this.Text=null;this.BrushType=AlphaTab.Model.BrushType.None;this.BrushDuration=0;this.TupletDenominator=0;this.TupletNumerator=0;this.WhammyBarPoints=null;this.MaxWhammyPoint=null;this.Vibrato=AlphaTab.Model.VibratoType.None;this.ChordId=null;this.GraceType=AlphaTab.Model.GraceType.None;this.PickStroke=AlphaTab.Model.PickStrokeType.None;this.TremoloSpeed=null;this.Crescendo=AlphaTab.Model.CrescendoType.None;this.Start=0;this.Dynamic=AlphaTab.Model.DynamicValue.PPP;this.InvertBeamDirection=!1;this.Id=AlphaTab.Model.Beat.GlobalBeatId++;this.WhammyBarPoints=[];this.Notes=[];this.BrushType=AlphaTab.Model.BrushType.None;this.Vibrato=AlphaTab.Model.VibratoType.None;this.GraceType=AlphaTab.Model.GraceType.None;this.PickStroke=AlphaTab.Model.PickStrokeType.None;this.Duration=AlphaTab.Model.Duration.Quarter;this.TremoloSpeed=null;this.Automations=[];this.Dots=0;this.Start=0;this.TupletDenominator=-1;this.TupletNumerator=-1;this.Dynamic=AlphaTab.Model.DynamicValue.F;this.Crescendo=AlphaTab.Model.CrescendoType.None;this.InvertBeamDirection=!1;this.Lyrics=[]},AlphaTab.Model.Beat.prototype={get_IsLegatoDestination:function(){return this.PreviousBeat!=null&&this.PreviousBeat.IsLegatoOrigin},get_MinNote:function(){return this._minNote==null&&this.RefreshNotes(),this._minNote},get_MaxNote:function(){return this._maxNote==null&&this.RefreshNotes(),this._maxNote},get_MaxStringNote:function(){return this._maxStringNote==null&&this.RefreshNotes(),this._maxStringNote},get_MinStringNote:function(){return this._minStringNote==null&&this.RefreshNotes(),this._minStringNote},get_IsRest:function(){return this.Notes.length==0},get_HasTuplet:function(){return!(this.TupletDenominator==-1&&this.TupletNumerator==-1)&&!(this.TupletDenominator==1&&this.TupletNumerator==1)},get_HasWhammyBar:function(){return this.WhammyBarPoints.length>0},get_HasChord:function(){return this.ChordId!=null},get_Chord:function(){return this.Voice.Bar.Staff.Track.Chords[this.ChordId]},get_IsTremolo:function(){return this.TremoloSpeed!=null},get_AbsoluteStart:function(){return this.Voice.Bar.get_MasterBar().Start+this.Start},Clone:function(){for(var t=new AlphaTab.Model.Beat,r=t.Id,n=0,i=this.WhammyBarPoints.length;n<i;n++)t.AddWhammyBarPoint(this.WhammyBarPoints[n].Clone());for(n=0,i=this.Notes.length;n<i;n++)t.AddNote(this.Notes[n].Clone());for(AlphaTab.Model.Beat.CopyTo(this,t),n=0,i=this.Automations.length;n<i;n++)t.Automations.push(this.Automations[n].Clone());return t.Id=r,t},AddWhammyBarPoint:function(n){this.WhammyBarPoints.push(n);(this.MaxWhammyPoint==null||n.Value>this.MaxWhammyPoint.Value)&&(this.MaxWhammyPoint=n)},RemoveWhammyBarPoint:function(n){var u;if(!(n<0)&&!(n>=this.WhammyBarPoints.length)&&(this.WhammyBarPoints.splice(n,1),u=this.WhammyBarPoints[n],u==this.MaxWhammyPoint)){this.MaxWhammyPoint=null;for(var t=0,i=this.WhammyBarPoints,f=i.length,r=i[t];t<f;t++,r=i[t])(this.MaxWhammyPoint==null||r.Value>this.MaxWhammyPoint.Value)&&(this.MaxWhammyPoint=r)}},CalculateDuration:function(){var n=AlphaTab.Audio.MidiUtils.ToTicks(this.Duration);return this.Dots==2?n=AlphaTab.Audio.MidiUtils.ApplyDot(n,!0):this.Dots==1&&(n=AlphaTab.Audio.MidiUtils.ApplyDot(n,!1)),this.TupletDenominator>0&&this.TupletNumerator>=0&&(n=AlphaTab.Audio.MidiUtils.ApplyTuplet(n,this.TupletNumerator,this.TupletDenominator)),n},AddNote:function(n){n.Beat=this;n.Index=this.Notes.length;this.Notes.push(n)},RemoveNote:function(n){var t=this.Notes.indexOf(n);t>=0&&this.Notes.splice(t,1);(n==this._minNote||n==this._maxNote||n==this._minStringNote||n==this._maxStringNote)&&this.RefreshNotes()},RefreshNotes:function(){for(var n,t=0,i=this.Notes.length;t<i;t++)n=this.Notes[t],(this._minNote==null||n.get_RealValue()<this._minNote.get_RealValue())&&(this._minNote=n),(this._maxNote==null||n.get_RealValue()>this._maxNote.get_RealValue())&&(this._maxNote=n),(this._minStringNote==null||n.String<this._minStringNote.String)&&(this._minStringNote=n),(this._maxStringNote==null||n.String>this._maxStringNote.String)&&(this._maxStringNote=n)},GetAutomation:function(n){for(var i,t=0,r=this.Automations.length;t<r;t++)if(i=this.Automations[t],i.Type==n)return i;return null},GetNoteOnString:function(n){for(var i,t=0,r=this.Notes.length;t<r;t++)if(i=this.Notes[t],i.String==n)return i;return null},Finish:function(){this.Start=this.Index==0?0:this.PreviousBeat.Start+this.PreviousBeat.CalculateDuration();for(var n=0,t=this.Notes.length;n<t;n++)this.Notes[n].Finish()}},$StaticConstructor(function(){AlphaTab.Model.Beat.WhammyBarMaxPosition=60;AlphaTab.Model.Beat.WhammyBarMaxValue=24;AlphaTab.Model.Beat.GlobalBeatId=0}),AlphaTab.Model.Beat.CopyTo=function(n,t){t.Id=n.Id;t.Index=n.Index;t.IsEmpty=n.IsEmpty;t.Duration=n.Duration;t.Dots=n.Dots;t.FadeIn=n.FadeIn;t.Lyrics=n.Lyrics==null?null:n.Lyrics.slice();t.Pop=n.Pop;t.HasRasgueado=n.HasRasgueado;t.Slap=n.Slap;t.Tap=n.Tap;t.Text=n.Text;t.BrushType=n.BrushType;t.BrushDuration=n.BrushDuration;t.TupletDenominator=n.TupletDenominator;t.TupletNumerator=n.TupletNumerator;t.Vibrato=n.Vibrato;t.ChordId=n.ChordId;t.GraceType=n.GraceType;t.PickStroke=n.PickStroke;t.TremoloSpeed=n.TremoloSpeed;t.Crescendo=n.Crescendo;t.Start=n.Start;t.Dynamic=n.Dynamic;t.IsLegatoOrigin=n.IsLegatoOrigin;t.InvertBeamDirection=n.InvertBeamDirection},AlphaTab.Model.BendPoint=function(n,t){this.Offset=0;this.Value=0;this.Offset=n;this.Value=t},AlphaTab.Model.BendPoint.prototype={Clone:function(){var n=new AlphaTab.Model.BendPoint(0,0);return AlphaTab.Model.BendPoint.CopyTo(this,n),n}},$StaticConstructor(function(){AlphaTab.Model.BendPoint.MaxPosition=60;AlphaTab.Model.BendPoint.MaxValue=12}),AlphaTab.Model.BendPoint.CopyTo=function(n,t){t.Offset=n.Offset;t.Value=n.Value},AlphaTab.Model.BrushType={None:0,BrushUp:1,BrushDown:2,ArpeggioUp:3,ArpeggioDown:4},AlphaTab.Model.Chord=function(){this.Name=null;this.FirstFret=0;this.Strings=null;this.BarreFrets=null;this.Strings=[];this.BarreFrets=[]},AlphaTab.Model.Chord.CopyTo=function(n,t){t.FirstFret=n.FirstFret;t.Name=n.Name;t.Strings=n.Strings.slice()},AlphaTab.Model.Clef={Neutral:0,C3:1,C4:2,F4:3,G2:4},AlphaTab.Model.ClefOttavia={_15ma:0,_8va:1,Regular:2,_8vb:3,_15mb:4},AlphaTab.Model.CrescendoType={None:0,Crescendo:1,Decrescendo:2},AlphaTab.Model.Duration={QuadrupleWhole:-4,DoubleWhole:-2,Whole:1,Half:2,Quarter:4,Eighth:8,Sixteenth:16,ThirtySecond:32,SixtyFourth:64,OneHundredTwentyEighth:128,TwoHundredFiftySixth:256},AlphaTab.Model.DynamicValue={PPP:0,PP:1,P:2,MP:3,MF:4,F:5,FF:6,FFF:7},AlphaTab.Model.Fingers={Unknown:-2,NoOrDead:-1,Thumb:0,IndexFinger:1,MiddleFinger:2,AnnularFinger:3,LittleFinger:4},AlphaTab.Model.GraceType={None:0,OnBeat:1,BeforeBeat:2},AlphaTab.Model.HarmonicType={None:0,Natural:1,Artificial:2,Pinch:3,Tap:4,Semi:5,Feedback:6},AlphaTab.Model.KeySignatureType={Major:0,Minor:1},AlphaTab.Model.MasterBar=function(){this.AlternateEndings=0;this.NextMasterBar=null;this.PreviousMasterBar=null;this.Index=0;this.KeySignature=0;this.KeySignatureType=AlphaTab.Model.KeySignatureType.Major;this.IsDoubleBar=!1;this.IsRepeatStart=!1;this.RepeatCount=0;this.RepeatGroup=null;this.TimeSignatureNumerator=0;this.TimeSignatureDenominator=0;this.TimeSignatureCommon=!1;this.TripletFeel=AlphaTab.Model.TripletFeel.NoTripletFeel;this.Section=null;this.TempoAutomation=null;this.VolumeAutomation=null;this.Score=null;this.Start=0;this.TimeSignatureDenominator=4;this.TimeSignatureNumerator=4;this.TripletFeel=AlphaTab.Model.TripletFeel.NoTripletFeel;this.KeySignatureType=AlphaTab.Model.KeySignatureType.Major;this.TimeSignatureCommon=!1},AlphaTab.Model.MasterBar.prototype={get_IsRepeatEnd:function(){return this.RepeatCount>0},get_IsSectionStart:function(){return this.Section!=null},CalculateDuration:function(){return this.TimeSignatureNumerator*AlphaTab.Audio.MidiUtils.ValueToTicks(this.TimeSignatureDenominator)}},$StaticConstructor(function(){AlphaTab.Model.MasterBar.MaxAlternateEndings=8}),AlphaTab.Model.MasterBar.CopyTo=function(n,t){t.AlternateEndings=n.AlternateEndings;t.Index=n.Index;t.KeySignature=n.KeySignature;t.KeySignatureType=n.KeySignatureType;t.IsDoubleBar=n.IsDoubleBar;t.IsRepeatStart=n.IsRepeatStart;t.RepeatCount=n.RepeatCount;t.TimeSignatureNumerator=n.TimeSignatureNumerator;t.TimeSignatureDenominator=n.TimeSignatureDenominator;t.TimeSignatureCommon=n.TimeSignatureCommon;t.TripletFeel=n.TripletFeel;t.Start=n.Start},AlphaTab.Model.ModelUtils=function(){},AlphaTab.Model.ModelUtils.GetIndex=function(n){var t=n;return t<0?0:Math.log2(n)|0},AlphaTab.Model.ModelUtils.KeySignatureIsFlat=function(n){return n<0},AlphaTab.Model.ModelUtils.KeySignatureIsNatural=function(n){return n==0},AlphaTab.Model.ModelUtils.KeySignatureIsSharp=function(n){return n>0},AlphaTab.Model.NoteAccidentalMode={Default:0,SwapAccidentals:1,ForceNatural:2,ForceSharp:3,ForceFlat:4},AlphaTab.Model.Note=function(){this.Id=0;this.Index=0;this.Accentuated=AlphaTab.Model.AccentuationType.None;this.BendPoints=null;this.MaxBendPoint=null;this.Fret=0;this.String=0;this.Octave=0;this.Tone=0;this.Element=0;this.Variation=0;this.IsHammerPullOrigin=!1;this.HammerPullOrigin=null;this.HammerPullDestination=null;this.HarmonicValue=0;this.HarmonicType=AlphaTab.Model.HarmonicType.None;this.IsGhost=!1;this.IsLetRing=!1;this.IsPalmMute=!1;this.IsDead=!1;this.IsStaccato=!1;this.SlideType=AlphaTab.Model.SlideType.None;this.SlideTarget=null;this.Vibrato=AlphaTab.Model.VibratoType.None;this.TieOrigin=null;this.TieDestination=null;this.IsTieDestination=!1;this.IsTieOrigin=!1;this.LeftHandFinger=AlphaTab.Model.Fingers.Thumb;this.RightHandFinger=AlphaTab.Model.Fingers.Thumb;this.IsFingering=!1;this.TrillValue=0;this.TrillSpeed=AlphaTab.Model.Duration.QuadrupleWhole;this.DurationPercent=0;this.AccidentalMode=AlphaTab.Model.NoteAccidentalMode.Default;this.Beat=null;this.Dynamic=AlphaTab.Model.DynamicValue.PPP;this.Id=AlphaTab.Model.Note.GlobalNoteId++;this.BendPoints=[];this.Dynamic=AlphaTab.Model.DynamicValue.F;this.Accentuated=AlphaTab.Model.AccentuationType.None;this.Fret=-2147483648;this.HarmonicType=AlphaTab.Model.HarmonicType.None;this.SlideType=AlphaTab.Model.SlideType.None;this.Vibrato=AlphaTab.Model.VibratoType.None;this.LeftHandFinger=AlphaTab.Model.Fingers.Unknown;this.RightHandFinger=AlphaTab.Model.Fingers.Unknown;this.TrillValue=-1;this.TrillSpeed=AlphaTab.Model.Duration.ThirtySecond;this.DurationPercent=1;this.Octave=-1;this.Tone=-1;this.Fret=-1;this.String=-1;this.Element=-1;this.Variation=-1},AlphaTab.Model.Note.prototype={get_HasBend:function(){return this.BendPoints.length>0},get_IsStringed:function(){return this.Fret>=0&&this.String>=0},get_IsPiano:function(){return this.get_IsStringed()?!1:this.Octave>=0&&this.Tone>=0},get_IsPercussion:function(){return this.get_IsStringed()?!1:this.Element>=0&&this.Variation>=0},get_IsHammerPullDestination:function(){return this.HammerPullOrigin!=null},get_IsHarmonic:function(){return this.HarmonicType!=AlphaTab.Model.HarmonicType.None},get_TrillFret:function(){return this.TrillValue-this.get_StringTuning()},get_IsTrill:function(){return this.TrillValue>=0},get_StringTuning:function(){return this.Beat.Voice.Bar.Staff.Track.Capo+AlphaTab.Model.Note.GetStringTuning(this.Beat.Voice.Bar.Staff.Track,this.String)},get_RealValue:function(){return this.get_IsPercussion()?AlphaTab.Rendering.Utils.PercussionMapper.MidiFromElementVariation(this):this.get_IsStringed()?this.Fret+this.get_StringTuning():this.get_IsPiano()?this.Octave*12+this.Tone:0},Clone:function(){var t=new AlphaTab.Model.Note,n,i;for(AlphaTab.Model.Note.CopyTo(this,t),n=0,i=this.BendPoints.length;n<i;n++)t.AddBendPoint(this.BendPoints[n].Clone());return t},AddBendPoint:function(n){this.BendPoints.push(n);(this.MaxBendPoint==null||n.Value>this.MaxBendPoint.Value)&&(this.MaxBendPoint=n)},Finish:function(){var n=new AlphaTab.Util.Lazy($CreateAnonymousDelegate(this,function(){return AlphaTab.Model.Note.NextNoteOnSameLine(this)})),t=new AlphaTab.Util.Lazy($CreateAnonymousDelegate(this,function(){return AlphaTab.Model.Note.PreviousNoteOnSameLine(this)}));this.IsTieDestination&&(t.get_Value()==null?this.IsTieDestination=!1:(this.TieOrigin=t.get_Value(),this.TieOrigin.IsTieOrigin=!0,this.TieOrigin.TieDestination=this,this.Fret=this.TieOrigin.Fret));this.IsHammerPullOrigin&&(n.get_Value()==null?this.IsHammerPullOrigin=!1:(this.HammerPullDestination=n.get_Value(),this.HammerPullDestination.HammerPullOrigin=this));this.SlideType!=AlphaTab.Model.SlideType.None&&(this.SlideTarget=n.get_Value())}},$StaticConstructor(function(){AlphaTab.Model.Note.GlobalNoteId=0;AlphaTab.Model.Note.MaxOffsetForSameLineSearch=3}),AlphaTab.Model.Note.GetStringTuning=function(n,t){return n.Tuning.length>0?n.Tuning[n.Tuning.length-(t-1)-1]:0},AlphaTab.Model.Note.CopyTo=function(n,t){t.Id=n.Id;t.Accentuated=n.Accentuated;t.Fret=n.Fret;t.String=n.String;t.IsHammerPullOrigin=n.IsHammerPullOrigin;t.HarmonicValue=n.HarmonicValue;t.HarmonicType=n.HarmonicType;t.IsGhost=n.IsGhost;t.IsLetRing=n.IsLetRing;t.IsPalmMute=n.IsPalmMute;t.IsDead=n.IsDead;t.IsStaccato=n.IsStaccato;t.SlideType=n.SlideType;t.Vibrato=n.Vibrato;t.IsTieDestination=n.IsTieDestination;t.LeftHandFinger=n.LeftHandFinger;t.RightHandFinger=n.RightHandFinger;t.IsFingering=n.IsFingering;t.TrillValue=n.TrillValue;t.TrillSpeed=n.TrillSpeed;t.DurationPercent=n.DurationPercent;t.AccidentalMode=n.AccidentalMode;t.Dynamic=n.Dynamic;t.Octave=n.Octave;t.Tone=n.Tone;t.Element=n.Element;t.Variation=n.Variation},AlphaTab.Model.Note.NextNoteOnSameLine=function(n){for(var t=n.Beat.NextBeat,i;t!=null&&t.Voice.Bar.Index<=n.Beat.Voice.Bar.Index+3;){if(i=t.GetNoteOnString(n.String),i!=null)return i;t=t.NextBeat}return null},AlphaTab.Model.Note.PreviousNoteOnSameLine=function(n){for(var t=n.Beat.PreviousBeat,i;t!=null&&t.Voice.Bar.Index>=n.Beat.Voice.Bar.Index-3;){if(i=t.GetNoteOnString(n.String),i!=null)return i;t=t.PreviousBeat}return null},AlphaTab.Model.PickStrokeType={None:0,Up:1,Down:2},AlphaTab.Model.PlaybackInformation=function(){this.Volume=0;this.Balance=0;this.Port=0;this.Program=0;this.PrimaryChannel=0;this.SecondaryChannel=0;this.IsMute=!1;this.IsSolo=!1;this.Volume=15;this.Balance=8;this.Port=1},AlphaTab.Model.PlaybackInformation.CopyTo=function(n,t){t.Volume=n.Volume;t.Balance=n.Balance;t.Port=n.Port;t.Program=n.Program;t.PrimaryChannel=n.PrimaryChannel;t.SecondaryChannel=n.SecondaryChannel;t.IsMute=n.IsMute;t.IsSolo=n.IsSolo},AlphaTab.Model.RepeatGroup=function(){this.MasterBars=null;this.Openings=null;this.Closings=null;this.IsClosed=!1;this.MasterBars=[];this.Openings=[];this.Closings=[];this.IsClosed=!1},AlphaTab.Model.RepeatGroup.prototype={AddMasterBar:function(n){this.Openings.length==0&&this.Openings.push(n);this.MasterBars.push(n);n.RepeatGroup=this;n.get_IsRepeatEnd()?(this.Closings.push(n),this.IsClosed=!0):this.IsClosed&&(this.IsClosed=!1,this.Openings.push(n))}},AlphaTab.Model.Score=function(){this._currentRepeatGroup=null;this.Album=null;this.Artist=null;this.Copyright=null;this.Instructions=null;this.Music=null;this.Notices=null;this.SubTitle=null;this.Title=null;this.Words=null;this.Tab=null;this.Tempo=0;this.TempoLabel=null;this.MasterBars=null;this.Tracks=null;this.MasterBars=[];this.Tracks=[];this._currentRepeatGroup=new AlphaTab.Model.RepeatGroup;this.Album=this.Artist=this.Copyright=this.Instructions=this.Music=this.Notices=this.SubTitle=this.Title=this.Words=this.Tab=this.TempoLabel="";this.Tempo=120},AlphaTab.Model.Score.prototype={AddMasterBar:function(n){n.Score=this;n.Index=this.MasterBars.length;this.MasterBars.length!=0&&(n.PreviousMasterBar=this.MasterBars[this.MasterBars.length-1],n.PreviousMasterBar.NextMasterBar=n,n.Start=n.PreviousMasterBar.Start+n.PreviousMasterBar.CalculateDuration());(n.IsRepeatStart||this._currentRepeatGroup.IsClosed&&n.AlternateEndings<=0)&&(this._currentRepeatGroup=new AlphaTab.Model.RepeatGroup);this._currentRepeatGroup.AddMasterBar(n);this.MasterBars.push(n)},AddTrack:function(n){n.Score=this;n.Index=this.Tracks.length;this.Tracks.push(n)},Finish:function(){for(var n=0,t=this.Tracks.length;n<t;n++)this.Tracks[n].Finish()}},AlphaTab.Model.Score.CopyTo=function(n,t){t.Album=n.Album;t.Artist=n.Artist;t.Copyright=n.Copyright;t.Instructions=n.Instructions;t.Music=n.Music;t.Notices=n.Notices;t.SubTitle=n.SubTitle;t.Title=n.Title;t.Words=n.Words;t.Tab=n.Tab;t.Tempo=n.Tempo;t.TempoLabel=n.TempoLabel},AlphaTab.Model.Section=function(){this.Marker=null;this.Text=null;this.Text=this.Marker=""},AlphaTab.Model.Section.CopyTo=function(n,t){t.Marker=n.Marker;t.Text=n.Text},AlphaTab.Model.SlideType={None:0,Shift:1,Legato:2,IntoFromBelow:3,IntoFromAbove:4,OutUp:5,OutDown:6},AlphaTab.Model.Staff=function(){this.Bars=null;this.Track=null;this.Index=0;this.Bars=[]},AlphaTab.Model.Staff.prototype={Finish:function(){for(var n=0,t=this.Bars.length;n<t;n++)this.Bars[n].Finish()}},AlphaTab.Model.Track=function(n){this.Capo=0;this.Index=0;this.Name=null;this.ShortName=null;this.Tuning=null;this.TuningName=null;this.Color=null;this.PlaybackInfo=null;this.IsPercussion=!1;this.Score=null;this.Staves=null;this.Chords=null;this.Name="";this.ShortName="";this.Tuning=new Int32Array(0);this.Chords={};this.PlaybackInfo=new AlphaTab.Model.PlaybackInformation;this.Color=new AlphaTab.Platform.Model.Color(200,0,0,255);this.Staves=[];this.EnsureStaveCount(n)},AlphaTab.Model.Track.prototype={EnsureStaveCount:function(n){while(this.Staves.length<n){var t=new AlphaTab.Model.Staff;t.Index=this.Staves.length;t.Track=this;this.Staves.push(t)}},AddBarToStaff:function(n,t){var r=this.Staves[n],i=r.Bars;t.Staff=r;t.Index=i.length;i.length>0&&(t.PreviousBar=i[i.length-1],t.PreviousBar.NextBar=t);i.push(t)},Finish:function(){(this.ShortName==null||this.ShortName.length==0)&&(this.ShortName=this.Name,this.ShortName.length>10&&(this.ShortName=this.ShortName.substr(0,10)));for(var n=0,t=this.Staves.length;n<t;n++)this.Staves[n].Finish()}},$StaticConstructor(function(){AlphaTab.Model.Track.ShortNameMaxLength=10}),AlphaTab.Model.Track.CopyTo=function(n,t){t.Name=n.Name;t.Capo=n.Capo;t.Index=n.Index;t.ShortName=n.ShortName;t.Tuning=new Int32Array(n.Tuning);t.Color.Raw=n.Color.Raw;t.IsPercussion=n.IsPercussion},AlphaTab.Model.TripletFeel={NoTripletFeel:0,Triplet16th:1,Triplet8th:2,Dotted16th:3,Dotted8th:4,Scottish16th:5,Scottish8th:6},AlphaTab.Model.Tuning=function(n,t,i){this.IsStandard=!1;this.Name=null;this.Tunings=null;this.IsStandard=i;this.Name=n;this.Tunings=t},AlphaTab.Model.Tuning.GetTextForTuning=function(n,t){var r=n/12|0,u=n%12,i=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][u];return t&&(i+=r-1),i},AlphaTab.Model.Tuning.GetDefaultTuningFor=function(n){return AlphaTab.Model.Tuning._defaultTunings.hasOwnProperty(n)?AlphaTab.Model.Tuning._defaultTunings[n]:null},AlphaTab.Model.Tuning.GetPresetsFor=function(n){switch(n){case 7:return AlphaTab.Model.Tuning._sevenStrings;case 6:return AlphaTab.Model.Tuning._sixStrings;case 5:return AlphaTab.Model.Tuning._fiveStrings;case 4:return AlphaTab.Model.Tuning._fourStrings}return[]},$StaticConstructor(function(){AlphaTab.Model.Tuning._sevenStrings=null;AlphaTab.Model.Tuning._sixStrings=null;AlphaTab.Model.Tuning._fiveStrings=null;AlphaTab.Model.Tuning._fourStrings=null;AlphaTab.Model.Tuning._defaultTunings=null;AlphaTab.Model.Tuning.Initialize()}),AlphaTab.Model.Tuning.Initialize=function(){AlphaTab.Model.Tuning._sevenStrings=[];AlphaTab.Model.Tuning._sixStrings=[];AlphaTab.Model.Tuning._fiveStrings=[];AlphaTab.Model.Tuning._fourStrings=[];AlphaTab.Model.Tuning._defaultTunings={};AlphaTab.Model.Tuning._defaultTunings[7]=new AlphaTab.Model.Tuning("Guitar 7 strings",new Int32Array([64,59,55,50,45,40,35]),!0);AlphaTab.Model.Tuning._sevenStrings.push(AlphaTab.Model.Tuning._defaultTunings[7]);AlphaTab.Model.Tuning._defaultTunings[6]=new AlphaTab.Model.Tuning("Guitar Standard Tuning",new Int32Array([64,59,55,50,45,40]),!0);AlphaTab.Model.Tuning._sixStrings.push(AlphaTab.Model.Tuning._defaultTunings[6]);AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Tune down  step",new Int32Array([63,58,54,49,44,39]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Tune down 1 step",new Int32Array([62,57,53,48,43,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Tune down 2 step",new Int32Array([60,55,51,46,41,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Dropped D Tuning",new Int32Array([64,59,55,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Dropped D Tuning variant",new Int32Array([64,57,55,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Double Dropped D Tuning",new Int32Array([62,59,55,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Dropped E Tuning",new Int32Array([66,61,57,52,47,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Dropped C Tuning",new Int32Array([62,57,53,48,43,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open C Tuning",new Int32Array([64,60,55,48,43,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Cm Tuning",new Int32Array([63,60,55,48,43,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open C6 Tuning",new Int32Array([64,57,55,48,43,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Cmaj7 Tuning",new Int32Array([64,59,55,52,43,36]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open D Tuning",new Int32Array([62,57,54,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Dm Tuning",new Int32Array([62,57,53,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open D5 Tuning",new Int32Array([62,57,50,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open D6 Tuning",new Int32Array([62,59,54,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Dsus4 Tuning",new Int32Array([62,57,55,50,45,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open E Tuning",new Int32Array([64,59,56,52,47,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Em Tuning",new Int32Array([64,59,55,52,47,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Esus11 Tuning",new Int32Array([64,59,55,52,45,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open F Tuning",new Int32Array([65,60,53,48,45,41]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open G Tuning",new Int32Array([62,59,55,50,43,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Gm Tuning",new Int32Array([62,58,55,50,43,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open G6 Tuning",new Int32Array([64,59,55,50,43,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Gsus4 Tuning",new Int32Array([62,60,55,50,43,38]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open A Tuning",new Int32Array([64,61,57,52,45,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Open Am Tuning",new Int32Array([64,60,57,52,45,40]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Guitar Nashville Tuning",new Int32Array([64,59,67,62,57,52]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Bass 6 Strings Tuning",new Int32Array([48,43,38,33,28,23]),!1));AlphaTab.Model.Tuning._sixStrings.push(new AlphaTab.Model.Tuning("Lute or Vihuela Tuning",new Int32Array([64,59,54,50,45,40]),!1));AlphaTab.Model.Tuning._defaultTunings[5]=new AlphaTab.Model.Tuning("Bass 5 Strings Tuning",new Int32Array([43,38,33,28,23]),!0);AlphaTab.Model.Tuning._fiveStrings.push(AlphaTab.Model.Tuning._defaultTunings[5]);AlphaTab.Model.Tuning._fiveStrings.push(new AlphaTab.Model.Tuning("Banjo Dropped C Tuning",new Int32Array([62,59,55,48,67]),!1));AlphaTab.Model.Tuning._fiveStrings.push(new AlphaTab.Model.Tuning("Banjo Open D Tuning",new Int32Array([62,57,54,50,69]),!1));AlphaTab.Model.Tuning._fiveStrings.push(new AlphaTab.Model.Tuning("Banjo Open G Tuning",new Int32Array([62,59,55,50,67]),!1));AlphaTab.Model.Tuning._fiveStrings.push(new AlphaTab.Model.Tuning("Banjo G Minor Tuning",new Int32Array([62,58,55,50,67]),!1));AlphaTab.Model.Tuning._fiveStrings.push(new AlphaTab.Model.Tuning("Banjo G Modal Tuning",new Int32Array([62,57,55,50,67]),!1));AlphaTab.Model.Tuning._defaultTunings[4]=new AlphaTab.Model.Tuning("Bass Standard Tuning",new Int32Array([43,38,33,28]),!0);AlphaTab.Model.Tuning._fourStrings.push(AlphaTab.Model.Tuning._defaultTunings[4]);AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Bass Tune down  step",new Int32Array([42,37,32,27]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Bass Tune down 1 step",new Int32Array([41,36,31,26]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Bass Tune down 2 step",new Int32Array([39,34,29,24]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Bass Dropped D Tuning",new Int32Array([43,38,33,26]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Ukulele C Tuning",new Int32Array([45,40,36,43]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Ukulele G Tuning",new Int32Array([52,47,43,38]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Mandolin Standard Tuning",new Int32Array([64,57,50,43]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Mandolin or Violin Tuning",new Int32Array([76,69,62,55]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Viola Tuning",new Int32Array([69,62,55,48]),!1));AlphaTab.Model.Tuning._fourStrings.push(new AlphaTab.Model.Tuning("Cello Tuning",new Int32Array([57,50,43,36]),!1))},AlphaTab.Model.Tuning.FindTuning=function(n){for(var r,u,t,e,f=AlphaTab.Model.Tuning.GetPresetsFor(n.length),i=0,o=f.length;i<o;i++){for(r=f[i],u=!0,t=0,e=n.length;t<e;t++)if(n[t]!=r.Tunings[t]){u=!1;break}if(u)return r}return null},AlphaTab.Model.TuningParser=function(){},AlphaTab.Model.TuningParser.IsTuning=function(n){return AlphaTab.Model.TuningParser.Parse(n)!=null},AlphaTab.Model.TuningParser.Parse=function(n){for(var i,u,t="",r="",f=0;f<n.length;f++)if(i=n.charCodeAt(f),AlphaTab.Platform.Std.IsCharNumber(i,!1)){if(t==null||t.length==0)return null;r+=String.fromCharCode(i)}else if(i>=65&&i<=90||i>=97&&i<=122){if(!(t==null||t.length==0))return null;t+=String.fromCharCode(i)}else return null;return r==null||r.length==0||t==null||t.length==0?null:(u=new AlphaTab.Model.TuningParser.TuningParseResult,u.Octave=AlphaTab.Platform.Std.ParseInt(r),u.Note=t.toLowerCase(),u)},AlphaTab.Model.TuningParser.GetTuningForText=function(n){var i=0,t=AlphaTab.Model.TuningParser.Parse(n);return t==null?-1:(i=AlphaTab.Model.TuningParser.GetToneForText(t.Note),i+(t.Octave+1)*12)},AlphaTab.Model.TuningParser.GetToneForText=function(n){var t;switch(n.toLowerCase()){case"c":t=0;break;case"db":t=1;break;case"d":t=2;break;case"eb":t=3;break;case"e":t=4;break;case"f":t=5;break;case"gb":t=6;break;case"g":t=7;break;case"ab":t=8;break;case"a":t=9;break;case"bb":t=10;break;case"b":t=11;break;default:return 0}return t},AlphaTab.Model.VibratoType={None:0,Slight:1,Wide:2},AlphaTab.Model.Voice=function(){this.Index=0;this.Bar=null;this.Beats=null;this.IsEmpty=!1;this.Beats=[];this.IsEmpty=!0},AlphaTab.Model.Voice.prototype={AddBeat:function(n){n.Voice=this;n.Index=this.Beats.length;this.Beats.push(n);n.IsEmpty||(this.IsEmpty=!1)},Chain:function(n){if(this.Bar!=null)if(n.Index<this.Beats.length-1)n.NextBeat=this.Beats[n.Index+1],n.NextBeat.PreviousBeat=n;else if(n.Index==n.Voice.Beats.length-1&&n.Voice.Bar.NextBar!=null){var t=this.Bar.NextBar.Voices[this.Index];t.Beats.length>0?(n.NextBeat=t.Beats[0],n.NextBeat.PreviousBeat=n):n.NextBeat.PreviousBeat=n}},AddGraceBeat:function(n){if(this.Beats.length==0){this.AddBeat(n);return}var t=this.Beats[this.Beats.length-1];this.Beats.splice(this.Beats.length-1,1);this.AddBeat(n);this.AddBeat(t);this.IsEmpty=!1},Finish:function(){for(var i,n=0,t=this.Beats.length;n<t;n++)i=this.Beats[n],this.Chain(i);for(n=0,t=this.Beats.length;n<t;n++)i=this.Beats[n],i.Finish()}},AlphaTab.Model.Voice.CopyTo=function(n,t){t.Index=n.Index;t.IsEmpty=n.IsEmpty},AlphaTab.Platform.Model=AlphaTab.Platform.Model||{},AlphaTab.Platform.Model.Color=function(n,t,i,r){this.Raw=0;this.RGBA=null;this.Raw=r<<24|n<<16|t<<8|i;this.RGBA=r==255?"#"+AlphaTab.Platform.Std.ToHexString(this.get_R(),2)+AlphaTab.Platform.Std.ToHexString(this.get_G(),2)+AlphaTab.Platform.Std.ToHexString(this.get_B(),2):"rgba("+this.get_R()+","+this.get_G()+","+this.get_B()+","+this.get_A()/255+")"},AlphaTab.Platform.Model.Color.prototype={get_A:function(){return this.Raw>>24&255},get_R:function(){return this.Raw>>16&255},get_G:function(){return this.Raw>>8&255},get_B:function(){return this.Raw&255}},$StaticConstructor(function(){AlphaTab.Platform.Model.Color.BlackRgb="#000000"}),AlphaTab.Platform.Model.FontStyle={Plain:0,Bold:1,Italic:2},AlphaTab.Platform.Model.Font=function(n,t,i){this._css=null;this.Family=null;this.Size=0;this.Style=AlphaTab.Platform.Model.FontStyle.Plain;this.Family=n;this.Size=t;this.Style=i;this._css=this.ToCssString(1)},AlphaTab.Platform.Model.Font.prototype={get_IsBold:function(){return(this.Style&AlphaTab.Platform.Model.FontStyle.Bold)!=AlphaTab.Platform.Model.FontStyle.Plain},get_IsItalic:function(){return(this.Style&AlphaTab.Platform.Model.FontStyle.Italic)!=AlphaTab.Platform.Model.FontStyle.Plain},Clone:function(){return new AlphaTab.Platform.Model.Font(this.Family,this.Size,this.Style)},ToCssString:function(n){if(this._css!=null&&n==1)return this._css;var t=new String;return this.get_IsBold()&&(t+="bold "),this.get_IsItalic()&&(t+="italic "),t+=this.Size*n,t+="px ",t+="'",t+=this.Family,t+"'"}},AlphaTab.Platform.Model.TextAlign={Left:0,Center:1,Right:2},AlphaTab.Platform.Model.TextBaseline={Top:0,Middle:1,Bottom:2},AlphaTab.Platform.Svg=AlphaTab.Platform.Svg||{},AlphaTab.Platform.Svg.FontSizes=function(){},$StaticConstructor(function(){AlphaTab.Platform.Svg.FontSizes.TimesNewRoman=new Uint8Array([3,4,5,6,6,9,9,2,4,4,6,6,3,4,3,3,6,6,6,6,6,6,6,6,6,6,3,3,6,6,6,5,10,8,7,7,8,7,6,7,8,4,4,8,7,10,8,8,7,8,7,5,8,8,7,11,8,8,7,4,3,4,5,6,4,5,5,5,5,5,4,5,6,3,3,6,3,9,6,6,6,5,4,4,4,5,6,7,6,6,5,5,2,5,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,6,6,6,6,2,5,4,8,4,6,6,0,8,6,4,6,3,3,4,5,5,4,4,3,3,6,8,8,8,5,8,8,8,8,8,8,11,7,7,7,7,7,4,4,4,4,8,8,8,8,8,8,8,6,8,8,8,8,8,8,6,5,5,5,5,5,5,5,8,5,5,5,5,5,3,3,3,3,6,6,6,6,6,6,6,6,6,5,5,5,5,6,6]);AlphaTab.Platform.Svg.FontSizes.Arial11Pt=new Uint8Array([3,3,4,6,6,10,7,2,4,4,4,6,3,4,3,3,6,6,6,6,6,6,6,6,6,6,3,3,6,6,6,6,11,7,7,8,8,7,7,9,8,3,6,7,6,9,8,9,7,9,8,7,7,8,7,10,7,7,7,3,3,3,5,6,4,6,6,6,6,6,3,6,6,2,2,6,2,9,6,6,6,6,4,6,3,6,6,8,6,6,6,4,3,4,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,6,6,6,6,3,6,4,8,4,6,6,0,8,6,4,6,4,4,4,6,6,4,4,4,4,6,9,9,9,7,7,7,7,7,7,7,11,8,7,7,7,7,3,3,3,3,8,8,9,9,9,9,9,6,9,8,8,8,8,7,7,7,6,6,6,6,6,6,10,6,6,6,6,6,3,3,3,3,6,6,6,6,6,6,6,6,7,6,6,6,6,6,6]);AlphaTab.Platform.Svg.FontSizes.ControlChars=32}),AlphaTab.Platform.Svg.FontSizes.MeasureString=function(n,t,i,r){var u,f,o=1,s,e,h;for((r&AlphaTab.Platform.Model.FontStyle.Italic)!=AlphaTab.Platform.Model.FontStyle.Plain&&(o*=1.2),(r&AlphaTab.Platform.Model.FontStyle.Bold)!=AlphaTab.Platform.Model.FontStyle.Plain&&(o*=1.2),t==AlphaTab.Platform.Svg.SupportedFonts.TimesNewRoman?(u=AlphaTab.Platform.Svg.FontSizes.TimesNewRoman,f=11):t==AlphaTab.Platform.Svg.SupportedFonts.Arial?(u=AlphaTab.Platform.Svg.FontSizes.Arial11Pt,f=11):(u=new Uint8Array([8]),f=11),s=0,e=0;e<n.length;e++)h=Math.min(u.length-1,n.charCodeAt(e)-32),h>=0&&(s+=u[h]*i/f);return s*o},AlphaTab.Platform.Svg.SupportedFonts={TimesNewRoman:0,Arial:1},AlphaTab.Platform.Svg.SvgCanvas=function(){this.Buffer=null;this._currentPath=null;this._currentPathIsEmpty=!1;this._Color=null;this._LineWidth=0;this._Font=null;this._TextAlign=AlphaTab.Platform.Model.TextAlign.Left;this._TextBaseline=AlphaTab.Platform.Model.TextBaseline.Top;this._Resources=null;this._currentPath=new String;this._currentPathIsEmpty=!0;this.set_Color(new AlphaTab.Platform.Model.Color(255,255,255,255));this.set_LineWidth(1);this.set_Font(new AlphaTab.Platform.Model.Font("Arial",10,AlphaTab.Platform.Model.FontStyle.Plain));this.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Left);this.set_TextBaseline(AlphaTab.Platform.Model.TextBaseline.Top)},AlphaTab.Platform.Svg.SvgCanvas.prototype={get_Color:function(){return this._Color},set_Color:function(n){this._Color=n},get_LineWidth:function(){return this._LineWidth},set_LineWidth:function(n){this._LineWidth=n},get_Font:function(){return this._Font},set_Font:function(n){this._Font=n},get_TextAlign:function(){return this._TextAlign},set_TextAlign:function(n){this._TextAlign=n},get_TextBaseline:function(){return this._TextBaseline},set_TextBaseline:function(n){this._TextBaseline=n},get_Resources:function(){return this._Resources},set_Resources:function(n){this._Resources=n},BeginRender:function(n,t){this.Buffer=new String;this.Buffer+='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="';this.Buffer+=n;this.Buffer+='px" height="';this.Buffer+=t;this.Buffer+='px" class="alphaTabSurfaceSvg">\n';this._currentPath=new String;this._currentPathIsEmpty=!0},BeginGroup:function(n){this.Buffer+='<g class="'+n+'">'},EndGroup:function(){this.Buffer+="<\/g>"},EndRender:function(){return this.Buffer+="<\/svg>",this.Buffer},FillRect:function(n,t,i,r){i>0&&(this.Buffer+='<rect x="'+(n|0-.5)+'" y="'+(t|0-.5)+'" width="'+i+'" height="'+r+'" fill="'+this.get_Color().RGBA+'" />\n')},StrokeRect:function(n,t,i,r){this.Buffer+='<rect x="'+(n|0-.5)+'" y="'+(t|0-.5)+'" width="'+i+'" height="'+r+'" stroke="'+this.get_Color().RGBA+'"';this.get_LineWidth()!=1&&(this.Buffer+=' stroke-width="'+this.get_LineWidth()+'"');this.Buffer+=' fill="transparent" />\n'},BeginPath:function(){},ClosePath:function(){this._currentPath+=" z"},MoveTo:function(n,t){this._currentPath+=" M"+(n-.5)+","+(t-.5)},LineTo:function(n,t){this._currentPathIsEmpty=!1;this._currentPath+=" L"+(n-.5)+","+(t-.5)},QuadraticCurveTo:function(n,t,i,r){this._currentPathIsEmpty=!1;this._currentPath+=" Q"+n+","+t+","+i+","+r},BezierCurveTo:function(n,t,i,r,u,f){this._currentPathIsEmpty=!1;this._currentPath+=" C"+n+","+t+","+i+","+r+","+u+","+f},FillCircle:function(n,t,i){this._currentPathIsEmpty=!1;this._currentPath+=" M"+(n-i)+","+t+" A1,1 0 0,0 "+(n+i)+","+t+" A1,1 0 0,0 "+(n-i)+","+t+" z";this.Fill()},Fill:function(){this._currentPathIsEmpty||(this.Buffer+='<path d="'+this._currentPath+'"',this.get_Color().RGBA!="#000000"&&(this.Buffer+=' fill="'+this.get_Color().RGBA+'"'),this.Buffer+=' stroke="none"/>');this._currentPath=new String;this._currentPathIsEmpty=!0},Stroke:function(){if(!this._currentPathIsEmpty){var n='<path d="'+this._currentPath+'" stroke="'+this.get_Color().RGBA+'"';this.get_LineWidth()!=1&&(n+=' stroke-width="'+this.get_LineWidth()+'"');n+=' fill="none" />';this.Buffer+=n}this._currentPath=new String;this._currentPathIsEmpty=!0},FillText:function(n,t,i){var r='<text x="'+(t|0)+'" y="'+(i|0)+'" style="font:'+this.get_Font().ToCssString(1)+'"  dominant-baseline="'+this.GetSvgBaseLine()+'"';this.get_Color().RGBA!="#000000"&&(r+=' fill="'+this.get_Color().RGBA+'"');this.get_TextAlign()!=AlphaTab.Platform.Model.TextAlign.Left&&(r+=' text-anchor="'+this.GetSvgTextAlignment()+'"');r+=">"+n+"<\/text>";this.Buffer+=r},GetSvgTextAlignment:function(){switch(this.get_TextAlign()){case AlphaTab.Platform.Model.TextAlign.Left:return"start";case AlphaTab.Platform.Model.TextAlign.Center:return"middle";case AlphaTab.Platform.Model.TextAlign.Right:return"end"}return""},GetSvgBaseLine:function(){switch(this.get_TextBaseline()){case AlphaTab.Platform.Model.TextBaseline.Top:return"hanging";case AlphaTab.Platform.Model.TextBaseline.Middle:return"middle";case AlphaTab.Platform.Model.TextBaseline.Bottom:return"bottom";default:return""}},MeasureText:function(n){if(n==null||n.length==0)return 0;var t=AlphaTab.Platform.Svg.SupportedFonts.Arial;return this.get_Font().Family.indexOf("Times")!=-1&&(t=AlphaTab.Platform.Svg.SupportedFonts.TimesNewRoman),AlphaTab.Platform.Svg.FontSizes.MeasureString(n,t,this.get_Font().Size,this.get_Font().Style)},OnPreRender:function(){return null},OnRenderFinished:function(){return null}},$StaticConstructor(function(){AlphaTab.Platform.Svg.SvgCanvas.BlurCorrection=.5}),AlphaTab.Platform.Svg.FontSvgCanvas=function(){AlphaTab.Platform.Svg.SvgCanvas.call(this)},AlphaTab.Platform.Svg.FontSvgCanvas.prototype={FillMusicFontSymbol:function(n,t,i,r){this.Buffer+='<g transform="translate('+(n|0-.5)+" "+(t|0-.5)+')" class="at" ><text';i!=1&&(this.Buffer+='  style="font-size: '+i*100+'%"');this.get_Color().RGBA!="#000000"&&(this.Buffer+=' fill="'+this.get_Color().RGBA+'"');this.Buffer+=">&#"+r+";<\/text><\/g>"}},$Inherit(AlphaTab.Platform.Svg.FontSvgCanvas,AlphaTab.Platform.Svg.SvgCanvas),AlphaTab.Rendering.BarRendererBase=function(n,t){this._preBeatGlyphs=null;this._voiceContainers=null;this._postBeatGlyphs=null;this._wasFirstOfLine=!1;this._appliedLayoutingInfo=0;this.Staff=null;this.X=0;this.Y=0;this.Width=0;this.Height=0;this.Index=0;this.TopOverflow=0;this.BottomOverflow=0;this.Helpers=null;this.Bar=null;this.IsLinkedToPrevious=!1;this.ScoreRenderer=null;this.LayoutingInfo=null;this.IsFinalized=!1;this.TopPadding=0;this.BottomPadding=0;this.Bar=t;this.ScoreRenderer=n;this.Helpers=new AlphaTab.Rendering.Utils.BarHelpers(t)},AlphaTab.Rendering.BarRendererBase.prototype={get_NextRenderer:function(){return this.Bar.NextBar==null?null:this.ScoreRenderer.Layout.GetRendererForBar(this.Staff.get_StaveId(),this.Bar.NextBar)},get_PreviousRenderer:function(){return this.Bar.PreviousBar==null?null:this.ScoreRenderer.Layout.GetRendererForBar(this.Staff.get_StaveId(),this.Bar.PreviousBar)},RegisterOverflowTop:function(n){n>this.TopOverflow&&(this.TopOverflow=n)},RegisterOverflowBottom:function(n){n>this.BottomOverflow&&(this.BottomOverflow=n)},ScaleToWidth:function(n){var t=n-this._preBeatGlyphs.Width-this._postBeatGlyphs.Width,i,r;for(i in this._voiceContainers)r=this._voiceContainers[i],r.ScaleToWidth(t);this._postBeatGlyphs.X=this._preBeatGlyphs.X+this._preBeatGlyphs.Width+t;this.Width=n},get_Resources:function(){return this.ScoreRenderer.RenderingResources},get_Settings:function(){return this.ScoreRenderer.Settings},get_Scale:function(){return this.get_Settings().Scale},get_IsFirstOfLine:function(){return this.Index==0},get_IsLast:function(){return this.Staff.StaveGroup.IsLast&&this.Index==this.Staff.BarRenderers.length-1},RegisterLayoutingInfo:function(){var n=this.LayoutingInfo,i=this._preBeatGlyphs.Width,r,u,t;n.PreBeatSize<i&&(n.PreBeatSize=i);for(r in this._voiceContainers)u=this._voiceContainers[r],u.RegisterLayoutingInfo(n);t=this._postBeatGlyphs.Width;n.PostBeatSize<t&&(n.PostBeatSize=t)},ApplyLayoutingInfo:function(){var t,r,n,i;if(this._appliedLayoutingInfo>=this.LayoutingInfo.Version)return!1;this._appliedLayoutingInfo=this.LayoutingInfo.Version;this._preBeatGlyphs.Width=this.LayoutingInfo.PreBeatSize;t=this._preBeatGlyphs.X+this._preBeatGlyphs.Width;for(r in this._voiceContainers)n=this._voiceContainers[r],n.X=this._preBeatGlyphs.X+this._preBeatGlyphs.Width,n.ApplyLayoutingInfo(this.LayoutingInfo),i=n.X+n.Width,t<i&&(t=i);return this._postBeatGlyphs.X=t,this._postBeatGlyphs.Width=this.LayoutingInfo.PostBeatSize,this.Width=this._postBeatGlyphs.X+this._postBeatGlyphs.Width,!0},FinalizeRenderer:function(){this.IsFinalized=!0},DoLayout:function(){var n,t,i;for(this._preBeatGlyphs=new AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup,this._preBeatGlyphs.Renderer=this,this._voiceContainers={},this._postBeatGlyphs=new AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup,this._postBeatGlyphs.Renderer=this,n=0;n<this.Bar.Voices.length;n++)t=this.Bar.Voices[n],this.HasVoiceContainer(t)&&(i=new AlphaTab.Rendering.Glyphs.VoiceContainerGlyph(0,0,t),i.Renderer=this,this._voiceContainers[this.Bar.Voices[n].Index]=i);this.CreatePreBeatGlyphs();this.CreateBeatGlyphs();this.CreatePostBeatGlyphs();this.UpdateSizes()},HasVoiceContainer:function(n){return!n.IsEmpty||n.Index==0},UpdateSizes:function(){var f,n,i;this.Staff.RegisterStaffTop(this.TopPadding);this.Staff.RegisterStaffBottom(this.Height-this.BottomPadding);var r=this._voiceContainers,u=this.get_BeatGlyphsStart(),t=u;for(f in r)n=r[f],n.X=u,n.DoLayout(),i=n.X+n.Width,t<i&&(t=i);this._postBeatGlyphs.X=t;this.Width=this._postBeatGlyphs.X+this._postBeatGlyphs.Width},AddPreBeatGlyph:function(n){this._preBeatGlyphs.AddGlyph(n)},AddBeatGlyph:function(n){n.Renderer=this;n.PreNotes.Renderer=this;n.OnNotes.Renderer=this;n.OnNotes.BeamingHelper=this.Helpers.BeamHelperLookup[n.Beat.Voice.Index][n.Beat.Index];this.GetOrCreateVoiceContainer(n.Beat.Voice).AddGlyph(n)},GetOrCreateVoiceContainer:function(n){return this._voiceContainers[n.Index]},GetBeatContainer:function(n){return this.GetOrCreateVoiceContainer(n.Voice).BeatGlyphs[n.Index]},GetPreNotesGlyphForBeat:function(n){return this.GetBeatContainer(n).PreNotes},GetOnNotesGlyphForBeat:function(n){return this.GetBeatContainer(n).OnNotes},Paint:function(n,t,i){var u,r;this.PaintBackground(n,t,i);i.set_Color(this.get_Resources().MainGlyphColor);this._preBeatGlyphs.Paint(n+this.X,t+this.Y,i);for(u in this._voiceContainers)r=this._voiceContainers[u],i.set_Color(r.Voice.Index==0?this.get_Resources().MainGlyphColor:this.get_Resources().SecondaryGlyphColor),r.Paint(n+this.X,t+this.Y,i);i.set_Color(this.get_Resources().MainGlyphColor);this._postBeatGlyphs.Paint(n+this.X,t+this.Y,i)},PaintBackground:function(){},BuildBoundingsLookup:function(n,t,i){var r=new AlphaTab.Rendering.Utils.BarBounds,s,f,o,h,u,e;r.Bar=this.Bar;r.VisualBounds={X:t+this.X,Y:i+this.Y+this.TopPadding,W:this.Width,H:this.Height-this.TopPadding-this.BottomPadding};r.RealBounds={X:t+this.X,Y:i+this.Y,W:this.Width,H:this.Height};n.AddBar(r);for(s in this._voiceContainers)if(f=this._voiceContainers[s],!f.Voice.IsEmpty)for(o=0,h=f.BeatGlyphs.length;o<h;o++)u=f.BeatGlyphs[o],e=new AlphaTab.Rendering.Utils.BeatBounds,e.Beat=u.Beat,e.VisualBounds={X:t+this.X+f.X+u.X+u.OnNotes.X,Y:r.VisualBounds.Y,W:u.OnNotes.Width,H:r.VisualBounds.H},e.RealBounds={X:t+this.X+f.X+u.X,Y:r.RealBounds.Y,W:u.Width,H:r.RealBounds.H},r.AddBeat(e)},AddPostBeatGlyph:function(n){this._postBeatGlyphs.AddGlyph(n)},CreatePreBeatGlyphs:function(){this._wasFirstOfLine=this.get_IsFirstOfLine()},CreateBeatGlyphs:function(){},CreatePostBeatGlyphs:function(){this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,5*this.get_Scale()))},get_BeatGlyphsStart:function(){return this._preBeatGlyphs.X+this._preBeatGlyphs.Width},GetNoteX:function(){return 0},GetBeatX:function(n,t){var i=this.GetBeatContainer(n);if(i!=null)switch(t){case AlphaTab.Rendering.BeatXPosition.PreNotes:return i.VoiceContainer.X+i.X+i.PreNotes.X;case AlphaTab.Rendering.BeatXPosition.OnNotes:return i.VoiceContainer.X+i.X+i.OnNotes.X;case AlphaTab.Rendering.BeatXPosition.PostNotes:return i.VoiceContainer.X+i.X+i.OnNotes.X+i.OnNotes.Width;case AlphaTab.Rendering.BeatXPosition.EndBeat:return i.VoiceContainer.X+i.X+i.Width}return 0},GetNoteY:function(){return 0},ReLayout:function(){this._wasFirstOfLine^this.get_IsFirstOfLine()&&(this._preBeatGlyphs=new AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup,this._preBeatGlyphs.Renderer=this,this.CreatePreBeatGlyphs());this.UpdateSizes();this.RegisterLayoutingInfo()}},AlphaTab.Rendering.BeatXPosition={PreNotes:0,OnNotes:1,PostNotes:2,EndBeat:3},AlphaTab.Rendering.BarRendererFactory=function(){this.IsInAccolade=!1;this.HideOnMultiTrack=!1;this.HideOnPercussionTrack=!1;this.IsInAccolade=!0;this.HideOnPercussionTrack=!1;this.HideOnMultiTrack=!1},AlphaTab.Rendering.BarRendererFactory.prototype={CanCreate:function(n){return!this.HideOnPercussionTrack||!n.IsPercussion}},AlphaTab.Rendering.EffectBarGlyphSizing={SinglePreBeat:0,SingleOnBeat:1,GroupedBeforeBeat:2,GroupedOnBeat:3,FullBar:4},AlphaTab.Rendering.Glyphs=AlphaTab.Rendering.Glyphs||{},AlphaTab.Rendering.Glyphs.Glyph=function(n,t){this.X=0;this.Y=0;this.Width=0;this.Renderer=null;this.X=n;this.Y=t},AlphaTab.Rendering.Glyphs.Glyph.prototype={get_Scale:function(){return this.Renderer.get_Scale()},DoLayout:function(){},Paint:function(){}},AlphaTab.Rendering.EffectBand=function(n){this._uniqueEffectGlyphs=null;this._effectGlyphs=null;this.IsEmpty=!1;this.PreviousBand=null;this.IsLinkedToPrevious=!1;this.FirstBeat=null;this.LastBeat=null;this.Height=0;this.Info=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this.Info=n;this._uniqueEffectGlyphs=[];this._effectGlyphs=[];this.IsEmpty=!0},AlphaTab.Rendering.EffectBand.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);for(var n=0;n<this.Renderer.Bar.Voices.length;n++)this._effectGlyphs.push({}),this._uniqueEffectGlyphs.push([])},CreateGlyph:function(n){if(this.Info.ShouldCreateGlyph(n)&&(!this.Info.get_HideOnMultiTrack()||this.Renderer.Staff.TrackIndex==0)){this.IsEmpty=!1;(this.FirstBeat==null||this.FirstBeat.Index>n.Index)&&(this.FirstBeat=n);(this.LastBeat==null||this.LastBeat.Index<n.Index)&&(this.LastBeat=n);var t=this.CreateOrResizeGlyph(this.Info.get_SizingMode(),n);t.Height>this.Height&&(this.Height=t.Height)}},CreateOrResizeGlyph:function(n,t){var i,r,u,f;switch(n){case AlphaTab.Rendering.EffectBarGlyphSizing.FullBar:return i=this.Info.CreateNewGlyph(this.Renderer,t),i.Renderer=this.Renderer,i.Beat=t,i.DoLayout(),this._effectGlyphs[t.Voice.Index][t.Index]=i,this._uniqueEffectGlyphs[t.Voice.Index].push(i),i;case AlphaTab.Rendering.EffectBarGlyphSizing.SinglePreBeat:case AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat:return i=this.Info.CreateNewGlyph(this.Renderer,t),i.Renderer=this.Renderer,i.Beat=t,i.DoLayout(),this._effectGlyphs[t.Voice.Index][t.Index]=i,this._uniqueEffectGlyphs[t.Voice.Index].push(i),i;case AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat:if(t.Index>0||this.Renderer.Index>0){if(r=t.PreviousBeat,this.Info.ShouldCreateGlyph(r)){if(u=null,t.Index>0&&this._effectGlyphs[t.Voice.Index].hasOwnProperty(r.Index))u=this._effectGlyphs[t.Voice.Index][r.Index];else if(this.Renderer.Index>0){var o=this.Renderer.get_PreviousRenderer(),s=o.BandLookup[this.Info.get_EffectId()],e=s._effectGlyphs[t.Voice.Index];e.hasOwnProperty(r.Index)&&(u=e[r.Index])}return f=this.CreateOrResizeGlyph(AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat,t),u!=null&&this.Info.CanExpand(r,t)&&(u.NextGlyph=f,f.PreviousGlyph=u,this.IsLinkedToPrevious=!0),f}return this.CreateOrResizeGlyph(AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat,t)}return this.CreateOrResizeGlyph(AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat,t)}return null},Paint:function(n,t,i){var r,e,f,u,o,s;for(AlphaTab.Rendering.Glyphs.Glyph.prototype.Paint.call(this,n,t,i),r=0,e=this._uniqueEffectGlyphs.length;r<e;r++)for(f=this._uniqueEffectGlyphs[r],u=0,o=f.length;u<o;u++)s=f[u],s.Paint(n+this.X,t+this.Y,i)},AlignGlyphs:function(){for(var t,n=0;n<this._effectGlyphs.length;n++)for(t in this._effectGlyphs[n])this.AlignGlyph(this.Info.get_SizingMode(),this.Renderer.Bar.Voices[n].Beats[t])},AlignGlyph:function(n,t){var r=this._effectGlyphs[t.Voice.Index][t.Index],i,u=this.Renderer.GetBeatContainer(t);switch(n){case AlphaTab.Rendering.EffectBarGlyphSizing.SinglePreBeat:i=u.PreNotes;r.X=this.Renderer.get_BeatGlyphsStart()+i.X+u.X;r.Width=i.Width;break;case AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat:case AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat:i=u.OnNotes;r.X=this.Renderer.get_BeatGlyphsStart()+i.X+u.X;r.Width=i.Width;break;case AlphaTab.Rendering.EffectBarGlyphSizing.FullBar:r.Width=this.Renderer.Width}}},$Inherit(AlphaTab.Rendering.EffectBand,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.EffectBandSizingInfo=function(){this._effectSlot=null;this.Slots=null;this.Slots=[];this._effectSlot={}},AlphaTab.Rendering.EffectBandSizingInfo.prototype={GetOrCreateSlot:function(n){var t,u;if(this._effectSlot.hasOwnProperty(n.Info.get_EffectId())&&(t=this._effectSlot[n.Info.get_EffectId()],t.CanBeUsed(n)))return t;for(var i=0,r=this.Slots,f=r.length,t=r[i];i<f;i++,t=r[i])if(t.CanBeUsed(n))return t;return u=new AlphaTab.Rendering.EffectBandSlot,this.Slots.push(u),u},CopySlots:function(n){for(var t,r=0,f=n.Slots,s=f.length,i=f[r];r<s;r++,i=f[r]){t=new AlphaTab.Rendering.EffectBandSlot;t.Y=i.Y;t.Height=i.Height;t.UniqueEffectId=i.UniqueEffectId;this.Slots.push(t);for(var u=0,e=i.Bands,h=e.length,o=e[u];u<h;u++,o=e[u])this._effectSlot[o.Info.get_EffectId()]=t}},Register:function(n){var t=this.GetOrCreateSlot(n);t.Update(n);this._effectSlot[n.Info.get_EffectId()]=t}},AlphaTab.Rendering.EffectBandSlot=function(){this.Y=0;this.Height=0;this.FirstBeat=null;this.LastBeat=null;this.Bands=null;this.UniqueEffectId=null;this.Bands=[]},AlphaTab.Rendering.EffectBandSlot.prototype={Update:function(n){n.Info.get_CanShareBand()||(this.UniqueEffectId=n.Info.get_EffectId());this.Bands.push(n);n.Height>this.Height&&(this.Height=n.Height);(this.FirstBeat==null||this.FirstBeat.Index>n.FirstBeat.Index)&&(this.FirstBeat=n.FirstBeat);(this.LastBeat==null||this.LastBeat.Index<n.LastBeat.Index)&&(this.LastBeat=n.LastBeat)},CanBeUsed:function(n){return(this.UniqueEffectId==null&&n.Info.get_CanShareBand()||n.Info.get_EffectId()==this.UniqueEffectId)&&(this.FirstBeat==null||this.LastBeat.Index<n.FirstBeat.Index||n.LastBeat.Index<this.FirstBeat.Index)}},AlphaTab.Rendering.EffectBarRenderer=function(n,t,i){this._infos=null;this._bands=null;this.BandLookup=null;this.SizingInfo=null;AlphaTab.Rendering.BarRendererBase.call(this,n,t);this._infos=i},AlphaTab.Rendering.EffectBarRenderer.prototype={UpdateSizes:function(){this.TopOverflow=0;this.BottomOverflow=0;this.TopPadding=0;this.BottomPadding=0;this.UpdateHeight();AlphaTab.Rendering.BarRendererBase.prototype.UpdateSizes.call(this)},UpdateHeight:function(){var n;if(this.SizingInfo!=null){n=0;for(var i=0,u=this.SizingInfo.Slots,o=u.length,t=u[i];i<o;i++,t=u[i]){t.Y=n;for(var r=0,f=t.Bands,s=f.length,e=f[r];r<s;r++,e=f[r])e.Y=n,e.Height=t.Height;n+=t.Height}this.Height=n}},ApplyLayoutingInfo:function(){var r;if(!AlphaTab.Rendering.BarRendererBase.prototype.ApplyLayoutingInfo.call(this))return!1;this.SizingInfo=new AlphaTab.Rendering.EffectBandSizingInfo;this.Index>0&&(r=this.get_PreviousRenderer(),this.SizingInfo.CopySlots(r.SizingInfo));for(var n=0,i=this._bands,u=i.length,t=i[n];n<u;n++,t=i[n])t.AlignGlyphs(),t.IsEmpty||this.SizingInfo.Register(t);return this.UpdateHeight(),!0},ScaleToWidth:function(n){AlphaTab.Rendering.BarRendererBase.prototype.ScaleToWidth.call(this,n);for(var t=0,i=this._bands,u=i.length,r=i[t];t<u;t++,r=i[t])r.AlignGlyphs()},CreateBeatGlyphs:function(){var n;for(this._bands=new Array(this._infos.length),this.BandLookup={},n=0;n<this._infos.length;n++)this._bands[n]=new AlphaTab.Rendering.EffectBand(this._infos[n]),this._bands[n].Renderer=this,this._bands[n].DoLayout(),this.BandLookup[this._infos[n].get_EffectId()]=this._bands[n];for(var t=0,r=this.Bar.Voices,o=r.length,u=r[t];t<o;t++,u=r[t])this.HasVoiceContainer(u)&&this.CreateVoiceGlyphs(u);for(var i=0,f=this._bands,s=f.length,e=f[i];i<s;i++,e=f[i])e.IsLinkedToPrevious&&(this.IsLinkedToPrevious=!0)},CreateVoiceGlyphs:function(n){for(var i,t=0,u=n.Beats,s=u.length,f=u[t];t<s;t++,f=u[t]){i=new AlphaTab.Rendering.Glyphs.BeatContainerGlyph(f,this.GetOrCreateVoiceContainer(n));i.PreNotes=new AlphaTab.Rendering.Glyphs.BeatGlyphBase;i.OnNotes=new AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase;this.AddBeatGlyph(i);for(var r=0,e=this._bands,h=e.length,o=e[r];r<h;r++,o=e[r])o.CreateGlyph(f)}},Paint:function(n,t,i){this.PaintBackground(n,t,i);i.set_Color(this.get_Resources().MainGlyphColor);for(var r=0,u=this._bands,e=u.length,f=u[r];r<e;r++,f=u[r])f.Paint(n+this.X,t+this.Y,i)}},$Inherit(AlphaTab.Rendering.EffectBarRenderer,AlphaTab.Rendering.BarRendererBase),AlphaTab.Rendering.EffectBarRendererFactory=function(n,t){this._infos=null;this._staffId=null;AlphaTab.Rendering.BarRendererFactory.call(this);this._infos=t;this._staffId=n;this.IsInAccolade=!1},AlphaTab.Rendering.EffectBarRendererFactory.prototype={get_StaffId:function(){return this._staffId},Create:function(n,t){return new AlphaTab.Rendering.EffectBarRenderer(n,t,this._infos)}},$Inherit(AlphaTab.Rendering.EffectBarRendererFactory,AlphaTab.Rendering.BarRendererFactory),AlphaTab.Rendering.Effects=AlphaTab.Rendering.Effects||{},AlphaTab.Rendering.Effects.BeatVibratoEffectInfo=function(){},AlphaTab.Rendering.Effects.BeatVibratoEffectInfo.prototype={get_EffectId:function(){return"beat-vibrato"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat},ShouldCreateGlyph:function(n){return n.Vibrato!=AlphaTab.Model.VibratoType.None},CreateNewGlyph:function(n){return new AlphaTab.Rendering.Glyphs.VibratoGlyph(0,5*n.get_Scale(),1.4)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.ChordsEffectInfo=function(){},AlphaTab.Rendering.Effects.ChordsEffectInfo.prototype={get_EffectId:function(){return"chords"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.get_HasChord()},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,t.get_Chord().Name,n.get_Resources().EffectFont,AlphaTab.Platform.Model.TextAlign.Left)},CanExpand:function(){return!1}},AlphaTab.Rendering.Effects.CrescendoEffectInfo=function(){},AlphaTab.Rendering.Effects.CrescendoEffectInfo.prototype={get_EffectId:function(){return"crescendo"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat},ShouldCreateGlyph:function(n){return n.Crescendo!=AlphaTab.Model.CrescendoType.None},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.CrescendoGlyph(0,0,t.Crescendo)},CanExpand:function(n,t){return n.Crescendo==t.Crescendo}},AlphaTab.Rendering.Glyphs.EffectGlyph=function(n,t){this.Beat=null;this.NextGlyph=null;this.PreviousGlyph=null;this.Height=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t)},$Inherit(AlphaTab.Rendering.Glyphs.EffectGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Effects.DummyEffectGlyph=function(n,t,i){this._s=null;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t);this._s=i},AlphaTab.Rendering.Effects.DummyEffectGlyph.prototype={DoLayout:function(){this.Width=20*this.get_Scale()},Paint:function(n,t,i){var r=this.Renderer.get_Resources();i.set_Color(r.MainGlyphColor);i.StrokeRect(n+this.X,t+this.Y,this.Width,20*this.get_Scale());i.set_Font(r.TablatureFont);i.FillText(this._s,n+this.X,t+this.Y)}},$Inherit(AlphaTab.Rendering.Effects.DummyEffectGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Effects.DynamicsEffectInfo=function(){},AlphaTab.Rendering.Effects.DynamicsEffectInfo.prototype={get_EffectId:function(){return"dynamics"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.Voice.Index==0&&(n.Index==0&&n.Voice.Bar.Index==0||n.PreviousBeat!=null&&n.Dynamic!=n.PreviousBeat.Dynamic)},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.DynamicsGlyph(0,0,t.Dynamic)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.FadeInEffectInfo=function(){},AlphaTab.Rendering.Effects.FadeInEffectInfo.prototype={get_EffectId:function(){return"fade-in"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.FadeIn},CreateNewGlyph:function(){return new AlphaTab.Rendering.Glyphs.FadeInGlyph(0,0)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.NoteEffectInfoBase=function(){this.LastCreateInfo=null},AlphaTab.Rendering.Effects.NoteEffectInfoBase.prototype={ShouldCreateGlyph:function(n){var t,r,i;for(this.LastCreateInfo=[],t=0,r=n.Notes.length;t<r;t++)i=n.Notes[t],this.ShouldCreateGlyphForNote(i)&&this.LastCreateInfo.push(i);return this.LastCreateInfo.length>0},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.HarmonicsEffectInfo=function(){this._beat=null;this._beatType=AlphaTab.Model.HarmonicType.None;AlphaTab.Rendering.Effects.NoteEffectInfoBase.call(this)},AlphaTab.Rendering.Effects.HarmonicsEffectInfo.prototype={get_EffectId:function(){return"harmonics"},ShouldCreateGlyphForNote:function(n){return n.get_IsHarmonic()?((n.Beat!=this._beat||n.HarmonicType>this._beatType)&&(this._beat=n.Beat,this._beatType=n.HarmonicType),!0):!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},CreateNewGlyph:function(n){return new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,AlphaTab.Rendering.Effects.HarmonicsEffectInfo.HarmonicToString(this._beatType),n.get_Resources().EffectFont,AlphaTab.Platform.Model.TextAlign.Left)}},AlphaTab.Rendering.Effects.HarmonicsEffectInfo.HarmonicToString=function(n){switch(n){case AlphaTab.Model.HarmonicType.Natural:return"N.H.";case AlphaTab.Model.HarmonicType.Artificial:return"A.H.";case AlphaTab.Model.HarmonicType.Pinch:return"P.H.";case AlphaTab.Model.HarmonicType.Tap:return"T.H.";case AlphaTab.Model.HarmonicType.Semi:return"S.H.";case AlphaTab.Model.HarmonicType.Feedback:return"Fdbk."}return""},$Inherit(AlphaTab.Rendering.Effects.HarmonicsEffectInfo,AlphaTab.Rendering.Effects.NoteEffectInfoBase),AlphaTab.Rendering.Effects.LetRingEffectInfo=function(){AlphaTab.Rendering.Effects.NoteEffectInfoBase.call(this)},AlphaTab.Rendering.Effects.LetRingEffectInfo.prototype={get_EffectId:function(){return"let-ring"},get_CanShareBand:function(){return!1},ShouldCreateGlyphForNote:function(n){return n.IsLetRing},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat},CreateNewGlyph:function(){return new AlphaTab.Rendering.Glyphs.LineRangedGlyph("LetRing")}},$Inherit(AlphaTab.Rendering.Effects.LetRingEffectInfo,AlphaTab.Rendering.Effects.NoteEffectInfoBase),AlphaTab.Rendering.Effects.MarkerEffectInfo=function(){},AlphaTab.Rendering.Effects.MarkerEffectInfo.prototype={get_EffectId:function(){return"marker"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SinglePreBeat},ShouldCreateGlyph:function(n){return n.Voice.Bar.Staff.Index==0&&n.Voice.Index==0&&n.Index==0&&n.Voice.Bar.get_MasterBar().get_IsSectionStart()},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,t.Voice.Bar.get_MasterBar().Section.Text,n.get_Resources().MarkerFont,AlphaTab.Platform.Model.TextAlign.Left)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.NoteVibratoEffectInfo=function(){AlphaTab.Rendering.Effects.NoteEffectInfoBase.call(this)},AlphaTab.Rendering.Effects.NoteVibratoEffectInfo.prototype={get_EffectId:function(){return"note-vibrato"},ShouldCreateGlyphForNote:function(n){return n.Vibrato!=AlphaTab.Model.VibratoType.None||n.IsTieDestination&&n.TieOrigin.Vibrato!=AlphaTab.Model.VibratoType.None},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat},CreateNewGlyph:function(n){return new AlphaTab.Rendering.Glyphs.VibratoGlyph(0,5*n.get_Scale(),1.2)}},$Inherit(AlphaTab.Rendering.Effects.NoteVibratoEffectInfo,AlphaTab.Rendering.Effects.NoteEffectInfoBase),AlphaTab.Rendering.Effects.CapoEffectInfo=function(){},AlphaTab.Rendering.Effects.CapoEffectInfo.prototype={get_EffectId:function(){return"capo"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.Index==0&&n.Voice.Bar.Index==0&&n.Voice.Bar.Staff.Track.Capo!=0},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"Capo. fret "+t.Voice.Bar.Staff.Track.Capo,n.get_Resources().EffectFont,AlphaTab.Platform.Model.TextAlign.Left)},CanExpand:function(){return!1}},AlphaTab.Rendering.Effects.PalmMuteEffectInfo=function(){AlphaTab.Rendering.Effects.NoteEffectInfoBase.call(this)},AlphaTab.Rendering.Effects.PalmMuteEffectInfo.prototype={get_EffectId:function(){return"palm-mute"},ShouldCreateGlyphForNote:function(n){return n.IsPalmMute},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.GroupedOnBeat},CreateNewGlyph:function(){return new AlphaTab.Rendering.Glyphs.LineRangedGlyph("P.M.")}},$Inherit(AlphaTab.Rendering.Effects.PalmMuteEffectInfo,AlphaTab.Rendering.Effects.NoteEffectInfoBase),AlphaTab.Rendering.Effects.PickStrokeEffectInfo=function(){},AlphaTab.Rendering.Effects.PickStrokeEffectInfo.prototype={get_EffectId:function(){return"pick-stroke"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.PickStroke!=AlphaTab.Model.PickStrokeType.None},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.PickStrokeGlyph(0,0,t.PickStroke)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.TapEffectInfo=function(){},AlphaTab.Rendering.Effects.TapEffectInfo.prototype={get_EffectId:function(){return"tap"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!0},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return n.Slap||n.Pop||n.Tap},CreateNewGlyph:function(n,t){var i=n.get_Resources();return t.Slap?new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"S",i.EffectFont,AlphaTab.Platform.Model.TextAlign.Left):t.Pop?new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"P",i.EffectFont,AlphaTab.Platform.Model.TextAlign.Left):new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"T",i.EffectFont,AlphaTab.Platform.Model.TextAlign.Left)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.TempoEffectInfo=function(){},AlphaTab.Rendering.Effects.TempoEffectInfo.prototype={get_EffectId:function(){return"tempo"},get_HideOnMultiTrack:function(){return!0},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SinglePreBeat},ShouldCreateGlyph:function(n){return n.Voice.Bar.Staff.Index==0&&n.Voice.Index==0&&n.Index==0&&(n.Voice.Bar.get_MasterBar().TempoAutomation!=null||n.Voice.Bar.Index==0)},CreateNewGlyph:function(n,t){var i;return i=t.Voice.Bar.get_MasterBar().TempoAutomation!=null?t.Voice.Bar.get_MasterBar().TempoAutomation.Value|0:t.Voice.Bar.Staff.Track.Score.Tempo,new AlphaTab.Rendering.Glyphs.TempoGlyph(0,0,i)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.TextEffectInfo=function(){},AlphaTab.Rendering.Effects.TextEffectInfo.prototype={get_EffectId:function(){return"text"},get_HideOnMultiTrack:function(){return!1},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},ShouldCreateGlyph:function(n){return!AlphaTab.Platform.Std.IsNullOrWhiteSpace(n.Text)},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,t.Text,n.get_Resources().EffectFont,AlphaTab.Platform.Model.TextAlign.Left)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.TrillEffectInfo=function(){AlphaTab.Rendering.Effects.NoteEffectInfoBase.call(this)},AlphaTab.Rendering.Effects.TrillEffectInfo.prototype={get_EffectId:function(){return"trill"},ShouldCreateGlyphForNote:function(n){return n.get_IsTrill()},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SingleOnBeat},CreateNewGlyph:function(){return new AlphaTab.Rendering.Glyphs.TrillGlyph(0,0)}},$Inherit(AlphaTab.Rendering.Effects.TrillEffectInfo,AlphaTab.Rendering.Effects.NoteEffectInfoBase),AlphaTab.Rendering.Effects.AlternateEndingsEffectInfo=function(){},AlphaTab.Rendering.Effects.AlternateEndingsEffectInfo.prototype={get_EffectId:function(){return"alternate-feel"},get_HideOnMultiTrack:function(){return!0},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.FullBar},ShouldCreateGlyph:function(n){return n.Index==0&&n.Voice.Bar.get_MasterBar().AlternateEndings!=0},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.AlternateEndingsGlyph(0,0,t.Voice.Bar.get_MasterBar().AlternateEndings)},CanExpand:function(){return!0}},AlphaTab.Rendering.Effects.TripletFeelEffectInfo=function(){},AlphaTab.Rendering.Effects.TripletFeelEffectInfo.prototype={get_EffectId:function(){return"triplet-feel"},get_HideOnMultiTrack:function(){return!0},get_CanShareBand:function(){return!1},get_SizingMode:function(){return AlphaTab.Rendering.EffectBarGlyphSizing.SinglePreBeat},ShouldCreateGlyph:function(n){return n.Index==0&&(n.Voice.Bar.get_MasterBar().Index==0&&n.Voice.Bar.get_MasterBar().TripletFeel!=AlphaTab.Model.TripletFeel.NoTripletFeel||n.Voice.Bar.get_MasterBar().Index>0&&n.Voice.Bar.get_MasterBar().TripletFeel!=n.Voice.Bar.get_MasterBar().PreviousMasterBar.TripletFeel)},CreateNewGlyph:function(n,t){return new AlphaTab.Rendering.Glyphs.TripletFeelGlyph(t.Voice.Bar.get_MasterBar().TripletFeel)},CanExpand:function(){return!0}},AlphaTab.Rendering.Glyphs.MusicFontGlyph=function(n,t,i,r){this.GlyphScale=0;this._symbol=AlphaTab.Rendering.Glyphs.MusicFontSymbol.None;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t);this.GlyphScale=i;this._symbol=r},AlphaTab.Rendering.Glyphs.MusicFontGlyph.prototype={Paint:function(n,t,i){i.FillMusicFontSymbol(n+this.X,t+this.Y,this.GlyphScale*this.get_Scale(),this._symbol)}},$Inherit(AlphaTab.Rendering.Glyphs.MusicFontGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.AccentuationGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,1,AlphaTab.Rendering.Glyphs.AccentuationGlyph.GetSymbol(i))},AlphaTab.Rendering.Glyphs.AccentuationGlyph.prototype={DoLayout:function(){this.Width=9*this.get_Scale()}},AlphaTab.Rendering.Glyphs.AccentuationGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.AccentuationType.None:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None;case AlphaTab.Model.AccentuationType.Normal:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Accentuation;case AlphaTab.Model.AccentuationType.Heavy:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.HeavyAccentuation;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.AccentuationGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.GlyphGroup=function(n,t){this.Glyphs=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.GlyphGroup.prototype={get_IsEmpty:function(){return this.Glyphs==null||this.Glyphs.length==0},DoLayout:function(){var n,t,r,i;if(this.Glyphs==null||this.Glyphs.length==0){this.Width=0;return}for(n=0,t=0,r=this.Glyphs.length;t<r;t++)i=this.Glyphs[t],i.Renderer=this.Renderer,i.DoLayout(),n=Math.max(n,i.Width);this.Width=n},AddGlyph:function(n){this.Glyphs==null&&(this.Glyphs=[]);this.Glyphs.push(n)},Paint:function(n,t,i){var r=this.Glyphs;if(r!=null&&r.length!=0)for(var u=0,e=r.length,f=r[u];u<e;u++,f=r[u])f.Paint(n+this.X,t+this.Y,i)}},$Inherit(AlphaTab.Rendering.Glyphs.GlyphGroup,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.AccidentalGroupGlyph=function(){AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,0,0)},AlphaTab.Rendering.Glyphs.AccidentalGroupGlyph.prototype={DoLayout:function(){var i,o,r,f,e,t,u,n;if(this.Glyphs==null){this.Width=0;return}for(this.Glyphs.sort($CreateAnonymousDelegate(this,function(n,t){return n.Y-t.Y})),i=[],i.push(-3e3),o=21*this.get_Scale(),t=0,u=this.Glyphs.length;t<u;t++){for(n=this.Glyphs[t],n.Renderer=this.Renderer,n.DoLayout(),r=0;i[r]>n.Y;)r++,r==i.length&&i.push(-3e3);n.X=r;i[r]=n.Y+o}for(f=8*this.get_Scale(),e=2*this.get_Scale(),this.Width=this.Glyphs.length==0?0:e+f*i.length,t=0,u=this.Glyphs.length;t<u;t++)n=this.Glyphs[t],n.X=e+(this.Width-(n.X+1)*f)}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.AccidentalGroupGlyph.NonReserved=-3e3}),$Inherit(AlphaTab.Rendering.Glyphs.AccidentalGroupGlyph,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.AlternateEndingsGlyph=function(n,t,i){this._endings=null;this._endingsString=null;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t);this._endings=[];for(var r=0;r<8;r++)(i&1<<r)!=0&&this._endings.push(r)},AlphaTab.Rendering.Glyphs.AlternateEndingsGlyph.prototype={DoLayout:function(){var n,t,i;for(AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this),this.Height=this.Renderer.get_Resources().WordsFont.Size+(3*this.get_Scale()+2),n=new String,t=0,i=this._endings.length;t<i;t++)n+=this._endings[t]+1,n+=". ";this._endingsString=n},Paint:function(n,t,i){if(AlphaTab.Rendering.Glyphs.Glyph.prototype.Paint.call(this,n,t,i),this._endings.length>0){var r=this.Renderer.get_Resources();i.set_Font(r.WordsFont);i.MoveTo(n+this.X,t+this.Y+this.Height);i.LineTo(n+this.X,t+this.Y);i.LineTo(n+this.X+this.Width,t+this.Y);i.Stroke();i.FillText(this._endingsString,n+this.X+3*this.get_Scale(),t+this.Y*this.get_Scale())}}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.AlternateEndingsGlyph.Padding=3}),$Inherit(AlphaTab.Rendering.Glyphs.AlternateEndingsGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.BarNumberGlyph=function(n,t,i){this._number=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this._number=i},AlphaTab.Rendering.Glyphs.BarNumberGlyph.prototype={DoLayout:function(){this.Renderer.ScoreRenderer.Canvas.set_Font(this.Renderer.get_Resources().BarNumberFont);this.Width=this.Renderer.ScoreRenderer.Canvas.MeasureText(this._number.toString())+5*this.get_Scale()},Paint:function(n,t,i){if(this.Renderer.Staff.IsFirstInAccolade){var r=this.Renderer.get_Resources();i.set_Color(r.BarNumberColor);i.set_Font(r.BarNumberFont);i.FillText(this._number.toString(),n+this.X,t+this.Y);i.set_Color(r.MainGlyphColor)}}},$Inherit(AlphaTab.Rendering.Glyphs.BarNumberGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.BarSeperatorGlyph=function(n,t){AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.BarSeperatorGlyph.prototype={DoLayout:function(){this.Width=8*this.get_Scale()},Paint:function(n,t,i){var e=4*this.get_Scale(),r=t+this.Y+this.Renderer.TopPadding,o=t+this.Y+this.Renderer.Height-this.Renderer.BottomPadding,u=n+this.X|0,f=o-r;this.Renderer.get_IsLast()?(i.FillRect(u,r,this.get_Scale(),f),i.FillRect(u+this.Width-e,r,e,f)):(i.FillRect(u+this.Width,r,this.get_Scale(),f),this.Renderer.Bar.get_MasterBar().IsDoubleBar&&i.FillRect(u+this.Width-5*this.get_Scale(),r,this.get_Scale(),f))}},$Inherit(AlphaTab.Rendering.Glyphs.BarSeperatorGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.BeamGlyph=function(n,t,i,r,u){AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,u?.75:1,AlphaTab.Rendering.Glyphs.BeamGlyph.GetSymbol(i,r,u))},AlphaTab.Rendering.Glyphs.BeamGlyph.prototype={DoLayout:function(){this.Width=0}},AlphaTab.Rendering.Glyphs.BeamGlyph.GetSymbol=function(n,t){if(t==AlphaTab.Rendering.Utils.BeamDirection.Up)switch(n){case AlphaTab.Model.Duration.Eighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpEighth;case AlphaTab.Model.Duration.Sixteenth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpSixteenth;case AlphaTab.Model.Duration.ThirtySecond:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpThirtySecond;case AlphaTab.Model.Duration.SixtyFourth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpSixtyFourth;case AlphaTab.Model.Duration.OneHundredTwentyEighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpOneHundredTwentyEighth;case AlphaTab.Model.Duration.TwoHundredFiftySixth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpTwoHundredFiftySixth;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterUpEighth}else switch(n){case AlphaTab.Model.Duration.Eighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownEighth;case AlphaTab.Model.Duration.Sixteenth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownSixteenth;case AlphaTab.Model.Duration.ThirtySecond:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownThirtySecond;case AlphaTab.Model.Duration.SixtyFourth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownSixtyFourth;case AlphaTab.Model.Duration.OneHundredTwentyEighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownOneHundredTwentyEighth;case AlphaTab.Model.Duration.TwoHundredFiftySixth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownOneHundredTwentyEighth;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.FooterDownEighth}},$Inherit(AlphaTab.Rendering.Glyphs.BeamGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.BeatContainerGlyph=function(n,t){this.VoiceContainer=null;this.Beat=null;this.PreNotes=null;this.OnNotes=null;this.Ties=null;this.MinWidth=0;this.OnTimeX=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this.Beat=n;this.Ties=[];this.VoiceContainer=t},AlphaTab.Rendering.Glyphs.BeatContainerGlyph.prototype={RegisterLayoutingInfo:function(n){var t=this.PreNotes.Width+this.OnNotes.Width/2;n.AddBeatSpring(this.Beat,this.MinWidth,t);n.SetPreBeatSize(this.Beat,this.PreNotes.Width);n.SetOnBeatSize(this.Beat,this.OnNotes.Width)},ApplyLayoutingInfo:function(n){this.PreNotes.Width=n.GetPreBeatSize(this.Beat);this.OnNotes.Width=n.GetOnBeatSize(this.Beat);this.OnNotes.X=this.PreNotes.X+this.PreNotes.Width;this.OnTimeX=this.OnNotes.X+this.OnNotes.Width/2;this.OnNotes.UpdateBeamingHelper()},DoLayout:function(){this.PreNotes.X=0;this.PreNotes.Renderer=this.Renderer;this.PreNotes.Container=this;this.PreNotes.DoLayout();this.OnNotes.X=this.PreNotes.X+this.PreNotes.Width;this.OnNotes.Renderer=this.Renderer;this.OnNotes.Container=this;this.OnNotes.DoLayout();for(var n=this.Beat.Notes.length-1;n>=0;)this.CreateTies(this.Beat.Notes[n--]);if(this.MinWidth=this.PreNotes.Width+this.OnNotes.Width,!this.Beat.get_IsRest())if(this.OnNotes.BeamingHelper.Beats.length==1)this.Beat.Duration>=AlphaTab.Model.Duration.Eighth&&(this.MinWidth+=20*this.get_Scale());else switch(this.Beat.Duration){case AlphaTab.Model.Duration.OneHundredTwentyEighth:case AlphaTab.Model.Duration.TwoHundredFiftySixth:this.MinWidth+=10*this.get_Scale()}this.Width=this.MinWidth;this.OnTimeX=this.OnNotes.X+this.OnNotes.Width/2},ScaleToWidth:function(n){this.OnNotes.UpdateBeamingHelper();this.Width=n},CreateTies:function(){},Paint:function(n,t,i){var f,h,e,o,r,s,u;if(!this.Beat.Voice.IsEmpty&&(f=this.PreNotes.get_IsEmpty()&&this.OnNotes.get_IsEmpty()&&this.Ties.length==0,!f)){for(i.BeginGroup("b"+this.Beat.Id),h=i.get_Color(),this.PreNotes.Paint(n+this.X,t+this.Y,i),this.OnNotes.Paint(n+this.X,t+this.Y,i),e=n-this.VoiceContainer.X-this.Renderer.X,o=t-this.VoiceContainer.Y-this.Renderer.Y,r=0,s=this.Ties.length;r<s;r++)u=this.Ties[r],u.Renderer=this.Renderer,u.Paint(e,o,i);i.EndGroup()}}},$Inherit(AlphaTab.Rendering.Glyphs.BeatContainerGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.BeatGlyphBase=function(){this.Container=null;AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,0,0)},AlphaTab.Rendering.Glyphs.BeatGlyphBase.prototype={DoLayout:function(){var i=0,t,r,n;if(this.Glyphs!=null)for(t=0,r=this.Glyphs.length;t<r;t++)n=this.Glyphs[t],n.X=i,n.Renderer=this.Renderer,n.DoLayout(),i+=n.Width;this.Width=i},NoteLoop:function(n){for(var t=this.Container.Beat.Notes.length-1;t>=0;t--)n(this.Container.Beat.Notes[t])}},$Inherit(AlphaTab.Rendering.Glyphs.BeatGlyphBase,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase=function(){this.BeamingHelper=null;AlphaTab.Rendering.Glyphs.BeatGlyphBase.call(this)},AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase.prototype={UpdateBeamingHelper:function(){}},$Inherit(AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase,AlphaTab.Rendering.Glyphs.BeatGlyphBase),AlphaTab.Rendering.Glyphs.BendGlyph=function(n,t){this._note=null;this._bendValueHeight=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._note=n;this._bendValueHeight=t},AlphaTab.Rendering.Glyphs.BendGlyph.prototype={Paint:function(n,t,i){for(var u,e,o=this.Width/60,s=0,r=0,f=this._note.BendPoints.length;r<f;r++)this._note.BendPoints[r].Value>s&&(s=this._note.BendPoints[r].Value);for(n+=this.X,t+=this.Y,i.BeginPath(),r=0,f=this._note.BendPoints.length-1;r<f;r++)(u=this._note.BendPoints[r],e=this._note.BendPoints[r+1],r!=0||u.Value==0||this._note.IsTieDestination||this.PaintBend(new AlphaTab.Model.BendPoint(0,0),u,n,t,o,i),u.Value!=e.Value||r!=this._note.BendPoints.length-2)&&this.PaintBend(u,e,n,t,o,i)},PaintBend:function(n,t,i,r,u,f){var p=this.Renderer,b=this.Renderer.get_Resources(),k=p.get_LineOffset()/2,v=i+u*n.Offset,l=r-this._bendValueHeight*n.Value,e,o,a,s,h,y,c,w;if(l+=n.Value==0?p.GetNoteY(this._note):k,e=i+u*t.Offset,o=r-this._bendValueHeight*t.Value,o+=t.Value==0?p.GetNoteY(this._note):k,a=0,s=6*this.get_Scale(),t.Value>n.Value?(f.BeginPath(),f.MoveTo(e,o),f.LineTo(e-s*.5,o+s),f.LineTo(e+s*.5,o+s),f.ClosePath(),f.Fill(),a=s):t.Value!=n.Value&&(f.BeginPath(),f.MoveTo(e,o),f.LineTo(e-s*.5,o-s),f.LineTo(e+s*.5,o-s),f.ClosePath(),f.Fill(),a=-s),f.Stroke(),n.Value==t.Value?(f.MoveTo(v,l),f.LineTo(e,o),f.Stroke()):e>v?(f.MoveTo(v,l),f.BezierCurveTo(e,l,e,o+a,e,o+a),f.Stroke()):(f.MoveTo(v,l),f.LineTo(e,o),f.Stroke()),t.Value!=0&&(h=t.Value,y=t.Value>n.Value,h=Math.abs(h),c="",h==4&&y?(c="full",h-=4):(h>=4||h<=-4)&&(w=h/4|0,c+=w,h-=w*4),h>0&&(c+=AlphaTab.Rendering.Glyphs.BendGlyph.GetFractionSign(h)),c!="")){y||(c="-"+c);f.set_Font(b.TablatureFont);var d=f.MeasureText(c),g=y?o-b.TablatureFont.Size-2*this.get_Scale():o+2*this.get_Scale(),nt=e-d/2;f.FillText(c,nt,g)}}},AlphaTab.Rendering.Glyphs.BendGlyph.GetFractionSign=function(n){switch(n){case 1:return"";case 2:return"";case 3:return"";default:return n+"/ 4"}},$Inherit(AlphaTab.Rendering.Glyphs.BendGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ChineseCymbalGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteHarmonic);this._isGrace=i},AlphaTab.Rendering.Glyphs.ChineseCymbalGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.ChineseCymbalGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.CircleGlyph=function(n,t,i){this._size=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this._size=i},AlphaTab.Rendering.Glyphs.CircleGlyph.prototype={DoLayout:function(){this.Width=this._size+3*this.get_Scale()},Paint:function(n,t,i){i.FillCircle(n+this.X,t+this.Y,this._size)}},$Inherit(AlphaTab.Rendering.Glyphs.CircleGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ClefGlyph=function(n,t,i,r){this._clef=AlphaTab.Model.Clef.Neutral;this._clefOttavia=AlphaTab.Model.ClefOttavia._15ma;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,1,AlphaTab.Rendering.Glyphs.ClefGlyph.GetSymbol(i));this._clef=i;this._clefOttavia=r},AlphaTab.Rendering.Glyphs.ClefGlyph.prototype={DoLayout:function(){switch(this._clef){case AlphaTab.Model.Clef.Neutral:this.Width=15*this.get_Scale();break;case AlphaTab.Model.Clef.C3:case AlphaTab.Model.Clef.C4:case AlphaTab.Model.Clef.F4:case AlphaTab.Model.Clef.G2:this.Width=28*this.get_Scale()}},Paint:function(n,t,i){var r,u,f,e;AlphaTab.Rendering.Glyphs.MusicFontGlyph.prototype.Paint.call(this,n,t,i);u=!1;switch(this._clefOttavia){case AlphaTab.Model.ClefOttavia._15ma:r=new AlphaTab.Rendering.Glyphs.NumberGlyph(this.Width/2,0,15,.5);u=!0;break;case AlphaTab.Model.ClefOttavia._8va:r=new AlphaTab.Rendering.Glyphs.NumberGlyph(0,0,8,.5);u=!0;break;case AlphaTab.Model.ClefOttavia._8vb:r=new AlphaTab.Rendering.Glyphs.NumberGlyph(0,0,8,.5);break;case AlphaTab.Model.ClefOttavia._15mb:r=new AlphaTab.Rendering.Glyphs.NumberGlyph(0,0,15,.5);break;default:return}switch(this._clef){case AlphaTab.Model.Clef.Neutral:f=u?-25:10;break;case AlphaTab.Model.Clef.C3:f=u?-30:20;break;case AlphaTab.Model.Clef.C4:f=u?-30:20;break;case AlphaTab.Model.Clef.F4:f=u?-25:20;break;case AlphaTab.Model.Clef.G2:f=u?-50:25;break;default:return}r.Renderer=this.Renderer;r.DoLayout();e=(this.Width-r.Width)/2;r.Paint(n+this.X+e,t+this.Y+f*this.get_Scale(),i)}},AlphaTab.Rendering.Glyphs.ClefGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.Clef.Neutral:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefNeutral;case AlphaTab.Model.Clef.C3:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefC;case AlphaTab.Model.Clef.C4:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefC;case AlphaTab.Model.Clef.F4:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefF;case AlphaTab.Model.Clef.G2:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefG;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.ClefGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.GroupedEffectGlyph=function(n){this._endPosition=AlphaTab.Rendering.BeatXPosition.PreNotes;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,0,0);this._endPosition=n},AlphaTab.Rendering.Glyphs.GroupedEffectGlyph.prototype={get_IsLinkedWithPrevious:function(){return this.PreviousGlyph!=null&&this.PreviousGlyph.Renderer.Staff.StaveGroup==this.Renderer.Staff.StaveGroup},get_IsLinkedWithNext:function(){return this.NextGlyph!=null&&this.NextGlyph.Renderer.IsFinalized&&this.NextGlyph.Renderer.Staff.StaveGroup==this.Renderer.Staff.StaveGroup},Paint:function(n,t,i){var r;if(!this.get_IsLinkedWithPrevious()){if(!this.get_IsLinkedWithNext()){this.PaintNonGrouped(n,t,i);return}for(r=this.NextGlyph;r.get_IsLinkedWithNext();)r=r.NextGlyph;var f=n-this.Renderer.X,u=r.Renderer,e=u.GetBeatX(r.Beat,this._endPosition),o=f+u.X+e;this.PaintGrouped(n,t,o,i)}},PaintNonGrouped:function(n,t,i){var r=this.Renderer.GetBeatX(this.Beat,AlphaTab.Rendering.BeatXPosition.EndBeat),u=n+r;this.PaintGrouped(n,t,u,i)}},$Inherit(AlphaTab.Rendering.Glyphs.GroupedEffectGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.CrescendoGlyph=function(n,t,i){this._crescendo=AlphaTab.Model.CrescendoType.None;AlphaTab.Rendering.Glyphs.GroupedEffectGlyph.call(this,AlphaTab.Rendering.BeatXPosition.EndBeat);this._crescendo=i;this.X=n;this.Y=t},AlphaTab.Rendering.Glyphs.CrescendoGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=17*this.get_Scale()},PaintGrouped:function(n,t,i,r){var f=n+this.X,u=this.Height*this.get_Scale();r.BeginPath();this._crescendo==AlphaTab.Model.CrescendoType.Crescendo?(r.MoveTo(i,t+this.Y),r.LineTo(f,t+this.Y+u/2),r.LineTo(i,t+this.Y+u)):(r.MoveTo(n+this.X,t+this.Y),r.LineTo(i,t+this.Y+u/2),r.LineTo(n+this.X,t+this.Y+u));r.Stroke()}},$Inherit(AlphaTab.Rendering.Glyphs.CrescendoGlyph,AlphaTab.Rendering.Glyphs.GroupedEffectGlyph),AlphaTab.Rendering.Glyphs.DeadNoteHeadGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteDead);this._isGrace=i},AlphaTab.Rendering.Glyphs.DeadNoteHeadGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.DeadNoteHeadGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.DiamondNoteHeadGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteHarmonic);this._isGrace=i},AlphaTab.Rendering.Glyphs.DiamondNoteHeadGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.DiamondNoteHeadGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.DigitGlyph=function(n,t,i,r){this._digit=0;this._scale=0;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,r,AlphaTab.Rendering.Glyphs.DigitGlyph.GetSymbol(i));this._digit=i;this._scale=r},AlphaTab.Rendering.Glyphs.DigitGlyph.prototype={DoLayout:function(){this.Y+=7*this.get_Scale();this.Width=this.GetDigitWidth(this._digit)*this.get_Scale()*this._scale},GetDigitWidth:function(n){switch(n){case 0:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return 14;case 1:return 10;default:return 0}}},AlphaTab.Rendering.Glyphs.DigitGlyph.GetSymbol=function(n){switch(n){case 0:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num0;case 1:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num1;case 2:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num2;case 3:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num3;case 4:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num4;case 5:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num5;case 6:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num6;case 7:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num7;case 8:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num8;case 9:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.Num9;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.DigitGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.DrumSticksGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteSideStick);this._isGrace=i},AlphaTab.Rendering.Glyphs.DrumSticksGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.DrumSticksGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.DynamicsGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,.6,AlphaTab.Rendering.Glyphs.DynamicsGlyph.GetSymbol(i))},AlphaTab.Rendering.Glyphs.DynamicsGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=17*this.get_Scale();this.Y+=this.Height/2}},AlphaTab.Rendering.Glyphs.DynamicsGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.DynamicValue.PPP:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicPPP;case AlphaTab.Model.DynamicValue.PP:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicPP;case AlphaTab.Model.DynamicValue.P:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicP;case AlphaTab.Model.DynamicValue.MP:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicMP;case AlphaTab.Model.DynamicValue.MF:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicMF;case AlphaTab.Model.DynamicValue.F:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicF;case AlphaTab.Model.DynamicValue.FF:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicFFF;case AlphaTab.Model.DynamicValue.FFF:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.DynamicFFF;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.DynamicsGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.FadeInGlyph=function(n,t){AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.FadeInGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=17*this.get_Scale()},Paint:function(n,t,i){var f=6*this.get_Scale(),u=Math.max(this.Width,14*this.get_Scale()),r=this.Height/2;i.BeginPath();i.MoveTo(n+this.X,t+this.Y+r);i.QuadraticCurveTo(n+this.X+u/2,t+this.Y+r,n+this.X+u,t+this.Y+r-f);i.MoveTo(n+this.X,t+this.Y+r);i.QuadraticCurveTo(n+this.X+u/2,t+this.Y+r,n+this.X+u,t+this.Y+r+f);i.Stroke()}},$Inherit(AlphaTab.Rendering.Glyphs.FadeInGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.FlatGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.AccidentalFlat);this._isGrace=i},AlphaTab.Rendering.Glyphs.FlatGlyph.prototype={DoLayout:function(){this.Width=8*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.FlatGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.HiHatGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteHiHat);this._isGrace=i},AlphaTab.Rendering.Glyphs.HiHatGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.HiHatGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup=function(){AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,0,0);this.Glyphs=[]},AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup.prototype={AddGlyph:function(n){n.X=this.Glyphs.length==0?0:this.Glyphs[this.Glyphs.length-1].X+this.Glyphs[this.Glyphs.length-1].Width;n.Renderer=this.Renderer;n.DoLayout();this.Width=n.X+n.Width;AlphaTab.Rendering.Glyphs.GlyphGroup.prototype.AddGlyph.call(this,n)}},$Inherit(AlphaTab.Rendering.Glyphs.LeftToRightLayoutingGlyphGroup,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.LineRangedGlyph=function(n){this._label=null;AlphaTab.Rendering.Glyphs.GroupedEffectGlyph.call(this,AlphaTab.Rendering.BeatXPosition.PostNotes);this._label=n},AlphaTab.Rendering.Glyphs.LineRangedGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=this.Renderer.get_Resources().EffectFont.Size},PaintNonGrouped:function(n,t,i){var r=this.Renderer.get_Resources();i.set_Font(r.EffectFont);i.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Left);i.FillText(this._label,n+this.X,t+this.Y)},PaintGrouped:function(n,t,i,r){var u;this.PaintNonGrouped(n,t,r);var e=3*this.get_Scale(),h=r.MeasureText(this._label),o=n+this.X+h+e,f=t+this.Y+8*this.get_Scale(),s=8*this.get_Scale();if(i>o){for(u=o;u<i;)r.BeginPath(),r.MoveTo(u,f|0),r.LineTo(Math.min(u+s,i),f|0),u+=s+e,r.Stroke();r.BeginPath();r.MoveTo(i,f-6*this.get_Scale()|0);r.LineTo(i,f+6*this.get_Scale()|0);r.Stroke()}}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.LineRangedGlyph.LineSpacing=3;AlphaTab.Rendering.Glyphs.LineRangedGlyph.LineTopPadding=8;AlphaTab.Rendering.Glyphs.LineRangedGlyph.LineTopOffset=6;AlphaTab.Rendering.Glyphs.LineRangedGlyph.LineSize=8}),$Inherit(AlphaTab.Rendering.Glyphs.LineRangedGlyph,AlphaTab.Rendering.Glyphs.GroupedEffectGlyph),AlphaTab.Rendering.Glyphs.MusicFontSymbol={None:-1,ClefG:57424,ClefC:57436,ClefF:57442,ClefNeutral:57449,ClefTab:57453,ClefTabSmall:57454,RestQuadrupleWhole:58593,RestDoubleWhole:58594,RestWhole:58595,RestHalf:58596,RestQuarter:58597,RestEighth:58598,RestSixteenth:58599,RestThirtySecond:58600,RestSixtyFourth:58601,RestOneHundredTwentyEighth:58602,RestTwoHundredFiftySixth:58603,GraceUp:57815,GraceDown:57816,Trill:58726,Num0:57472,Num1:57473,Num2:57474,Num3:57475,Num4:57476,Num5:57477,Num6:57478,Num7:57479,Num8:57480,Num9:57481,TimeSignatureCommon:57482,TimeSignatureCutCommon:57483,NoteQuadrupleWhole:57505,NoteDoubleWhole:57504,NoteWhole:57506,NoteHalf:57507,NoteQuarter:57508,NoteDead:57514,NoteHarmonic:57564,NoteRideCymbal:57566,NoteHiHat:57523,NoteSideStick:57513,NoteHiHatHalf:57591,NoteChineseCymbal:57593,FooterUpEighth:57920,FooterDownEighth:57921,FooterUpSixteenth:57922,FooterDownSixteenth:57923,FooterUpThirtySecond:57924,FooterDownThirtySecond:57925,FooterUpSixtyFourth:57926,FooterDownSixtyFourth:57927,FooterUpOneHundredTwentyEighth:57928,FooterDownOneHundredTwentyEighth:57929,FooterUpTwoHundredFiftySixth:57930,FooterDownTwoHundredFiftySixth:57931,DynamicPPP:58666,DynamicPP:58667,DynamicP:58656,DynamicMP:58668,DynamicMF:58669,DynamicF:58658,DynamicFF:58671,DynamicFFF:58672,Accentuation:58528,HeavyAccentuation:58540,WaveHorizontal:60068,PickStrokeDown:58896,PickStrokeUp:58898,TremoloPickingThirtySecond:57890,TremoloPickingSixteenth:57889,TremoloPickingEighth:57888,Tempo:57813,NoteEighth:57815,AccidentalFlat:57952,AccidentalNatural:57953,AccidentalSharp:57954},AlphaTab.Rendering.Glyphs.NaturalizeGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.AccidentalNatural);this._isGrace=i},AlphaTab.Rendering.Glyphs.NaturalizeGlyph.prototype={DoLayout:function(){this.Width=8*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.NaturalizeGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.NoteHeadGlyph=function(n,t,i,r){this._isGrace=!1;this._duration=AlphaTab.Model.Duration.QuadrupleWhole;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,r?.75:1,AlphaTab.Rendering.Glyphs.NoteHeadGlyph.GetSymbol(i));this._isGrace=r;this._duration=i},AlphaTab.Rendering.Glyphs.NoteHeadGlyph.prototype={DoLayout:function(){switch(this._duration){case AlphaTab.Model.Duration.QuadrupleWhole:this.Width=14*(this._isGrace?.75:1)*this.get_Scale();break;case AlphaTab.Model.Duration.DoubleWhole:this.Width=14*(this._isGrace?.75:1)*this.get_Scale();break;case AlphaTab.Model.Duration.Whole:this.Width=14*(this._isGrace?.75:1)*this.get_Scale();break;default:this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.NoteHeadGlyph.GraceScale=.75;AlphaTab.Rendering.Glyphs.NoteHeadGlyph.NoteHeadHeight=9}),AlphaTab.Rendering.Glyphs.NoteHeadGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.Duration.QuadrupleWhole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteQuadrupleWhole;case AlphaTab.Model.Duration.DoubleWhole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteDoubleWhole;case AlphaTab.Model.Duration.Whole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteWhole;case AlphaTab.Model.Duration.Half:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteHalf;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteQuarter}},$Inherit(AlphaTab.Rendering.Glyphs.NoteHeadGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.NoteNumberGlyph=function(n,t,i){this._noteString=null;this._noteStringWidth=0;this._trillNoteString=null;this._trillNoteStringWidth=0;this.IsEmpty=!1;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);i.IsTieDestination?this._noteString=i.Beat.Index==0||i.get_HasBend()?"("+i.TieOrigin.Fret+")":"":(this._noteString=i.IsDead?"x":i.Fret.toString(),i.IsGhost&&(this._noteString="("+this._noteString+")"));this._trillNoteString=i.get_IsTrill()?"("+i.get_TrillFret()+")":""},AlphaTab.Rendering.Glyphs.NoteNumberGlyph.prototype={DoLayout:function(){this.IsEmpty=(this._noteString==null||this._noteString.length==0)&&(this._trillNoteString==null||this._trillNoteString.length==0);this.IsEmpty||(this.Renderer.ScoreRenderer.Canvas.set_Font(this.Renderer.get_Resources().TablatureFont),this._noteStringWidth=this.Renderer.ScoreRenderer.Canvas.MeasureText(this._noteString),this._trillNoteStringWidth=this.Renderer.ScoreRenderer.Canvas.MeasureText(this._trillNoteString),this.Width=this._noteStringWidth+this._trillNoteStringWidth)},Paint:function(n,t,i){if(!this.IsEmpty){var u=this._noteStringWidth+this._trillNoteStringWidth,r=n+this.X+(this.Width-u)/2;i.FillText(this._noteString,r,t+this.Y);i.FillText(this._trillNoteString,r+this._noteStringWidth,t+this.Y)}}},$Inherit(AlphaTab.Rendering.Glyphs.NoteNumberGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.NumberGlyph=function(n,t,i,r){this._number=0;this._scale=0;AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,n,t);this._number=i;this._scale=r},AlphaTab.Rendering.Glyphs.NumberGlyph.prototype={DoLayout:function(){for(var t=this._number,u,f,i,r,e,n;t>0;)u=t%10,f=new AlphaTab.Rendering.Glyphs.DigitGlyph(0,0,u,this._scale),this.AddGlyph(f),t=t/10|0;for(this.Glyphs.reverse(),i=0,r=0,e=this.Glyphs.length;r<e;r++)n=this.Glyphs[r],n.X=i,n.Y=0,n.Renderer=this.Renderer,n.DoLayout(),i+=n.Width;this.Width=i}},$Inherit(AlphaTab.Rendering.Glyphs.NumberGlyph,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.PickStrokeGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,.75,AlphaTab.Rendering.Glyphs.PickStrokeGlyph.GetSymbol(i))},AlphaTab.Rendering.Glyphs.PickStrokeGlyph.prototype={DoLayout:function(){this.Width=9*this.get_Scale();this.Height=10*this.get_Scale()},Paint:function(n,t,i){AlphaTab.Rendering.Glyphs.MusicFontGlyph.prototype.Paint.call(this,n,t+this.Height,i)}},AlphaTab.Rendering.Glyphs.PickStrokeGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.PickStrokeType.Up:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.PickStrokeUp;case AlphaTab.Model.PickStrokeType.Down:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.PickStrokeDown;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.PickStrokeGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.RepeatCloseGlyph=function(n,t){AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.RepeatCloseGlyph.prototype={DoLayout:function(){this.Width=11*this.get_Scale()},Paint:function(n,t,i){var s=4*this.get_Scale(),u=t+this.Y+this.Renderer.TopPadding,e=t+this.Y+this.Renderer.Height-this.Renderer.BottomPadding,r=n+this.X,h=e-u,f=1.5*this.get_Scale(),o=(u+e)/2;i.FillCircle(r,o-f*3,f);i.FillCircle(r,o+f*3,f);r+=4*this.get_Scale();i.BeginPath();i.MoveTo(r,u);i.LineTo(r,e);i.Stroke();r+=3*this.get_Scale()+.5;i.FillRect(r,u,s,h)}},$Inherit(AlphaTab.Rendering.Glyphs.RepeatCloseGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.RepeatCountGlyph=function(n,t,i){this._count=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this._count=i},AlphaTab.Rendering.Glyphs.RepeatCountGlyph.prototype={DoLayout:function(){this.Width=0},Paint:function(n,t,i){var f=this.Renderer.get_Resources(),e=i.get_TextAlign(),r,u;i.set_Font(f.BarNumberFont);i.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Right);r="x"+this._count;u=i.MeasureText(r)/1.5;i.FillText(r,n+this.X-u,t+this.Y);i.set_TextAlign(e)}},$Inherit(AlphaTab.Rendering.Glyphs.RepeatCountGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.RepeatOpenGlyph=function(n,t,i,r){this._dotOffset=0;this._circleSize=0;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this._dotOffset=r;this._circleSize=i},AlphaTab.Rendering.Glyphs.RepeatOpenGlyph.prototype={DoLayout:function(){this.Width=13*this.get_Scale()},Paint:function(n,t,i){var s=4*this.get_Scale(),f=t+this.Y+this.Renderer.TopPadding,e=t+this.Y+this.Renderer.Height-this.Renderer.BottomPadding,r=n+this.X+.5,h=e-f,u,o;i.FillRect(r,f,s,h);r+=s*2-.5;i.BeginPath();i.MoveTo(r,f);i.LineTo(r,e);i.Stroke();r+=3*this.get_Scale();u=this._circleSize*this.get_Scale();o=(f+e)/2;i.FillCircle(r,o-u*this._dotOffset,u);i.FillCircle(r,o+u*this._dotOffset,u)}},$Inherit(AlphaTab.Rendering.Glyphs.RepeatOpenGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TieGlyph=function(n,t,i){this.StartBeat=null;this.EndBeat=null;this.YOffset=0;this._forEnd=!1;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this.StartBeat=n;this.EndBeat=t;this._forEnd=i},AlphaTab.Rendering.Glyphs.TieGlyph.prototype={DoLayout:function(){this.Width=0},Paint:function(n,t,i){if(this.EndBeat!=null){var u=this.Renderer.ScoreRenderer.Layout.GetRendererForBar(this.Renderer.Staff.get_StaveId(),this.StartBeat.Voice.Bar),r=this.Renderer.ScoreRenderer.Layout.GetRendererForBar(this.Renderer.Staff.get_StaveId(),this.EndBeat.Voice.Bar),h=0,o=0,f=0,s=0,c=!1,e=this.GetBeamDirection(this.StartBeat,u);this._forEnd?u.Staff!=r.Staff&&(h=n+r.X,o=n+r.X+this.GetEndX(r),f=t+r.Y+this.GetEndY(r,e)+this.YOffset,s=f,c=!0):(u!=r?(h=n+u.X+this.GetStartX(u),f=t+u.Y+this.GetStartY(u,e)+this.YOffset,r==null||u.Staff!=r.Staff?(o=n+u.X+u.Width,s=f):(o=n+r.X+this.GetEndX(r),s=t+r.Y+this.GetEndY(r,e)+this.YOffset)):(h=n+u.X+this.GetStartX(u),o=n+r.X+this.GetEndX(r),f=t+u.Y+this.GetStartY(u,e)+this.YOffset,s=t+r.Y+this.GetEndY(r,e)+this.YOffset),c=!0);c&&(AlphaTab.Rendering.Glyphs.TieGlyph.PaintTie(i,this.get_Scale(),h,f,o,s,e==AlphaTab.Rendering.Utils.BeamDirection.Down),i.Fill())}},GetBeamDirection:function(){return AlphaTab.Rendering.Utils.BeamDirection.Down},GetStartY:function(){return 0},GetEndY:function(){return 0},GetStartX:function(){return 0},GetEndX:function(){return 0}},AlphaTab.Rendering.Glyphs.TieGlyph.PaintTie=function(n,t,i,r,u,f,e){var h;if(i!=u||r!=f){u<i&&(h=i,i=u,u=h,h=r,r=f,f=h);var c=22*t,l=4*t,o=f-r,s=u-i,a=Math.sqrt(o*o+s*s);e?o*=-1:s*=-1;o/=a;s/=a;var v=(u+i)/2,y=(f+r)/2,p=v+c*o,w=y+c*s,b=v+(c-l)*o,k=y+(c-l)*s;n.BeginPath();n.MoveTo(i,r);n.QuadraticCurveTo(p,w,u,f);n.QuadraticCurveTo(b,k,i,r);n.ClosePath()}},$Inherit(AlphaTab.Rendering.Glyphs.TieGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ScoreLegatoGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.TieGlyph.call(this,n,t,i)},AlphaTab.Rendering.Glyphs.ScoreLegatoGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.TieGlyph.prototype.DoLayout.call(this);this.YOffset=4.5},GetBeamDirection:function(n,t){if(n.get_IsRest())return AlphaTab.Rendering.Utils.BeamDirection.Up;switch(t.GetBeatDirection(n)){case AlphaTab.Rendering.Utils.BeamDirection.Up:return AlphaTab.Rendering.Utils.BeamDirection.Down;case AlphaTab.Rendering.Utils.BeamDirection.Down:default:return AlphaTab.Rendering.Utils.BeamDirection.Up}},GetStartY:function(n,t){if(this.StartBeat.get_IsRest())return n.GetScoreY(9,0);switch(t){case AlphaTab.Rendering.Utils.BeamDirection.Up:return n.GetNoteY(this.StartBeat.get_MinNote());default:return n.GetNoteY(this.StartBeat.get_MaxNote())}},GetEndY:function(n,t){if(this.EndBeat.get_IsRest())switch(t){case AlphaTab.Rendering.Utils.BeamDirection.Up:return n.GetScoreY(9,0);default:return n.GetScoreY(0,0)}switch(t){case AlphaTab.Rendering.Utils.BeamDirection.Up:return n.GetNoteY(this.EndBeat.get_MinNote());default:return n.GetNoteY(this.EndBeat.get_MaxNote())}},GetStartX:function(n){return this.StartBeat.get_IsRest()?n.GetBeatX(this.StartBeat,AlphaTab.Rendering.BeatXPosition.PreNotes):n.GetNoteX(this.StartBeat.get_MinNote(),!0)},GetEndX:function(n){return this.EndBeat.get_IsRest()?n.GetBeatX(this.EndBeat,AlphaTab.Rendering.BeatXPosition.PreNotes):n.GetNoteX(this.EndBeat.get_MinNote(),!1)}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreLegatoGlyph,AlphaTab.Rendering.Glyphs.TieGlyph),AlphaTab.Rendering.Glyphs.ScoreRestGlyph=function(n,t,i){this._duration=AlphaTab.Model.Duration.QuadrupleWhole;this.BeamingHelper=null;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,1,AlphaTab.Rendering.Glyphs.ScoreRestGlyph.GetSymbol(i));this._duration=i},AlphaTab.Rendering.Glyphs.ScoreRestGlyph.prototype={DoLayout:function(){switch(this._duration){case AlphaTab.Model.Duration.QuadrupleWhole:case AlphaTab.Model.Duration.DoubleWhole:case AlphaTab.Model.Duration.Whole:case AlphaTab.Model.Duration.Half:case AlphaTab.Model.Duration.Quarter:case AlphaTab.Model.Duration.Eighth:case AlphaTab.Model.Duration.Sixteenth:this.Width=9*this.get_Scale();break;case AlphaTab.Model.Duration.ThirtySecond:this.Width=12*this.get_Scale();break;case AlphaTab.Model.Duration.SixtyFourth:this.Width=14*this.get_Scale();break;case AlphaTab.Model.Duration.OneHundredTwentyEighth:case AlphaTab.Model.Duration.TwoHundredFiftySixth:this.Width=20*this.get_Scale()}},UpdateBeamingHelper:function(n){this.BeamingHelper!=null&&this.BeamingHelper.RegisterBeatLineX("score",this.Beat,n+this.X+this.Width/2,n+this.X+this.Width/2)}},AlphaTab.Rendering.Glyphs.ScoreRestGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.Duration.QuadrupleWhole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestQuadrupleWhole;case AlphaTab.Model.Duration.DoubleWhole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestDoubleWhole;case AlphaTab.Model.Duration.Whole:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestWhole;case AlphaTab.Model.Duration.Half:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestHalf;case AlphaTab.Model.Duration.Quarter:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestQuarter;case AlphaTab.Model.Duration.Eighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestEighth;case AlphaTab.Model.Duration.Sixteenth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestSixteenth;case AlphaTab.Model.Duration.ThirtySecond:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestThirtySecond;case AlphaTab.Model.Duration.SixtyFourth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestSixtyFourth;case AlphaTab.Model.Duration.OneHundredTwentyEighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestOneHundredTwentyEighth;case AlphaTab.Model.Duration.TwoHundredFiftySixth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.RestTwoHundredFiftySixth;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreRestGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.RideCymbalGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteRideCymbal);this._isGrace=i},AlphaTab.Rendering.Glyphs.RideCymbalGlyph.prototype={DoLayout:function(){this.Width=9*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.RideCymbalGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.ScoreBeatContainerGlyph=function(n,t){AlphaTab.Rendering.Glyphs.BeatContainerGlyph.call(this,n,t)},AlphaTab.Rendering.ScoreBeatContainerGlyph.prototype={DoLayout:function(){var n,t;if(AlphaTab.Rendering.Glyphs.BeatContainerGlyph.prototype.DoLayout.call(this),this.Beat.IsLegatoOrigin){if(this.Beat.PreviousBeat==null||!this.Beat.PreviousBeat.IsLegatoOrigin){for(n=this.Beat.NextBeat;n.NextBeat!=null&&n.NextBeat.get_IsLegatoDestination();)n=n.NextBeat;this.Ties.push(new AlphaTab.Rendering.Glyphs.ScoreLegatoGlyph(this.Beat,n,!1))}}else if(this.Beat.get_IsLegatoDestination()&&!this.Beat.IsLegatoOrigin){for(t=this.Beat.PreviousBeat;t.PreviousBeat!=null&&t.PreviousBeat.IsLegatoOrigin;)t=t.PreviousBeat;this.Ties.push(new AlphaTab.Rendering.Glyphs.ScoreLegatoGlyph(t,this.Beat,!0))}},CreateTies:function(n){var i,r,t,u;if(n.IsTieOrigin&&(t=new AlphaTab.Rendering.Glyphs.ScoreTieGlyph(n,n.TieDestination,!1),this.Ties.push(t)),n.IsTieDestination)t=new AlphaTab.Rendering.Glyphs.ScoreTieGlyph(n.TieOrigin,n,!0),this.Ties.push(t);else if(n.IsHammerPullOrigin){if(n.HammerPullOrigin==null){for(i=n.HammerPullDestination;i.HammerPullDestination!=null;)i=i.HammerPullDestination;t=new AlphaTab.Rendering.Glyphs.ScoreTieGlyph(n,i,!1);this.Ties.push(t)}}else if(n.get_IsHammerPullDestination()){if(n.HammerPullDestination==null){for(r=n.HammerPullOrigin;r.HammerPullOrigin!=null;)r=r.HammerPullOrigin;t=new AlphaTab.Rendering.Glyphs.ScoreTieGlyph(r,n,!0);this.Ties.push(t)}}else n.SlideType==AlphaTab.Model.SlideType.Legato&&(t=new AlphaTab.Rendering.Glyphs.ScoreTieGlyph(n,n.SlideTarget,!1),this.Ties.push(t));n.SlideType!=AlphaTab.Model.SlideType.None&&(u=new AlphaTab.Rendering.Glyphs.ScoreSlideLineGlyph(n.SlideType,n,this),this.Ties.push(u))}},$Inherit(AlphaTab.Rendering.ScoreBeatContainerGlyph,AlphaTab.Rendering.Glyphs.BeatContainerGlyph),AlphaTab.Rendering.Glyphs.ScoreBeatGlyph=function(){this.NoteHeads=null;this.RestGlyph=null;AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase.call(this)},AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.prototype={UpdateBeamingHelper:function(){this.NoteHeads!=null?this.NoteHeads.UpdateBeamingHelper(this.Container.X+this.X):this.RestGlyph!=null&&this.RestGlyph.UpdateBeamingHelper(this.Container.X+this.X)},DoLayout:function(){var h=this.Renderer,l,i,r;if(!this.Container.Beat.IsEmpty)if(this.Container.Beat.get_IsRest()){var n=0,t=0,c=0;switch(this.Container.Beat.Duration){case AlphaTab.Model.Duration.QuadrupleWhole:t=6;n=5;break;case AlphaTab.Model.Duration.DoubleWhole:t=6;n=5;break;case AlphaTab.Model.Duration.Whole:t=4;n=5;break;case AlphaTab.Model.Duration.Half:t=6;n=5;break;case AlphaTab.Model.Duration.Quarter:t=6;c=-2;n=5;break;case AlphaTab.Model.Duration.Eighth:t=6;n=5;break;case AlphaTab.Model.Duration.Sixteenth:t=6;n=5;break;case AlphaTab.Model.Duration.ThirtySecond:t=6;n=3;break;case AlphaTab.Model.Duration.SixtyFourth:t=6;n=3;break;case AlphaTab.Model.Duration.OneHundredTwentyEighth:t=6;n=3;break;case AlphaTab.Model.Duration.TwoHundredFiftySixth:t=6;n=3}if(l=h.GetScoreY(t,c),this.RestGlyph=new AlphaTab.Rendering.Glyphs.ScoreRestGlyph(0,l,this.Container.Beat.Duration),this.RestGlyph.Beat=this.Container.Beat,this.RestGlyph.BeamingHelper=this.BeamingHelper,this.AddGlyph(this.RestGlyph),this.Container.Beat.Dots>0)for(this.AddGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,5*this.get_Scale())),i=0;i<this.Container.Beat.Dots;i++)r=new AlphaTab.Rendering.Glyphs.GlyphGroup(0,0),this.CreateBeatDot(n,r),this.AddGlyph(r)}else{this.NoteHeads=new AlphaTab.Rendering.Glyphs.ScoreNoteChordGlyph;this.NoteHeads.Beat=this.Container.Beat;this.NoteHeads.BeamingHelper=this.BeamingHelper;for(var u=0,o=this.Container.Beat.Notes,a=o.length,f=o[u];u<a;u++,f=o[u])this.CreateNoteGlyph(f);if(this.AddGlyph(this.NoteHeads),this.Container.Beat.Dots>0)for(this.AddGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,5*this.get_Scale())),i=0;i<this.Container.Beat.Dots;i++){r=new AlphaTab.Rendering.Glyphs.GlyphGroup(0,0);for(var e=0,s=this.Container.Beat.Notes,v=s.length,f=s[e];e<v;e++,f=s[e])this.CreateBeatDot(h.GetNoteLine(f),r);this.AddGlyph(r)}}AlphaTab.Rendering.Glyphs.BeatGlyphBase.prototype.DoLayout.call(this)},CreateBeatDot:function(n,t){var i=this.Renderer;t.AddGlyph(new AlphaTab.Rendering.Glyphs.CircleGlyph(0,i.GetScoreY(n,0),1.5*this.get_Scale()))},CreateNoteHeadGlyph:function(n){var i=this.Container.Beat.GraceType!=AlphaTab.Model.GraceType.None,t;return n.Beat.Voice.Bar.Staff.Track.IsPercussion?(t=n.get_RealValue(),t<=30||t>=67||AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.NormalKeys.hasOwnProperty(t))?new AlphaTab.Rendering.Glyphs.NoteHeadGlyph(0,0,AlphaTab.Model.Duration.Quarter,i):AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.XKeys.hasOwnProperty(t)?new AlphaTab.Rendering.Glyphs.DrumSticksGlyph(0,0,i):t==46?new AlphaTab.Rendering.Glyphs.HiHatGlyph(0,0,i):t==49||t==57?new AlphaTab.Rendering.Glyphs.DiamondNoteHeadGlyph(0,0,i):t==52?new AlphaTab.Rendering.Glyphs.ChineseCymbalGlyph(0,0,i):t==51||t==53||t==59?new AlphaTab.Rendering.Glyphs.RideCymbalGlyph(0,0,i):new AlphaTab.Rendering.Glyphs.NoteHeadGlyph(0,0,AlphaTab.Model.Duration.Quarter,i):n.IsDead?new AlphaTab.Rendering.Glyphs.DeadNoteHeadGlyph(0,0,i):n.HarmonicType==AlphaTab.Model.HarmonicType.None?new AlphaTab.Rendering.Glyphs.NoteHeadGlyph(0,0,n.Beat.Duration,i):new AlphaTab.Rendering.Glyphs.DiamondNoteHeadGlyph(0,0,i)},CreateNoteGlyph:function(n){var t=this.Renderer,i=this.CreateNoteHeadGlyph(n),r=t.GetNoteLine(n);i.Y=t.GetScoreY(r,0);this.NoteHeads.AddNoteGlyph(i,n,r);n.IsStaccato&&!this.NoteHeads.BeatEffects.hasOwnProperty("Staccato")&&(this.NoteHeads.BeatEffects.Staccato=new AlphaTab.Rendering.Glyphs.CircleGlyph(0,0,1.5));n.Accentuated!=AlphaTab.Model.AccentuationType.Normal||this.NoteHeads.BeatEffects.hasOwnProperty("Accent")||(this.NoteHeads.BeatEffects.Accent=new AlphaTab.Rendering.Glyphs.AccentuationGlyph(0,0,AlphaTab.Model.AccentuationType.Normal));n.Accentuated!=AlphaTab.Model.AccentuationType.Heavy||this.NoteHeads.BeatEffects.hasOwnProperty("HAccent")||(this.NoteHeads.BeatEffects.HAccent=new AlphaTab.Rendering.Glyphs.AccentuationGlyph(0,0,AlphaTab.Model.AccentuationType.Heavy))}},$StaticConstructor(function(){var t,i,n;for(AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.NormalKeys=null,AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.XKeys=null,AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.NormalKeys={},t=new Int32Array([32,34,35,36,38,39,40,41,43,45,47,48,50,55,56,58,60,61]),n=0;n<t.length;n++)AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.NormalKeys[t[n]]=!0;for(AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.XKeys={},i=new Int32Array([31,33,37,42,44,54,62,63,64,65,66]),n=0;n<i.length;n++)AlphaTab.Rendering.Glyphs.ScoreBeatGlyph.XKeys[i[n]]=!0}),$Inherit(AlphaTab.Rendering.Glyphs.ScoreBeatGlyph,AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase),AlphaTab.Rendering.Glyphs.ScoreBeatPreNotesGlyph=function(){AlphaTab.Rendering.Glyphs.BeatGlyphBase.call(this)},AlphaTab.Rendering.Glyphs.ScoreBeatPreNotesGlyph.prototype={DoLayout:function(){var n;if(this.Container.Beat.BrushType!=AlphaTab.Model.BrushType.None&&(this.AddGlyph(new AlphaTab.Rendering.Glyphs.ScoreBrushGlyph(this.Container.Beat)),this.AddGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,4*this.get_Scale()))),!this.Container.Beat.get_IsRest()){n=new AlphaTab.Rendering.Glyphs.AccidentalGroupGlyph;for(var t=0,i=this.Container.Beat.Notes,u=i.length,r=i[t];t<u;t++,r=i[t])this.CreateAccidentalGlyph(r,n);n.get_IsEmpty()||(this.AddGlyph(n),this.AddGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,4*(this.Container.Beat.GraceType!=AlphaTab.Model.GraceType.None?.75:1)*this.get_Scale())))}AlphaTab.Rendering.Glyphs.BeatGlyphBase.prototype.DoLayout.call(this)},CreateAccidentalGlyph:function(n,t){var i=this.Renderer,f=i.AccidentalHelper.ApplyAccidental(n),r=i.GetNoteLine(n),u=this.Container.Beat.GraceType!=AlphaTab.Model.GraceType.None;switch(f){case AlphaTab.Model.AccidentalType.Sharp:t.AddGlyph(new AlphaTab.Rendering.Glyphs.SharpGlyph(0,i.GetScoreY(r,0),u));break;case AlphaTab.Model.AccidentalType.Flat:t.AddGlyph(new AlphaTab.Rendering.Glyphs.FlatGlyph(0,i.GetScoreY(r,0),u));break;case AlphaTab.Model.AccidentalType.Natural:t.AddGlyph(new AlphaTab.Rendering.Glyphs.NaturalizeGlyph(0,i.GetScoreY(r,0),u))}}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreBeatPreNotesGlyph,AlphaTab.Rendering.Glyphs.BeatGlyphBase),AlphaTab.Rendering.Glyphs.ScoreBrushGlyph=function(n){this._beat=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._beat=n},AlphaTab.Rendering.Glyphs.ScoreBrushGlyph.prototype={DoLayout:function(){this.Width=10*this.get_Scale()},Paint:function(n,t,i){var f=this.Renderer,s=f.get_LineOffset(),e=t+this.Y+(f.GetNoteY(this._beat.get_MaxNote())-s/2),o=t+this.Y+f.GetNoteY(this._beat.get_MinNote())+s,u=n+this.X+this.Width/2,r=8*this.get_Scale();this._beat.BrushType!=AlphaTab.Model.BrushType.None&&(this._beat.BrushType==AlphaTab.Model.BrushType.ArpeggioUp?(i.BeginPath(),i.MoveTo(u,o),i.LineTo(u+r/2,o-r),i.LineTo(u-r/2,o-r),i.ClosePath(),i.Fill()):this._beat.BrushType==AlphaTab.Model.BrushType.ArpeggioDown&&(i.BeginPath(),i.MoveTo(u,e),i.LineTo(u+r/2,e+r),i.LineTo(u-r/2,e+r),i.ClosePath(),i.Fill()))}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreBrushGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ScoreNoteGlyphInfo=function(n,t){this.Glyph=null;this.Line=0;this.Glyph=n;this.Line=t},AlphaTab.Rendering.Glyphs.ScoreNoteChordGlyph=function(){this._infos=null;this._noteLookup=null;this._tremoloPicking=null;this._noteHeadPadding=0;this.MinNote=null;this.MaxNote=null;this.SpacingChanged=null;this.UpLineX=0;this.DownLineX=0;this.BeatEffects=null;this.Beat=null;this.BeamingHelper=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._infos=[];this.BeatEffects={};this._noteLookup={}},AlphaTab.Rendering.Glyphs.ScoreNoteChordGlyph.prototype={get_Direction:function(){return this.BeamingHelper.Direction},GetNoteX:function(n,t){if(this._noteLookup.hasOwnProperty(n.String)){var i=this._noteLookup[n.String],r=this.X+i.X;return t&&(r+=i.Width),r}return 0},GetNoteY:function(n){return this._noteLookup.hasOwnProperty(n.String)?this.Y+this._noteLookup[n.String].Y:0},AddNoteGlyph:function(n,t,i){var r=new AlphaTab.Rendering.Glyphs.ScoreNoteGlyphInfo(n,i);this._infos.push(r);this._noteLookup[t.String]=n;(this.MinNote==null||this.MinNote.Line>r.Line)&&(this.MinNote=r);(this.MaxNote==null||this.MaxNote.Line<r.Line)&&(this.MaxNote=r)},UpdateBeamingHelper:function(n){this.BeamingHelper!=null&&this.BeamingHelper.RegisterBeatLineX("score",this.Beat,n+this.X+this.UpLineX,n+this.X+this.DownLineX)},get_HasTopOverflow:function(){return this.MinNote!=null&&this.MinNote.Line<0},get_HasBottomOverflow:function(){return this.MaxNote!=null&&this.MaxNote.Line>8},DoLayout:function(){var r,l,i,o,a,s;this._infos.sort($CreateAnonymousDelegate(this,function(n,t){return n.Line-t.Line}));var n=0,e=!1,h=0,c=!1,t=this.get_Direction(),u=0;for(r=0,l=this._infos.length;r<l;r++)i=this._infos[r].Glyph,i.Renderer=this.Renderer,i.DoLayout(),o=!1,r==0?n=i.Width+0:Math.abs(h-this._infos[r].Line)<=1?e?e=!1:(o=!0,i.X=n-this.get_Scale(),c=!0,e=!0):e=!1,i.X=t==AlphaTab.Rendering.Utils.BeamDirection.Down?o?0:n:o?n:0,h=this._infos[r].Line,u=Math.max(u,i.X+i.Width);c?(this._noteHeadPadding=0,this.UpLineX=n,this.DownLineX=n):(this._noteHeadPadding=t==AlphaTab.Rendering.Utils.BeamDirection.Down?-n:0,u+=this._noteHeadPadding,this.UpLineX=u,this.DownLineX=0);for(a in this.BeatEffects)s=this.BeatEffects[a],s.Renderer=this.Renderer,s.DoLayout();if(this.Beat.get_IsTremolo()){var f,v=t==AlphaTab.Rendering.Utils.BeamDirection.Up?this.MinNote:this.MaxNote,y=t==AlphaTab.Rendering.Utils.BeamDirection.Up?n:0,p=this.Beat.TremoloSpeed;switch(p){case AlphaTab.Model.Duration.ThirtySecond:f=t==AlphaTab.Rendering.Utils.BeamDirection.Up?-15:15;break;case AlphaTab.Model.Duration.Sixteenth:f=t==AlphaTab.Rendering.Utils.BeamDirection.Up?-12:15;break;case AlphaTab.Model.Duration.Eighth:f=t==AlphaTab.Rendering.Utils.BeamDirection.Up?-10:10;break;default:f=t==AlphaTab.Rendering.Utils.BeamDirection.Up?-10:15}this._tremoloPicking=new AlphaTab.Rendering.Glyphs.TremoloPickingGlyph(y,v.Glyph.Y+f*this.get_Scale(),this.Beat.TremoloSpeed);this._tremoloPicking.Renderer=this.Renderer;this._tremoloPicking.DoLayout()}this.Width=u+0},Paint:function(n,t,i){var v,u,e,l,o,r,s,h,y;n+=this.X;t+=this.Y;var f=this.Renderer,a=this.BeamingHelper.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?f.GetScoreY(this.MaxNote.Line,13.5):f.GetScoreY(this.MinNote.Line,-9),p=this.BeamingHelper.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?7*this.get_Scale():-7*this.get_Scale();for(v in this.BeatEffects)u=this.BeatEffects[v],u.Y=a,u.X=this.Width/2,u.Paint(n,t,i),a+=p;if(e=3*this.get_Scale(),l=this.Width+e*2,this.get_HasTopOverflow()){for(o=i.get_Color(),i.set_Color(this.Renderer.ScoreRenderer.RenderingResources.StaveLineColor),r=-1;r>=this.MinNote.Line;)s=t+f.GetScoreY(r,0),i.FillRect(n-e,s,l,this.get_Scale()),r-=2;i.set_Color(o)}if(this.get_HasBottomOverflow()){for(o=i.get_Color(),i.set_Color(this.Renderer.ScoreRenderer.RenderingResources.StaveLineColor),r=12;r<=this.MaxNote.Line;)s=t+f.GetScoreY(r,0),i.FillRect(n-e,s,l,this.get_Scale()),r+=2;i.set_Color(o)}this._tremoloPicking!=null&&this._tremoloPicking.Paint(n,t,i);h=this._infos;y=n+this._noteHeadPadding;for(var c=0,w=h.length,u=h[c];c<w;c++,u=h[c])u.Glyph.Renderer=this.Renderer,u.Glyph.Paint(y,t,i)}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreNoteChordGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ScoreSlideLineGlyph=function(n,t,i){this._startNote=null;this._type=AlphaTab.Model.SlideType.None;this._parent=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._type=n;this._startNote=t;this._parent=i},AlphaTab.Rendering.Glyphs.ScoreSlideLineGlyph.prototype={DoLayout:function(){this.Width=0},Paint:function(n,t,i){var r=this.Renderer,h,e,f,o,u,s;n+=r.X;t+=r.Y;h=12*this.get_Scale();e=1*this.get_Scale();switch(this._type){case AlphaTab.Model.SlideType.Shift:case AlphaTab.Model.SlideType.Legato:f=n+r.GetNoteX(this._startNote,!0)+e;o=t+r.GetNoteY(this._startNote)+4.5;this._startNote.SlideTarget!=null?(u=n+r.GetNoteX(this._startNote.SlideTarget,!1)-e,s=t+r.GetNoteY(this._startNote.SlideTarget)+4.5):(u=n+this._parent.X,s=o);break;case AlphaTab.Model.SlideType.IntoFromBelow:u=n+r.GetNoteX(this._startNote,!1)-e;s=t+r.GetNoteY(this._startNote)+4.5;f=u-h;o=t+r.GetNoteY(this._startNote)+9;break;case AlphaTab.Model.SlideType.IntoFromAbove:u=n+r.GetNoteX(this._startNote,!1)-e;s=t+r.GetNoteY(this._startNote)+4.5;f=u-h;o=t+r.GetNoteY(this._startNote);break;case AlphaTab.Model.SlideType.OutUp:f=n+r.GetNoteX(this._startNote,!0)+e;o=t+r.GetNoteY(this._startNote)+4.5;u=f+h;s=t+r.GetNoteY(this._startNote);break;case AlphaTab.Model.SlideType.OutDown:f=n+r.GetNoteX(this._startNote,!0)+e;o=t+r.GetNoteY(this._startNote)+4.5;u=f+h;s=t+r.GetNoteY(this._startNote)+9;break;default:return}i.BeginPath();i.MoveTo(f,o);i.LineTo(u,s);i.Stroke()}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreSlideLineGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.ScoreTieGlyph=function(n,t,i){this._startNote=null;this._endNote=null;AlphaTab.Rendering.Glyphs.TieGlyph.call(this,n==null?null:n.Beat,t==null?null:t.Beat,i);this._startNote=n;this._endNote=t},AlphaTab.Rendering.Glyphs.ScoreTieGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.TieGlyph.prototype.DoLayout.call(this);this.YOffset=4.5},GetBeamDirection:function(n,t){switch(t.GetBeatDirection(n)){case AlphaTab.Rendering.Utils.BeamDirection.Up:return AlphaTab.Rendering.Utils.BeamDirection.Down;case AlphaTab.Rendering.Utils.BeamDirection.Down:default:return AlphaTab.Rendering.Utils.BeamDirection.Up}},GetStartY:function(n){return n.GetNoteY(this._startNote)},GetEndY:function(n){return n.GetNoteY(this._endNote)},GetStartX:function(n){return n.GetNoteX(this._startNote,!0)},GetEndX:function(n){return n.GetNoteX(this._endNote,!1)}},$Inherit(AlphaTab.Rendering.Glyphs.ScoreTieGlyph,AlphaTab.Rendering.Glyphs.TieGlyph),AlphaTab.Rendering.Glyphs.SharpGlyph=function(n,t,i){this._isGrace=!1;AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,i?.75:1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.AccidentalSharp);this._isGrace=i},AlphaTab.Rendering.Glyphs.SharpGlyph.prototype={DoLayout:function(){this.Width=8*(this._isGrace?.75:1)*this.get_Scale()}},$Inherit(AlphaTab.Rendering.Glyphs.SharpGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.SpacingGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this.Width=i},$Inherit(AlphaTab.Rendering.Glyphs.SpacingGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TabBeatContainerGlyph=function(n,t){this._bendGlyphs=null;AlphaTab.Rendering.Glyphs.BeatContainerGlyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.TabBeatContainerGlyph.prototype={DoLayout:function(){var n,t,r,u,i;for(AlphaTab.Rendering.Glyphs.BeatContainerGlyph.prototype.DoLayout.call(this),this._bendGlyphs=[],n=0;n<this.Beat.Notes.length;n++)t=this.Beat.Notes[n],t.get_HasBend()&&(r=6,u=t.MaxBendPoint.Value*r,this.Renderer.RegisterOverflowTop(u),i=new AlphaTab.Rendering.Glyphs.BendGlyph(t,r),i.X=this.OnNotes.X+this.OnNotes.Width,i.Renderer=this.Renderer,this._bendGlyphs.push(i))},ScaleToWidth:function(n){var t,i;for(AlphaTab.Rendering.Glyphs.BeatContainerGlyph.prototype.ScaleToWidth.call(this,n),t=0;t<this._bendGlyphs.length;t++)i=this._bendGlyphs[t],i.Width=n-i.X},CreateTies:function(n){var i,r,t,u;if(n.IsHammerPullOrigin){if(n.HammerPullOrigin==null){for(i=n.HammerPullDestination;i.HammerPullDestination!=null;)i=i.HammerPullDestination;t=new AlphaTab.Rendering.Glyphs.TabTieGlyph(n,i,!1,!1);this.Ties.push(t)}}else if(n.get_IsHammerPullDestination()){if(n.HammerPullDestination==null){for(r=n.HammerPullOrigin;r.HammerPullOrigin!=null;)r=r.HammerPullOrigin;t=new AlphaTab.Rendering.Glyphs.TabTieGlyph(r,n,!1,!0);this.Ties.push(t)}}else n.SlideType==AlphaTab.Model.SlideType.Legato&&(t=new AlphaTab.Rendering.Glyphs.TabTieGlyph(n,n.SlideTarget,!0,!1),this.Ties.push(t));n.SlideType!=AlphaTab.Model.SlideType.None&&(u=new AlphaTab.Rendering.Glyphs.TabSlideLineGlyph(n.SlideType,n,this),this.Ties.push(u))},Paint:function(n,t,i){var r,u;for(AlphaTab.Rendering.Glyphs.BeatContainerGlyph.prototype.Paint.call(this,n,t,i),r=0;r<this._bendGlyphs.length;r++)u=this._bendGlyphs[r],u.Paint(n+this.X,t+this.Y,i)}},$Inherit(AlphaTab.Rendering.Glyphs.TabBeatContainerGlyph,AlphaTab.Rendering.Glyphs.BeatContainerGlyph),AlphaTab.Rendering.Glyphs.TabBeatGlyph=function(){this.NoteNumbers=null;this.RestGlyph=null;AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase.call(this)},AlphaTab.Rendering.Glyphs.TabBeatGlyph.prototype={DoLayout:function(){var o,s,n,h,r,u,c,t;if(this.Container.Beat.get_IsRest())this.RestGlyph=new AlphaTab.Rendering.Glyphs.TabRestGlyph,this.RestGlyph.Beat=this.Container.Beat,this.RestGlyph.BeamingHelper=this.BeamingHelper,this.AddGlyph(this.RestGlyph);else{this.NoteNumbers=new AlphaTab.Rendering.Glyphs.TabNoteChordGlyph(0,0,this.Container.Beat.GraceType!=AlphaTab.Model.GraceType.None);this.NoteNumbers.Beat=this.Container.Beat;this.NoteNumbers.BeamingHelper=this.BeamingHelper;for(var i=0,f=this.Container.Beat.Notes,l=f.length,e=f[i];i<l;i++,e=f[i])this.CreateNoteGlyph(e);if(this.AddGlyph(this.NoteNumbers),this.Container.Beat.get_HasWhammyBar()&&!this.NoteNumbers.BeatEffects.hasOwnProperty("Whammy")&&(this.NoteNumbers.BeatEffects.Whammy=new AlphaTab.Rendering.Glyphs.WhammyBarGlyph(this.Container.Beat,this.Container),o=60*this.get_Scale()/24,s=this.Container.Beat.MaxWhammyPoint.Value*o,this.Renderer.RegisterOverflowTop(s)),this.Container.Beat.get_IsTremolo()&&!this.NoteNumbers.BeatEffects.hasOwnProperty("Tremolo")){n=0;h=this.Container.Beat.TremoloSpeed;switch(h){case AlphaTab.Model.Duration.ThirtySecond:n=10;break;case AlphaTab.Model.Duration.Sixteenth:n=5;break;case AlphaTab.Model.Duration.Eighth:n=0}this.NoteNumbers.BeatEffects.Tremolo=new AlphaTab.Rendering.Glyphs.TremoloPickingGlyph(5*this.get_Scale(),n*this.get_Scale(),this.Container.Beat.TremoloSpeed)}}if(this.Glyphs!=null){for(r=0,u=0,c=this.Glyphs.length;u<c;u++)t=this.Glyphs[u],t.X=r,t.Renderer=this.Renderer,t.DoLayout(),r+=t.Width;this.Width=r}},UpdateBeamingHelper:function(){this.Container.Beat.get_IsRest()?this.RestGlyph.UpdateBeamingHelper(this.Container.X+this.X):this.NoteNumbers.UpdateBeamingHelper(this.Container.X+this.X)},CreateNoteGlyph:function(n){var i=this.Renderer,t=new AlphaTab.Rendering.Glyphs.NoteNumberGlyph(0,0,n),r=n.Beat.Voice.Bar.Staff.Track.Tuning.length-n.String+1;t.Y=i.GetTabY(r,-2);t.Renderer=this.Renderer;t.DoLayout();this.NoteNumbers.AddNoteGlyph(t,n)}},$Inherit(AlphaTab.Rendering.Glyphs.TabBeatGlyph,AlphaTab.Rendering.Glyphs.BeatOnNoteGlyphBase),AlphaTab.Rendering.Glyphs.TabBeatPreNotesGlyph=function(){AlphaTab.Rendering.Glyphs.BeatGlyphBase.call(this)},AlphaTab.Rendering.Glyphs.TabBeatPreNotesGlyph.prototype={DoLayout:function(){this.Container.Beat.BrushType!=AlphaTab.Model.BrushType.None&&(this.AddGlyph(new AlphaTab.Rendering.Glyphs.TabBrushGlyph(this.Container.Beat)),this.AddGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,4*this.get_Scale())));AlphaTab.Rendering.Glyphs.BeatGlyphBase.prototype.DoLayout.call(this)}},$Inherit(AlphaTab.Rendering.Glyphs.TabBeatPreNotesGlyph,AlphaTab.Rendering.Glyphs.BeatGlyphBase),AlphaTab.Rendering.Glyphs.TabBrushGlyph=function(n){this._beat=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._beat=n},AlphaTab.Rendering.Glyphs.TabBrushGlyph.prototype={DoLayout:function(){this.Width=10*this.get_Scale()},Paint:function(n,t,i){var o=this.Renderer,s=this.Renderer.get_Resources(),f=t+this.X+(o.GetNoteY(this._beat.get_MaxNote())-s.TablatureFont.Size/2),e=t+this.Y+o.GetNoteY(this._beat.get_MinNote())+s.TablatureFont.Size/2,r=n+this.X+this.Width/2|0,u=8*this.get_Scale();this._beat.BrushType!=AlphaTab.Model.BrushType.None&&((this._beat.BrushType==AlphaTab.Model.BrushType.BrushUp||this._beat.BrushType==AlphaTab.Model.BrushType.BrushDown)&&(i.BeginPath(),i.MoveTo(r,f),i.LineTo(r,e),i.Stroke()),this._beat.BrushType==AlphaTab.Model.BrushType.BrushUp||this._beat.BrushType==AlphaTab.Model.BrushType.ArpeggioUp?(i.BeginPath(),i.MoveTo(r,e),i.LineTo(r+u/2,e-u),i.LineTo(r-u/2,e-u),i.ClosePath(),i.Fill()):(i.BeginPath(),i.MoveTo(r,f),i.LineTo(r+u/2,f+u),i.LineTo(r-u/2,f+u),i.ClosePath(),i.Fill()))}},$Inherit(AlphaTab.Rendering.Glyphs.TabBrushGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TabClefGlyph=function(n,t){AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.TabClefGlyph.prototype={DoLayout:function(){this.Width=28*this.get_Scale()},Paint:function(n,t,i){var r=this.Renderer.Bar.Staff.Track.Tuning.length,u=r*this.get_Scale()*.5,f=r<=4?AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefTabSmall:AlphaTab.Rendering.Glyphs.MusicFontSymbol.ClefTab,e=r<=4?r/4.5:r/6.5;i.FillMusicFontSymbol(n+this.X+5*this.get_Scale(),t+this.Y-u,e*this.get_Scale(),f)}},$Inherit(AlphaTab.Rendering.Glyphs.TabClefGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TabNoteChordGlyph=function(n,t,i){this._notes=null;this._isGrace=!1;this.Beat=null;this.BeamingHelper=null;this.MinStringNote=null;this.BeatEffects=null;this.NotesPerString=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,n,t);this._isGrace=i;this._notes=[];this.BeatEffects={};this.NotesPerString={}},AlphaTab.Rendering.Glyphs.TabNoteChordGlyph.prototype={GetNoteX:function(n,t){if(this.NotesPerString.hasOwnProperty(n.String)){var i=this.NotesPerString[n.String],r=this.X+i.X;return t&&(r+=i.Width),r}return 0},GetNoteY:function(n){return this.NotesPerString.hasOwnProperty(n.String)?this.Y+this.NotesPerString[n.String].Y:0},DoLayout:function(){for(var u,n,t=0,i=0,f=this._notes.length;i<f;i++)n=this._notes[i],n.Renderer=this.Renderer,n.DoLayout(),n.Width>t&&(t=n.Width);var e=this.Renderer.get_Resources().TablatureFont.Size,r=this.GetNoteY(this.MinStringNote)+e/2,o=7*this.get_Scale();for(u in this.BeatEffects)n=this.BeatEffects[u],n.Y+=r,n.X+=this.Width/2,n.Renderer=this.Renderer,r+=o,n.DoLayout();this.Width=t},AddNoteGlyph:function(n,t){this._notes.push(n);this.NotesPerString[t.String]=n;(this.MinStringNote==null||t.String<this.MinStringNote.String)&&(this.MinStringNote=t)},Paint:function(n,t,i){var e,o,u,s,h,r;n+=this.X;t+=this.Y;e=this.Renderer.get_Resources();o=i.get_TextBaseline();i.set_TextBaseline(AlphaTab.Platform.Model.TextBaseline.Middle);i.set_Font(this._isGrace?e.GraceFont:e.TablatureFont);u=this._notes;s=this.Width;for(var f=0,c=u.length,r=u[f];f<c;f++,r=u[f])r.Renderer=this.Renderer,r.Width=s,r.Paint(n,t,i);i.set_TextBaseline(o);for(h in this.BeatEffects)r=this.BeatEffects[h],r.Paint(n,t,i)},UpdateBeamingHelper:function(n){this.BeamingHelper!=null&&this.BeamingHelper.IsPositionFrom("tab",this.Beat)&&this.BeamingHelper.RegisterBeatLineX("tab",this.Beat,n+this.X+this.Width,n+this.X)}},$Inherit(AlphaTab.Rendering.Glyphs.TabNoteChordGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TabRestGlyph=function(){this.Beat=null;this.BeamingHelper=null;AlphaTab.Rendering.Glyphs.SpacingGlyph.call(this,0,0,0)},AlphaTab.Rendering.Glyphs.TabRestGlyph.prototype={DoLayout:function(){this.Width=10*this.get_Scale()},UpdateBeamingHelper:function(n){this.BeamingHelper!=null&&this.BeamingHelper.IsPositionFrom("tab",this.Beat)&&this.BeamingHelper.RegisterBeatLineX("tab",this.Beat,n+this.X+this.Width,n+this.X)}},$Inherit(AlphaTab.Rendering.Glyphs.TabRestGlyph,AlphaTab.Rendering.Glyphs.SpacingGlyph),AlphaTab.Rendering.Glyphs.TabSlideLineGlyph=function(n,t,i){this._startNote=null;this._type=AlphaTab.Model.SlideType.None;this._parent=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._type=n;this._startNote=t;this._parent=i},AlphaTab.Rendering.Glyphs.TabSlideLineGlyph.prototype={DoLayout:function(){this.Width=0},Paint:function(n,t,i){var r=this.Renderer,h,u,e,o,f,s,c,l;n+=r.X;t+=r.Y;h=12*this.get_Scale();u=3*this.get_Scale();switch(this._type){case AlphaTab.Model.SlideType.Shift:case AlphaTab.Model.SlideType.Legato:this._startNote.SlideTarget==null?(c=0,l=0):this._startNote.SlideTarget.Fret>this._startNote.Fret?(c=u,l=u*-1):(c=u*-1,l=u);e=n+r.GetNoteX(this._startNote,!0);o=t+r.GetNoteY(this._startNote)+c;this._startNote.SlideTarget!=null?(f=n+r.GetNoteX(this._startNote.SlideTarget,!1),s=t+r.GetNoteY(this._startNote.SlideTarget)+l):(f=n+this._parent.X,s=o);break;case AlphaTab.Model.SlideType.IntoFromBelow:f=n+r.GetNoteX(this._startNote,!1);s=t+r.GetNoteY(this._startNote);e=f-h;o=t+r.GetNoteY(this._startNote)+u;break;case AlphaTab.Model.SlideType.IntoFromAbove:f=n+r.GetNoteX(this._startNote,!1);s=t+r.GetNoteY(this._startNote);e=f-h;o=t+r.GetNoteY(this._startNote)-u;break;case AlphaTab.Model.SlideType.OutUp:e=n+r.GetNoteX(this._startNote,!0);o=t+r.GetNoteY(this._startNote);f=e+h;s=t+r.GetNoteY(this._startNote)-u;break;case AlphaTab.Model.SlideType.OutDown:e=n+r.GetNoteX(this._startNote,!0);o=t+r.GetNoteY(this._startNote);f=e+h;s=t+r.GetNoteY(this._startNote)+u;break;default:return}i.BeginPath();i.MoveTo(e,o);i.LineTo(f,s);i.Stroke()}},$Inherit(AlphaTab.Rendering.Glyphs.TabSlideLineGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.Glyphs.TabTieGlyph=function(n,t,i,r){this._startNote=null;this._endNote=null;this._forSlide=!1;AlphaTab.Rendering.Glyphs.TieGlyph.call(this,n.Beat,t.Beat,r);this._startNote=n;this._endNote=t;this._forSlide=i},AlphaTab.Rendering.Glyphs.TabTieGlyph.prototype={get_Offset:function(){return this._forSlide?5*this.get_Scale():0},GetBeamDirection:function(){return this._startNote.String>3?AlphaTab.Rendering.Utils.BeamDirection.Down:AlphaTab.Rendering.Utils.BeamDirection.Up},GetStartY:function(n){return n.GetNoteY(this._startNote)-this.get_Offset()},GetEndY:function(n){return n.GetNoteY(this._endNote)-this.get_Offset()},GetStartX:function(n){return n.GetNoteX(this._startNote,!0)},GetEndX:function(n){return n.GetNoteX(this._endNote,!1)}},$Inherit(AlphaTab.Rendering.Glyphs.TabTieGlyph,AlphaTab.Rendering.Glyphs.TieGlyph),AlphaTab.Rendering.Glyphs.TempoGlyph=function(n,t,i){this._tempo=0;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t);this._tempo=i},AlphaTab.Rendering.Glyphs.TempoGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=25*this.get_Scale()},Paint:function(n,t,i){var r=this.Renderer.get_Resources();i.set_Font(r.MarkerFont);i.FillMusicFontSymbol(n+this.X,t+this.Y+this.Height*.8,.75,AlphaTab.Rendering.Glyphs.MusicFontSymbol.Tempo);i.FillText("= "+this._tempo,n+this.X+this.Height/2,t+this.Y+i.get_Font().Size/2)}},$Inherit(AlphaTab.Rendering.Glyphs.TempoGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.TextGlyph=function(n,t,i,r,u){this._text=null;this.Font=null;this.TextAlign=AlphaTab.Platform.Model.TextAlign.Left;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t);this._text=i;this.Font=r;this.TextAlign=u},AlphaTab.Rendering.Glyphs.TextGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=this.Font.Size},Paint:function(n,t,i){i.set_Font(this.Font);var r=i.get_TextAlign();i.set_TextAlign(this.TextAlign);i.FillText(this._text,n+this.X,t+this.Y);i.set_TextAlign(r)}},$Inherit(AlphaTab.Rendering.Glyphs.TextGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.TimeSignatureGlyph=function(n,t,i,r,u){this._numerator=0;this._denominator=0;this._isCommon=!1;AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,n,t);this._numerator=i;this._denominator=r;this._isCommon=u},AlphaTab.Rendering.Glyphs.TimeSignatureGlyph.prototype={DoLayout:function(){var r=this.Renderer,n,u,f,t,e,i;if(this._isCommon&&this._numerator==2&&this._denominator==2)n=new AlphaTab.Rendering.Glyphs.MusicFontGlyph(0,r.GetScoreY(4,0),1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.TimeSignatureCutCommon),n.Width=14*this.get_Scale(),this.AddGlyph(n),AlphaTab.Rendering.Glyphs.GlyphGroup.prototype.DoLayout.call(this);else if(this._isCommon&&this._numerator==4&&this._denominator==4)n=new AlphaTab.Rendering.Glyphs.MusicFontGlyph(0,r.GetScoreY(4,0),1,AlphaTab.Rendering.Glyphs.MusicFontSymbol.TimeSignatureCommon),n.Width=14*this.get_Scale(),this.AddGlyph(n),AlphaTab.Rendering.Glyphs.GlyphGroup.prototype.DoLayout.call(this);else for(u=new AlphaTab.Rendering.Glyphs.NumberGlyph(0,2*this.get_Scale(),this._numerator,1),f=new AlphaTab.Rendering.Glyphs.NumberGlyph(0,20*this.get_Scale(),this._denominator,1),this.AddGlyph(u),this.AddGlyph(f),AlphaTab.Rendering.Glyphs.GlyphGroup.prototype.DoLayout.call(this),t=0,e=this.Glyphs.length;t<e;t++)i=this.Glyphs[t],i.X=(this.Width-i.Width)/2}},$Inherit(AlphaTab.Rendering.Glyphs.TimeSignatureGlyph,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.TremoloPickingGlyph=function(n,t,i){AlphaTab.Rendering.Glyphs.MusicFontGlyph.call(this,n,t,1,AlphaTab.Rendering.Glyphs.TremoloPickingGlyph.GetSymbol(i))},AlphaTab.Rendering.Glyphs.TremoloPickingGlyph.prototype={DoLayout:function(){this.Width=12*this.get_Scale()}},AlphaTab.Rendering.Glyphs.TremoloPickingGlyph.GetSymbol=function(n){switch(n){case AlphaTab.Model.Duration.ThirtySecond:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.TremoloPickingThirtySecond;case AlphaTab.Model.Duration.Sixteenth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.TremoloPickingSixteenth;case AlphaTab.Model.Duration.Eighth:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.TremoloPickingEighth;default:return AlphaTab.Rendering.Glyphs.MusicFontSymbol.None}},$Inherit(AlphaTab.Rendering.Glyphs.TremoloPickingGlyph,AlphaTab.Rendering.Glyphs.MusicFontGlyph),AlphaTab.Rendering.Glyphs.TrillGlyph=function(n,t){AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,n,t)},AlphaTab.Rendering.Glyphs.TrillGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=20*this.get_Scale()},Paint:function(n,t,i){var h=this.Renderer.get_Resources(),f,u;i.set_Font(h.MarkerFont);f=i.MeasureText("tr");i.FillText("tr",n+this.X,t+this.Y+i.get_Font().Size/2);var r=f+3*this.get_Scale(),c=this.Width-r,e=1.2,o=11*this.get_Scale()*e,l=Math.max(1,(c-r)/o),s=r,a=t+this.Y+this.Height;for(u=0;u<l;u++)i.FillMusicFontSymbol(n+this.X+s,a,e,AlphaTab.Rendering.Glyphs.MusicFontSymbol.WaveHorizontal),s+=o}},$Inherit(AlphaTab.Rendering.Glyphs.TrillGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.TripletFeelGlyph=function(n){this._tripletFeel=AlphaTab.Model.TripletFeel.NoTripletFeel;AlphaTab.Rendering.Glyphs.EffectGlyph.call(this,0,0);this._tripletFeel=n},AlphaTab.Rendering.Glyphs.TripletFeelGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=25*this.get_Scale()},Paint:function(n,t,i){var r,f,u;n+=this.X;t+=this.Y;r=t+this.Height*.75;i.set_Font(this.Renderer.get_Resources().EffectFont);i.FillText("(",n,t+this.Height*.3);f=n+10*this.get_Scale();u=n+40*this.get_Scale();switch(this._tripletFeel){case AlphaTab.Model.TripletFeel.NoTripletFeel:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);break;case AlphaTab.Model.TripletFeel.Triplet8th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);i.FillMusicFontSymbol(u,r,.4,AlphaTab.Rendering.Glyphs.MusicFontSymbol.Tempo);i.FillMusicFontSymbol(u+12*this.get_Scale(),r,.4,AlphaTab.Rendering.Glyphs.MusicFontSymbol.NoteEighth);this.RenderTriplet(u,t,i);break;case AlphaTab.Model.TripletFeel.Triplet16th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialRight]);this.RenderTriplet(u,t,i);break;case AlphaTab.Model.TripletFeel.Dotted8th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialRight]);i.FillCircle(u+9*this.get_Scale(),r,this.get_Scale());break;case AlphaTab.Model.TripletFeel.Dotted16th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialRight]);i.FillCircle(u+9*this.get_Scale(),r,this.get_Scale());break;case AlphaTab.Model.TripletFeel.Scottish8th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialLeft]);i.FillCircle(u+12*this.get_Scale()+8*this.get_Scale(),r,this.get_Scale());break;case AlphaTab.Model.TripletFeel.Scottish16th:this.RenderBarNote(f,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full]);this.RenderBarNote(u,r,.4,i,[AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full,AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialLeft]);i.FillCircle(u+12*this.get_Scale()+8*this.get_Scale(),r,this.get_Scale())}i.FillText("=",n+30*this.get_Scale(),t+5*this.get_Scale());i.FillText(")",n+65*this.get_Scale(),t+this.Height*.3)},RenderBarNote:function(n,t,i,r,u){var e,f;for(r.FillMusicFontSymbol(n,t,i,AlphaTab.Rendering.Glyphs.MusicFontSymbol.Tempo),e=6*this.get_Scale(),f=0;f<u.length;f++)switch(u[f]){case AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.Full:r.FillRect(n+4*this.get_Scale(),t-12*this.get_Scale()+3*this.get_Scale()*f,12*this.get_Scale(),2*this.get_Scale());break;case AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialLeft:r.FillRect(n+4*this.get_Scale(),t-12*this.get_Scale()+3*this.get_Scale()*f,e,2*this.get_Scale());break;case AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType.PartialRight:r.FillRect(n+4*this.get_Scale()+e,t-12*this.get_Scale()+3*this.get_Scale()*f,e,2*this.get_Scale())}r.FillMusicFontSymbol(n+12*this.get_Scale(),t,i,AlphaTab.Rendering.Glyphs.MusicFontSymbol.Tempo)},RenderTriplet:function(n,t,i){var r,u;t+=2*this.get_Scale();r=this.Renderer.get_Resources().EffectFont;i.set_Font(new AlphaTab.Platform.Model.Font(r.Family,r.Size*.8,r.Style));u=n+12*this.get_Scale()+3*this.get_Scale();i.BeginPath();i.MoveTo(n,t+3*this.get_Scale());i.LineTo(n,t);i.LineTo(n+5*this.get_Scale(),t);i.MoveTo(u+5*this.get_Scale(),t+3*this.get_Scale());i.LineTo(u+5*this.get_Scale(),t);i.LineTo(u,t);i.Stroke();i.FillText("3",n+7*this.get_Scale(),t-10*this.get_Scale());i.set_Font(r)}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.TripletFeelGlyph.NoteScale=.4;AlphaTab.Rendering.Glyphs.TripletFeelGlyph.NoteHeight=12;AlphaTab.Rendering.Glyphs.TripletFeelGlyph.NoteSeparation=12;AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarHeight=2;AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarSeparation=3}),$Inherit(AlphaTab.Rendering.Glyphs.TripletFeelGlyph,AlphaTab.Rendering.Glyphs.EffectGlyph),AlphaTab.Rendering.Glyphs.TuningGlyph=function(n,t,i,r,u){this._scale=0;this._resources=null;this.Height=0;AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,n,t);this._scale=i;this._resources=r;this.CreateGlyphs(u)},AlphaTab.Rendering.Glyphs.TuningGlyph.prototype={CreateGlyphs:function(n){var t,f,e;if(this.AddGlyph(new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,n.Name,this._resources.EffectFont,AlphaTab.Platform.Model.TextAlign.Left)),this.Height+=15*this._scale,!n.IsStandard){var r=Math.ceil(n.Tunings.length/2)|0,u=0,i=this.Height;for(t=0,f=n.Tunings.length;t<f;t++)e="("+(t+1)+") = "+AlphaTab.Model.Tuning.GetTextForTuning(n.Tunings[t],!1),this.AddGlyph(new AlphaTab.Rendering.Glyphs.TextGlyph(u,i,e,this._resources.EffectFont,AlphaTab.Platform.Model.TextAlign.Left)),i+=this.Height,t==r-1&&(i=this.Height,u+=43*this._scale);this.Height+=r*15*this._scale}}},$Inherit(AlphaTab.Rendering.Glyphs.TuningGlyph,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.VibratoGlyph=function(n,t,i){this._scale=0;AlphaTab.Rendering.Glyphs.GroupedEffectGlyph.call(this,AlphaTab.Rendering.BeatXPosition.EndBeat);this._scale=i;this.X=n;this.Y=t},AlphaTab.Rendering.Glyphs.VibratoGlyph.prototype={DoLayout:function(){AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);this.Height=10*this.get_Scale()*this._scale},PaintGrouped:function(n,t,i,r){for(var o=n+this.X,s=i-o,u=9*this.get_Scale()*this._scale,h=Math.max(1,s/u)|0,c=this.Height,f=0,e=0;e<h;e++)r.FillMusicFontSymbol(n+this.X+f,t+this.Y+c,this._scale,AlphaTab.Rendering.Glyphs.MusicFontSymbol.WaveHorizontal),f+=u}},$Inherit(AlphaTab.Rendering.Glyphs.VibratoGlyph,AlphaTab.Rendering.Glyphs.GroupedEffectGlyph),AlphaTab.Rendering.Glyphs.VoiceContainerGlyph=function(n,t,i){this.BeatGlyphs=null;this.Voice=null;this.MinWidth=0;AlphaTab.Rendering.Glyphs.GlyphGroup.call(this,n,t);this.Voice=i;this.BeatGlyphs=[]},AlphaTab.Rendering.Glyphs.VoiceContainerGlyph.prototype={ScaleToWidth:function(n){var t=this.Renderer.LayoutingInfo.SpaceToForce(n);this.ScaleToForce(t)},ScaleToForce:function(n){var e,i,t,f,r,o,u;for(this.Width=this.Renderer.LayoutingInfo.CalculateVoiceWidth(n),e=this.Renderer.LayoutingInfo.BuildOnTimePositions(n),i=this.BeatGlyphs,t=0,f=i.length;t<f;t++)r=i[t],o=r.Beat.get_AbsoluteStart(),r.X=e[o]-r.OnTimeX,t>0&&(u=r.X-i[t-1].X,i[t-1].ScaleToWidth(u)),t==f-1&&(u=this.Width-i[i.length-1].X,r.ScaleToWidth(u))},RegisterLayoutingInfo:function(n){var t;n.UpdateVoiceSize(this.Width);t=this.BeatGlyphs;for(var i=0,u=t.length,r=t[i];i<u;i++,r=t[i])r.RegisterLayoutingInfo(n)},ApplyLayoutingInfo:function(n){for(var i=this.BeatGlyphs,t=0,u=i.length,r=i[t];t<u;t++,r=i[t])r.ApplyLayoutingInfo(n);this.ScaleToForce(Math.max(this.Renderer.get_Settings().StretchForce,n.MinStretchForce))},AddGlyph:function(n){n.X=this.BeatGlyphs.length==0?0:this.BeatGlyphs[this.BeatGlyphs.length-1].X+this.BeatGlyphs[this.BeatGlyphs.length-1].Width;n.Renderer=this.Renderer;n.DoLayout();this.BeatGlyphs.push(n);this.Width=n.X+n.Width},DoLayout:function(){this.MinWidth=this.Width},Paint:function(n,t,i){i.set_Color(this.Voice.Index==0?this.Renderer.ScoreRenderer.RenderingResources.MainGlyphColor:this.Renderer.ScoreRenderer.RenderingResources.SecondaryGlyphColor);for(var r=0,u=this.BeatGlyphs.length;r<u;r++)this.BeatGlyphs[r].Paint(n+this.X,t+this.Y,i)}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.VoiceContainerGlyph.KeySizeBeat="Beat"}),$Inherit(AlphaTab.Rendering.Glyphs.VoiceContainerGlyph,AlphaTab.Rendering.Glyphs.GlyphGroup),AlphaTab.Rendering.Glyphs.WhammyBarGlyph=function(n,t){this._beat=null;this._parent=null;AlphaTab.Rendering.Glyphs.Glyph.call(this,0,0);this._beat=n;this._parent=t},AlphaTab.Rendering.Glyphs.WhammyBarGlyph.prototype={DoLayout:function(){var f,t,e,o,n;AlphaTab.Rendering.Glyphs.Glyph.prototype.DoLayout.call(this);var r=0,u=0,c=60*this.get_Scale();if(this._beat.WhammyBarPoints.length>=2)for(f=c/24,t=0,e=this._beat.WhammyBarPoints.length;t<e;t++)o=this._beat.WhammyBarPoints[t],n=0-f*o.Value,n>u&&(u=n),n<r&&(r=n);var i=this.Renderer,l=this.Renderer.Bar.Staff.Track,a=i.GetTabY(0,-2),v=i.GetTabY(l.Tuning.length,-2),s=r+a,h=u-v;s<0&&i.RegisterOverflowTop(Math.abs(s));h>0&&i.RegisterOverflowBottom(Math.abs(h))},Paint:function(n,t,i){var d=this.Renderer,g=this.Renderer.get_Resources(),h=n+this.X+this._parent.OnNotes.Width/2,nt=this._beat.NextBeat==null||this._beat.Voice!=this._beat.NextBeat.Voice?n+this.X+this._parent.Width:n+d.GetBeatX(this._beat.NextBeat,AlphaTab.Rendering.BeatXPosition.PreNotes),y=t,tt=60*this.get_Scale(),it=i.get_TextAlign(),c,l,u,p,o,f,r,e,v,s,k;if(i.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Center),this._beat.WhammyBarPoints.length>=2){for(c=(nt-h)/60,l=tt/24,i.BeginPath(),u=0,p=this._beat.WhammyBarPoints.length-1;u<p;u++)if(o=this._beat.WhammyBarPoints[u],f=this._beat.WhammyBarPoints[u+1],o.Value!=f.Value||u!=this._beat.WhammyBarPoints.length-2){var rt=h+c*o.Offset,w=y-l*o.Value,b=h+c*f.Offset,a=y-l*f.Value;i.MoveTo(rt,w);i.LineTo(b,a);f.Value!=0&&(r=f.Value,e="",(r>=4||r<=-4)&&(v=r/4|0,e+=v,r-=v*4),r>0&&(e+=AlphaTab.Rendering.Glyphs.BendGlyph.GetFractionSign(r)),e!=""&&(i.set_Font(g.GraceFont),s=a,a<w?s-=i.get_Font().Size:s+=3*this.get_Scale(),k=b,i.FillText(e,k,s)))}i.Stroke()}i.set_TextAlign(it)}},$StaticConstructor(function(){AlphaTab.Rendering.Glyphs.WhammyBarGlyph.WhammyMaxOffset=60}),$Inherit(AlphaTab.Rendering.Glyphs.WhammyBarGlyph,AlphaTab.Rendering.Glyphs.Glyph),AlphaTab.Rendering.RenderFinishedEventArgs=function(){this.Width=0;this.Height=0;this.TotalWidth=0;this.TotalHeight=0;this.FirstMasterBarIndex=0;this.LastMasterBarIndex=0;this.RenderResult=null},AlphaTab.Rendering.Layout=AlphaTab.Rendering.Layout||{},AlphaTab.Rendering.Layout.HeaderFooterElements={None:0,Title:1,SubTitle:2,Artist:4,Album:8,Words:16,Music:32,WordsAndMusic:64,Copyright:128,PageNumber:256,All:511},AlphaTab.Rendering.Layout.HorizontalScreenLayoutPartialInfo=function(){this.Width=0;this.MasterBars=null;this.MasterBars=[]},AlphaTab.Rendering.Layout.ScoreLayout=function(n){this._barRendererLookup=null;this.ScoreInfoGlyphs=null;this.TuningGlyph=null;this.Renderer=null;this.Width=0;this.Height=0;this.Renderer=n;this._barRendererLookup={}},AlphaTab.Rendering.Layout.ScoreLayout.prototype={LayoutAndRender:function(){this.CreateScoreInfoGlyphs();this.DoLayoutAndRender()},CreateScoreInfoGlyphs:function(){var r;AlphaTab.Util.Logger.Info("ScoreLayout","Creating score info glyphs");var t=this.Renderer.Settings.Layout.Get("hideInfo",!1)?AlphaTab.Rendering.Layout.HeaderFooterElements.None:AlphaTab.Rendering.Layout.HeaderFooterElements.All,n=this.Renderer.Score,i=this.Renderer.RenderingResources;this.ScoreInfoGlyphs={};n.Title==null||n.Title.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.Title)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Title]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,n.Title,i.TitleFont,AlphaTab.Platform.Model.TextAlign.Center));n.SubTitle==null||n.SubTitle.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.SubTitle)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.SubTitle]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,n.SubTitle,i.SubTitleFont,AlphaTab.Platform.Model.TextAlign.Center));n.Artist==null||n.Artist.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.Artist)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Artist]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,n.Artist,i.SubTitleFont,AlphaTab.Platform.Model.TextAlign.Center));n.Album==null||n.Album.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.Album)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Album]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,n.Album,i.SubTitleFont,AlphaTab.Platform.Model.TextAlign.Center));n.Music==null||n.Music.length==0||n.Music!=n.Words||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.WordsAndMusic)==AlphaTab.Rendering.Layout.HeaderFooterElements.None?(n.Music==null||n.Music.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.Music)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Music]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"Music by "+n.Music,i.WordsFont,AlphaTab.Platform.Model.TextAlign.Right)),n.Words==null||n.Words.length==0||(t&AlphaTab.Rendering.Layout.HeaderFooterElements.Words)==AlphaTab.Rendering.Layout.HeaderFooterElements.None||(this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Words]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"Words by "+n.Music,i.WordsFont,AlphaTab.Platform.Model.TextAlign.Left))):this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.WordsAndMusic]=new AlphaTab.Rendering.Glyphs.TextGlyph(0,0,"Music and Words by "+n.Words,i.WordsFont,AlphaTab.Platform.Model.TextAlign.Center);this.Renderer.Tracks.length!=1||this.Renderer.Tracks[0].IsPercussion||(r=AlphaTab.Model.Tuning.FindTuning(this.Renderer.Tracks[0].Tuning),r!=null&&(this.TuningGlyph=new AlphaTab.Rendering.Glyphs.TuningGlyph(0,0,this.get_Scale(),this.Renderer.RenderingResources,r)))},get_Scale:function(){return this.Renderer.Settings.Scale},CreateEmptyStaveGroup:function(){var u=new AlphaTab.Rendering.Staves.StaveGroup,f,s,n,t,i,r,e,o;for(u.Layout=this,f=AlphaTab.Environment.StaveProfiles.hasOwnProperty(this.Renderer.Settings.Staves.Id)?AlphaTab.Environment.StaveProfiles[this.Renderer.Settings.Staves.Id]:AlphaTab.Environment.StaveProfiles["default"],s=!0,n=0;n<this.Renderer.Tracks.length;n++){for(t=this.Renderer.Tracks[n],i=0;i<t.Staves.length;i++)for(r=0;r<f.length;r++)e=f[r],o=t.Staves[i],e.CanCreate(t,o)&&u.AddStaff(t,new AlphaTab.Rendering.Staves.Staff(n,o,e,this.Renderer.Settings.Staves.AdditionalSettings));s=!1}return u},RegisterBarRenderer:function(n,t){this._barRendererLookup.hasOwnProperty(n)||(this._barRendererLookup[n]={});this._barRendererLookup[n][t.Bar.Id]=t},UnregisterBarRenderer:function(n,t){if(this._barRendererLookup.hasOwnProperty(n)){var i=this._barRendererLookup[n];delete i[t.Bar.Id]}},GetRendererForBar:function(n,t){var i=t.Id;return this._barRendererLookup.hasOwnProperty(n)&&this._barRendererLookup[n].hasOwnProperty(i)?this._barRendererLookup[n][i]:null},RenderAnnotation:function(){var n=this.Renderer.Canvas,t=this.Renderer.RenderingResources,i=t.CopyrightFont.Size*2,r,u;this.Height+=i;r=this.Width/2;n.BeginRender(this.Width,i);n.set_Color(t.MainGlyphColor);n.set_Font(t.CopyrightFont);n.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Center);n.FillText("Rendered using alphaTab (http://www.alphaTab.net)",r,t.CopyrightFont.Size);u=n.EndRender();this.Renderer.OnPartialRenderFinished(function(){var n=new AlphaTab.Rendering.RenderFinishedEventArgs;return n.Width=this.Width,n.Height=i,n.RenderResult=u,n.TotalWidth=this.Width,n.TotalHeight=this.Height,n.FirstMasterBarIndex=-1,n.LastMasterBarIndex=-1,n}.call(this))}},AlphaTab.Rendering.Layout.HorizontalScreenLayout=function(n){this._group=null;AlphaTab.Rendering.Layout.ScoreLayout.call(this,n)},AlphaTab.Rendering.Layout.HorizontalScreenLayout.prototype={get_Name:function(){return"HorizontalScreen"},get_SupportsResize:function(){return!1},Resize:function(){},DoLayoutAndRender:function(){var f=this.Renderer.Score,h=this.Renderer.Canvas,o=this.Renderer.Settings.Layout.Get("start",1),i,u,c,s,t,l,e;o--;o=Math.min(f.MasterBars.length-1,Math.max(0,o));i=o;u=this.Renderer.Settings.Layout.Get("count",f.MasterBars.length);u<0&&(u=f.MasterBars.length);u=o+u-1;u=Math.min(f.MasterBars.length-1,Math.max(0,u));this._group=this.CreateEmptyStaveGroup();this._group.IsLast=!0;this._group.X=AlphaTab.Rendering.Layout.HorizontalScreenLayout.PagePadding[0];this._group.Y=AlphaTab.Rendering.Layout.HorizontalScreenLayout.PagePadding[1];for(var a=this.Renderer.Settings.Layout.Get("countPerPartial",10),r=[],n=new AlphaTab.Rendering.Layout.HorizontalScreenLayoutPartialInfo;i<=u;)e=this._group.AddBars(this.Renderer.Tracks,i),n.MasterBars.length==0&&e.IsLinkedToPrevious&&r.length>0?(c=r[r.length-1],c.MasterBars.push(f.MasterBars[i]),c.Width+=e.Width):(n.MasterBars.push(f.MasterBars[i]),n.Width+=e.Width,n.MasterBars.length>=a&&(r.length==0&&(n.Width+=this._group.X+this._group.AccoladeSpacing),r.push(n),AlphaTab.Util.Logger.Info(this.get_Name(),"Finished partial from bar "+n.MasterBars[0].Index+" to "+n.MasterBars[n.MasterBars.length-1].Index),n=new AlphaTab.Rendering.Layout.HorizontalScreenLayoutPartialInfo)),i++;for(n.MasterBars.length>0&&(r.length==0&&(n.Width+=this._group.X+this._group.AccoladeSpacing),r.push(n),AlphaTab.Util.Logger.Info(this.get_Name(),"Finished partial from bar "+n.MasterBars[0].Index+" to "+n.MasterBars[n.MasterBars.length-1].Index)),this._group.FinalizeGroup(),this.Height=this._group.Y+this._group.get_Height()+AlphaTab.Rendering.Layout.HorizontalScreenLayout.PagePadding[3],this.Width=this._group.X+this._group.Width+AlphaTab.Rendering.Layout.HorizontalScreenLayout.PagePadding[2],i=0,s=0;s<r.length;s++)t=r[s],h.BeginRender(t.Width,this.Height),h.set_Color(this.Renderer.RenderingResources.MainGlyphColor),h.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Left),l=this._group.GetBarX(t.MasterBars[0].Index)+this._group.AccoladeSpacing,s==0&&(l-=this._group.X+this._group.AccoladeSpacing),AlphaTab.Util.Logger.Info(this.get_Name(),"Rendering partial from bar "+t.MasterBars[0].Index+" to "+t.MasterBars[t.MasterBars.length-1].Index),this._group.PaintPartial(-l,this._group.Y,this.Renderer.Canvas,i,t.MasterBars.length),e=h.EndRender(),this.Renderer.OnPartialRenderFinished(function(){var n=new AlphaTab.Rendering.RenderFinishedEventArgs;return n.TotalWidth=this.Width,n.TotalHeight=this.Height,n.Width=t.Width,n.Height=this.Height,n.RenderResult=e,n.FirstMasterBarIndex=t.MasterBars[0].Index,n.LastMasterBarIndex=t.MasterBars[t.MasterBars.length-1].Index,n}.call(this)),i+=t.MasterBars.length}},$StaticConstructor(function(){AlphaTab.Rendering.Layout.HorizontalScreenLayout.PagePadding=new Float32Array([20,20,20,20]);AlphaTab.Rendering.Layout.HorizontalScreenLayout.GroupSpacing=20}),$Inherit(AlphaTab.Rendering.Layout.HorizontalScreenLayout,AlphaTab.Rendering.Layout.ScoreLayout),AlphaTab.Rendering.Layout.PageViewLayout=function(n){this._groups=null;this._allMasterBarRenderers=null;this._barsFromPreviousGroup=null;AlphaTab.Rendering.Layout.ScoreLayout.call(this,n)},AlphaTab.Rendering.Layout.PageViewLayout.prototype={get_Name:function(){return"PageView"},DoLayoutAndRender:function(){var t=AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[0],n=AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[1];this.Width=this.Renderer.Settings.Width;this._allMasterBarRenderers=[];n=this.LayoutAndRenderScoreInfo(t,n,-1);n=this.LayoutAndRenderScore(t,n);this.Height=n+AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[3]},get_SupportsResize:function(){return!0},Resize:function(){var i=AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[0],n=AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[1],t;this.Width=this.Renderer.Settings.Width;t=this.Height;n=this.LayoutAndRenderScoreInfo(i,n,t);n=this.ResizeAndRenderScore(i,n,t);this.Height=n+AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[3]},LayoutAndRenderScoreInfo:function(n,t,i){var f,e,o,r,u,c,l;AlphaTab.Util.Logger.Info(this.get_Name(),"Layouting score info");var h=this.get_Scale(),a=this.Renderer.RenderingResources,s=[AlphaTab.Rendering.Layout.HeaderFooterElements.Title,AlphaTab.Rendering.Layout.HeaderFooterElements.SubTitle,AlphaTab.Rendering.Layout.HeaderFooterElements.Artist,AlphaTab.Rendering.Layout.HeaderFooterElements.Album,AlphaTab.Rendering.Layout.HeaderFooterElements.WordsAndMusic];for(f=0;f<s.length;f++)this.ScoreInfoGlyphs.hasOwnProperty(s[f])&&(r=this.ScoreInfoGlyphs[s[f]],r.X=this.Width/2,r.Y=t,r.TextAlign=AlphaTab.Platform.Model.TextAlign.Center,t+=r.Font.Size);e=!1;o=0;this.ScoreInfoGlyphs.hasOwnProperty(AlphaTab.Rendering.Layout.HeaderFooterElements.Music)&&(r=this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Music],r.X=this.Width-AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[2],r.Y=t,r.TextAlign=AlphaTab.Platform.Model.TextAlign.Right,e=!0,o=r.Font.Size);this.ScoreInfoGlyphs.hasOwnProperty(AlphaTab.Rendering.Layout.HeaderFooterElements.Words)&&(r=this.ScoreInfoGlyphs[AlphaTab.Rendering.Layout.HeaderFooterElements.Words],r.X=n,r.Y=t,r.TextAlign=AlphaTab.Platform.Model.TextAlign.Left,e=!0,o=r.Font.Size);e&&(t+=o);this.TuningGlyph!=null&&(t+=20*h,this.TuningGlyph.X=n,this.TuningGlyph.Y=t,t+=this.TuningGlyph.Height);t+=20*h;u=this.Renderer.Canvas;u.BeginRender(this.Width,t);u.set_Color(a.ScoreInfoColor);u.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Center);for(c in this.ScoreInfoGlyphs)this.ScoreInfoGlyphs[c].Paint(0,0,u);return this.TuningGlyph!=null&&this.TuningGlyph.Paint(0,0,u),l=u.EndRender(),this.Renderer.OnPartialRenderFinished(function(){var n=new AlphaTab.Rendering.RenderFinishedEventArgs;return n.Width=this.Width,n.Height=t,n.RenderResult=l,n.TotalWidth=this.Width,n.TotalHeight=i<0?t:i,n.FirstMasterBarIndex=-1,n.LastMasterBarIndex=-1,n}.call(this)),t},ResizeAndRenderScore:function(n,t,i){var f=this.Renderer.Canvas,u,r,o;if(this.Renderer.Settings.Layout.Get("barsPerRow",-1)!=-1)for(u=0;u<this._groups.length;u++)r=this._groups[u],this.FitGroup(r),r.FinalizeGroup(),t+=this.PaintGroup(r,i,f);else{this._groups=[];var e=0,s=this.get_MaxWidth(),r=this.CreateEmptyStaveGroup();for(r.Index=this._groups.length,r.X=n,r.Y=t;e<this._allMasterBarRenderers.length;)o=this._allMasterBarRenderers[e],r.Width+o.Width<=s||r.MasterBarsRenderers.length==0?(r.AddMasterBarRenderers(this.Renderer.Tracks,o),e++):(r.IsFull=!0,r.IsLast=!1,this._groups.push(r),this.FitGroup(r),r.FinalizeGroup(),t+=this.PaintGroup(r,i,f),r=this.CreateEmptyStaveGroup(),r.Index=this._groups.length,r.X=n,r.Y=t);this.FitGroup(r);r.FinalizeGroup();t+=this.PaintGroup(r,i,f)}return t},LayoutAndRenderScore:function(n,t){var f=this.Renderer.Score,o=this.Renderer.Canvas,u=this.Renderer.Settings.Layout.Get("start",1),e,r,i;for(u--,u=Math.min(f.MasterBars.length-1,Math.max(0,u)),e=u,r=this.Renderer.Settings.Layout.Get("count",f.MasterBars.length),r<0&&(r=f.MasterBars.length),r=u+r-1,r=Math.min(f.MasterBars.length-1,Math.max(0,r)),this._groups=[];e<=r;)i=this.CreateStaveGroup(e,r),this._groups.push(i),i.X=n,i.Y=t,e=i.get_LastBarIndex()+1,this.FitGroup(i),i.FinalizeGroup(),AlphaTab.Util.Logger.Info(this.get_Name(),"Rendering partial from bar "+i.get_FirstBarIndex()+" to "+i.get_LastBarIndex()),t+=this.PaintGroup(i,t,o);return t},PaintGroup:function(n,t,i){var u=n.get_Height()+20*this.get_Scale(),f,r;return i.BeginRender(this.Width,u),this.Renderer.Canvas.set_Color(this.Renderer.RenderingResources.MainGlyphColor),this.Renderer.Canvas.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Left),n.Paint(0,-n.Y,i),t+=u,f=i.EndRender(),r=new AlphaTab.Rendering.RenderFinishedEventArgs,r.TotalWidth=this.Width,r.TotalHeight=t,r.Width=this.Width,r.Height=u,r.RenderResult=f,r.FirstMasterBarIndex=n.get_FirstBarIndex(),r.LastMasterBarIndex=n.get_LastBarIndex(),this.Renderer.OnPartialRenderFinished(r),u},FitGroup:function(n){(n.IsFull||n.Width>this.get_MaxWidth())&&n.ScaleToWidth(this.get_MaxWidth());this.Width=Math.max(this.Width,n.Width)},CreateStaveGroup:function(n,t){var i=this.CreateEmptyStaveGroup(),r,u,f;i.Index=this._groups.length;var e=this.Renderer.Settings.Layout.Get("barsPerRow",-1),o=this.get_MaxWidth(),s=t+1;for(r=n;r<s;r++){if(this._barsFromPreviousGroup!=null&&this._barsFromPreviousGroup.MasterBar.Index==r?u=i.AddMasterBarRenderers(this.Renderer.Tracks,this._barsFromPreviousGroup):(u=i.AddBars(this.Renderer.Tracks,r),this._allMasterBarRenderers.push(u)),this._barsFromPreviousGroup=null,f=!1,e==-1&&i.Width>=o&&i.MasterBarsRenderers.length!=0?f=!0:i.MasterBarsRenderers.length==e+1&&(f=!0),f)return i.RevertLastBar(),i.IsFull=!0,i.IsLast=!1,this._barsFromPreviousGroup=u,i;i.X=0}return i.IsLast=t==i.get_LastBarIndex(),i},get_MaxWidth:function(){return this.Renderer.Settings.Width-AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[0]-AlphaTab.Rendering.Layout.PageViewLayout.PagePadding[2]}},$StaticConstructor(function(){AlphaTab.Rendering.Layout.PageViewLayout.PagePadding=new Float32Array([40,40,40,40]);AlphaTab.Rendering.Layout.PageViewLayout.GroupSpacing=20}),$Inherit(AlphaTab.Rendering.Layout.PageViewLayout,AlphaTab.Rendering.Layout.ScoreLayout),AlphaTab.Rendering.RenderingResources=function(n){this.CopyrightFont=null;this.TitleFont=null;this.SubTitleFont=null;this.WordsFont=null;this.EffectFont=null;this.TablatureFont=null;this.GraceFont=null;this.StaveLineColor=null;this.BarSeperatorColor=null;this.BarNumberFont=null;this.BarNumberColor=null;this.MarkerFont=null;this.TabClefFont=null;this.MainGlyphColor=null;this.SecondaryGlyphColor=null;this.Scale=0;this.ScoreInfoColor=null;this.Init(n)},AlphaTab.Rendering.RenderingResources.prototype={Init:function(n){this.Scale=n;var t="Arial",i="Georgia";this.EffectFont=new AlphaTab.Platform.Model.Font(i,12*n,AlphaTab.Platform.Model.FontStyle.Italic);this.CopyrightFont=new AlphaTab.Platform.Model.Font(t,12*n,AlphaTab.Platform.Model.FontStyle.Bold);this.TitleFont=new AlphaTab.Platform.Model.Font(i,32*n,AlphaTab.Platform.Model.FontStyle.Plain);this.SubTitleFont=new AlphaTab.Platform.Model.Font(i,20*n,AlphaTab.Platform.Model.FontStyle.Plain);this.WordsFont=new AlphaTab.Platform.Model.Font(i,15*n,AlphaTab.Platform.Model.FontStyle.Plain);this.TablatureFont=new AlphaTab.Platform.Model.Font(t,13*n,AlphaTab.Platform.Model.FontStyle.Plain);this.GraceFont=new AlphaTab.Platform.Model.Font(t,11*n,AlphaTab.Platform.Model.FontStyle.Plain);this.StaveLineColor=new AlphaTab.Platform.Model.Color(0,0,0,255);this.BarSeperatorColor=new AlphaTab.Platform.Model.Color(34,34,17,255);this.BarNumberFont=new AlphaTab.Platform.Model.Font(t,11*n,AlphaTab.Platform.Model.FontStyle.Plain);this.BarNumberColor=new AlphaTab.Platform.Model.Color(200,0,0,255);this.MarkerFont=new AlphaTab.Platform.Model.Font(i,14*n,AlphaTab.Platform.Model.FontStyle.Bold);this.TabClefFont=new AlphaTab.Platform.Model.Font(t,18*n,AlphaTab.Platform.Model.FontStyle.Bold);this.ScoreInfoColor=new AlphaTab.Platform.Model.Color(0,0,0,255);this.MainGlyphColor=new AlphaTab.Platform.Model.Color(0,0,0,255);this.SecondaryGlyphColor=new AlphaTab.Platform.Model.Color(0,0,0,100)}},AlphaTab.Rendering.ScoreBarRenderer=function(n,t){this._startSpacing=!1;this.AccidentalHelper=null;AlphaTab.Rendering.BarRendererBase.call(this,n,t);this.AccidentalHelper=new AlphaTab.Rendering.Utils.AccidentalHelper},AlphaTab.Rendering.ScoreBarRenderer.prototype={GetBeatDirection:function(n){var t=this.GetOnNotesGlyphForBeat(n);return t!=null?t.NoteHeads.get_Direction():AlphaTab.Rendering.Utils.BeamDirection.Up},GetNoteX:function(n,t){var i=this.GetOnNotesGlyphForBeat(n.Beat),r;return i!=null?(r=i.Container.VoiceContainer.X+i.Container.X+i.X,t&&(r+=i.Width),r):0},GetNoteY:function(n){var t=this.GetOnNotesGlyphForBeat(n.Beat);return t!=null?t.NoteHeads.GetNoteY(n):0},get_LineOffset:function(){return 9*this.get_Scale()},UpdateSizes:function(){var n=this.get_Resources(),t=n.TablatureFont.Size/2+n.TablatureFont.Size*.2;this.TopPadding=t;this.BottomPadding=t;this.Height=this.get_LineOffset()*4+this.TopPadding+this.BottomPadding;AlphaTab.Rendering.BarRendererBase.prototype.UpdateSizes.call(this)},DoLayout:function(){var o,f,r,s,e,u,h,n,t,i;for(AlphaTab.Rendering.BarRendererBase.prototype.DoLayout.call(this),o=this.GetScoreY(0,0),f=this.GetScoreY(8,0),r=0,s=this.Helpers.BeamHelpers.length;r<s;r++)for(e=this.Helpers.BeamHelpers[r],u=0,h=e.length;u<h;u++)n=e[u],t=this.GetScoreY(this.GetNoteLine(n.MaxNote),0),n.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up&&(t-=this.GetStemSize(n),t-=n.FingeringCount*this.get_Resources().GraceFont.Size,n.HasTuplet&&(t-=this.get_Resources().EffectFont.Size*2)),n.HasTuplet&&(t-=this.get_Resources().EffectFont.Size*1.5),t<o&&this.RegisterOverflowTop(Math.abs(t)),i=this.GetScoreY(this.GetNoteLine(n.MinNote),0),n.Direction==AlphaTab.Rendering.Utils.BeamDirection.Down&&(i+=this.GetStemSize(n),i+=n.FingeringCount*this.get_Resources().GraceFont.Size),i>f&&this.RegisterOverflowBottom(Math.abs(i)-f)},Paint:function(n,t,i){AlphaTab.Rendering.BarRendererBase.prototype.Paint.call(this,n,t,i);this.PaintBeams(n,t,i);this.PaintTuplets(n,t,i)},PaintTuplets:function(n,t,i){for(var f,u,o,s,r=0,e=this.Helpers.TupletHelpers.length;r<e;r++)for(f=this.Helpers.TupletHelpers[r],u=0,o=f.length;u<o;u++)s=f[u],this.PaintTupletHelper(n+this.get_BeatGlyphsStart(),t,i,s)},PaintBeams:function(n,t,i){for(var f,u,o,s,r=0,e=this.Helpers.BeamHelpers.length;r<e;r++)for(f=this.Helpers.BeamHelpers[r],u=0,o=f.length;u<o;u++)s=f[u],this.PaintBeamHelper(n+this.get_BeatGlyphsStart(),t,i,s)},PaintBeamHelper:function(n,t,i,r){i.set_Color(r.Voice.Index==0?this.get_Resources().MainGlyphColor:this.get_Resources().SecondaryGlyphColor);r.Beats.length==1?this.PaintFooter(n,t,i,r):this.PaintBar(n,t,i,r)},PaintTupletHelper:function(n,t,i,r){var c=this.get_Resources(),st=i.get_TextAlign(),l,d,p,s;if(i.set_TextAlign(AlphaTab.Platform.Model.TextAlign.Center),r.Beats.length!=1&&r.get_IsFull()){var tt=r.Beats[0],it=r.Beats[r.Beats.length-1],f=this.Helpers.BeamHelperLookup[r.VoiceIndex][tt.Index],w=this.Helpers.BeamHelperLookup[r.VoiceIndex][it.Index];if(f!=null&&w!=null){var g=f.Direction,e=f.GetBeatLineX(tt)+this.get_Scale(),h=w.GetBeatLineX(it)+this.get_Scale();i.set_Font(c.EffectFont);var rt=r.Tuplet.toString(),ut=i.MeasureText(rt),ft=3*this.get_Scale(),a=(e+h)/2,et=a-ut/2-ft,ot=a+ut/2+ft,v=this.CalculateBeamYWithDirection(f,e,f.Direction),b=this.CalculateBeamYWithDirection(w,h,f.Direction),y=(b-v)/(h-e),k=v-y*e,ct=y*et+k,lt=y*a+k,at=y*ot+k,u=10*this.get_Scale(),o=5*this.get_Scale();g==AlphaTab.Rendering.Utils.BeamDirection.Down&&(u*=-1,o*=-1);i.BeginPath();i.MoveTo(n+this.X+e,t+this.Y+v-u|0);i.LineTo(n+this.X+e,t+this.Y+v-u-o|0);i.LineTo(n+this.X+et,t+this.Y+ct-u-o|0);i.Stroke();i.BeginPath();i.MoveTo(n+this.X+ot,t+this.Y+at-u-o|0);i.LineTo(n+this.X+h,t+this.Y+b-u-o|0);i.LineTo(n+this.X+h,t+this.Y+b-u|0);i.Stroke();i.FillText(rt,n+this.X+a,t+this.Y+lt-u-o-c.EffectFont.Size)}}else for(l=0,d=r.Beats.length;l<d;l++)if(p=r.Beats[l],s=this.Helpers.BeamHelperLookup[r.VoiceIndex][p.Index],s!=null){var g=s.Direction,nt=s.GetBeatLineX(p)+this.get_Scale(),ht=t+this.Y+this.CalculateBeamY(s,nt),u=g==AlphaTab.Rendering.Utils.BeamDirection.Up?c.EffectFont.Size*1.8:-3*this.get_Scale();i.set_Font(c.EffectFont);i.FillText(r.Tuplet.toString(),n+this.X+nt,ht-u)}i.set_TextAlign(st)},GetStemSize:function(n){return n.Beats.length==1?this.GetFooterStemSize(n.ShortestDuration):this.GetBarStemSize(n.ShortestDuration)},GetBarStemSize:function(n){var t;switch(n){case AlphaTab.Model.Duration.QuadrupleWhole:t=6;break;case AlphaTab.Model.Duration.Half:t=6;break;case AlphaTab.Model.Duration.Quarter:t=6;break;case AlphaTab.Model.Duration.Eighth:t=6;break;case AlphaTab.Model.Duration.Sixteenth:t=6;break;case AlphaTab.Model.Duration.ThirtySecond:t=7;break;case AlphaTab.Model.Duration.SixtyFourth:t=7;break;case AlphaTab.Model.Duration.OneHundredTwentyEighth:t=9;break;case AlphaTab.Model.Duration.TwoHundredFiftySixth:t=10;break;default:t=0}return this.GetScoreY(t,0)},GetFooterStemSize:function(n){var t;switch(n){case AlphaTab.Model.Duration.QuadrupleWhole:t=6;break;case AlphaTab.Model.Duration.Half:t=6;break;case AlphaTab.Model.Duration.Quarter:t=6;break;case AlphaTab.Model.Duration.Eighth:t=6;break;case AlphaTab.Model.Duration.Sixteenth:t=6;break;case AlphaTab.Model.Duration.ThirtySecond:t=6;break;case AlphaTab.Model.Duration.SixtyFourth:t=6;break;case AlphaTab.Model.Duration.OneHundredTwentyEighth:t=6;break;case AlphaTab.Model.Duration.TwoHundredFiftySixth:t=6;break;default:t=0}return this.GetScoreY(t,0)},GetYPositionForNote:function(n){return this.GetScoreY(this.GetNoteLine(n),0)},CalculateBeamY:function(n,t){var i=this.GetStemSize(n);return n.CalculateBeamY(i,this.get_Scale(),t,this.get_Scale(),this)},CalculateBeamYWithDirection:function(n,t,i){var r=this.GetStemSize(n);return n.CalculateBeamYWithDirection(r,this.get_Scale(),t,this.get_Scale(),this,i)},PaintBar:function(n,t,i,r){for(var v,y,h,s,c,w,b,l,u=0,d=r.Beats.length;u<d;u++){var f=r.Beats[u],tt=f.GraceType!=AlphaTab.Model.GraceType.None,e=tt?.75:1,o=r.GetBeatLineX(f)+this.get_Scale(),a=r.Direction,g=t+this.Y;g+=a==AlphaTab.Rendering.Utils.BeamDirection.Up?this.GetScoreY(this.GetNoteLine(f.get_MinNote()),0):this.GetScoreY(this.GetNoteLine(f.get_MaxNote()),0);v=t+this.Y;v+=e*this.CalculateBeamY(r,o);i.set_LineWidth(1.5*this.get_Scale());i.BeginPath();i.MoveTo(n+this.X+o,g);i.LineTo(n+this.X+o,v);i.Stroke();i.set_LineWidth(this.get_Scale());y=v;a==AlphaTab.Rendering.Utils.BeamDirection.Down?y+=i.get_Font().Size*2:u!=0&&(y-=i.get_Font().Size*1.5);this.PaintFingering(i,f,n+this.X+o,a,y);var nt=6*this.get_Scale()*e,k=7*this.get_Scale()*e,p=4*this.get_Scale()*e,it=AlphaTab.Model.ModelUtils.GetIndex(f.Duration)-2,rt=t+this.Y;for(a==AlphaTab.Rendering.Utils.BeamDirection.Down&&(k=-k,p=-p),h=0;h<it;h++)if(l=rt+h*k,u<r.Beats.length-1){if(AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(f,r.Beats[u+1],h))s=o,c=r.GetBeatLineX(r.Beats[u+1])+this.get_Scale();else if(u!=0&&AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(r.Beats[u-1],f,h))continue;else s=o,c=s+nt;w=l+this.CalculateBeamY(r,s)*e;b=l+this.CalculateBeamY(r,c)*e;AlphaTab.Rendering.ScoreBarRenderer.PaintSingleBar(i,n+this.X+s,w,n+this.X+c,b,p)}else u>0&&!AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(f,r.Beats[u-1],h)&&(s=o-nt,c=o,w=l+this.CalculateBeamY(r,s)*e,b=l+this.CalculateBeamY(r,c)*e,AlphaTab.Rendering.ScoreBarRenderer.PaintSingleBar(i,n+this.X+s,w,n+this.X+c,b,p))}},PaintFooter:function(n,t,i,r){var u=r.Beats[0],l=u.GraceType!=AlphaTab.Model.GraceType.None,p=l?.75:1,w=this.GetFooterStemSize(r.ShortestDuration),f=r.GetBeatLineX(u)+this.get_Scale(),h=r.Direction,e=this.GetScoreY(this.GetNoteLine(u.get_MaxNote()),0),o=this.GetScoreY(this.GetNoteLine(u.get_MinNote()),0),a,v,y,s,c;(h==AlphaTab.Rendering.Utils.BeamDirection.Down?(o+=w*p,a=o,v=t+this.Y+o):(e-=w*p,a=e,v=t+this.Y+e),this.PaintFingering(i,u,n+this.X+f,h,v),u.Duration!=AlphaTab.Model.Duration.Whole&&u.Duration!=AlphaTab.Model.Duration.DoubleWhole)&&(i.set_LineWidth(1.5*this.get_Scale()),i.BeginPath(),i.MoveTo(n+this.X+f,t+this.Y+e),i.LineTo(n+this.X+f,t+this.Y+o),i.Stroke(),i.set_LineWidth(this.get_Scale()),l&&(y=15*this.get_Scale(),s=12*this.get_Scale(),i.BeginPath(),h==AlphaTab.Rendering.Utils.BeamDirection.Down?(i.MoveTo(n+this.X+f-s/2,t+this.Y+o-y),i.LineTo(n+this.X+f+s/2,t+this.Y+o)):(i.MoveTo(n+this.X+f-s/2,t+this.Y+e+y),i.LineTo(n+this.X+f+s/2,t+this.Y+e)),i.Stroke()),u.Duration>AlphaTab.Model.Duration.Quarter&&(c=new AlphaTab.Rendering.Glyphs.BeamGlyph(f-this.get_Scale()/2,a,u.Duration,h,l),c.Renderer=this,c.DoLayout(),c.Paint(n+this.X,t+this.Y,i)))},PaintFingering:function(n,t,i,r,u){var o,s,f,e;for(r==AlphaTab.Rendering.Utils.BeamDirection.Up?i-=10*this.get_Scale():i+=3*this.get_Scale(),o=t.Notes.slice(),o.sort($CreateAnonymousDelegate(this,function(n,t){return t.get_RealValue()-n.get_RealValue()})),s=0;s<o.length;s++)(f=o[s],e=null,f.LeftHandFinger!=AlphaTab.Model.Fingers.Unknown?e=this.FingerToString(t,f.LeftHandFinger,!0):f.RightHandFinger!=AlphaTab.Model.Fingers.Unknown&&(e=this.FingerToString(t,f.RightHandFinger,!1)),e!=null)&&(n.FillText(e,i,u),u-=n.get_Font().Size|0)},FingerToString:function(n,t,i){if(this.get_Settings().ForcePianoFingering||AlphaTab.Audio.GeneralMidi.IsPiano(n.Voice.Bar.Staff.Track.PlaybackInfo.Program))switch(t){case AlphaTab.Model.Fingers.Unknown:case AlphaTab.Model.Fingers.NoOrDead:return null;case AlphaTab.Model.Fingers.Thumb:return"1";case AlphaTab.Model.Fingers.IndexFinger:return"2";case AlphaTab.Model.Fingers.MiddleFinger:return"3";case AlphaTab.Model.Fingers.AnnularFinger:return"4";case AlphaTab.Model.Fingers.LittleFinger:return"5";default:return null}else if(i)switch(t){case AlphaTab.Model.Fingers.Unknown:case AlphaTab.Model.Fingers.NoOrDead:return"0";case AlphaTab.Model.Fingers.Thumb:return"T";case AlphaTab.Model.Fingers.IndexFinger:return"1";case AlphaTab.Model.Fingers.MiddleFinger:return"2";case AlphaTab.Model.Fingers.AnnularFinger:return"3";case AlphaTab.Model.Fingers.LittleFinger:return"4";default:return null}else switch(t){case AlphaTab.Model.Fingers.Unknown:case AlphaTab.Model.Fingers.NoOrDead:return null;case AlphaTab.Model.Fingers.Thumb:return"p";case AlphaTab.Model.Fingers.IndexFinger:return"i";case AlphaTab.Model.Fingers.MiddleFinger:return"m";case AlphaTab.Model.Fingers.AnnularFinger:return"a";case AlphaTab.Model.Fingers.LittleFinger:return"c";default:return null}},CreatePreBeatGlyphs:function(){if(AlphaTab.Rendering.BarRendererBase.prototype.CreatePreBeatGlyphs.call(this),this.Bar.get_MasterBar().IsRepeatStart&&this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatOpenGlyph(0,0,1.5,3)),this.get_IsFirstOfLine()||this.Bar.Clef!=this.Bar.PreviousBar.Clef||this.Bar.ClefOttavia!=this.Bar.PreviousBar.ClefOttavia){var n=0,t=0;switch(this.Bar.Clef){case AlphaTab.Model.Clef.Neutral:n=6;break;case AlphaTab.Model.Clef.F4:n=4;t=-1;break;case AlphaTab.Model.Clef.C3:n=6;break;case AlphaTab.Model.Clef.C4:n=4;break;case AlphaTab.Model.Clef.G2:n=8}this.CreateStartSpacing();this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.ClefGlyph(0,this.GetScoreY(n,t),this.Bar.Clef,this.Bar.ClefOttavia))}(this.Index==0&&this.Bar.get_MasterBar().KeySignature!=0||this.Bar.PreviousBar!=null&&this.Bar.get_MasterBar().KeySignature!=this.Bar.PreviousBar.get_MasterBar().KeySignature)&&(this.CreateStartSpacing(),this.CreateKeySignatureGlyphs());(this.Bar.PreviousBar==null||this.Bar.PreviousBar!=null&&this.Bar.get_MasterBar().TimeSignatureNumerator!=this.Bar.PreviousBar.get_MasterBar().TimeSignatureNumerator||this.Bar.PreviousBar!=null&&this.Bar.get_MasterBar().TimeSignatureDenominator!=this.Bar.PreviousBar.get_MasterBar().TimeSignatureDenominator)&&(this.CreateStartSpacing(),this.CreateTimeSignatureGlyphs());this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.BarNumberGlyph(0,this.GetScoreY(-.5,0),this.Bar.Index+1));this.Bar.get_IsEmpty()&&this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,30*this.get_Scale()))},CreateBeatGlyphs:function(){for(var t,n=0;n<this.Bar.Voices.length;n++)t=this.Bar.Voices[n],this.HasVoiceContainer(t)&&this.CreateVoiceGlyphs(t)},CreatePostBeatGlyphs:function(){AlphaTab.Rendering.BarRendererBase.prototype.CreatePostBeatGlyphs.call(this);this.Bar.get_MasterBar().get_IsRepeatEnd()?(this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatCloseGlyph(this.X,0)),this.Bar.get_MasterBar().RepeatCount>2&&this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatCountGlyph(0,this.GetScoreY(-1,-3),this.Bar.get_MasterBar().RepeatCount))):this.Bar.NextBar!=null&&this.Bar.NextBar.get_MasterBar().IsRepeatStart||this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.BarSeperatorGlyph(0,0))},CreateStartSpacing:function(){this._startSpacing||(this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,2*this.get_Scale())),this._startSpacing=!0)},CreateKeySignatureGlyphs:function(){var t=0,e=this.Bar.get_MasterBar().KeySignature,s=this.Bar.PreviousBar==null?0:this.Bar.PreviousBar.get_MasterBar().KeySignature,u,r,h,o,n,i;switch(this.Bar.Clef){case AlphaTab.Model.Clef.Neutral:t=0;break;case AlphaTab.Model.Clef.G2:t=1;break;case AlphaTab.Model.Clef.F4:t=2;break;case AlphaTab.Model.Clef.C3:t=-1;break;case AlphaTab.Model.Clef.C4:t=1}if(u={},r=[],AlphaTab.Model.ModelUtils.KeySignatureIsSharp(e))for(n=0;n<Math.abs(e);n++)i=AlphaTab.Rendering.ScoreBarRenderer.SharpKsSteps[n]+t,r.push(new AlphaTab.Rendering.Glyphs.SharpGlyph(0,this.GetScoreY(i,0),!1)),u[i]=!0;else for(n=0;n<Math.abs(e);n++)i=AlphaTab.Rendering.ScoreBarRenderer.FlatKsSteps[n]+t,r.push(new AlphaTab.Rendering.Glyphs.FlatGlyph(0,this.GetScoreY(i,0),!1)),u[i]=!0;for(h=Math.abs(s),o=AlphaTab.Model.ModelUtils.KeySignatureIsSharp(s)?AlphaTab.Rendering.ScoreBarRenderer.SharpKsSteps:AlphaTab.Rendering.ScoreBarRenderer.FlatKsSteps,n=0;n<h;n++)i=o[n]+t,u.hasOwnProperty(i)||this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.NaturalizeGlyph(0,this.GetScoreY(o[n]+t,0),!1));for(var f=0,l=r.length,c=r[f];f<l;f++,c=r[f])this.AddPreBeatGlyph(c)},CreateTimeSignatureGlyphs:function(){this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,5*this.get_Scale()));this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.TimeSignatureGlyph(0,this.GetScoreY(2,0),this.Bar.get_MasterBar().TimeSignatureNumerator,this.Bar.get_MasterBar().TimeSignatureDenominator,this.Bar.get_MasterBar().TimeSignatureCommon))},CreateVoiceGlyphs:function(n){for(var u,i,t=0,r=n.Beats.length;t<r;t++)u=n.Beats[t],i=new AlphaTab.Rendering.ScoreBeatContainerGlyph(u,this.GetOrCreateVoiceContainer(n)),i.PreNotes=new AlphaTab.Rendering.Glyphs.ScoreBeatPreNotesGlyph,i.OnNotes=new AlphaTab.Rendering.Glyphs.ScoreBeatGlyph,this.AddBeatGlyph(i)},GetNoteLine:function(n){return this.AccidentalHelper.GetNoteLine(n)},GetScoreY:function(n,t){return this.get_LineOffset()/2*n+t*this.get_Scale()},PaintBackground:function(n,t,i){var u,f,e,r;for(AlphaTab.Rendering.BarRendererBase.prototype.PaintBackground.call(this,n,t,i),u=this.get_Resources(),i.set_Color(u.StaveLineColor),f=t+this.Y+this.TopPadding,e=this.get_LineOffset(),r=0;r<5;r++)r>0&&(f+=e),i.FillRect(n+this.X,f|0,this.Width,this.get_Scale());i.set_Color(u.MainGlyphColor)}},$StaticConstructor(function(){AlphaTab.Rendering.ScoreBarRenderer.StaffId="score";AlphaTab.Rendering.ScoreBarRenderer.SharpKsSteps=new Int32Array([1,4,0,3,6,2,5]);AlphaTab.Rendering.ScoreBarRenderer.FlatKsSteps=new Int32Array([5,2,6,3,7,4,8]);AlphaTab.Rendering.ScoreBarRenderer.LineSpacing=8}),AlphaTab.Rendering.ScoreBarRenderer.PaintSingleBar=function(n,t,i,r,u,f){n.BeginPath();n.MoveTo(t,i);n.LineTo(r,u);n.LineTo(r,u+f);n.LineTo(t,i+f);n.ClosePath();n.Fill()},$Inherit(AlphaTab.Rendering.ScoreBarRenderer,AlphaTab.Rendering.BarRendererBase),AlphaTab.Rendering.ScoreBarRendererFactory=function(){AlphaTab.Rendering.BarRendererFactory.call(this)},AlphaTab.Rendering.ScoreBarRendererFactory.prototype={get_StaffId:function(){return"score"},Create:function(n,t){return new AlphaTab.Rendering.ScoreBarRenderer(n,t)}},$Inherit(AlphaTab.Rendering.ScoreBarRendererFactory,AlphaTab.Rendering.BarRendererFactory),AlphaTab.Rendering.ScoreRenderer=function(n){this._currentLayoutMode=null;this.PreRender=null;this.PartialRenderFinished=null;this.RenderFinished=null;this.PostRenderFinished=null;this.Canvas=null;this.Score=null;this.Tracks=null;this.Layout=null;this.RenderingResources=null;this.Settings=null;this.BoundsLookup=null;this.Settings=n;this.RenderingResources=new AlphaTab.Rendering.RenderingResources(1);this.Canvas=n.Engine!=null&&AlphaTab.Environment.RenderEngines.hasOwnProperty(n.Engine)?AlphaTab.Environment.RenderEngines[n.Engine]():AlphaTab.Environment.RenderEngines["default"]();this.RecreateLayout()},AlphaTab.Rendering.ScoreRenderer.prototype={RecreateLayout:function(){return this._currentLayoutMode!=this.Settings.Layout.Mode?(this.Layout=this.Settings.Layout!=null&&AlphaTab.Environment.LayoutEngines.hasOwnProperty(this.Settings.Layout.Mode)?AlphaTab.Environment.LayoutEngines[this.Settings.Layout.Mode](this):AlphaTab.Environment.LayoutEngines["default"](this),this._currentLayoutMode=this.Settings.Layout.Mode,!0):!1},Render:function(n){this.Score=n.Score;this.Tracks=[n];this.Invalidate()},RenderMultiple:function(n){var t,i;for(this.Score=n.length==0?null:n[0].Score,this.Tracks=n,AlphaTab.Util.Logger.Info("Rendering","Rendering "+n.length+" tracks"),t=0;t<n.length;t++)i=n[t],AlphaTab.Util.Logger.Info("Rendering","Track "+t+": "+i.Name);this.Invalidate()},UpdateSettings:function(n){this.Settings=n},Invalidate:function(){if(this.Settings.Width==0){AlphaTab.Util.Logger.Warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)");return}(this.BoundsLookup=new AlphaTab.Rendering.Utils.BoundsLookup,this.Tracks.length!=0)&&(this.RenderingResources.Scale!=this.Settings.Scale&&(this.RenderingResources.Init(this.Settings.Scale),this.Canvas.set_LineWidth(this.Settings.Scale)),this.Canvas.set_Resources(this.RenderingResources),this.OnPreRender(),this.RecreateLayout(),this.LayoutAndRender(),AlphaTab.Util.Logger.Info("Rendering","Rendering finished"))},Resize:function(n){this.RecreateLayout()?(AlphaTab.Util.Logger.Info("Rendering","Starting full rerendering due to layout change"),this.Invalidate()):this.Layout.get_SupportsResize()?(AlphaTab.Util.Logger.Info("Rendering","Starting optimized rerendering for resize"),this.BoundsLookup=new AlphaTab.Rendering.Utils.BoundsLookup,this.OnPreRender(),this.Settings.Width=n,this.Layout.Resize(),this.Layout.RenderAnnotation(),this.OnRenderFinished(),this.OnPostRender()):AlphaTab.Util.Logger.Warning("Rendering","Current layout does not support dynamic resizing, nothing was done");AlphaTab.Util.Logger.Info("Rendering","Resize finished")},LayoutAndRender:function(){AlphaTab.Util.Logger.Info("Rendering","Rendering at scale "+this.Settings.Scale+" with layout "+this.Layout.get_Name());this.Layout.LayoutAndRender();this.Layout.RenderAnnotation();this.OnRenderFinished();this.OnPostRender()},add_PreRender:function(n){this.PreRender=$CombineDelegates(this.PreRender,n)},remove_PreRender:function(n){this.PreRender=$RemoveDelegate(this.PreRender,n)},OnPreRender:function(){var i=this.Canvas.OnPreRender(),t=this.PreRender,n=new AlphaTab.Rendering.RenderFinishedEventArgs;n.TotalWidth=0;n.TotalHeight=0;n.Width=0;n.Height=0;n.RenderResult=i;t!=null&&t(n)},add_PartialRenderFinished:function(n){this.PartialRenderFinished=$CombineDelegates(this.PartialRenderFinished,n)},remove_PartialRenderFinished:function(n){this.PartialRenderFinished=$RemoveDelegate(this.PartialRenderFinished,n)},OnPartialRenderFinished:function(n){var t=this.PartialRenderFinished;t!=null&&t(n)},add_RenderFinished:function(n){this.RenderFinished=$CombineDelegates(this.RenderFinished,n)},remove_RenderFinished:function(n){this.RenderFinished=$RemoveDelegate(this.RenderFinished,n)},OnRenderFinished:function(){var t=this.Canvas.OnRenderFinished(),n=this.RenderFinished;n!=null&&n(function(){var n=new AlphaTab.Rendering.RenderFinishedEventArgs;return n.RenderResult=t,n.TotalHeight=this.Layout.Height,n.TotalWidth=this.Layout.Width,n}.call(this))},add_PostRenderFinished:function(n){this.PostRenderFinished=$CombineDelegates(this.PostRenderFinished,n)},remove_PostRenderFinished:function(n){this.PostRenderFinished=$RemoveDelegate(this.PostRenderFinished,n)},OnPostRender:function(){var n=this.PostRenderFinished;n!=null&&n()}},AlphaTab.Rendering.Staves=AlphaTab.Rendering.Staves||{},AlphaTab.Rendering.Staves.BarLayoutingInfo=function(){this._timeSortedSprings=null;this._xMin=0;this._onTimePositionsForce=0;this._onTimePositions=null;this.Version=0;this.PreBeatSizes=null;this.OnBeatSizes=null;this.PreBeatSize=0;this.PostBeatSize=0;this.VoiceSize=0;this.MinStretchForce=0;this.TotalSpringConstant=0;this.Springs=null;this.SmallestDuration=0;this.PreBeatSizes={};this.OnBeatSizes={};this.VoiceSize=0;this.Springs={};this.Version=0},AlphaTab.Rendering.Staves.BarLayoutingInfo.prototype={UpdateVoiceSize:function(n){n>this.VoiceSize&&(this.VoiceSize=n,this.Version++)},SetPreBeatSize:function(n,t){(!this.PreBeatSizes.hasOwnProperty(n.Index)||this.PreBeatSizes[n.Index]<t)&&(this.PreBeatSizes[n.Index]=t,this.Version++)},GetPreBeatSize:function(n){return this.PreBeatSizes.hasOwnProperty(n.Index)?this.PreBeatSizes[n.Index]:0},SetOnBeatSize:function(n,t){(!this.OnBeatSizes.hasOwnProperty(n.Index)||this.OnBeatSizes[n.Index]<t)&&(this.OnBeatSizes[n.Index]=t,this.Version++)},GetOnBeatSize:function(n){return this.OnBeatSizes.hasOwnProperty(n.Index)?this.OnBeatSizes[n.Index]:0},UpdateMinStretchForce:function(n){this.MinStretchForce<n&&(this.MinStretchForce=n,this.Version++)},AddSpring:function(n,t,i,r){this.Version++;var u;return this.Springs.hasOwnProperty(n)?(u=this.Springs[n],u.SpringWidth<i&&(u.SpringWidth=i),u.PreSpringWidth<r&&(u.PreSpringWidth=r),t<u.SmallestDuration&&(u.SmallestDuration=t),t>u.LongestDuration&&(u.LongestDuration=t)):(u=new AlphaTab.Rendering.Staves.Spring,u.TimePosition=n,u.SmallestDuration=t,u.LongestDuration=t,u.SpringWidth=i,u.PreSpringWidth=r,this.Springs[n]=u),t<this.SmallestDuration&&(this.SmallestDuration=t),u},AddBeatSpring:function(n,t,i){return this.AddSpring(n.get_AbsoluteStart(),n.CalculateDuration(),t,i)},Finish:function(){this.CalculateSpringConstants();this.Version++},CalculateSpringConstants:function(){var t=this._timeSortedSprings=[],u,o,r,f,i,e,s,n,h;this._xMin=0;u=this.Springs;for(o in u)r=u[o],t.push(r),r.SpringWidth<this._xMin&&(this._xMin=r.SpringWidth);for(t.sort($CreateAnonymousDelegate(this,function(n,t){return n.TimePosition<t.TimePosition?-1:n.TimePosition>t.TimePosition?1:0})),f=0,n=0;n<t.length;n++)i=t[n],n==t.length-1?e=i.LongestDuration:(s=t[n+1],e=s.TimePosition-i.TimePosition),i.SpringConstant=this.CalculateSpringConstant(i,e),f+=1/i.SpringConstant;for(this.TotalSpringConstant=1/f,n=0;n<t.length;n++)h=t[n].SpringWidth*t[n].SpringConstant,this.UpdateMinStretchForce(h)},CalculateSpringConstant:function(n,t){var i=n.SmallestDuration,r;return n.SmallestDuration==0&&(i=t),r=1+.6*Math.log2(t/30),i/t*1/(r*10)},SpaceToForce:function(n){return n*this.TotalSpringConstant},CalculateVoiceWidth:function(n){return this.CalculateWidth(n,this.TotalSpringConstant)},CalculateWidth:function(n,t){return n/t},BuildOnTimePositions:function(n){var r,t,u,i;if(Math.abs(this._onTimePositionsForce-n)<1e-5&&this._onTimePositions!=null)return this._onTimePositions;if(this._onTimePositionsForce=n,r=this._onTimePositions={},t=this._timeSortedSprings,t.length==0)return r;for(u=t[0].PreSpringWidth,i=0;i<t.length;i++)r[t[i].TimePosition]=u,u+=this.CalculateWidth(n,t[i].SpringConstant);return r}},$StaticConstructor(function(){AlphaTab.Rendering.Staves.BarLayoutingInfo.MinDuration=30;AlphaTab.Rendering.Staves.BarLayoutingInfo.MinDurationWidth=10}),AlphaTab.Rendering.Staves.Spring=function(){this.TimePosition=0;this.LongestDuration=0;this.SmallestDuration=0;this.Force=0;this.SpringConstant=0;this.SpringWidth=0;this.PreSpringWidth=0},AlphaTab.Rendering.Staves.MasterBarsRenderers=function(){this.Width=0;this.IsLinkedToPrevious=!1;this.MasterBar=null;this.Renderers=null;this.LayoutingInfo=null;this.Renderers=[]},AlphaTab.Rendering.Staves.Staff=function(n,t,i,r){this._factory=null;this._settings=null;this.StaveTrackGroup=null;this.StaveGroup=null;this.BarRenderers=null;this.X=0;this.Y=0;this.Height=0;this.Index=0;this.StaffIndex=0;this.TrackIndex=0;this.ModelStaff=null;this.StaveTop=0;this.TopSpacing=0;this.BottomSpacing=0;this.StaveBottom=0;this.IsFirstInAccolade=!1;this.IsLastInAccolade=!1;this.BarRenderers=[];this.TrackIndex=n;this.ModelStaff=t;this._factory=i;this._settings=r;this.TopSpacing=15;this.BottomSpacing=5;this.StaveTop=0;this.StaveBottom=0},AlphaTab.Rendering.Staves.Staff.prototype={get_StaveId:function(){return this._factory.get_StaffId()},GetSetting:function(n,t){return this._settings.hasOwnProperty(n)?this._settings[n]:t},get_IsInAccolade:function(){return this._factory.IsInAccolade},RegisterStaffTop:function(n){this.StaveTop=n},RegisterStaffBottom:function(n){this.StaveBottom=n},AddBarRenderer:function(n){n.Staff=this;n.Index=this.BarRenderers.length;n.ReLayout();this.BarRenderers.push(n);this.StaveGroup.Layout.RegisterBarRenderer(this.get_StaveId(),n)},AddBar:function(n,t){var i;i=n==null?new AlphaTab.Rendering.BarRendererBase(this.StaveGroup.Layout.Renderer,n):this._factory.Create(this.StaveGroup.Layout.Renderer,n,this._settings);i.Staff=this;i.Index=this.BarRenderers.length;i.LayoutingInfo=t;i.DoLayout();i.RegisterLayoutingInfo();this.BarRenderers.push(i);n!=null&&this.StaveGroup.Layout.RegisterBarRenderer(this.get_StaveId(),i)},RevertLastBar:function(){var n=this.BarRenderers[this.BarRenderers.length-1];this.BarRenderers.splice(this.BarRenderers.length-1,1);this.StaveGroup.Layout.UnregisterBarRenderer(this.get_StaveId(),n)},ScaleToWidth:function(n){for(var i=n-this.StaveGroup.Width,r=i/this.BarRenderers.length,t=0,u=this.BarRenderers.length;t<u;t++)this.BarRenderers[t].ScaleToWidth(this.BarRenderers[t].Width+r)},get_TopOverflow:function(){for(var i,n=0,t=0,r=this.BarRenderers.length;t<r;t++)i=this.BarRenderers[t],i.TopOverflow>n&&(n=i.TopOverflow);return n},get_BottomOverflow:function(){for(var i,n=0,t=0,r=this.BarRenderers.length;t<r;t++)i=this.BarRenderers[t],i.BottomOverflow>n&&(n=i.BottomOverflow);return n},FinalizeStave:function(){var i=0,t,r,n;for(this.Height=0,t=this.get_TopOverflow(),r=this.get_BottomOverflow(),n=0;n<this.BarRenderers.length;n++)this.BarRenderers[n].X=i,this.BarRenderers[n].Y=this.TopSpacing+t,this.Height=Math.max(this.Height,this.BarRenderers[n].Height),this.BarRenderers[n].FinalizeRenderer(),i+=this.BarRenderers[n].Width;this.Height>0&&(this.Height+=this.TopSpacing+t+r+this.BottomSpacing)},Paint:function(n,t,i,r,u){if(this.Height!=0&&u!=0)for(var f=r,e=Math.min(r+u,this.BarRenderers.length);f<e;f++)this.BarRenderers[f].Paint(n+this.X,t+this.Y,i)}},AlphaTab.Rendering.Staves.StaveTrackGroup=function(n,t){this.Track=null;this.StaveGroup=null;this.Staves=null;this.FirstStaffInAccolade=null;this.LastStaffInAccolade=null;this.StaveGroup=n;this.Track=t;this.Staves=[]},AlphaTab.Rendering.Staves.StaveGroup=function(){this._allStaves=null;this._firstStaffInAccolade=null;this._lastStaffInAccolade=null;this._accoladeSpacingCalculated=!1;this.X=0;this.Y=0;this.Index=0;this.AccoladeSpacing=0;this.IsFull=!1;this.Width=0;this.IsLast=!1;this.MasterBarsRenderers=null;this.Staves=null;this.Layout=null;this.MasterBarsRenderers=[];this.Staves=[];this._allStaves=[];this.Width=0;this.Index=0;this._accoladeSpacingCalculated=!1;this.AccoladeSpacing=0},AlphaTab.Rendering.Staves.StaveGroup.prototype={get_FirstBarIndex:function(){return this.MasterBarsRenderers[0].MasterBar.Index},get_LastBarIndex:function(){return this.MasterBarsRenderers[this.MasterBarsRenderers.length-1].MasterBar.Index},AddMasterBarRenderers:function(n,t){var f,i,e,u,r,o,s,h;if(n.length==0)return null;for(this.MasterBarsRenderers.push(t),this.CalculateAccoladeSpacing(n),t.LayoutingInfo.PreBeatSize=0,f=0,i=0,e=this.Staves.length;i<e;i++)for(u=this.Staves[i],r=0,o=u.Staves.length;r<o;r++)s=u.Staves[r],h=t.Renderers[f++],s.AddBarRenderer(h);return this.UpdateWidth(),t},AddBars:function(n,t){var i,e,c;if(n.length==0)return null;i=new AlphaTab.Rendering.Staves.MasterBarsRenderers;i.LayoutingInfo=new AlphaTab.Rendering.Staves.BarLayoutingInfo;i.MasterBar=n[0].Score.MasterBars[t];this.MasterBarsRenderers.push(i);this.CalculateAccoladeSpacing(n);e=i.LayoutingInfo;for(var u=0,o=this.Staves,l=o.length,s=o[u];u<l;u++,s=o[u])for(var f=0,h=s.Staves,a=h.length,r=h[f];f<a;f++,r=h[f])r.AddBar(s.Track.Staves[r.ModelStaff.Index].Bars[t],e),c=r.BarRenderers[r.BarRenderers.length-1],i.Renderers.push(c),c.IsLinkedToPrevious&&(i.IsLinkedToPrevious=!0);return e.Finish(),i.Width=this.UpdateWidth(),i},RevertLastBar:function(){var n,t,r,i;if(this.MasterBarsRenderers.length>1){for(this.MasterBarsRenderers.splice(this.MasterBarsRenderers.length-1,1),n=0,t=0,r=this._allStaves.length;t<r;t++)i=this._allStaves[t],n=Math.max(n,i.BarRenderers[i.BarRenderers.length-1].Width),i.RevertLastBar();this.Width-=n}},UpdateWidth:function(){for(var n,t=0,i=0,r=this._allStaves.length;i<r;i++)n=this._allStaves[i],n.BarRenderers[n.BarRenderers.length-1].ApplyLayoutingInfo(),n.BarRenderers[n.BarRenderers.length-1].Width>t&&(t=n.BarRenderers[n.BarRenderers.length-1].Width);return this.Width+=t,t},CalculateAccoladeSpacing:function(n){var i,r,t;if(!this._accoladeSpacingCalculated&&this.Index==0){for(this._accoladeSpacingCalculated=!0,i=this.Layout.Renderer.Canvas,r=this.Layout.Renderer.RenderingResources.EffectFont,i.set_Font(r),t=0;t<n.length;t++)this.AccoladeSpacing=Math.max(this.AccoladeSpacing,i.MeasureText(n[t].ShortName));this.AccoladeSpacing+=20;this.Width+=this.AccoladeSpacing}},GetStaveTrackGroup:function(n){for(var i,t=0,r=this.Staves.length;t<r;t++)if(i=this.Staves[t],i.Track==n)return i;return null},AddStaff:function(n,t){var i=this.GetStaveTrackGroup(n);i==null&&(i=new AlphaTab.Rendering.Staves.StaveTrackGroup(this,n),this.Staves.push(i));t.StaveTrackGroup=i;t.StaveGroup=this;t.Index=this._allStaves.length;this._allStaves.push(t);i.Staves.push(t);t.get_IsInAccolade()&&(this._firstStaffInAccolade==null&&(this._firstStaffInAccolade=t,t.IsFirstInAccolade=!0),i.FirstStaffInAccolade==null&&(i.FirstStaffInAccolade=t),this._lastStaffInAccolade==null&&(this._lastStaffInAccolade=t,t.IsLastInAccolade=!0),this._lastStaffInAccolade!=null&&(this._lastStaffInAccolade.IsLastInAccolade=!1),this._lastStaffInAccolade=t,this._lastStaffInAccolade.IsLastInAccolade=!0,i.LastStaffInAccolade=t)},get_Height:function(){return this._allStaves[this._allStaves.length-1].Y+this._allStaves[this._allStaves.length-1].Height},ScaleToWidth:function(n){for(var t=0,i=this._allStaves.length;t<i;t++)this._allStaves[t].ScaleToWidth(n);this.Width=n},Paint:function(n,t,i){this.PaintPartial(n+this.X,t+this.Y,i,0,this.MasterBarsRenderers.length)},PaintPartial:function(n,t,i,r,u){var v,h,a,e,o,p;for(this.BuildBoundingsLookup(n,t),h=0,a=this._allStaves.length;h<a;h++)this._allStaves[h].Paint(n,t,i,r,u);if(v=this.Layout.Renderer.RenderingResources,this.Staves.length>0&&r==0){if(this._firstStaffInAccolade!=null&&this._lastStaffInAccolade!=null){var y=t+this._firstStaffInAccolade.Y+this._firstStaffInAccolade.StaveTop+this._firstStaffInAccolade.TopSpacing+this._firstStaffInAccolade.get_TopOverflow(),w=t+this._lastStaffInAccolade.Y+this._lastStaffInAccolade.TopSpacing+this._lastStaffInAccolade.get_TopOverflow()+this._lastStaffInAccolade.StaveBottom,c=n+this._firstStaffInAccolade.X;i.set_Color(v.BarSeperatorColor);i.BeginPath();i.MoveTo(c,y);i.LineTo(c,w);i.Stroke()}for(i.set_Font(v.EffectFont),h=0,a=this.Staves.length;h<a;h++)if(e=this.Staves[h],e.FirstStaffInAccolade!=null&&e.LastStaffInAccolade!=null){var y=t+e.FirstStaffInAccolade.Y+e.FirstStaffInAccolade.StaveTop+e.FirstStaffInAccolade.TopSpacing+e.FirstStaffInAccolade.get_TopOverflow(),w=t+e.LastStaffInAccolade.Y+e.LastStaffInAccolade.TopSpacing+e.LastStaffInAccolade.get_TopOverflow()+e.LastStaffInAccolade.StaveBottom,c=n+e.FirstStaffInAccolade.X,f=3*this.Layout.Renderer.Settings.Scale,b=f,s=y-f*4,l=w+f*4;this.Index==0&&i.FillText(e.Track.ShortName,n+10*this.Layout.get_Scale(),y);i.FillRect(c-b-f,s,f,l-s);o=c-b-f;p=c+f*2;i.BeginPath();i.MoveTo(o,s);i.BezierCurveTo(o,s,o,s,p,s-f);i.BezierCurveTo(c,s+f,o,s+f,o,s+f);i.ClosePath();i.Fill();i.BeginPath();i.MoveTo(o,l);i.BezierCurveTo(o,l,c,l,p,l+f);i.BezierCurveTo(c,l-f,o,l-f,o,l-f);i.ClosePath();i.Fill()}}},FinalizeGroup:function(){for(var r=0,t=0,i=this._allStaves,u=i.length,n=i[t];t<u;t++,n=i[t])n.X=this.AccoladeSpacing,n.Y=r,n.FinalizeStave(),r+=n.Height},BuildBoundingsLookup:function(n,t){var s,r,f,l,i,u;if(!this.Layout.Renderer.BoundsLookup.IsFinished&&this._firstStaffInAccolade!=null&&this._lastStaffInAccolade!=null){var h=t+this.Y+this._firstStaffInAccolade.Y,a=t+this.Y+this._lastStaffInAccolade.Y+this._lastStaffInAccolade.Height,c=t+this.Y+this._allStaves[0].Y,v=t+this.Y+this._allStaves[this._allStaves.length-1].Y+this._allStaves[this._allStaves.length-1].Height,y=a-h,p=v-c,e=this.X+this._firstStaffInAccolade.X,o=new AlphaTab.Rendering.Utils.StaveGroupBounds;for(o.VisualBounds={X:n,Y:t+this.Y,W:this.Width,H:this.get_Height()},o.RealBounds={X:n,Y:t+this.Y,W:this.Width,H:this.get_Height()},this.Layout.Renderer.BoundsLookup.AddStaveGroup(o),s=[],r=0;r<this.Staves.length;r++)for(f=0,l=this.Staves[r].FirstStaffInAccolade.BarRenderers.length;f<l;f++)i=this.Staves[r].FirstStaffInAccolade.BarRenderers[f],r==0&&(u=new AlphaTab.Rendering.Utils.MasterBarBounds,u.IsFirstOfLine=i.get_IsFirstOfLine(),u.RealBounds={X:e+i.X,Y:c,W:i.Width,H:p},u.VisualBounds={X:e+i.X,Y:h,W:i.Width,H:y},this.Layout.Renderer.BoundsLookup.AddMasterBar(u),s.push(u)),i.BuildBoundingsLookup(s[f],e,t+this.Y+this._firstStaffInAccolade.Y)}},GetBarX:function(n){if(this._firstStaffInAccolade==null||this.Layout.Renderer.Tracks.length==0)return 0;var t=this.Layout.Renderer.Tracks[0].Staves[0].Bars[n],i=this.Layout.GetRendererForBar(this._firstStaffInAccolade.get_StaveId(),t);return i.X}},$StaticConstructor(function(){AlphaTab.Rendering.Staves.StaveGroup.AccoladeLabelSpacing=10}),AlphaTab.Rendering.TabBarRenderer=function(n,t){this.RenderRhythm=!1;this.RhythmHeight=0;this.RhythmBeams=!1;AlphaTab.Rendering.BarRendererBase.call(this,n,t);this.RhythmHeight=15*n.Layout.get_Scale()},AlphaTab.Rendering.TabBarRenderer.prototype={get_LineOffset:function(){return 11*this.get_Scale()},GetNoteX:function(n,t){var i=this.GetOnNotesGlyphForBeat(n.Beat);return i!=null?i.Container.X+i.Container.VoiceContainer.X+i.X+i.NoteNumbers.GetNoteX(n,t):0},GetNoteY:function(n){var t=this.GetOnNotesGlyphForBeat(n.Beat);return t!=null?t.NoteNumbers.GetNoteY(n):0},UpdateSizes:function(){var t=this.get_Resources(),n=t.TablatureFont.Size/2+t.TablatureFont.Size*.2;this.TopPadding=n;this.BottomPadding=n;this.Height=this.get_LineOffset()*(this.Bar.Staff.Track.Tuning.length-1)+n*2;this.RenderRhythm&&(this.Height+=this.RhythmHeight,this.BottomPadding+=this.RhythmHeight);AlphaTab.Rendering.BarRendererBase.prototype.UpdateSizes.call(this)},CreatePreBeatGlyphs:function(){if(AlphaTab.Rendering.BarRendererBase.prototype.CreatePreBeatGlyphs.call(this),this.Bar.get_MasterBar().IsRepeatStart&&this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatOpenGlyph(0,0,1.5,3)),this.get_IsFirstOfLine()){var n=(this.Bar.Staff.Track.Tuning.length+1)/2;this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.TabClefGlyph(5*this.get_Scale(),this.GetTabY(n,0)))}this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.BarNumberGlyph(0,this.GetTabY(-.5,0),this.Bar.Index+1));this.Bar.get_IsEmpty()&&this.AddPreBeatGlyph(new AlphaTab.Rendering.Glyphs.SpacingGlyph(0,0,30*this.get_Scale()))},CreateBeatGlyphs:function(){for(var t,n=0;n<this.Bar.Voices.length;n++)t=this.Bar.Voices[n],this.HasVoiceContainer(t)&&this.CreateVoiceGlyphs(this.Bar.Voices[n])},CreateVoiceGlyphs:function(n){for(var u,i,t=0,r=n.Beats.length;t<r;t++)u=n.Beats[t],i=new AlphaTab.Rendering.Glyphs.TabBeatContainerGlyph(u,this.GetOrCreateVoiceContainer(n)),i.PreNotes=new AlphaTab.Rendering.Glyphs.TabBeatPreNotesGlyph,i.OnNotes=new AlphaTab.Rendering.Glyphs.TabBeatGlyph,this.AddBeatGlyph(i)},CreatePostBeatGlyphs:function(){AlphaTab.Rendering.BarRendererBase.prototype.CreatePostBeatGlyphs.call(this);this.Bar.get_MasterBar().get_IsRepeatEnd()?(this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatCloseGlyph(this.X,0)),this.Bar.get_MasterBar().RepeatCount>2&&this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.RepeatCountGlyph(0,this.GetTabY(-.5,-3),this.Bar.get_MasterBar().RepeatCount))):this.Bar.NextBar!=null&&this.Bar.NextBar.get_MasterBar().IsRepeatStart||this.AddPostBeatGlyph(new AlphaTab.Rendering.Glyphs.BarSeperatorGlyph(0,0))},GetTabY:function(n,t){return this.get_LineOffset()*n+t*this.get_Scale()},PaintBackground:function(n,t,i){var v,b,g,f,nt,it,rt,r,s,o;AlphaTab.Rendering.BarRendererBase.prototype.PaintBackground.call(this,n,t,i);v=this.get_Resources();i.set_Color(v.StaveLineColor);var y=t+this.Y+this.TopPadding,ut=this.get_Scale(),u=[];for(r=0,s=this.Bar.Staff.Track.Tuning.length;r<s;r++)u.push([]);for(var h=0,p=this.Bar.Voices,ft=p.length,w=p[h];h<ft;h++,w=p[h])if(this.HasVoiceContainer(w)){b=this.GetOrCreateVoiceContainer(w);for(var c=0,k=b.BeatGlyphs,et=k.length,d=k[c];c<et;c++,d=k[c])if(g=d.OnNotes,f=g.NoteNumbers,f!=null)for(nt in f.NotesPerString)it=f.NotesPerString[nt],it.IsEmpty||u[this.Bar.Staff.Track.Tuning.length-nt].push(new Float32Array([b.X+d.X+g.X+f.X,f.Width+ut]))}for(var l=0,ot=u.length,e=u[l];l<ot;l++,e=u[l])e.sort($CreateAnonymousDelegate(this,function(n,t){return n[0]>t[0]?1:n[0]<t[0]?-1:0}));for(rt=this.get_LineOffset(),r=0,s=this.Bar.Staff.Track.Tuning.length;r<s;r++){r>0&&(y+=rt);o=0;for(var a=0,tt=u[r],st=tt.length,e=tt[a];a<st;a++,e=tt[a])i.FillRect(n+this.X+o,y|0,e[0]-o,this.get_Scale()),o=e[0]+e[1];i.FillRect(n+this.X+o,y|0,this.Width-o,this.get_Scale())}i.set_Color(v.MainGlyphColor)},Paint:function(n,t,i){AlphaTab.Rendering.BarRendererBase.prototype.Paint.call(this,n,t,i);this.RenderRhythm&&this.PaintBeams(n,t,i)},PaintBeams:function(n,t,i){for(var f,u,o,s,r=0,e=this.Helpers.BeamHelpers.length;r<e;r++)for(f=this.Helpers.BeamHelpers[r],u=0,o=f.length;u<o;u++)s=f[u],this.PaintBeamHelper(n+this.get_BeatGlyphsStart(),t,i,s)},PaintBeamHelper:function(n,t,i,r){i.set_Color(r.Voice.Index==0?this.get_Resources().MainGlyphColor:this.get_Resources().SecondaryGlyphColor);r.Beats.length==1||this.RhythmBeams?this.PaintFooter(n,t,i,r):this.PaintBar(n,t,i,r)},PaintBar:function(n,t,i,r){for(var o,h,s,e,l,a,c,b,u=0,k=r.Beats.length;u<k;u++)if(o=r.Beats[u],r.HasBeatLineX(o)){var f=r.GetBeatLineX(o),d=t+this.Y,nt=t+this.Y+this.Height,v=this.GetOnNotesGlyphForBeat(o);d+=v.NoteNumbers==null?this.Height-this.RhythmHeight:v.NoteNumbers.GetNoteY(v.NoteNumbers.MinStringNote)+this.get_LineOffset()/2;r.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?f-=v.Width/2:f+=v.Width/2;i.BeginPath();i.MoveTo(n+this.X+f,d);i.LineTo(n+this.X+f,nt);i.Stroke();var y=6*this.get_Scale(),p=6*this.get_Scale(),w=3*this.get_Scale(),tt=AlphaTab.Model.ModelUtils.GetIndex(o.Duration)-2,g=t+this.Y;for(p=-p,g+=this.Height,h=0;h<tt;h++)if(c=g+h*p,r.Beats.length==1)s=f,e=f+y,l=c,a=c,AlphaTab.Rendering.TabBarRenderer.PaintSingleBar(i,n+this.X+s,l,n+this.X+e,a,w);else if(u<r.Beats.length-1){if(AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(o,r.Beats[u+1],h))s=f,e=r.GetBeatLineX(r.Beats[u+1])+this.get_Scale(),b=this.GetOnNotesGlyphForBeat(r.Beats[u+1]),r.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?e-=b.Width/2:e+=b.Width/2;else if(u!=0&&AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(r.Beats[u-1],o,h))continue;else s=f,e=s+y;l=c;a=c;AlphaTab.Rendering.TabBarRenderer.PaintSingleBar(i,n+this.X+s,l,n+this.X+e,a,w)}else u>0&&!AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin(o,r.Beats[u-1],h)&&(s=f-y,e=f,l=c,a=c,AlphaTab.Rendering.TabBarRenderer.PaintSingleBar(i,n+this.X+s,l,n+this.X+e,a,w))}},PaintFooter:function(n,t,i,r){for(var s,o=0,h=r.Beats,a=h.length,u=h[o];o<a;o++,u=h[o])if(u.Duration!=AlphaTab.Model.Duration.Whole&&u.Duration!=AlphaTab.Model.Duration.DoubleWhole){var f=r.GetBeatLineX(u),c=t+this.Y,l=t+this.Y+this.Height,e=this.GetOnNotesGlyphForBeat(u);c+=e.NoteNumbers==null?this.Height-this.RhythmHeight:e.NoteNumbers.GetNoteY(e.NoteNumbers.MinStringNote)+this.get_LineOffset()/2;r.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?f-=e.Width/2:f+=e.Width/2;i.BeginPath();i.MoveTo(n+this.X+f,c);i.LineTo(n+this.X+f,l);i.Stroke();s=new AlphaTab.Rendering.Glyphs.BeamGlyph(0,0,u.Duration,AlphaTab.Rendering.Utils.BeamDirection.Down,!1);s.Renderer=this;s.DoLayout();s.Paint(n+this.X+f,l,i)}}},$StaticConstructor(function(){AlphaTab.Rendering.TabBarRenderer.StaffId="tab";AlphaTab.Rendering.TabBarRenderer.LineSpacing=10}),AlphaTab.Rendering.TabBarRenderer.PaintSingleBar=function(n,t,i,r,u,f){n.BeginPath();n.MoveTo(t,i);n.LineTo(r,u);n.LineTo(r,u-f);n.LineTo(t,i-f);n.ClosePath();n.Fill()},$Inherit(AlphaTab.Rendering.TabBarRenderer,AlphaTab.Rendering.BarRendererBase),AlphaTab.Rendering.TabBarRendererFactory=function(){AlphaTab.Rendering.BarRendererFactory.call(this);this.HideOnPercussionTrack=!0},AlphaTab.Rendering.TabBarRendererFactory.prototype={get_StaffId:function(){return"tab"},CanCreate:function(n,t){return n.Tuning.length>0&&AlphaTab.Rendering.BarRendererFactory.prototype.CanCreate.call(this,n,t)},Create:function(n,t,i){var r=new AlphaTab.Rendering.TabBarRenderer(n,t);return i.hasOwnProperty("rhythm")&&(r.RenderRhythm=i.rhythm),i.hasOwnProperty("rhythm-height")&&(r.RhythmHeight=i["rhythm-height"]),i.hasOwnProperty("rhythm-beams")&&(r.RhythmBeams=i["rhythm-beams"]),r}},$Inherit(AlphaTab.Rendering.TabBarRendererFactory,AlphaTab.Rendering.BarRendererFactory),AlphaTab.Rendering.Utils.AccidentalHelper=function(){this._registeredAccidentals=null;this._appliedScoreLines=null;this._registeredAccidentals={};this._appliedScoreLines={}},AlphaTab.Rendering.Utils.AccidentalHelper.prototype={ApplyAccidental:function(n){var h=n.get_RealValue(),c=n.Beat.Voice.Bar.get_MasterBar().KeySignature,u=c+7,f=h%12,i=AlphaTab.Model.AccidentalType.None,r=this.RegisterNoteLine(n);if(!n.Beat.Voice.Bar.Staff.Track.IsPercussion){var e=u<7?AlphaTab.Model.AccidentalType.Flat:AlphaTab.Model.AccidentalType.Sharp,o=AlphaTab.Rendering.Utils.AccidentalHelper.KeySignatureLookup[u][f],t=AlphaTab.Rendering.Utils.AccidentalHelper.AccidentalNotes[f],s=this._registeredAccidentals.hasOwnProperty(r);o==t||s?o==t&&s&&(delete this._registeredAccidentals[r],i=t?e:AlphaTab.Model.AccidentalType.Natural):(this._registeredAccidentals[r]=!0,i=t?e:AlphaTab.Model.AccidentalType.Natural)}return i},RegisterNoteLine:function(n){var r=n.Beat.Voice.Bar.Staff.Track.IsPercussion?AlphaTab.Rendering.Utils.PercussionMapper.MapNoteForDisplay(n):n.get_RealValue(),u=n.Beat.Voice.Bar.get_MasterBar().KeySignature,o=n.Beat.Voice.Bar.Clef,f=r%12,s=r/12|0,t=AlphaTab.Rendering.Utils.AccidentalHelper.OctaveSteps[o],i,e;t-=s*7;i=AlphaTab.Model.ModelUtils.KeySignatureIsSharp(u)||AlphaTab.Model.ModelUtils.KeySignatureIsNatural(u)?AlphaTab.Rendering.Utils.AccidentalHelper.SharpNoteSteps:AlphaTab.Rendering.Utils.AccidentalHelper.FlatNoteSteps;e=0;switch(n.AccidentalMode){case AlphaTab.Model.NoteAccidentalMode.Default:case AlphaTab.Model.NoteAccidentalMode.SwapAccidentals:case AlphaTab.Model.NoteAccidentalMode.ForceNatural:case AlphaTab.Model.NoteAccidentalMode.ForceFlat:case AlphaTab.Model.NoteAccidentalMode.ForceSharp:default:e=i[f]}return t-=i[f],this._appliedScoreLines[n.Id]=t,t},GetNoteLine:function(n){return this._appliedScoreLines[n.Id]}},$StaticConstructor(function(){AlphaTab.Rendering.Utils.AccidentalHelper.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];AlphaTab.Rendering.Utils.AccidentalHelper.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];AlphaTab.Rendering.Utils.AccidentalHelper.StepsPerOctave=7;AlphaTab.Rendering.Utils.AccidentalHelper.OctaveSteps=new Int32Array([40,34,32,28,40]);AlphaTab.Rendering.Utils.AccidentalHelper.SharpNoteSteps=new Int32Array([0,0,1,1,2,3,3,4,4,5,5,6]);AlphaTab.Rendering.Utils.AccidentalHelper.FlatNoteSteps=new Int32Array([0,1,1,2,2,3,4,4,5,5,6,6])}),AlphaTab.Rendering.Utils.BarHelpers=function(n){var t,i,e,h,u,o,c,r,s,f;if(this.BeamHelpers=null,this.BeamHelperLookup=null,this.TupletHelpers=null,this.BeamHelpers=[],this.BeamHelperLookup=[],this.TupletHelpers=[],t=null,i=null,n!=null)for(e=0,h=n.Voices.length;e<h;e++){for(u=n.Voices[e],this.BeamHelpers.push([]),this.BeamHelperLookup.push({}),this.TupletHelpers.push([]),o=0,c=u.Beats.length;o<c;o++)r=u.Beats[o],s=!1,r.get_IsRest()||t!=null&&t.CheckBeat(r)||(t!=null?(t.Finish(),s=t.Beats.length>1):s=!0,t=new AlphaTab.Rendering.Utils.BeamingHelper(n.Staff.Track),t.CheckBeat(r),this.BeamHelpers[u.Index].push(t)),r.get_HasTuplet()&&(f=r.PreviousBeat,f!=null&&f.Voice!=r.Voice&&(f=null),s&&i!=null&&i.Finish(),f!=null&&i!=null&&i.Check(r)||(i=new AlphaTab.Rendering.Utils.TupletHelper(u.Index),i.Check(r),this.TupletHelpers[u.Index].push(i))),this.BeamHelperLookup[u.Index][r.Index]=t;t!=null&&t.Finish();i!=null&&i.Finish();t=null;i=null}},AlphaTab.Rendering.Utils.BeamDirection={Up:0,Down:1},AlphaTab.Rendering.Utils.BeamBarType={Full:0,PartLeft:1,PartRight:2},AlphaTab.Rendering.Utils.BeatLinePositions=function(n,t,i){this.StaffId=null;this.Up=0;this.Down=0;this.StaffId=n;this.Up=t;this.Down=i},AlphaTab.Rendering.Utils.BeamingHelper=function(n){this._lastBeat=null;this._track=null;this._beatLineXPositions=null;this.Voice=null;this.Beats=null;this.ShortestDuration=AlphaTab.Model.Duration.QuadrupleWhole;this.FingeringCount=0;this.HasTuplet=!1;this.FirstMinNote=null;this.FirstMaxNote=null;this.LastMinNote=null;this.LastMaxNote=null;this.MinNote=null;this.MaxNote=null;this.InvertBeamDirection=!1;this.Direction=AlphaTab.Rendering.Utils.BeamDirection.Up;this._track=n;this.Beats=[];this._beatLineXPositions={};this.ShortestDuration=AlphaTab.Model.Duration.QuadrupleWhole},AlphaTab.Rendering.Utils.BeamingHelper.prototype={GetValue:function(n){return this._track.IsPercussion?AlphaTab.Rendering.Utils.PercussionMapper.MapNoteForDisplay(n):n.get_RealValue()},GetBeatLineX:function(n){return this.HasBeatLineX(n)?this.Direction==AlphaTab.Rendering.Utils.BeamDirection.Up?this._beatLineXPositions[n.Index].Up:this._beatLineXPositions[n.Index].Down:0},HasBeatLineX:function(n){return this._beatLineXPositions.hasOwnProperty(n.Index)},RegisterBeatLineX:function(n,t,i,r){this._beatLineXPositions[t.Index]=new AlphaTab.Rendering.Utils.BeatLinePositions(n,i,r)},Finish:function(){this.Direction=this.CalculateDirection()},CalculateDirection:function(){var n,t;if(this.Voice.Index>0)return this.Invert(AlphaTab.Rendering.Utils.BeamDirection.Down);if(this.Voice.Bar.Voices.length>1)for(n=1;n<this.Voice.Bar.Voices.length;n++)if(!this.Voice.Bar.Voices[n].IsEmpty)return this.Invert(AlphaTab.Rendering.Utils.BeamDirection.Up);return this.Beats.length==1&&(this.Beats[0].Duration==AlphaTab.Model.Duration.Whole||this.Beats[0].Duration==AlphaTab.Model.Duration.DoubleWhole)?this.Invert(AlphaTab.Rendering.Utils.BeamDirection.Up):this.Beats[0].GraceType!=AlphaTab.Model.GraceType.None?this.Invert(AlphaTab.Rendering.Utils.BeamDirection.Up):(t=(this.GetValue(this.MaxNote)+this.GetValue(this.MinNote))/2|0,this.Invert(t<AlphaTab.Rendering.Utils.BeamingHelper.ScoreMiddleKeys[this._lastBeat.Voice.Bar.Clef]?AlphaTab.Rendering.Utils.BeamDirection.Up:AlphaTab.Rendering.Utils.BeamDirection.Down))},Invert:function(n){if(!this.InvertBeamDirection)return n;switch(n){case AlphaTab.Rendering.Utils.BeamDirection.Down:return AlphaTab.Rendering.Utils.BeamDirection.Up;case AlphaTab.Rendering.Utils.BeamDirection.Up:return AlphaTab.Rendering.Utils.BeamDirection.Down}return AlphaTab.Rendering.Utils.BeamDirection.Up},CheckBeat:function(n){var t,i,r,u;if(n.InvertBeamDirection&&(this.InvertBeamDirection=!0),this.Voice==null&&(this.Voice=n.Voice),t=!1,this.Beats.length==0?t=!0:AlphaTab.Rendering.Utils.BeamingHelper.CanJoin(this._lastBeat,n)&&(t=!0),t){for(this._lastBeat=n,this.Beats.push(n),n.get_HasTuplet()&&(this.HasTuplet=!0),i=0,r=0;r<n.Notes.length;r++)u=n.Notes[r],(u.LeftHandFinger!=AlphaTab.Model.Fingers.Unknown||u.RightHandFinger!=AlphaTab.Model.Fingers.Unknown)&&i++;i>this.FingeringCount&&(this.FingeringCount=i);this.CheckNote(n.get_MinNote());this.CheckNote(n.get_MaxNote());this.ShortestDuration<n.Duration&&(this.ShortestDuration=n.Duration);n.get_HasTuplet()&&(this.HasTuplet=!0)}return t},CheckNote:function(n){var t=this.GetValue(n);this.FirstMinNote==null||n.Beat.Start<this.FirstMinNote.Beat.Start?this.FirstMinNote=n:n.Beat.Start==this.FirstMinNote.Beat.Start&&t<this.GetValue(this.FirstMinNote)&&(this.FirstMinNote=n);this.FirstMaxNote==null||n.Beat.Start<this.FirstMaxNote.Beat.Start?this.FirstMaxNote=n:n.Beat.Start==this.FirstMaxNote.Beat.Start&&t>this.GetValue(this.FirstMaxNote)&&(this.FirstMaxNote=n);this.LastMinNote==null||n.Beat.Start>this.LastMinNote.Beat.Start?this.LastMinNote=n:n.Beat.Start==this.LastMinNote.Beat.Start&&t<this.GetValue(this.LastMinNote)&&(this.LastMinNote=n);this.LastMaxNote==null||n.Beat.Start>this.LastMaxNote.Beat.Start?this.LastMaxNote=n:n.Beat.Start==this.LastMaxNote.Beat.Start&&t>this.GetValue(this.LastMaxNote)&&(this.LastMaxNote=n);(this.MaxNote==null||t>this.GetValue(this.MaxNote))&&(this.MaxNote=n);(this.MinNote==null||t<this.GetValue(this.MinNote))&&(this.MinNote=n)},CalculateBeamY:function(n,t,i,r,u){return this.CalculateBeamYWithDirection(n,t,i,r,u,this.Direction)},CalculateBeamYWithDirection:function(n,t,i,r,u,f){var s;if(this.Beats.length==1)return f==AlphaTab.Rendering.Utils.BeamDirection.Up?u.GetYPositionForNote(this.MaxNote)-n:u.GetYPositionForNote(this.MinNote)+n;if(s=10*r,f==AlphaTab.Rendering.Utils.BeamDirection.Down&&this.MinNote!=this.FirstMinNote&&this.MinNote!=this.LastMinNote)return u.GetYPositionForNote(this.MinNote)+n;if(f==AlphaTab.Rendering.Utils.BeamDirection.Up&&this.MaxNote!=this.FirstMaxNote&&this.MaxNote!=this.LastMaxNote)return u.GetYPositionForNote(this.MaxNote)-n;var h=this.GetBeatLineX(this.FirstMinNote.Beat)+t,e=f==AlphaTab.Rendering.Utils.BeamDirection.Up?u.GetYPositionForNote(this.FirstMaxNote)-n:u.GetYPositionForNote(this.FirstMinNote)+n,c=this.GetBeatLineX(this.LastMaxNote.Beat)+t,o=f==AlphaTab.Rendering.Utils.BeamDirection.Up?u.GetYPositionForNote(this.LastMaxNote)-n:u.GetYPositionForNote(this.LastMinNote)+n;return(f==AlphaTab.Rendering.Utils.BeamDirection.Down&&e>o&&e-o>s&&(o=e-s),f==AlphaTab.Rendering.Utils.BeamDirection.Down&&o>e&&o-e>s&&(e=o-s),f==AlphaTab.Rendering.Utils.BeamDirection.Up&&e<o&&o-e>s&&(o=e+s),f==AlphaTab.Rendering.Utils.BeamDirection.Up&&o<e&&e-o>s&&(e=o+s),h==c)?e:(o-e)/(c-h)*(i-h)+e},IsPositionFrom:function(n,t){return this._beatLineXPositions.hasOwnProperty(t.Index)?this._beatLineXPositions[t.Index].StaffId==n:!0}},$StaticConstructor(function(){AlphaTab.Rendering.Utils.BeamingHelper.ScoreMiddleKeys=new Int32Array([48,48,45,38,59])}),AlphaTab.Rendering.Utils.BeamingHelper.CanJoin=function(n,t){var r,e,u,f,i,o,s;if(n==null||t==null||n.get_IsRest()||t.get_IsRest()||n.GraceType!=t.GraceType||(r=n.Voice.Bar,e=n.Voice.Bar,r!=e))return!1;if(u=n.Start,f=t.Start,!AlphaTab.Rendering.Utils.BeamingHelper.CanJoinDuration(n.Duration)||!AlphaTab.Rendering.Utils.BeamingHelper.CanJoinDuration(t.Duration))return u==f;i=960;switch(r.get_MasterBar().TimeSignatureDenominator){case 8:r.get_MasterBar().TimeSignatureNumerator%3==0&&(i+=480)}return o=(i+u)/i|0,s=(i+f)/i|0,o==s},AlphaTab.Rendering.Utils.BeamingHelper.CanJoinDuration=function(n){switch(n){case AlphaTab.Model.Duration.Whole:case AlphaTab.Model.Duration.Half:case AlphaTab.Model.Duration.Quarter:return!1;default:return!0}},AlphaTab.Rendering.Utils.BeamingHelper.IsFullBarJoin=function(n,t,i){return AlphaTab.Model.ModelUtils.GetIndex(n.Duration)-2-i>0&&AlphaTab.Model.ModelUtils.GetIndex(t.Duration)-2-i>0},AlphaTab.Rendering.Utils.StaveGroupBounds=function(){this.Index=0;this.VisualBounds=null;this.RealBounds=null;this.Bars=null;this.BoundsLookup=null;this.Bars=[];this.Index=0},AlphaTab.Rendering.Utils.StaveGroupBounds.prototype={Finish:function(){for(var n=0;n<this.Bars.length;n++)this.Bars[n].Finish()},AddBar:function(n){n.StaveGroupBounds=this;this.Bars.push(n)},FindBarAtPos:function(n){for(var i=null,t=0;t<this.Bars.length;t++)if(i==null||this.Bars[t].RealBounds.X<n)i=this.Bars[t];else if(n>this.Bars[t].RealBounds.X+this.Bars[t].RealBounds.W)break;return i}},AlphaTab.Rendering.Utils.MasterBarBounds=function(){this.IsFirstOfLine=!1;this.VisualBounds=null;this.RealBounds=null;this.Bars=null;this.StaveGroupBounds=null;this.Bars=[]},AlphaTab.Rendering.Utils.MasterBarBounds.prototype={AddBar:function(n){n.MasterBarBounds=this;this.Bars.push(n)},FindBeatAtPos:function(n){for(var i,t=null,r=0;r<this.Bars.length;r++)i=this.Bars[r].FindBeatAtPos(n),i!=null&&(t==null||t.RealBounds.X<i.RealBounds.X)&&(t=i);return t==null?null:t.Beat},Finish:function(){this.Bars.sort($CreateAnonymousDelegate(this,function(n,t){return n.RealBounds.Y<t.RealBounds.Y?-1:n.RealBounds.Y>t.RealBounds.Y?1:n.RealBounds.X<t.RealBounds.X?-1:n.RealBounds.X>t.RealBounds.X?1:0}))},AddBeat:function(n){this.StaveGroupBounds.BoundsLookup.AddBeat(n)}},AlphaTab.Rendering.Utils.BarBounds=function(){this.MasterBarBounds=null;this.VisualBounds=null;this.RealBounds=null;this.Bar=null;this.Beats=null;this.Beats=[]},AlphaTab.Rendering.Utils.BarBounds.prototype={AddBeat:function(n){n.BarBounds=this;this.Beats.push(n);this.MasterBarBounds.AddBeat(n)},FindBeatAtPos:function(n){for(var i=null,t=0;t<this.Beats.length;t++)if(i==null||this.Beats[t].RealBounds.X<n)i=this.Beats[t];else if(this.Beats[t].RealBounds.X>n)break;return i}},AlphaTab.Rendering.Utils.BeatBounds=function(){this.BarBounds=null;this.VisualBounds=null;this.RealBounds=null;this.Beat=null},AlphaTab.Rendering.Utils.PercussionMapper=function(){},$StaticConstructor(function(){AlphaTab.Rendering.Utils.PercussionMapper.ElementVariationToMidi=[new Int32Array([35,35,35]),new Int32Array([38,38,37]),new Int32Array([56,56,56]),new Int32Array([56,56,56]),new Int32Array([56,56,56]),new Int32Array([41,41,41]),new Int32Array([43,43,43]),new Int32Array([45,45,45]),new Int32Array([47,47,47]),new Int32Array([48,48,48]),new Int32Array([42,46,46]),new Int32Array([44,44,44]),new Int32Array([49,49,49]),new Int32Array([57,57,57]),new Int32Array([55,55,55]),new Int32Array([51,59,53]),new Int32Array([52,52,52])]}),AlphaTab.Rendering.Utils.PercussionMapper.MidiFromElementVariation=function(n){return AlphaTab.Rendering.Utils.PercussionMapper.ElementVariationToMidi[n.Element][n.Variation]},AlphaTab.Rendering.Utils.PercussionMapper.MapNoteForDisplay=function(n){var t=n.get_RealValue();return t==61||t==66?50:t==60||t==65?52:t>=35&&t<=36||t==44?53:t==41||t==64?55:t==43||t==62?57:t==45||t==63?59:t==47||t==54?62:t==48||t==56?64:t==50?65:t==42||t==46||t>=49&&t<=53||t==57||t==59?67:60},AlphaTab.Rendering.Utils.TupletHelper=function(n){this._isFinished=!1;this.Beats=null;this.VoiceIndex=0;this.Tuplet=0;this.VoiceIndex=n;this.Beats=[]},AlphaTab.Rendering.Utils.TupletHelper.prototype={get_IsFull:function(){return this.Beats.length==this.Tuplet},Finish:function(){this._isFinished=!0},Check:function(n){if(this.Beats.length==0)this.Tuplet=n.TupletNumerator;else if(n.Voice.Index!=this.VoiceIndex||n.TupletNumerator!=this.Tuplet||this.get_IsFull()||this._isFinished)return!1;return this.Beats.push(n),!0}},AlphaTab.LayoutSettings=function(){this.Mode=null;this.AdditionalSettings=null;this.AdditionalSettings={}},AlphaTab.LayoutSettings.prototype={Get:function(n,t){return this.AdditionalSettings.hasOwnProperty(n)?this.AdditionalSettings[n]:t}},AlphaTab.LayoutSettings.get_Defaults=function(){var n=new AlphaTab.LayoutSettings;return n.Mode="page",n},AlphaTab.StaveSettings=function(n){this.Id=null;this.AdditionalSettings=null;this.Id=n;this.AdditionalSettings={}},AlphaTab.Util=AlphaTab.Util||{},AlphaTab.Util.Lazy=function(n){this._factory=null;this._created=!1;this._value=null;this._factory=n},AlphaTab.Util.Lazy.prototype={get_Value:function(){return this._created||(this._value=this._factory(),this._created=!0),this._value}},AlphaTab.Util.Logger=function(){},$StaticConstructor(function(){AlphaTab.Util.Logger.LogLevel=AlphaTab.Util.LogLevel.None;AlphaTab.Util.Logger.LogLevel=AlphaTab.Util.LogLevel.Info}),AlphaTab.Util.Logger.Debug=function(n,t){AlphaTab.Util.Logger.Log(AlphaTab.Util.LogLevel.Debug,n,t)},AlphaTab.Util.Logger.Warning=function(n,t){AlphaTab.Util.Logger.Log(AlphaTab.Util.LogLevel.Warning,n,t)},AlphaTab.Util.Logger.Info=function(n,t){AlphaTab.Util.Logger.Log(AlphaTab.Util.LogLevel.Info,n,t)},AlphaTab.Util.Logger.Error=function(n,t){AlphaTab.Util.Logger.Log(AlphaTab.Util.LogLevel.Error,n,t)},AlphaTab.Util.Logger.Log=function(n,t,i){if(!(n<AlphaTab.Util.Logger.LogLevel)){var r=arguments.callee.caller.caller.name;AlphaTab.Platform.Std.Log("[AlphaTab]["+t+"] "+r+" - "+i,n)}},AlphaTab.Util.LogLevel={None:0,Debug:1,Info:2,Warning:3,Error:4},AlphaTab.Xml=AlphaTab.Xml||{},AlphaTab.Xml.XmlNodeType={None:0,Element:1,Attribute:2,Text:3,CDATA:4,EntityReference:5,Entity:6,ProcessingInstruction:7,Comment:8,Document:9,DocumentType:10,DocumentFragment:11,Notation:12,Whitespace:13,SignificantWhitespace:14,EndElement:15,EndEntity:16,XmlDeclaration:17},AlphaTab.Model.TuningParser=AlphaTab.Model.TuningParser||{},AlphaTab.Model.TuningParser.TuningParseResult=function(){this.Note=null;this.Octave=0},AlphaTab.Rendering.Glyphs.TripletFeelGlyph=AlphaTab.Rendering.Glyphs.TripletFeelGlyph||{},AlphaTab.Rendering.Glyphs.TripletFeelGlyph.BarType={Full:0,PartialLeft:1,PartialRight:2},i=0;i<$StaticConstructors.length;i++)$StaticConstructors[i]();(function(n){var t={init:function(n,t,i){t||(t=i&&i.useWorker&&!!window.Worker?new AlphaTab.Platform.JavaScript.JsWorkerApi(n[0],i):new AlphaTab.Platform.JavaScript.JsApi(n[0],i),n.data("alphaTab",t))},tex:function(n,t,i){t.Tex(i)},load:function(n,t,i){t.Load(i)},tracks:function(n,t,i){if(i)t.SetTracks(i,!0);else return t.get_Tracks()},api:function(n,t){return t},score:function(n,t,i){if(i)t.ScoreLoaded(i);else return t.Score},renderer:function(n,t){return t.Renderer}},i=function(i,r,u){var e,f,o;if(typeof r!="string"&&(u=[r],r="init"),e=n(i),f=n(i).data("alphaTab"),r!="init"&&!f)throw new Error("alphaTab not initialized!");if(t[r])return o=[e,f].concat(u),t[r].apply(this,o);console.error("Method "+r+" does not exist on jQuery.alphaTab")};n.fn.alphaTab=function(n){return this.length==1?i(this[0],n,Array.prototype.slice.call(arguments,1)):this.each(function(){i(this,n,Array.prototype.slice.call(arguments,1))})};n.alphaTab={restore:function(t){n(t).empty().removeData("alphaTab")}};n.fn.alphaTab.fn=t})(jQuery);document.write('<script type="text/vbscript">\nFunction VbAjaxLoader(method, fileName)\n\tDim xhr\n\tSet xhr = CreateObject("Microsoft.XMLHTTP")\n\n\txhr.Open method, fileName, False\n\n\txhr.setRequestHeader "Accept-Charset", "x-user-defined"\n\txhr.send\n\n\tDim byteArray()\n\n\tif xhr.Status = 200 Then\n\t\tDim byteString\n\t\tDim i\n\n\t\tbyteString=xhr.responseBody\n\n\t\tReDim byteArray(LenB(byteString))\n\n\t\tFor i = 1 To LenB(byteString)\n\t\t\tbyteArray(i-1) = AscB(MidB(byteString, i, 1))\n\t\tNext\n\tEnd If\n\n\tVbAjaxLoader=byteArray\nEnd Function\n<\/script>');var swfobject=function(){function v(){var i,r,n;if(!c){try{i=t.getElementsByTagName("body")[0].appendChild(h("span"));i.parentNode.removeChild(i)}catch(u){return}for(c=!0,r=w.length,n=0;n<r;n++)w[n]()}}function yt(n){c?n():w[w.length]=n}function pt(n){if(typeof r.addEventListener!=i)r.addEventListener("load",n,!1);else if(typeof t.addEventListener!=i)t.addEventListener("load",n,!1);else if(typeof r.attachEvent!=i)ui(r,"onload",n);else if(typeof r.onload=="function"){var u=r.onload;r.onload=function(){u();n()}}else r.onload=n}function gt(){lt?ni():it()}function ni(){var o=t.getElementsByTagName("body")[0],u=h(f),r,e;u.setAttribute("type",p);r=o.appendChild(u);r?(e=0,function(){if(typeof r.GetVariable!=i){var t=r.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),n.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(e<10){e++;setTimeout(arguments.callee,10);return}o.removeChild(u);r=null;it()}()):it()}function it(){var y=s.length,r,t,h,c,v;if(y>0)for(r=0;r<y;r++){var f=s[r].id,e=s[r].callbackFn,o={success:!1,id:f};if(n.pv[0]>0){if(t=u(f),t)if(!g(s[r].swfVersion)||n.wk&&n.wk<312)if(s[r].expressInstall&&ut()){h={};h.data=s[r].expressInstall;h.width=t.getAttribute("width")||"0";h.height=t.getAttribute("height")||"0";t.getAttribute("class")&&(h.styleclass=t.getAttribute("class"));t.getAttribute("align")&&(h.align=t.getAttribute("align"));var p={},a=t.getElementsByTagName("param"),w=a.length;for(c=0;c<w;c++)a[c].getAttribute("name").toLowerCase()!="movie"&&(p[a[c].getAttribute("name")]=a[c].getAttribute("value"));ft(h,p,f,e)}else ti(t),e&&e(o);else l(f,!0),e&&(o.success=!0,o.ref=rt(f),e(o))}else l(f,!0),e&&(v=rt(f),v&&typeof v.SetVariable!=i&&(o.success=!0,o.ref=v),e(o))}}function rt(n){var r=null,t=u(n),e;return t&&t.nodeName=="OBJECT"&&(typeof t.SetVariable!=i?r=t:(e=t.getElementsByTagName(f)[0],e&&(r=e))),r}function ut(){return!d&&g("6.0.65")&&(n.win||n.mac)&&!(n.wk&&n.wk<312)}function ft(f,e,o,s){var c,v,l,a;d=!0;nt=s||null;at={success:!1,id:o};c=u(o);c&&(c.nodeName=="OBJECT"?(y=et(c),k=null):(y=c,k=o),f.id=ht,(typeof f.width==i||!/%$/.test(f.width)&&parseInt(f.width,10)<310)&&(f.width="310"),(typeof f.height==i||!/%$/.test(f.height)&&parseInt(f.height,10)<137)&&(f.height="137"),t.title=t.title.slice(0,47)+" - Flash Player Installation",v=n.ie&&n.win?"ActiveX":"PlugIn",l="MMredirectURL="+r.location.toString().replace(/&/g,"%26")+"&MMplayerType="+v+"&MMdoctitle="+t.title,typeof e.flashvars!=i?e.flashvars+="&"+l:e.flashvars=l,n.ie&&n.win&&c.readyState!=4&&(a=h("div"),o+="SWFObjectNew",a.setAttribute("id",o),c.parentNode.insertBefore(a,c),c.style.display="none",function(){c.readyState==4?c.parentNode.removeChild(c):setTimeout(arguments.callee,10)}()),ot(f,e,o))}function ti(t){if(n.ie&&n.win&&t.readyState!=4){var i=h("div");t.parentNode.insertBefore(i,t);i.parentNode.replaceChild(et(t),i);t.style.display="none",function(){t.readyState==4?t.parentNode.removeChild(t):setTimeout(arguments.callee,10)}()}else t.parentNode.replaceChild(et(t),t)}function et(t){var u=h("div"),e,i,o,r;if(n.win&&n.ie)u.innerHTML=t.innerHTML;else if(e=t.getElementsByTagName(f)[0],e&&(i=e.childNodes,i))for(o=i.length,r=0;r<o;r++)i[r].nodeType==1&&i[r].nodeName=="PARAM"||i[r].nodeType==8||u.appendChild(i[r].cloneNode(!0));return u}function ot(t,r,e){var v,y=u(e),w,o,k,a,c,s,l;if(n.wk&&n.wk<312)return v;if(y)if(typeof t.id==i&&(t.id=e),n.ie&&n.win){w="";for(o in t)t[o]!=Object.prototype[o]&&(o.toLowerCase()=="data"?r.movie=t[o]:o.toLowerCase()=="styleclass"?w+=' class="'+t[o]+'"':o.toLowerCase()!="classid"&&(w+=" "+o+'="'+t[o]+'"'));k="";for(a in r)r[a]!=Object.prototype[a]&&(k+='<param name="'+a+'" value="'+r[a]+'" />');y.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+w+">"+k+"<\/object>";b[b.length]=t.id;v=u(t.id)}else{c=h(f);c.setAttribute("type",p);for(s in t)t[s]!=Object.prototype[s]&&(s.toLowerCase()=="styleclass"?c.setAttribute("class",t[s]):s.toLowerCase()!="classid"&&c.setAttribute(s,t[s]));for(l in r)r[l]!=Object.prototype[l]&&l.toLowerCase()!="movie"&&ii(c,l,r[l]);y.parentNode.replaceChild(c,y);v=c}return v}function ii(n,t,i){var r=h("param");r.setAttribute("name",t);r.setAttribute("value",i);n.appendChild(r)}function wt(t){var i=u(t);i&&i.nodeName=="OBJECT"&&(n.ie&&n.win?(i.style.display="none",function(){i.readyState==4?ri(t):setTimeout(arguments.callee,10)}()):i.parentNode.removeChild(i))}function ri(n){var t=u(n),i;if(t){for(i in t)typeof t[i]=="function"&&(t[i]=null);t.parentNode.removeChild(t)}}function u(n){var i=null;try{i=t.getElementById(n)}catch(r){}return i}function h(n){return t.createElement(n)}function ui(n,t,i){n.attachEvent(t,i);a[a.length]=[n,t,i]}function g(t){var r=n.pv,i=t.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,r[0]>i[0]||r[0]==i[0]&&r[1]>i[1]||r[0]==i[0]&&r[1]==i[1]&&r[2]>=i[2]?!0:!1}function bt(r,u,o,s){var a,c,l;n.ie&&n.mac||(a=t.getElementsByTagName("head")[0],a)&&(c=o&&typeof o=="string"?o:"screen",s&&(e=null,tt=null),e&&tt==c||(l=h("style"),l.setAttribute("type","text/css"),l.setAttribute("media",c),e=a.appendChild(l),n.ie&&n.win&&typeof t.styleSheets!=i&&t.styleSheets.length>0&&(e=t.styleSheets[t.styleSheets.length-1]),tt=c),n.ie&&n.win?e&&typeof e.addRule==f&&e.addRule(r,u):e&&typeof t.createTextNode!=i&&e.appendChild(t.createTextNode(r+" {"+u+"}")))}function l(n,t){if(vt){var i=t?"visible":"hidden";c&&u(n)?u(n).style.visibility=i:bt("#"+n,"visibility:"+i)}}function kt(n){var t=/[\\\"<>\.;]/.exec(n)!=null;return t&&typeof encodeURIComponent!=i?encodeURIComponent(n):n}var i="undefined",f="object",st="Shockwave Flash",dt="ShockwaveFlash.ShockwaveFlash",p="application/x-shockwave-flash",ht="SWFObjectExprInst",ct="onreadystatechange",r=window,t=document,o=navigator,lt=!1,w=[gt],s=[],b=[],a=[],y,k,nt,at,c=!1,d=!1,e,tt,vt=!0,n=function(){var l=typeof t.getElementById!=i&&typeof t.getElementsByTagName!=i&&typeof t.createElement!=i,e=o.userAgent.toLowerCase(),s=o.platform.toLowerCase(),a=s?/win/.test(s):/win/.test(e),v=s?/mac/.test(s):/mac/.test(e),y=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,h=!+"\v1",u=[0,0,0],n=null,c;if(typeof o.plugins!=i&&typeof o.plugins[st]==f)n=o.plugins[st].description,!n||typeof o.mimeTypes!=i&&o.mimeTypes[p]&&!o.mimeTypes[p].enabledPlugin||(lt=!0,h=!1,n=n.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),u[0]=parseInt(n.replace(/^(.*)\..*$/,"$1"),10),u[1]=parseInt(n.replace(/^.*\.(.*)\s.*$/,"$1"),10),u[2]=/[a-zA-Z]/.test(n)?parseInt(n.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof r.ActiveXObject!=i)try{c=new ActiveXObject(dt);c&&(n=c.GetVariable("$version"),n&&(h=!0,n=n.split(" ")[1].split(","),u=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)]))}catch(w){}return{w3:l,pv:u,wk:y,ie:h,win:a,mac:v}}(),fi=function(){n.w3&&((typeof t.readyState!=i&&t.readyState=="complete"||typeof t.readyState==i&&(t.getElementsByTagName("body")[0]||t.body))&&v(),c||(typeof t.addEventListener!=i&&t.addEventListener("DOMContentLoaded",v,!1),n.ie&&n.win&&(t.attachEvent(ct,function(){t.readyState=="complete"&&(t.detachEvent(ct,arguments.callee),v())}),r==top&&function(){if(!c){try{t.documentElement.doScroll("left")}catch(n){setTimeout(arguments.callee,0);return}v()}}()),n.wk&&function(){if(!c){if(!/loaded|complete/.test(t.readyState)){setTimeout(arguments.callee,0);return}v()}}(),pt(v)))}(),ei=function(){n.ie&&n.win&&window.attachEvent("onunload",function(){for(var r,i,u,f,e=a.length,t=0;t<e;t++)a[t][0].detachEvent(a[t][1],a[t][2]);for(r=b.length,i=0;i<r;i++)wt(b[i]);for(u in n)n[u]=null;n=null;for(f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(t,i,r,u){if(n.w3&&t&&i){var f={};f.id=t;f.swfVersion=i;f.expressInstall=r;f.callbackFn=u;s[s.length]=f;l(t,!1)}else u&&u({success:!1,id:t})},getObjectById:function(t){if(n.w3)return rt(t)},embedSWF:function(t,r,u,e,o,s,h,c,a,v){var y={success:!1,id:r};n.w3&&!(n.wk&&n.wk<312)&&t&&r&&u&&e&&o?(l(r,!1),yt(function(){var n,b,p,k,w,d;if(u+="",e+="",n={},a&&typeof a===f)for(b in a)n[b]=a[b];if(n.data=t,n.width=u,n.height=e,p={},c&&typeof c===f)for(k in c)p[k]=c[k];if(h&&typeof h===f)for(w in h)typeof p.flashvars!=i?p.flashvars+="&"+w+"="+h[w]:p.flashvars=w+"="+h[w];if(g(o))d=ot(n,p,r),n.id==r&&l(r,!0),y.success=!0,y.ref=d;else{if(s&&ut()){n.data=s;ft(n,p,r,v);return}l(r,!0)}v&&v(y)})):v&&v(y)},switchOffAutoHideShow:function(){vt=!1},ua:n,getFlashPlayerVersion:function(){return{major:n.pv[0],minor:n.pv[1],release:n.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(t,i,r){return n.w3?ot(t,i,r):undefined},showExpressInstall:function(t,i,r,u){n.w3&&ut()&&ft(t,i,r,u)},removeSWF:function(t){n.w3&&wt(t)},createCSS:function(t,i,r,u){n.w3&&bt(t,i,r,u)},addDomLoadEvent:yt,addLoadEvent:pt,getQueryParamValue:function(n){var r=t.location.search||t.location.hash,u,i;if(r){if(/\?/.test(r)&&(r=r.split("?")[1]),n==null)return kt(r);for(u=r.split("&"),i=0;i<u.length;i++)if(u[i].substring(0,u[i].indexOf("="))==n)return kt(u[i].substring(u[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(d){var t=u(ht);t&&y&&(t.parentNode.replaceChild(y,t),k&&(l(k,!0),n.ie&&n.win&&(y.style.display="block")),nt&&nt(at));d=!1}}}}(),$StaticConstructors=[],$StaticConstructor=function(n){$StaticConstructors.push(n)};typeof $Inherit=="undefined"&&($Inherit=function(n,t){var u,r,i;if(typeof Object.getOwnPropertyNames=="undefined"){for(i in t.prototype)(typeof n.prototype[i]=="undefined"||n.prototype[i]==Object.prototype[i])&&(n.prototype[i]=t.prototype[i]);for(i in t)typeof n[i]=="undefined"&&(n[i]=t[i]);n.$baseCtor=t}else{for(u=Object.getOwnPropertyNames(t.prototype),r=0;r<u.length;r++)typeof Object.getOwnPropertyDescriptor(n.prototype,u[r])=="undefined"&&Object.defineProperty(n.prototype,u[r],Object.getOwnPropertyDescriptor(t.prototype,u[r]));for(i in t)typeof n[i]=="undefined"&&(n[i]=t[i]);n.$baseCtor=t}});typeof $CreateException=="undefined"&&($CreateException=function(n,t){t==null&&(t=new Error);n==null&&(n=new System.Exception.ctor);t.message=n.message;for(var i in n)t[i]=n[i];return t});typeof $CreateDelegate=="undefined"&&(typeof $iKey=="undefined"&&($iKey=0),typeof $pKey=="undefined"&&($pKey=String.fromCharCode(1)),$CreateDelegate=function(n,t){if(n==null||t==null||t.target==n&&t.func==t)return t;n.$delegateCache==null&&(n.$delegateCache={});t.$key==null&&(t.$key=$pKey+String(++$iKey));var i;return n.$delegateCache!=null&&(i=n.$delegateCache[t.$key]),i==null&&(i=function(){return t.apply(n,arguments)},i.func=t,i.target=n,i.isDelegate=!0,n.$delegateCache!=null&&(n.$delegateCache[t.$key]=i)),i});typeof $CreateAnonymousDelegate=="undefined"&&($CreateAnonymousDelegate=function(n,t){if(n==null||t==null)return t;var i=function(){return t.apply(n,arguments)};return i.func=t,i.target=n,i.isDelegate=!0,i});var Int16Array=Int16Array||Array,Uint8Array=Uint8Array||Array,Int32Array=Int32Array||Array;for(Float32Array=Float32Array||Array,AlphaSynth=AlphaSynth||{},AlphaSynth.Main=AlphaSynth.Main||{},AlphaSynth.Main.AlphaSynthApi=function(n){var t;this.RealInstance=null;this.Ready=!1;this.ReadyForPlay=!1;var i=!!window.ScriptProcessorNode,r=!!window.Worker,u=!!window.ForceFlash;if(n==null||n.length==0?n=AlphaSynth.Platform.Platform.ScriptFile:(n.lastIndexOf(".js")==n.length-3||(n.lastIndexOf("/")==n.length-1||(n+="/"),n+="AlphaSynth.js"),!n.indexOf("http")==0&&!n.indexOf("https")==0&&(t=[],t.push(window.location.protocol),t.push("//"),t.push(window.location.hostname),window.location.port&&(t.push(":"),t.push(window.location.port)),t.push(n),n=t.join(""))),i&&!u)AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and web audio api for playback"),this.RealInstance=new AlphaSynth.Main.AlphaSynthWebWorkerApi(n);else if(r)AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and flash for playback"),this.RealInstance=new AlphaSynth.Main.AlphaSynthFlashPlayerApi(n);else{AlphaSynth.Util.Logger.Error("Incompatible browser");throw $CreateException(new System.Exception.ctor$$String("Incompatible browser"),new Error);}this.RealInstance.Startup()},AlphaSynth.Main.AlphaSynthApi.prototype={Startup:function(){this.RealInstance.On("ready",$CreateAnonymousDelegate(this,function(){this.Ready=!0}));this.RealInstance.On("readyForPlay",$CreateAnonymousDelegate(this,function(){this.ReadyForPlay=!0}));this.RealInstance.Startup()},IsReadyForPlay:function(){this.RealInstance!=null&&this.RealInstance.IsReadyForPlay()},GetMasterVolume:function(){this.RealInstance!=null&&this.RealInstance.GetMasterVolume()},SetMasterVolume:function(n){this.RealInstance!=null&&this.RealInstance.SetMasterVolume(n)},GetPlaybackSpeed:function(){this.RealInstance!=null&&this.RealInstance.GetPlaybackSpeed()},SetPlaybackSpeed:function(n){this.RealInstance!=null&&this.RealInstance.SetPlaybackSpeed(n)},GetState:function(){this.RealInstance!=null&&this.RealInstance.GetState()},IsSoundFontLoaded:function(){this.RealInstance!=null&&this.RealInstance.IsSoundFontLoaded()},IsMidiLoaded:function(){this.RealInstance!=null&&this.RealInstance.IsMidiLoaded()},Play:function(){this.RealInstance!=null&&this.RealInstance.Play()},Pause:function(){this.RealInstance!=null&&this.RealInstance.Pause()},PlayPause:function(){this.RealInstance!=null&&this.RealInstance.PlayPause()},Stop:function(){this.RealInstance!=null&&this.RealInstance.Stop()},SetPositionTick:function(n){this.RealInstance!=null&&this.RealInstance.SetPositionTick(n)},SetPositionTime:function(n){this.RealInstance!=null&&this.RealInstance.SetPositionTime(n)},LoadSoundFontUrl:function(n){this.RealInstance!=null&&this.RealInstance.LoadSoundFontUrl(n)},LoadSoundFontBytes:function(n){this.RealInstance!=null&&this.RealInstance.LoadSoundFontBytes(n)},LoadMidiUrl:function(n){this.RealInstance!=null&&this.RealInstance.LoadMidiUrl(n)},LoadMidiBytes:function(n){this.RealInstance!=null&&this.RealInstance.LoadMidiBytes(n)},SetLogLevel:function(n){(AlphaSynth.Util.Logger.LogLevel=n,this.RealInstance!=null)&&this.RealInstance.SetLogLevel(n)},On:function(n,t){this.RealInstance!=null&&(this.RealInstance.On(n,t),n=="readyForPlay"&&this.Ready&&t())}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthApi.AlphaSynthId="AlphaSynth"}),AlphaSynth.Main.AlphaSynthFlashOutput=function(n){this._alphaSynthRoot=null;this._id=null;this._swfId=null;this._swfContainer=null;this._playbackSpeed=0;this.SampleRequest=null;this.Finished=null;this.PositionChanged=null;this.ReadyChanged=null;this._alphaSynthRoot=n;var t=this._alphaSynthRoot.lastIndexOf("/");t!=-1&&(this._alphaSynthRoot=this._alphaSynthRoot.substr(0,t+1))},AlphaSynth.Main.AlphaSynthFlashOutput.prototype={get_SampleRate:function(){return 44100},Open:function(){this._playbackSpeed=1;this._id="alphaSynthFlashPlayer"+AlphaSynth.Main.AlphaSynthFlashOutput.NextId;this._swfId=this._id+"swf";AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[this._id]=this;AlphaSynth.Main.AlphaSynthFlashOutput.NextId++;this._swfContainer=document.createElement("div");this._swfContainer.className="alphaSynthFlashPlayer";this._swfContainer.setAttribute("id",this._id);document.body.appendChild(this._swfContainer);var n=swfobject,t=n.embedSWF;t(this._alphaSynthRoot+"AlphaSynth.FlashOutput.swf",this._id,"1px","1px","9.0.0",null,{id:this._id,sampleRate:44100},{allowScriptAccess:"always"},{id:this._swfId})},SetPlaybackSpeed:function(n){document.getElementById(this._swfId).AlphaSynthSetPlaybackSpeed(n)},SequencerFinished:function(){document.getElementById(this._swfId).AlphaSynthSequencerFinished()},AddSamples:function(n){var t=new Uint8Array(n.buffer),i=window.btoa(String.fromCharCode.apply(null,t));document.getElementById(this._swfId).AlphaSynthAddSamples(i)},Play:function(){document.getElementById(this._swfId).AlphaSynthPlay()},Pause:function(){document.getElementById(this._swfId).AlphaSynthPause()},Stop:function(){document.getElementById(this._swfId).AlphaSynthStop()},Seek:function(n){document.getElementById(this._swfId).AlphaSynthSeek(n)},add_SampleRequest:function(n){this.SampleRequest=$CombineDelegates(this.SampleRequest,n)},remove_SampleRequest:function(n){this.SampleRequest=$RemoveDelegate(this.SampleRequest,n)},add_Finished:function(n){this.Finished=$CombineDelegates(this.Finished,n)},remove_Finished:function(n){this.Finished=$RemoveDelegate(this.Finished,n)},add_PositionChanged:function(n){this.PositionChanged=$CombineDelegates(this.PositionChanged,n)},remove_PositionChanged:function(n){this.PositionChanged=$RemoveDelegate(this.PositionChanged,n)},add_ReadyChanged:function(n){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,n)},remove_ReadyChanged:function(n){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,n)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthFlashOutput.PreferredSampleRate=44100;AlphaSynth.Main.AlphaSynthFlashOutput.Id="alphaSynthFlashPlayer";AlphaSynth.Main.AlphaSynthFlashOutput.Lookup=null;AlphaSynth.Main.AlphaSynthFlashOutput.NextId=0;AlphaSynth.Main.AlphaSynthFlashOutput.Lookup={}}),AlphaSynth.Main.AlphaSynthFlashOutput.OnSampleRequest=function(n){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(n)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].SampleRequest!=null&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].SampleRequest()},AlphaSynth.Main.AlphaSynthFlashOutput.OnFinished=function(n){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(n)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].Finished!=null&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].Finished()},AlphaSynth.Main.AlphaSynthFlashOutput.OnPositionChanged=function(n,t){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(n)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].PositionChanged!=null&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].PositionChanged(t)},AlphaSynth.Main.AlphaSynthFlashOutput.OnReadyChanged=function(n,t){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(n)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].ReadyChanged!=null&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[n].ReadyChanged(t)},AlphaSynth.Main.AlphaSynthWebAudioOutput=function(){this._context=null;this._buffer=null;this._source=null;this._audioNode=null;this._circularBuffer=null;this._finished=!1;this._currentTime=0;this._playbackSpeed=0;this.SampleRequest=null;this.Finished=null;this.PositionChanged=null;this.ReadyChanged=null},AlphaSynth.Main.AlphaSynthWebAudioOutput.prototype={get_SampleRate:function(){return this._context.sampleRate|0},Open:function(){this._playbackSpeed=1;this._finished=!1;this._circularBuffer=new AlphaSynth.Ds.CircularSampleBuffer(40960);window.AudioContext=window.AudioContext||window.webkitAudioContext;this._context=new AudioContext;this._currentTime=0;this._buffer=this._context.createBuffer(2,4096,this._context.sampleRate);this._audioNode=this._context.createScriptProcessor(4096,0,2);this._audioNode.onaudioprocess=$CreateDelegate(this,this.GenerateSound);this.OnReadyChanged(!0)},Play:function(){this.RequestBuffers();this._finished=!1;this._source=this._context.createBufferSource();this._source.buffer=this._buffer;this._source.loop=!0;this._source.connect(this._audioNode,0,0);this._source.start(0);this._audioNode.connect(this._context.destination,0,0)},Pause:function(){this._source!=null&&this._source.stop(0);this._source=null;this._audioNode.disconnect(0)},Stop:function(){this._finished=!0;this._source!=null&&this._source.stop(0);this._currentTime=0;this._source=null;this._circularBuffer.Clear();this._audioNode.disconnect(0)},Seek:function(n){this._currentTime=n;this._circularBuffer.Clear()},SequencerFinished:function(){this._finished=!0},AddSamples:function(n){this._circularBuffer.Write(n,0,n.length)},RequestBuffers:function(){var n;if(this._circularBuffer.get_Count()<20480&&this.SampleRequest!=null)for(n=0;n<5;n++)this.SampleRequest()},GenerateSound:function(n){var f=n,r=f.outputBuffer.getChannelData(0),e=f.outputBuffer.getChannelData(1),o=r.length+e.length,t,u,i;if(this._circularBuffer.get_Count()<o)this._finished&&(this.Finished!=null&&this.Finished(),this.Stop());else{for(t=new Float32Array(o),this._circularBuffer.Read(t,0,t.length),u=0,i=0;i<r.length;i++)r[i]=t[u++],e[i]=t[u++];this._currentTime+=r.length/this.get_SampleRate()*1e3*this._playbackSpeed}this.PositionChanged!=null&&this.PositionChanged(this._currentTime|0);this._finished||this.RequestBuffers()},SetPlaybackSpeed:function(n){this._playbackSpeed=n},add_SampleRequest:function(n){this.SampleRequest=$CombineDelegates(this.SampleRequest,n)},remove_SampleRequest:function(n){this.SampleRequest=$RemoveDelegate(this.SampleRequest,n)},add_Finished:function(n){this.Finished=$CombineDelegates(this.Finished,n)},remove_Finished:function(n){this.Finished=$RemoveDelegate(this.Finished,n)},add_PositionChanged:function(n){this.PositionChanged=$CombineDelegates(this.PositionChanged,n)},remove_PositionChanged:function(n){this.PositionChanged=$RemoveDelegate(this.PositionChanged,n)},add_ReadyChanged:function(n){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,n)},remove_ReadyChanged:function(n){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,n)},OnReadyChanged:function(n){var t=this.ReadyChanged;t!=null&&t(n)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferSize=4096;AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferCount=10}),AlphaSynth.Main.AlphaSynthWebWorker=function(n){this._player=null;this._main=null;this._main=n;this._main.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1);this._player=new AlphaSynth.Player.SynthPlayer;this._player.add_PositionChanged($CreateDelegate(this,this.OnPositionChanged));this._player.add_PlayerStateChanged($CreateDelegate(this,this.OnPlayerStateChanged));this._player.add_Finished($CreateDelegate(this,this.OnFinished));this._player.add_SoundFontLoad($CreateDelegate(this,this.OnSoundFontLoad));this._player.add_SoundFontLoaded($CreateDelegate(this,this.OnSoundFontLoaded));this._player.add_SoundFontLoadFailed($CreateDelegate(this,this.OnSoundFontLoadFailed));this._player.add_MidiLoad($CreateDelegate(this,this.OnMidiLoad));this._player.add_MidiLoaded($CreateDelegate(this,this.OnMidiLoaded));this._player.add_MidiLoadFailed($CreateDelegate(this,this.OnMidiLoadFailed));this._player.add_ReadyForPlay($CreateDelegate(this,this.OnReadyForPlay));this.OnReady()},AlphaSynth.Main.AlphaSynthWebWorker.prototype={HandleMessage:function(n){var t=n.data,i=t.cmd;switch(i){case"play":this.Play();break;case"pause":this.Pause();break;case"isReadyForPlay":this._main.postMessage({cmd:"isReadyForPlay",value:this.IsReadyForPlay()});break;case"getMasterVolume":this._main.postMessage({cmd:"getMasterVolume",value:this._player.get_MasterVolume()});break;case"setMasterVolume":this._player.set_MasterVolume(t.value);break;case"getPlaybackSpeed":this._main.postMessage({cmd:"getPlaybackSpeed",value:this._player.Sequencer.PlaybackSpeed});break;case"setPlaybackSpeed":this._player.set_PlaybackSpeed(t.value);break;case"playPause":this.PlayPause();break;case"stop":this.Stop();break;case"setPositionTick":this.SetPositionTick(t.tick);break;case"setPositionTime":this.SetPositionTime(t.time);break;case"loadSoundFontUrl":this.LoadSoundFontUrl(t.url);break;case"loadSoundFontBytes":this.LoadSoundFontBytes(t.data);break;case"loadMidiUrl":this.LoadMidiUrl(t.url);break;case"loadMidiBytes":this.LoadMidiBytes(t.data);break;case"getState":this._main.postMessage({cmd:"getState",value:this.GetState()});break;case"isSoundFontLoaded":this._main.postMessage({cmd:"isSoundFontLoaded",value:this.IsSoundFontLoaded()});break;case"isMidiLoaded":this._main.postMessage({cmd:"isMidiLoaded",value:this.IsMidiLoaded()});break;case"setLogLevel":this.SetLogLevel(t.level)}},IsReadyForPlay:function(){return this._player.get_IsReady()},Play:function(){this._player.Play()},Pause:function(){this._player.Pause()},PlayPause:function(){this._player.PlayPause()},Stop:function(){this._player.Stop()},SetPositionTick:function(n){this._player.set_TickPosition(n)},SetPositionTime:function(n){this._player.set_TimePosition(n)},LoadSoundFontUrl:function(n){this._player.LoadSoundFontUrl(n)},LoadSoundFontBytes:function(n){this._player.LoadSoundFontBytes(n)},LoadMidiUrl:function(n){this._player.LoadMidiUrl(n)},LoadMidiBytes:function(n){this._player.LoadMidiBytes(n)},GetState:function(){return this._player.State},IsSoundFontLoaded:function(){return this._player.IsSoundFontLoaded},IsMidiLoaded:function(){return this._player.IsMidiLoaded},GetMasterVolume:function(){return this._player.get_MasterVolume()},SetMasterVolume:function(n){this._player.set_MasterVolume(n)},GetPlaybackSpeed:function(){return this._player.get_PlaybackSpeed()},SetPlaybackSpeed:function(n){this._player.set_PlaybackSpeed(n)},OnReady:function(){this._main.postMessage({cmd:"ready"})},OnPositionChanged:function(n,t){this._main.postMessage({cmd:"positionChanged",currentTime:t.CurrentTime,endTime:t.EndTime,currentTick:t.CurrentTick,endTick:t.EndTick})},OnPlayerStateChanged:function(n,t){this._main.postMessage({cmd:"playerStateChanged",state:t.State})},OnFinished:function(){this._main.postMessage({cmd:"finished"})},OnSoundFontLoad:function(n,t){this._main.postMessage({cmd:"soundFontLoad",loaded:t.Loaded,total:t.Total})},OnSoundFontLoaded:function(){this._main.postMessage({cmd:"soundFontLoaded"})},OnSoundFontLoadFailed:function(){this._main.postMessage({cmd:"soundFontLoadFailed"})},OnMidiLoad:function(n,t){this._main.postMessage({cmd:"midiLoad",loaded:t.Loaded,total:t.Total})},OnMidiLoaded:function(){this._main.postMessage({cmd:"midiFileLoaded"})},OnMidiLoadFailed:function(){this._main.postMessage({cmd:"midiFileLoadFailed"})},OnReadyForPlay:function(){this._main.postMessage({cmd:"readyForPlay",value:this.IsReadyForPlay()})},SendLog:function(n,t){this._main.postMessage({cmd:"log",level:n,message:t})},SetLogLevel:function(n){AlphaSynth.Util.Logger.LogLevel=n}},AlphaSynth.Main.AlphaSynthWebWorkerApiBase=function(n,t){this._alphaSynthScriptFile=null;this._synth=null;this._player=null;this._isPlayerReady=!1;this._isWorkerReady=!1;this._events=null;this._player=n;this._player.add_ReadyChanged($CreateDelegate(this,this.PlayerReadyChanged));this._player.add_PositionChanged($CreateDelegate(this,this.PlayerPositionChanged));this._player.add_SampleRequest($CreateDelegate(this,this.PlayerSampleRequest));this._player.add_Finished($CreateDelegate(this,this.PlayerFinished));this._events={};this._alphaSynthScriptFile=t;this._synth=new Worker(this.CreateWorkerUrl())},AlphaSynth.Main.AlphaSynthWebWorkerApiBase.prototype={CreateWorkerUrl:function(){var i="self.onmessage = function(e) {\r\n                if(e.data.cmd == 'playerReady') {\r\n                    importScripts(e.data.alphaSynthScript);\r\n                    AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate = e.data.sampleRate;\r\n                    new AlphaSynth.Main.AlphaSynthWebWorker(self);\r\n                }\r\n            }",n,t;window.URL=window.URL||window.webkitURL;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;try{n=new Blob([i],{type:"application/javascript"})}catch(r){t=new BlobBuilder;t.append(i);n=t.getBlob()}return URL.createObjectURL(n)},Startup:function(){this._player.Open();this._synth.addEventListener("message",$CreateDelegate(this,this.HandleWorkerMessage),!1);this._synth.postMessage({cmd:"playerReady",alphaSynthScript:this._alphaSynthScriptFile,sampleRate:this._player.get_SampleRate()})},IsReadyForPlay:function(){this._synth.postMessage({cmd:"isReadyForPlay"})},Play:function(){this._synth.postMessage({cmd:"play"})},Pause:function(){this._synth.postMessage({cmd:"pause"})},PlayPause:function(){this._synth.postMessage({cmd:"playPause"})},Stop:function(){this._synth.postMessage({cmd:"stop"})},SetPositionTick:function(n){this._synth.postMessage({cmd:"setPositionTick",tick:n})},SetPositionTime:function(n){this._synth.postMessage({cmd:"setPositionTime",time:n})},LoadSoundFontUrl:function(n){this._synth.postMessage({cmd:"loadSoundFontUrl",url:AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl(n)})},LoadSoundFontBytes:function(n){this._synth.postMessage({cmd:"loadSoundFontBytes",data:n})},LoadMidiUrl:function(n){this._synth.postMessage({cmd:"loadMidiUrl",url:AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl(n)})},LoadMidiBytes:function(n){this._synth.postMessage({cmd:"loadMidiBytes",data:n})},GetState:function(){this._synth.postMessage({cmd:"getState"})},GetMasterVolume:function(){this._synth.postMessage({cmd:"getMasterVolume"})},SetMasterVolume:function(n){this._synth.postMessage({cmd:"setMasterVolume",value:n})},GetPlaybackSpeed:function(){this._synth.postMessage({cmd:"getPlaybackSpeed"})},SetPlaybackSpeed:function(n){this._synth.postMessage({cmd:"setPlaybackSpeed",value:n})},IsSoundFontLoaded:function(){this._synth.postMessage({cmd:"isSoundFontLoaded"})},IsMidiLoaded:function(){this._synth.postMessage({cmd:"isMidiLoaded"})},SetLogLevel:function(n){this._synth.postMessage({cmd:"setLogLevel",level:n})},HandleWorkerMessage:function(n){var t=n.data,i=t.cmd;switch(i){case"isReadyForPlay":case"getState":case"getMasterVolume":case"isSoundFontLoaded":case"isMidiLoaded":this.TriggerEvent(i,[t.value]);break;case"ready":this._isWorkerReady=!0;this.CheckForReadyState();break;case"positionChanged":this.TriggerEvent(i,[t.currentTime,t.endTime,t.currentTick,t.endTick]);break;case"playerStateChanged":this.TriggerEvent(i,[t.state]);break;case"finished":this.TriggerEvent(i,null);break;case"soundFontLoad":this.TriggerEvent(i,[t.loaded,t.total]);break;case"soundFontLoaded":this.TriggerEvent(i,null);break;case"soundFontLoadFailed":this.TriggerEvent(i,null);break;case"midiLoad":this.TriggerEvent(i,[t.loaded,t.total]);break;case"midiFileLoaded":this.TriggerEvent(i,null);break;case"midiFileLoadFailed":this.TriggerEvent(i,null);break;case"readyForPlay":this.TriggerEvent(i,[t.value]);break;case"log":this.Log(t.level,t.message);break;case"playerSequencerFinished":this._player.SequencerFinished();break;case"playerAddSamples":this._player.AddSamples(t.samples);break;case"playerPlay":this._player.Play();break;case"playerPause":this._player.Pause();break;case"playerStop":this._player.Stop();break;case"playerSeek":this._player.Seek(t.pos);break;case"setPlaybackSpeed":this._player.SetPlaybackSpeed(t.value)}},CheckForReadyState:function(){this.TriggerEvent("ready",[this._isWorkerReady&&this._isPlayerReady])},PlayerReadyChanged:function(n){this._isPlayerReady=n;this.CheckForReadyState()},On:function(n,t){this._events.hasOwnProperty(n)||(this._events[n]=[]);this._events[n].push(t)},TriggerEvent:function(n,t){var r=this._events[n],i;if(r!=null)for(i=0;i<r.length;i++)r[i].apply(null,t)},PlayerSampleRequest:function(){this._synth.postMessage({cmd:"playerSampleRequest"})},PlayerFinished:function(){this._synth.postMessage({cmd:"playerFinished"})},PlayerPositionChanged:function(n){this._synth.postMessage({cmd:"playerPositionChanged",pos:n})},Log:function(n,t){switch(n){case AlphaSynth.Util.LogLevel.None:console.log(t);break;case AlphaSynth.Util.LogLevel.Debug:console.debug(t);break;case AlphaSynth.Util.LogLevel.Info:console.info(t);break;case AlphaSynth.Util.LogLevel.Warning:console.warn(t);break;case AlphaSynth.Util.LogLevel.Error:console.error(t)}}},AlphaSynth.Main.AlphaSynthWebWorkerApiBase.QualifyUrl=function(n){var t=document.createElement("img");return t.onerror=function(){},t.src=n,n=t.src,t.src=null,n},AlphaSynth.Main.AlphaSynthFlashPlayerApi=function(n){AlphaSynth.Main.AlphaSynthWebWorkerApiBase.call(this,new AlphaSynth.Main.AlphaSynthFlashOutput(n),n)},$Inherit(AlphaSynth.Main.AlphaSynthFlashPlayerApi,AlphaSynth.Main.AlphaSynthWebWorkerApiBase),AlphaSynth.Main.AlphaSynthWebWorkerApi=function(n){AlphaSynth.Main.AlphaSynthWebWorkerApiBase.call(this,new AlphaSynth.Main.AlphaSynthWebAudioOutput,n)},$Inherit(AlphaSynth.Main.AlphaSynthWebWorkerApi,AlphaSynth.Main.AlphaSynthWebWorkerApiBase),AlphaSynth.Platform=AlphaSynth.Platform||{},AlphaSynth.Platform.Platform=function(){},AlphaSynth.Platform.Platform.CreateOutput=function(){return new AlphaSynth.Player.WebWorkerOutput},$StaticConstructor(function(){AlphaSynth.Platform.Platform.ScriptFile=null;AlphaSynth.Platform.Platform.PlatformInit()}),AlphaSynth.Platform.Platform.PlatformInit=function(){if(self.document){var n=document.currentScript;n||(n=document.querySelector("script[data-alphasynth]"));n?AlphaSynth.Platform.Platform.ScriptFile=n.src:console.warn("Could not automatically find alphaSynth script file for worker, please add the data-alphasynth attribute to the script tag that includes alphasynth or provide it when initializing")}},AlphaSynth.Platform.Std=function(){},$StaticConstructor(function(){AlphaSynth.Platform.Std.IsLittleEndian=!0}),AlphaSynth.Platform.Std.ParseInt=function(n){var t=parseInt(n);return isNaN(t)&&(t=0),t},AlphaSynth.Platform.Std.StringFromCharCode=function(){return""},AlphaSynth.Platform.Std.Random=function(){return Math.random()},AlphaSynth.Platform.Std.BlockCopy=function(){},AlphaSynth.Platform.Std.ArrayCopy=function(n,t,i,r,u){for(var f=0;f<u;f++)i[r+f]=n[t+f]},AlphaSynth.Platform.Std.Reverse=function(n){for(var t=0,i=n.length-1,r;t<i;)r=n[t],n[t]=n[i],n[i]=r,t++,i--},AlphaSynth.Platform.TypeUtils=function(){},$StaticConstructor(function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian=!0;AlphaSynth.Platform.TypeUtils.Int16=new Int16Array(1)}),AlphaSynth.Platform.TypeUtils.ToUInt32=function(n){return n|0},AlphaSynth.Platform.TypeUtils.ToInt16=function(n){return AlphaSynth.Platform.TypeUtils.Int16[0]=n|0,AlphaSynth.Platform.TypeUtils.Int16[0]},AlphaSynth.Platform.TypeUtils.ToUInt16=function(n){return n|0},AlphaSynth.Platform.TypeUtils.ToUInt8=function(n){return n},AlphaSynth.Platform.TypeUtils.ClearIntArray=function(n){for(var t=0;t<n.length;t++)n[t]=0},AlphaSynth.Platform.TypeUtils.ClearShortArray=function(n){for(var t=0;t<n.length;t++)n[t]=0},AlphaSynth.Player=AlphaSynth.Player||{},AlphaSynth.Player.WebWorkerOutput=function(){this._positionChangedListeners=null;this._finishedListeners=null;this._sampleRequestListeners=null;this._workerSelf=null;this._sampleRate=0;this.PositionChanged=null;this.Finished=null;this.SampleRequest=null;this.ReadyChanged=null},AlphaSynth.Player.WebWorkerOutput.prototype={get_SampleRate:function(){return AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate},Open:function(){AlphaSynth.Util.Logger.Debug("Initializing webworker worker");this._workerSelf=self;this._workerSelf.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1);this.OnReadyChanged(!0)},HandleMessage:function(n){var t=n.data,i=t.cmd;switch(i){case"playerSampleRequest":this.OnSampleRequest();break;case"playerFinished":this.OnFinished();break;case"playerPositionChanged":this.OnPositionChanged(t.pos)}},PostMessage:function(){},add_PositionChanged:function(n){this.PositionChanged=$CombineDelegates(this.PositionChanged,n)},remove_PositionChanged:function(n){this.PositionChanged=$RemoveDelegate(this.PositionChanged,n)},OnPositionChanged:function(n){var t=this.PositionChanged;t!=null&&t(n)},add_Finished:function(n){this.Finished=$CombineDelegates(this.Finished,n)},remove_Finished:function(n){this.Finished=$RemoveDelegate(this.Finished,n)},OnFinished:function(){var n=this.Finished;n!=null&&n()},add_SampleRequest:function(n){this.SampleRequest=$CombineDelegates(this.SampleRequest,n)},remove_SampleRequest:function(n){this.SampleRequest=$RemoveDelegate(this.SampleRequest,n)},OnSampleRequest:function(){var n=this.SampleRequest;n!=null&&n()},add_ReadyChanged:function(n){this.ReadyChanged=$CombineDelegates(this.ReadyChanged,n)},remove_ReadyChanged:function(n){this.ReadyChanged=$RemoveDelegate(this.ReadyChanged,n)},OnReadyChanged:function(n){var t=this.ReadyChanged;t!=null&&t(n)},SequencerFinished:function(){this._workerSelf.postMessage({cmd:"playerSequencerFinished"})},AddSamples:function(n){this._workerSelf.postMessage({cmd:"playerAddSamples",samples:n})},Play:function(){this._workerSelf.postMessage({cmd:"playerPlay"})},Pause:function(){this._workerSelf.postMessage({cmd:"playerPause"})},Stop:function(){this._workerSelf.postMessage({cmd:"playerStop"})},Seek:function(n){this._workerSelf.postMessage({cmd:"playerSeek",pos:n})},SetPlaybackSpeed:function(n){this._workerSelf.postMessage({cmd:"setPlaybackSpeed",value:n})}},$StaticConstructor(function(){AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate=0}),AlphaSynth.Util=AlphaSynth.Util||{},AlphaSynth.Util.Extensions=function(){},AlphaSynth.Util.Logger=function(){},$StaticConstructor(function(){AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.None;AlphaSynth.Util.Logger.LogHandler=null;AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.Info;AlphaSynth.Util.Logger.LogHandler=function(n){console.log(n)}}),AlphaSynth.Util.Logger.Debug=function(n){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Debug,n)},AlphaSynth.Util.Logger.Warning=function(n){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Warning,n)},AlphaSynth.Util.Logger.Info=function(n){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Info,n)},AlphaSynth.Util.Logger.Error=function(n){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Error,n)},AlphaSynth.Util.Logger.Log=function(n,t){if(!(n<AlphaSynth.Util.Logger.LogLevel)){var i=arguments.callee.caller.caller.name;AlphaSynth.Util.Logger.LogHandler(i+"-"+t)}},AlphaSynth.Util.Logger.GetCaller=function(){return""},AlphaSynth.Util.LogLevel={None:0,Debug:1,Info:2,Warning:3,Error:4},AlphaSynth.Util.UrlLoader=function(){this.Progress=null;this.Complete=null;this.Url=null;this.Method=null},AlphaSynth.Util.UrlLoader.prototype={Load:function(){var n=new XMLHttpRequest;n.open(this.Method,this.Url,!0);n.responseType="arraybuffer";n.onload=$CreateAnonymousDelegate(this,function(){var t=new Uint8Array(n.response);t!=null&&this.FireComplete(t)});n.onerror=$CreateAnonymousDelegate(this,function(n){AlphaSynth.Util.Logger.Error("Loading failed: "+n.message)});n.onprogress=$CreateAnonymousDelegate(this,function(n){this.FireProgress(n.loaded,n.total)});n.send()},FireProgress:function(n,t){this.Progress!=null&&this.Progress(n,t)},FireComplete:function(n){this.Complete!=null&&this.Complete(n)}},AlphaSynth.Bank=AlphaSynth.Bank||{},AlphaSynth.Bank.AssetManager=function(){this.PatchAssets=null;this.SampleAssets=null;this.PatchAssets=[];this.SampleAssets=[]},AlphaSynth.Bank.AssetManager.prototype={FindPatch:function(n){for(var i,t=0;t<this.PatchAssets.length;t++)if(i=this.PatchAssets[t],i.Name==n)return i;return null},FindSample:function(n){for(var i,t=0;t<this.SampleAssets.length;t++)if(i=this.SampleAssets[t],i.Name==n)return i;return null}},AlphaSynth.Bank.Components=AlphaSynth.Bank.Components||{},AlphaSynth.Bank.Components.Generators=AlphaSynth.Bank.Components.Generators||{},AlphaSynth.Bank.Components.Generators.Generator=function(n){this.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;this.LoopStartPhase=0;this.LoopEndPhase=0;this.StartPhase=0;this.EndPhase=0;this.Offset=0;this.Period=0;this.Frequency=0;this.RootKey=0;this.KeyTrack=0;this.VelocityTrack=0;this.Tune=0;this.LoopMode=n.LoopMethod;this.LoopStartPhase=n.LoopStartPhase;this.LoopEndPhase=n.LoopEndPhase;this.StartPhase=n.StartPhase;this.EndPhase=n.EndPhase;this.Offset=n.Offset;this.Period=n.Period;this.Frequency=0;this.RootKey=n.RootKey;this.KeyTrack=n.KeyTrack;this.VelocityTrack=n.VelTrack;this.Tune=n.Tune},AlphaSynth.Bank.Components.Generators.Generator.prototype={Release:function(n){this.LoopMode==AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff&&(n.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,n.CurrentStart=this.StartPhase,n.CurrentEnd=this.EndPhase)},GetValues:function(n,t,i){var r=0,u,f;do if(u=Math.ceil((n.CurrentEnd-n.Phase)/i)|0,u>t.length-r)while(r<t.length)t[r++]=this.GetValue(n.Phase),n.Phase+=i;else{for(f=r+u;r<f;)t[r++]=this.GetValue(n.Phase),n.Phase+=i;switch(n.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:n.CurrentStart=this.LoopStartPhase;n.CurrentEnd=this.LoopEndPhase;n.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:n.Phase+=n.CurrentStart-n.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(n.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;r<t.length;)t[r++]=0}}while(r<t.length)}},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator=function(n){AlphaSynth.Bank.Components.Generators.Generator.call(this,n);this.EndPhase<0&&(this.EndPhase=1);this.StartPhase<0&&(this.StartPhase=0);this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase);this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase);this.Period<0&&(this.Period=1);this.RootKey<0&&(this.RootKey=69);this.Frequency=440},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator.prototype={GetValue:function(){return AlphaSynth.Platform.Std.Random()*2-1}},$Inherit(AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.TriangleGenerator=function(n){AlphaSynth.Bank.Components.Generators.Generator.call(this,n);this.EndPhase<0&&(this.EndPhase=1.25);this.StartPhase<0&&(this.StartPhase=.25);this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase);this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase);this.Period<0&&(this.Period=1);this.RootKey<0&&(this.RootKey=69);this.Frequency=440},AlphaSynth.Bank.Components.Generators.TriangleGenerator.prototype={GetValue:function(n){return Math.abs(n-Math.Floor(n+.5))*4-1}},$Inherit(AlphaSynth.Bank.Components.Generators.TriangleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SquareGenerator=function(n){AlphaSynth.Bank.Components.Generators.Generator.call(this,n);this.EndPhase<0&&(this.EndPhase=6.28318530717958);this.StartPhase<0&&(this.StartPhase=0);this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase);this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase);this.Period<0&&(this.Period=6.28318530717958);this.RootKey<0&&(this.RootKey=69);this.Frequency=440},AlphaSynth.Bank.Components.Generators.SquareGenerator.prototype={GetValue:function(n){return Math.Sign(Math.sin(n))}},$Inherit(AlphaSynth.Bank.Components.Generators.SquareGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SineGenerator=function(n){AlphaSynth.Bank.Components.Generators.Generator.call(this,n);this.EndPhase<0&&(this.EndPhase=6.28318530717958);this.StartPhase<0&&(this.StartPhase=0);this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase);this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase);this.Period<0&&(this.Period=6.28318530717958);this.RootKey<0&&(this.RootKey=69);this.Frequency=440},AlphaSynth.Bank.Components.Generators.SineGenerator.prototype={GetValue:function(n){return Math.sin(n)}},$Inherit(AlphaSynth.Bank.Components.Generators.SineGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SawGenerator=function(n){AlphaSynth.Bank.Components.Generators.Generator.call(this,n);this.EndPhase<0&&(this.EndPhase=1);this.StartPhase<0&&(this.StartPhase=0);this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase);this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase);this.Period<0&&(this.Period=1);this.RootKey<0&&(this.RootKey=69);this.Frequency=440},AlphaSynth.Bank.Components.Generators.SawGenerator.prototype={GetValue:function(n){return 2*(n-Math.Floor(n+.5))}},$Inherit(AlphaSynth.Bank.Components.Generators.SawGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.Interpolation={None:0,Linear:1,Cosine:2,CubicSpline:3,Sinc:4},AlphaSynth.Bank.Components.Generators.SampleGenerator=function(){this.Samples=null;AlphaSynth.Bank.Components.Generators.Generator.call(this,new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)},AlphaSynth.Bank.Components.Generators.SampleGenerator.prototype={GetValue:function(n){return this.Samples.get_Item(n|0)},GetValues:function(n,t,i){var r=0,u,f;do{if(u=Math.ceil((n.CurrentEnd-n.Phase)/i)|0,u>t.length-r){this.Interpolate(n,t,i,r,t.length);return}f=r+u;this.Interpolate(n,t,i,r,f);r=f;switch(n.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:n.CurrentStart=this.LoopStartPhase;n.CurrentEnd=this.LoopEndPhase;n.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:n.Phase+=n.CurrentStart-n.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(n.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;r<t.length;)t[r++]=0}}while(r<t.length)},Interpolate:function(n,t,i,r,u){var l,f,h,o,s,c,e;switch(1){case AlphaSynth.Bank.Components.Generators.Interpolation.Linear:for(l=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;r<u&&n.Phase<l;)f=n.Phase|0,o=this.Samples.get_Item(f),s=this.Samples.get_Item(f+1),e=n.Phase-f,t[r++]=o+e*(s-o),n.Phase+=i;while(r<u)f=n.Phase|0,o=this.Samples.get_Item(f),s=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(n.CurrentStart|0):o,e=n.Phase-f,t[r++]=o+e*(s-o),n.Phase+=i;break;case AlphaSynth.Bank.Components.Generators.Interpolation.Cosine:for(l=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;r<u&&n.Phase<l;)f=n.Phase|0,o=this.Samples.get_Item(f),s=this.Samples.get_Item(f+1),e=(1-Math.cos((n.Phase-f)*3.14159265358979))*.5,t[r++]=o*(1-e)+s*e,n.Phase+=i;while(r<u)f=n.Phase|0,o=this.Samples.get_Item(f),s=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(n.CurrentStart|0):o,e=(1-Math.cos((n.Phase-f)*3.14159265358979))*.5,t[r++]=o*(1-e)+s*e,n.Phase+=i;break;case AlphaSynth.Bank.Components.Generators.Interpolation.CubicSpline:for(l=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopStartPhase+1:this.StartPhase+1;r<u&&n.Phase<l;)f=n.Phase|0,h=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(n.CurrentEnd|-1):this.Samples.get_Item(f),o=this.Samples.get_Item(f),s=this.Samples.get_Item(f+1),c=this.Samples.get_Item(f+2),e=n.Phase-f,t[r++]=(-.5*h+1.5*o-1.5*s+.5*c)*e*e*e+(h-2.5*o+2*s-.5*c)*e*e+(-.5*h+.5*s)*e+o,n.Phase+=i;for(l=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-2:this.EndPhase-2;r<u&&n.Phase<l;)f=n.Phase|0,h=this.Samples.get_Item(f-1),o=this.Samples.get_Item(f),s=this.Samples.get_Item(f+1),c=this.Samples.get_Item(f+2),e=n.Phase-f,t[r++]=(-.5*h+1.5*o-1.5*s+.5*c)*e*e*e+(h-2.5*o+2*s-.5*c)*e*e+(-.5*h+.5*s)*e+o,n.Phase+=i;for(l+=1;r<u;)f=n.Phase|0,h=this.Samples.get_Item(f-1),o=this.Samples.get_Item(f),n.Phase<l?(s=this.Samples.get_Item(f+1),c=n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(n.CurrentStart|0):s):n.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?(s=this.Samples.get_Item(n.CurrentStart|0),c=this.Samples.get_Item(n.CurrentStart|1)):(s=o,c=o),e=n.Phase-f,t[r++]=(-.5*h+1.5*o-1.5*s+.5*c)*e*e*e+(h-2.5*o+2*s-.5*c)*e*e+(-.5*h+.5*s)*e+o,n.Phase+=i;break;default:while(r<u)t[r++]=this.Samples.get_Item(n.Phase|0),n.Phase+=i}}},$Inherit(AlphaSynth.Bank.Components.Generators.SampleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.GeneratorParameters=function(){this.Phase=0;this.CurrentStart=0;this.CurrentEnd=0;this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop;this.Phase=0;this.CurrentStart=0;this.CurrentEnd=0;this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop},AlphaSynth.Bank.Components.Generators.GeneratorParameters.prototype={QuickSetup:function(n){this.CurrentStart=n.StartPhase;this.Phase=this.CurrentStart+n.Offset;switch(n.LoopMode){case AlphaSynth.Bank.Components.Generators.LoopMode.Continuous:case AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff:this.Phase>=n.EndPhase?this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:this.Phase>=n.LoopEndPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,this.CurrentEnd=n.EndPhase):this.Phase>=n.LoopStartPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop,this.CurrentEnd=n.LoopEndPhase,this.CurrentStart=n.LoopStartPhase):(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop,this.CurrentEnd=n.LoopStartPhase);break;default:this.CurrentEnd=n.EndPhase;this.CurrentState=this.Phase>=this.CurrentEnd?AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop}}},AlphaSynth.Bank.Components.Generators.LoopMode={NoLoop:0,OneShot:1,Continuous:2,LoopUntilNoteOff:3},AlphaSynth.Bank.Components.Generators.GeneratorState={PreLoop:0,Loop:1,PostLoop:2,Finished:3},AlphaSynth.Bank.Components.Generators.DefaultGenerators=function(){},$StaticConstructor(function(){AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine=new AlphaSynth.Bank.Components.Generators.SineGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor);AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSaw=new AlphaSynth.Bank.Components.Generators.SawGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor);AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSquare=new AlphaSynth.Bank.Components.Generators.SquareGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor);AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultTriangle=new AlphaSynth.Bank.Components.Generators.TriangleGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)}),AlphaSynth.Bank.Components.LfoState={Delay:0,Sustain:1},AlphaSynth.Bank.Components.Lfo=function(){this._phase=0;this._increment=0;this._delayTime=0;this._generator=null;this.Frequency=0;this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay;this.Value=0;this.Depth=0;this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay;this._generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine;this._delayTime=0;this._increment=0;this._phase=0;this.Frequency=0;this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay;this.Value=0;this.Depth=0},AlphaSynth.Bank.Components.Lfo.prototype={QuickSetup:function(n,t){this._generator=t.Generator;this._delayTime=n*t.DelayTime|0;this.Frequency=t.Frequency;this._increment=this._generator.Period*this.Frequency/n;this.Depth=t.Depth;this.Reset()},Increment:function(n){this.CurrentState==AlphaSynth.Bank.Components.LfoState.Delay?(this._phase-=n,this._phase<=0&&(this._phase=this._generator.LoopStartPhase+this._increment*-this._phase,this.Value=this._generator.GetValue(this._phase),this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)):(this._phase+=this._increment*n,this._phase>=this._generator.LoopEndPhase&&(this._phase=this._generator.LoopStartPhase+(this._phase-this._generator.LoopEndPhase)%(this._generator.LoopEndPhase-this._generator.LoopStartPhase)),this.Value=this._generator.GetValue(this._phase))},Reset:function(){this.Value=0;this._delayTime>0?(this._phase=this._delayTime,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay):(this._phase=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)}},AlphaSynth.Bank.Components.FilterType={None:0,BiquadLowpass:1,BiquadHighpass:2,OnePoleLowpass:3},AlphaSynth.Bank.Components.Filter=function(){this._a1=0;this._a2=0;this._b1=0;this._b2=0;this._m1=0;this._m2=0;this._m3=0;this._cutOff=0;this._resonance=0;this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None;this.CoeffNeedsUpdating=!1;this._a1=0;this._a2=0;this._b1=0;this._b2=0;this._m1=0;this._m2=0;this._m3=0;this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None;this.set_CutOff(0);this.set_Resonance(0)},AlphaSynth.Bank.Components.Filter.prototype={get_CutOff:function(){return this._cutOff},set_CutOff:function(n){this._cutOff=n;this.CoeffNeedsUpdating=!0},get_Resonance:function(){return this._resonance},set_Resonance:function(n){this._resonance=n;this.CoeffNeedsUpdating=!0},get_Enabled:function(){return this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None},Disable:function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None},QuickSetup:function(n,t,i,r){this.CoeffNeedsUpdating=!1;this.set_CutOff(r.CutOff);this.set_Resonance(r.Resonance);this.FilterMethod=r.FilterMethod;this._a1=0;this._a2=0;this._b1=0;this._b2=0;this._m1=0;this._m2=0;this._m3=0;(this.get_CutOff()<=0||this.get_Resonance()<=0)&&(this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None);this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None&&(this.set_CutOff(this.get_CutOff()*AlphaSynth.Synthesis.SynthHelper.CentsToPitch((t-r.RootKey)*r.KeyTrack+i*r.VelTrack|0)),this.UpdateCoefficients(n))},ApplyFilter:function(n){switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:return this._m3=n-this._a1*this._m1-this._a2*this._m2,n=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3,n;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:return this._m1+=this._a1*(n-this._m1),this._m1;default:return 0}},ApplyFilter:function(n){var t;switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(t=0;t<n.length;t++)this._m3=n[t]-this._a1*this._m1-this._a2*this._m2,n[t]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(t=0;t<n.length;t++)this._m1+=this._a1*(n[t]-this._m1),n[t]=this._m1}},ApplyFilterInterp:function(n,t){var r=this.GenerateFilterCoeff(this.get_CutOff()/t,this.get_Resonance()),u=(r[0]-this._a1)/n.length,f=(r[1]-this._a2)/n.length,e=(r[2]-this._b1)/n.length,o=(r[3]-this._b2)/n.length,i;switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(i=0;i<n.length;i++)this._a1+=u,this._a2+=f,this._b1+=e,this._b2+=o,this._m3=n[i]-this._a1*this._m1-this._a2*this._m2,n[i]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;this._a1=r[0];this._a2=r[1];this._b1=r[2];this._b2=r[3];break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(i=0;i<n.length;i++)this._a1+=u,this._m1+=this._a1*(n[i]-this._m1),n[i]=this._m1;this._a1=r[0]}this.CoeffNeedsUpdating=!1},UpdateCoefficients:function(n){var t=this.GenerateFilterCoeff(this.get_CutOff()/n,this.get_Resonance());this._a1=t[0];this._a2=t[1];this._b1=t[2];this._b2=t[3];this.CoeffNeedsUpdating=!1},GenerateFilterCoeff:function(n,t){var i;n=AlphaSynth.Synthesis.SynthHelper.ClampD(n,1e-38,.49);i=new Float32Array(4);switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:var f=6.28318530717958*n,u=Math.cos(f),e=Math.sin(f)/(2*t),r=1/(1+e);i[0]=-2*u*r;i[1]=(1-e)*r;i[2]=(1-u)*r*(1/Math.sqrt(t));i[3]=this._b1*.5;break;case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:var f=6.28318530717958*n,u=Math.cos(f),e=Math.sin(f)/(2*t),r=1/(1+e),o=1/Math.sqrt(t);i[0]=-2*u*r;i[1]=(1-e)*r;i[2]=(-1-u)*r*o;i[3]=(1+u)*r*o*.5;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:i[0]=1-Math.Exp(-6.28318530717959*n)}return i}},AlphaSynth.Bank.Components.EnvelopeState={Delay:0,Attack:1,Hold:2,Decay:3,Sustain:4,Release:5,None:6},AlphaSynth.Bank.Components.Envelope=function(){this._stages=null;this._index=0;this._stage=null;this.Value=0;this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay;this.Depth=0;this.Value=0;this.Depth=0;this._stages=new Array(7);for(var n=0;n<this._stages.length;n++)this._stages[n]=new AlphaSynth.Bank.Components.EnvelopeStage,this._stages[n].Graph=AlphaSynth.Util.Tables.EnvelopeTables(0);this._stages[3].Reverse=!0;this._stages[5].Reverse=!0;this._stages[6].Time=1e8;this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay;this._stage=this._stages[this.CurrentStage]},AlphaSynth.Bank.Components.Envelope.prototype={QuickSetupSf2:function(n,t,i,r,u,f){for(this.Depth=f.Depth,this._stages[0].Offset=0,this._stages[0].Scale=0,this._stages[0].Time=Math.max(0,n*f.DelayTime|0),this._stages[1].Offset=f.StartLevel,this._stages[1].Scale=f.PeakLevel-f.StartLevel,this._stages[1].Time=Math.max(0,n*f.AttackTime|0),this._stages[1].Graph=AlphaSynth.Util.Tables.EnvelopeTables(f.AttackGraph),this._stages[2].Offset=0,this._stages[2].Scale=f.PeakLevel,this._stages[2].Time=Math.max(0,n*f.HoldTime*Math.pow(2,(60-t)*i/1200))|0,this._stages[3].Offset=f.SustainLevel,this._stages[3].Scale=f.PeakLevel-f.SustainLevel,this._stages[3].Time=f.SustainLevel==f.PeakLevel?0:Math.max(0,n*f.DecayTime*Math.pow(2,(60-t)*r/1200)|0),this._stages[3].Graph=AlphaSynth.Util.Tables.EnvelopeTables(f.DecayGraph),this._stages[4].Offset=0,this._stages[4].Scale=f.SustainLevel,this._stages[4].Time=n*f.SustainTime|0,this._stages[5].Scale=this._stages[3].Time==0&&this._stages[4].Time==0?f.PeakLevel:this._stages[4].Scale,u?(this._stages[5].Offset=-100,this._stages[5].Scale+=100,this._stages[6].Scale=-100):(this._stages[5].Offset=0,this._stages[6].Scale=0),this._stages[5].Time=Math.max(0,n*f.ReleaseTime|0),this._stages[5].Graph=AlphaSynth.Util.Tables.EnvelopeTables(f.ReleaseGraph),this._index=0,this.Value=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay;this._stages[this.CurrentStage].Time==0;)this.CurrentStage++;this._stage=this._stages[this.CurrentStage]},Increment:function(n){var t,i;do if(t=this._stage.Time-this._index,t>n)this._index+=n,n=0;else{if(this._index=0,this.CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None)do this._stage=this._stages[++this.CurrentStage];while(this._stage.Time==0);n-=t}while(n>0);i=this._stage.Graph.length*(this._index/this._stage.Time)|0;this.Value=this._stage.Reverse?(1-this._stage.Graph[i])*this._stage.Scale+this._stage.Offset:this._stage.Graph[i]*this._stage.Scale+this._stage.Offset},Release:function(n){this.Value<=n?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Scale=this.Value)},ReleaseSf2VolumeEnvelope:function(){this.Value<=-100?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Offset=-100,this._stage.Scale=100+this.Value)}},AlphaSynth.Bank.Components.EnvelopeStage=function(){this.Time=0;this.Graph=null;this.Scale=0;this.Offset=0;this.Reverse=!1;this.Time=0;this.Graph=null;this.Scale=0;this.Offset=0;this.Reverse=!1},AlphaSynth.Bank.Components.PanFormulaEnum={Neg3dBCenter:0,Neg6dBCenter:1,ZeroCenter:2},AlphaSynth.Bank.Components.PanComponent=function(){this.Left=0;this.Right=0},AlphaSynth.Bank.Components.PanComponent.prototype={SetValue:function(n,t){n=AlphaSynth.Synthesis.SynthHelper.ClampF(n,-1,1);var i;switch(t){case AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter:i=1.5707963267949*(n+1)/2;this.Left=Math.cos(i);this.Right=Math.sin(i);break;case AlphaSynth.Bank.Components.PanFormulaEnum.Neg6dBCenter:this.Left=.5+n*-.5;this.Right=.5+n*.5;break;case AlphaSynth.Bank.Components.PanFormulaEnum.ZeroCenter:i=1.5707963267949*(n+1)/2;this.Left=Math.cos(i)/.707106781186;this.Right=Math.sin(i)/.707106781186;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid pan law selected."),new Error);}}},AlphaSynth.Bank.Descriptors=AlphaSynth.Bank.Descriptors||{},AlphaSynth.Bank.Descriptors.LfoDescriptor=function(){this.DelayTime=0;this.Frequency=0;this.Depth=0;this.Generator=null;this.DelayTime=0;this.Frequency=8;this.Depth=1;this.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},AlphaSynth.Bank.Descriptors.Waveform={Sine:0,Square:1,Saw:2,Triangle:3,SampleData:4,WhiteNoise:5},AlphaSynth.Bank.Descriptors.GeneratorDescriptor=function(){this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine;this.AssetName=null;this.EndPhase=0;this.StartPhase=0;this.LoopEndPhase=0;this.LoopStartPhase=0;this.Offset=0;this.Period=0;this.RootKey=0;this.KeyTrack=0;this.VelTrack=0;this.Tune=0;this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine;this.AssetName="null";this.EndPhase=-1;this.StartPhase=-1;this.LoopEndPhase=-1;this.LoopStartPhase=-1;this.Offset=0;this.Period=-1;this.RootKey=-1;this.KeyTrack=100;this.VelTrack=0;this.Tune=0},AlphaSynth.Bank.Descriptors.FilterDescriptor=function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None;this.CutOff=0;this.Resonance=0;this.RootKey=0;this.KeyTrack=0;this.VelTrack=0;this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None;this.CutOff=-1;this.Resonance=1;this.RootKey=60;this.KeyTrack=0;this.VelTrack=0},AlphaSynth.Bank.Descriptors.EnvelopeDescriptor=function(){this.DelayTime=0;this.AttackTime=0;this.AttackGraph=0;this.HoldTime=0;this.DecayTime=0;this.DecayGraph=0;this.SustainTime=0;this.ReleaseTime=0;this.ReleaseGraph=0;this.SustainLevel=0;this.PeakLevel=0;this.StartLevel=0;this.Depth=0;this.Vel2Delay=0;this.Vel2Attack=0;this.Vel2Hold=0;this.Vel2Decay=0;this.Vel2Sustain=0;this.Vel2Release=0;this.Vel2Depth=0;this.DelayTime=0;this.AttackTime=0;this.AttackGraph=1;this.HoldTime=0;this.DecayTime=0;this.DecayGraph=1;this.SustainTime=3600;this.ReleaseTime=0;this.ReleaseGraph=1;this.SustainLevel=0;this.PeakLevel=1;this.StartLevel=0;this.Depth=1;this.Vel2Delay=0;this.Vel2Attack=0;this.Vel2Hold=0;this.Vel2Decay=0;this.Vel2Sustain=0;this.Vel2Release=0;this.Vel2Depth=0},AlphaSynth.Bank.Patch=AlphaSynth.Bank.Patch||{},AlphaSynth.Bank.Patch.Patch=function(n){this.ExclusiveGroupTarget=0;this.ExclusiveGroup=0;this.Name=null;this.Name=n;this.ExclusiveGroup=0;this.ExclusiveGroupTarget=0},AlphaSynth.Bank.Patch.Sf2Patch=function(n){this.iniFilterFc=0;this.filterQ=0;this.initialAttn=0;this.keyOverride=0;this.velOverride=0;this.keynumToModEnvHold=0;this.keynumToModEnvDecay=0;this.keynumToVolEnvHold=0;this.keynumToVolEnvDecay=0;this.pan=null;this.modLfoToPitch=0;this.vibLfoToPitch=0;this.modEnvToPitch=0;this.modLfoToFilterFc=0;this.modEnvToFilterFc=0;this.modLfoToVolume=0;this.gen=null;this.mod_env=null;this.vel_env=null;this.mod_lfo=null;this.vib_lfo=null;this.fltr=null;AlphaSynth.Bank.Patch.Patch.call(this,n)},AlphaSynth.Bank.Patch.Sf2Patch.prototype={Start:function(n){var t=this.keyOverride>-1?this.keyOverride:n.Note,i=this.velOverride>-1?this.velOverride:n.Velocity;return n.GeneratorParams[0].QuickSetup(this.gen),n.Envelopes[0].QuickSetupSf2(n.SynthParams.Synth.SampleRate,t,this.keynumToModEnvHold,this.keynumToModEnvDecay,!1,this.mod_env),n.Envelopes[1].QuickSetupSf2(n.SynthParams.Synth.SampleRate,t,this.keynumToVolEnvHold,this.keynumToVolEnvDecay,!0,this.vel_env),n.Filters[0].Disable(),n.Lfos[0].QuickSetup(n.SynthParams.Synth.SampleRate,this.mod_lfo),n.Lfos[1].QuickSetup(n.SynthParams.Synth.SampleRate,this.vib_lfo),n.PitchOffset=(t-this.gen.RootKey)*this.gen.KeyTrack+this.gen.Tune,n.PitchOffset+=100*(n.SynthParams.MasterCoarseTune+(n.SynthParams.MasterFineTune.get_Combined()-8192)/8192)|0,n.VolOffset=this.initialAttn,n.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,n.Velocity,0,127),n.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,n.SynthParams.Volume.get_Coarse(),0,127),n.GeneratorParams[0].CurrentState!=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished&&n.Envelopes[1].CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None},Stop:function(n){this.gen.Release(n.GeneratorParams[0]);this.gen.LoopMode!=AlphaSynth.Bank.Components.Generators.LoopMode.OneShot&&(n.Envelopes[0].Release(1e-38),n.Envelopes[1].ReleaseSf2VolumeEnvelope())},Process:function(n,t,i){for(var f,r,e=AlphaSynth.Synthesis.SynthHelper.CentsToPitch(n.SynthParams.CurrentPitch)*this.gen.Frequency,o=e*AlphaSynth.Synthesis.SynthHelper.CentsToPitch(n.PitchOffset),s=o/n.SynthParams.Synth.SampleRate,h=n.SynthParams.Synth.get_MasterVolume()*n.SynthParams.CurrentVolume*n.SynthParams.Synth.get_MixGain(),u=t;u<i;u+=64*n.SynthParams.Synth.AudioChannels)if(n.Envelopes[0].Increment(64),n.Envelopes[1].Increment(64),n.Lfos[0].Increment(64),n.Lfos[1].Increment(64),this.gen.GetValues(n.GeneratorParams[0],n.BlockBuffer,s*AlphaSynth.Synthesis.SynthHelper.CentsToPitch(n.Envelopes[0].Value*this.modEnvToPitch+n.Lfos[0].Value*this.modLfoToPitch+n.Lfos[1].Value*this.vibLfoToPitch|0)),n.Filters[0].get_Enabled()&&(f=n.PData[0].getInt32(0,!0)+n.Lfos[0].Value*this.modLfoToFilterFc+n.Envelopes[0].Value*this.modEnvToFilterFc,f>13500&&(f=13500),n.Filters[0].set_CutOff(AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(f/100,69)),n.Filters[0].CoeffNeedsUpdating?n.Filters[0].ApplyFilterInterp(n.BlockBuffer,n.SynthParams.Synth.SampleRate):n.Filters[0].ApplyFilter(n.BlockBuffer)),r=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(n.VolOffset+n.Envelopes[1].Value+n.Lfos[0].Value*this.modLfoToVolume)*h,n.SynthParams.Synth.AudioChannels==2?n.MixMonoToStereoInterp(u,r*this.pan.Left*n.SynthParams.CurrentPan.Left,r*this.pan.Right*n.SynthParams.CurrentPan.Right):n.MixMonoToMonoInterp(u,r),n.Envelopes[1].CurrentStage>AlphaSynth.Bank.Components.EnvelopeState.Hold&&r<=1e-5||n.GeneratorParams[0].CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Finished){n.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped;return}},Load:function(n,t){this.ExclusiveGroup=n.Generators[57];this.ExclusiveGroupTarget=this.ExclusiveGroup;this.iniFilterFc=n.Generators[8];this.filterQ=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(n.Generators[9]/10);this.initialAttn=-n.Generators[48]/10;this.keyOverride=n.Generators[46];this.velOverride=n.Generators[47];this.keynumToModEnvHold=n.Generators[31];this.keynumToModEnvDecay=n.Generators[32];this.keynumToVolEnvHold=n.Generators[39];this.keynumToVolEnvDecay=n.Generators[40];this.pan=new AlphaSynth.Bank.Components.PanComponent;this.pan.SetValue(n.Generators[17]/500,AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter);this.modLfoToPitch=n.Generators[5];this.vibLfoToPitch=n.Generators[6];this.modEnvToPitch=n.Generators[7];this.modLfoToFilterFc=n.Generators[10];this.modEnvToFilterFc=n.Generators[11];this.modLfoToVolume=n.Generators[13]/10;this.LoadGen(n,t);this.LoadEnvelopes(n);this.LoadLfos(n);this.LoadFilter(n)},LoadGen:function(n,t){var i=t.SampleAssets[n.Generators[53]];this.gen=new AlphaSynth.Bank.Components.Generators.SampleGenerator;this.gen.EndPhase=i.End+n.Generators[1]+32768*n.Generators[12];this.gen.Frequency=i.SampleRate;this.gen.KeyTrack=n.Generators[56];this.gen.LoopEndPhase=i.LoopEnd+n.Generators[3]+32768*n.Generators[50];switch(n.Generators[54]&3){case 0:case 2:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;break;case 1:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.Continuous;break;case 3:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff}this.gen.LoopStartPhase=i.LoopStart+n.Generators[2]+32768*n.Generators[45];this.gen.Offset=0;this.gen.Period=1;this.gen.RootKey=n.Generators[58]>-1?n.Generators[58]:i.RootKey;this.gen.StartPhase=i.Start+n.Generators[0]+32768*n.Generators[4];this.gen.Tune=i.Tune+n.Generators[52]+100*n.Generators[51]|0;this.gen.VelocityTrack=0;this.gen.Samples=i.SampleData},LoadEnvelopes:function(n){this.mod_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor;this.mod_env.AttackTime=Math.pow(2,n.Generators[26]/1200);this.mod_env.AttackGraph=3;this.mod_env.DecayTime=Math.pow(2,n.Generators[28]/1200);this.mod_env.DelayTime=Math.pow(2,n.Generators[25]/1200);this.mod_env.HoldTime=Math.pow(2,n.Generators[27]/1200);this.mod_env.PeakLevel=1;this.mod_env.ReleaseTime=Math.pow(2,n.Generators[30]/1200);this.mod_env.StartLevel=0;this.mod_env.SustainLevel=1-AlphaSynth.Synthesis.SynthHelper.ClampS(n.Generators[29],0,1e3)/1e3;this.mod_env.AttackTime<.001?this.mod_env.AttackTime=.001:this.mod_env.AttackTime>100&&(this.mod_env.AttackTime=100);this.mod_env.DecayTime<.001?this.mod_env.DecayTime=0:this.mod_env.DecayTime>100&&(this.mod_env.DecayTime=100);this.mod_env.DelayTime<.001?this.mod_env.DelayTime=0:this.mod_env.DelayTime>20&&(this.mod_env.DelayTime=20);this.mod_env.HoldTime<.001?this.mod_env.HoldTime=0:this.mod_env.HoldTime>20&&(this.mod_env.HoldTime=20);this.mod_env.ReleaseTime<.001?this.mod_env.ReleaseTime=.001:this.mod_env.ReleaseTime>100&&(this.mod_env.ReleaseTime=100);this.vel_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor;this.vel_env.AttackTime=Math.pow(2,n.Generators[34]/1200);this.vel_env.AttackGraph=3;this.vel_env.DecayTime=Math.pow(2,n.Generators[36]/1200);this.vel_env.DelayTime=Math.pow(2,n.Generators[33]/1200);this.vel_env.HoldTime=Math.pow(2,n.Generators[35]/1200);this.vel_env.PeakLevel=0;this.vel_env.ReleaseTime=Math.pow(2,n.Generators[38]/1200);this.vel_env.StartLevel=-100;this.vel_env.SustainLevel=AlphaSynth.Synthesis.SynthHelper.ClampS(n.Generators[37],0,1e3)/-10;this.vel_env.AttackTime<.001?this.vel_env.AttackTime=.001:this.vel_env.AttackTime>100&&(this.vel_env.AttackTime=100);this.vel_env.DecayTime<.001?this.vel_env.DecayTime=0:this.vel_env.DecayTime>100&&(this.vel_env.DecayTime=100);this.vel_env.DelayTime<.001?this.vel_env.DelayTime=0:this.vel_env.DelayTime>20&&(this.vel_env.DelayTime=20);this.vel_env.HoldTime<.001?this.vel_env.HoldTime=0:this.vel_env.HoldTime>20&&(this.vel_env.HoldTime=20);this.vel_env.ReleaseTime<.001?this.vel_env.ReleaseTime=.001:this.vel_env.ReleaseTime>100&&(this.vel_env.ReleaseTime=100)},LoadLfos:function(n){this.mod_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor;this.mod_lfo.DelayTime=Math.pow(2,n.Generators[21]/1200);this.mod_lfo.Frequency=Math.pow(2,n.Generators[22]/1200)*8.176;this.mod_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine;this.vib_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor;this.vib_lfo.DelayTime=Math.pow(2,n.Generators[23]/1200);this.vib_lfo.Frequency=Math.pow(2,n.Generators[24]/1200)*8.176;this.vib_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},LoadFilter:function(n){this.fltr=new AlphaSynth.Bank.Descriptors.FilterDescriptor;this.fltr.FilterMethod=AlphaSynth.Bank.Components.FilterType.BiquadLowpass;this.fltr.CutOff=AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(n.Generators[8]/100,69);this.fltr.Resonance=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(n.Generators[9]/10)}},AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator=function(n,t,i,r,u,f,e){var o=0,s;u=u-f;e=e-f;i==AlphaSynth.Sf2.DirectionEnum.MaxToMin&&(u=e-u);switch(n){case AlphaSynth.Sf2.SourceTypeEnum.Linear:o=u/e|0;break;case AlphaSynth.Sf2.SourceTypeEnum.Concave:s=127-u;o=-.208333333333333*(Math.log(s*s/(e*e))/Math.LN10);break;case AlphaSynth.Sf2.SourceTypeEnum.Convex:s=u;o=1+.208333333333333*(Math.log(s*s/(e*e))/Math.LN10);break;case AlphaSynth.Sf2.SourceTypeEnum.Switch:o=u<=(e/2|0)?0:1}return r==AlphaSynth.Sf2.PolarityEnum.Bipolar&&(o=o*2-1),t==AlphaSynth.Sf2.TransformEnum.AbsoluteValue&&(o=Math.abs(o)),o},$Inherit(AlphaSynth.Bank.Patch.Sf2Patch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.MultiPatch=function(n){this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity;this._intervalList=null;AlphaSynth.Bank.Patch.Patch.call(this,n);this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity},AlphaSynth.Bank.Patch.MultiPatch.prototype={FindPatches:function(n,t,i,r){var f=0,u;switch(this._intervalType){case AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:for(u=0;u<this._intervalList.length;u++)if(this._intervalList[u].CheckAllIntervals(n,t,i)&&(r[f++]=this._intervalList[u].Patch,f==r.length))break;break;case AlphaSynth.Bank.Patch.IntervalType.ChannelKey:for(u=0;u<this._intervalList.length;u++)if(this._intervalList[u].CheckChannelAndKey(n,t)&&(r[f++]=this._intervalList[u].Patch,f==r.length))break;break;case AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:for(u=0;u<this._intervalList.length;u++)if(this._intervalList[u].CheckKeyAndVelocity(t,i)&&(r[f++]=this._intervalList[u].Patch,f==r.length))break;break;case AlphaSynth.Bank.Patch.IntervalType.Key:for(u=0;u<this._intervalList.length;u++)if(this._intervalList[u].CheckKey(t)&&(r[f++]=this._intervalList[u].Patch,f==r.length))break}return f},Start:function(){return!1},Process:function(){},Stop:function(){},LoadSf2:function(n,t){var i,r,u,f,e,o;for(this._intervalList=new Array(n.length),i=0;i<n.length;i++)AlphaSynth.Platform.TypeUtils.IsLittleEndian?(r=n[i].Generators[43]&255,u=n[i].Generators[43]>>8&255,f=n[i].Generators[44]&255,e=n[i].Generators[44]>>8&255):(u=n[i].Generators[43]&255,r=n[i].Generators[43]>>8&255,e=n[i].Generators[44]&255,f=n[i].Generators[44]>>8&255),o=new AlphaSynth.Bank.Patch.Sf2Patch(this.Name+"_"+i),o.Load(n[i],t),this._intervalList[i]=new AlphaSynth.Bank.Patch.PatchInterval(o,0,15,r,u,f,e);this.DetermineIntervalType()},DetermineIntervalType:function(){for(var t=!1,i=!1,n=0;n<this._intervalList.length;n++){if((this._intervalList[n].StartChannel!=0||this._intervalList[n].EndChannel!=15)&&(t=!0,t&&i))break;if((this._intervalList[n].StartVelocity!=0||this._intervalList[n].EndVelocity!=127)&&(i=!0,t&&i))break}this._intervalType=t&i?AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:t?AlphaSynth.Bank.Patch.IntervalType.ChannelKey:i?AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:AlphaSynth.Bank.Patch.IntervalType.Key}},$Inherit(AlphaSynth.Bank.Patch.MultiPatch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.IntervalType={ChannelKeyVelocity:0,ChannelKey:1,KeyVelocity:2,Key:3},AlphaSynth.Bank.Patch.PatchInterval=function(n,t,i,r,u,f,e){this.Patch=null;this.StartChannel=0;this.StartKey=0;this.StartVelocity=0;this.EndChannel=0;this.EndKey=0;this.EndVelocity=0;this.Patch=n;this.StartChannel=t;this.EndChannel=i;this.StartKey=r;this.EndKey=u;this.StartVelocity=f;this.EndVelocity=e},AlphaSynth.Bank.Patch.PatchInterval.prototype={CheckAllIntervals:function(n,t,i){return n>=this.StartChannel&&n<=this.EndChannel&&t>=this.StartKey&&t<=this.EndKey&&i>=this.StartVelocity&&i<=this.EndVelocity},CheckChannelAndKey:function(n,t){return n>=this.StartChannel&&n<=this.EndChannel&&t>=this.StartKey&&t<=this.EndKey},CheckKeyAndVelocity:function(n,t){return n>=this.StartKey&&n<=this.EndKey&&t>=this.StartVelocity&&t<=this.EndVelocity},CheckKey:function(n){return n>=this.StartKey&&n<=this.EndKey}},AlphaSynth.Bank.SampleDataAsset=function(n,t){this.Name=null;this.Channels=0;this.SampleRate=0;this.RootKey=0;this.Tune=0;this.Start=0;this.End=0;this.LoopStart=0;this.LoopEnd=0;this.SampleData=null;this.Channels=1;this.Name=n.Name;this.SampleRate=n.SampleRate;this.RootKey=n.RootKey;this.Tune=n.Tune;this.Start=n.Start;this.End=n.End;this.LoopStart=n.StartLoop;this.LoopEnd=n.EndLoop;this.SampleData=AlphaSynth.Util.PcmData.Create(t.BitsPerSample,t.SampleData,!0)},AlphaSynth.Bank.PatchBank=function(){this._bank=null;this._assets=null;this.Name=null;this.Comments=null;this.Reset()},AlphaSynth.Bank.PatchBank.prototype={Reset:function(){this._bank={};this._assets=new AlphaSynth.Bank.AssetManager;this.Name="";this.Comments=""},get_LoadedBanks:function(){for(var i=[],n=0,t=Object.keys(this._bank),u=t.length,r=t[n];n<u;n++,r=t[n])i.push(AlphaSynth.Platform.Std.ParseInt(r));return i.slice(0)},GetBank:function(n){return this._bank.hasOwnProperty(n)?this._bank[n]:null},GetPatchByNumber:function(n,t){return this._bank.hasOwnProperty(n)?this._bank[n][t]:null},GetPatchByName:function(n,t){var i;if(this._bank.hasOwnProperty(n)){i=this._bank[n];for(var r=0,f=i.length,u=i[r];r<f;r++,u=i[r])if(u!=null&&u.Name==t)return u}return null},IsBankLoaded:function(n){return this._bank.hasOwnProperty(n)},LoadSf2:function(n){var u,rt,p,i,w,l,d,g,nt,tt,o,s;this.Reset();AlphaSynth.Util.Logger.Debug("Reading SF2");u=new AlphaSynth.Sf2.SoundFont;u.Load(n);AlphaSynth.Util.Logger.Debug("Building patchbank");this.Name=u.Info.BankName;this.Comments=u.Info.Comments;for(var h=0,v=u.Presets.SampleHeaders,ut=v.length,it=v[h];h<ut;h++,it=v[h])this._assets.SampleAssets.push(new AlphaSynth.Bank.SampleDataAsset(it,u.SampleData));rt=this.ReadSf2Instruments(u.Presets.Instruments);for(var c=0,y=u.Presets.PresetHeaders,ft=y.length,t=y[c];c<ft;c++,t=y[c]){for(p=null,t.Zones[0].Generators.length==0||t.Zones[0].Generators[t.Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.Instrument?(p=t.Zones[0].Generators,i=1):i=0,w=[];i<t.Zones.length;){var b=0,k=127,f=0,e=127;if(t.Zones[i].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.KeyRange?(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(b=t.Zones[i].Generators[0].get_AmountInt16()&255,k=t.Zones[i].Generators[0].get_AmountInt16()>>8&255):(k=t.Zones[i].Generators[0].get_AmountInt16()&255,b=t.Zones[i].Generators[0].get_AmountInt16()>>8&255),t.Zones[i].Generators.length>1&&t.Zones[i].Generators[1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(f=t.Zones[i].Generators[1].get_AmountInt16()&255,e=t.Zones[i].Generators[1].get_AmountInt16()>>8&255):(e=t.Zones[i].Generators[1].get_AmountInt16()&255,f=t.Zones[i].Generators[1].get_AmountInt16()>>8&255))):t.Zones[i].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(f=t.Zones[i].Generators[0].get_AmountInt16()&255,e=t.Zones[i].Generators[0].get_AmountInt16()>>8&255):(e=t.Zones[i].Generators[0].get_AmountInt16()&255,f=t.Zones[i].Generators[0].get_AmountInt16()>>8&255)),t.Zones[i].Generators[t.Zones[i].Generators.length-1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.Instrument){l=rt[t.Zones[i].Generators[t.Zones[i].Generators.length-1].get_AmountInt16()];for(var a=0,et=l.length,r=l[a];a<et;a++,r=l[a])AlphaSynth.Platform.TypeUtils.IsLittleEndian?(d=r.Generators[43]&255,g=r.Generators[43]>>8&255,nt=r.Generators[44]&255,tt=r.Generators[44]>>8&255):(g=r.Generators[43]&255,d=r.Generators[43]>>8&255,tt=r.Generators[44]&255,nt=r.Generators[44]>>8&255),d<=k&&b<=g&&nt<=e&&f<=tt&&(o=new AlphaSynth.Sf2.Sf2Region,AlphaSynth.Platform.Std.ArrayCopy(r.Generators,0,o.Generators,0,o.Generators.length),this.ReadSf2Region(o,p,t.Zones[i].Generators,!0),w.push(o))}i++}s=new AlphaSynth.Bank.Patch.MultiPatch(t.Name);s.LoadSf2(w.slice(0),this._assets);this._assets.PatchAssets.push(new AlphaSynth.Bank.PatchAsset(s.Name,s));this.AssignPatchToBank(s,t.BankNumber,t.PatchNumber,t.PatchNumber)}},ReadSf2Instruments:function(n){for(var e,u,i,f,r=new Array(n.length),t=0;t<n.length;t++)for(e=null,n[t].Zones[0].Generators.length==0||n[t].Zones[0].Generators[n[t].Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.SampleID?(e=n[t].Zones[0].Generators,u=1):u=0,r[t]=new Array(n[t].Zones.length-u),i=0;i<r[t].length;i++)f=new AlphaSynth.Sf2.Sf2Region,f.ApplyDefaultValues(),this.ReadSf2Region(f,e,n[t].Zones[i+u].Generators,!1),r[t][i]=f;return r},ReadSf2Region:function(n,t,i,r){var e,l,c,u,f,o,s,a,v;if(r){e=[];for(var h=0,p=i.length,y=i[h];h<p;h++,y=i[h])e.push(y);if(t!=null)for(u=0;u<t.length;u++){for(l=!1,c=0;c<e.length;c++)if(e[c].GeneratorType==t[u].GeneratorType){l=!0;break}l||e.push(t[u])}for(u=0;u<e.length;u++)if(f=e[u].GeneratorType,f<5||f==12||f==45||f==46||f==47||f==50||f==54||f==57||f==58)continue;else if(f==43||f==44){if(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(o=n.Generators[f]&255,s=n.Generators[f]>>8&255,a=e[u].get_AmountInt16()&255,v=e[u].get_AmountInt16()>>8&255):(s=n.Generators[f]&255,o=n.Generators[f]>>8&255,v=e[u].get_AmountInt16()&255,a=e[u].get_AmountInt16()>>8&255),o=Math.max(o,a),s=Math.min(s,v),o>s)throw $CreateException(new System.Exception.ctor$$String("Invalid sf2 region. The range generators do not intersect."),new Error);n.Generators[f]=AlphaSynth.Platform.TypeUtils.IsLittleEndian?AlphaSynth.Platform.TypeUtils.ToInt16(o|s<<8):AlphaSynth.Platform.TypeUtils.ToInt16(o<<8|s)}else n.Generators[f]=AlphaSynth.Platform.TypeUtils.ToInt16(n.Generators[f]+e[u].get_AmountInt16())}else{if(t!=null)for(u=0;u<t.length;u++)n.Generators[t[u].GeneratorType]=t[u].get_AmountInt16();for(u=0;u<i.length;u++)n.Generators[i[u].GeneratorType]=i[u].get_AmountInt16()}},AssignPatchToBank:function(n,t,i,r){var e,u,f;if(!(t<0)){if(i>r&&(e=i,i=r,r=e),i<0||i>=128)throw $CreateException(new System.Exception.ctor$$String("startRange out of range"),new Error);if(r<0||r>=128)throw $CreateException(new System.Exception.ctor$$String("endRange out of range"),new Error);for(this._bank.hasOwnProperty(t)?u=this._bank[t]:(u=new Array(128),this._bank[t]=u),f=i;f<=r;f++)u[f]=n}}},$StaticConstructor(function(){AlphaSynth.Bank.PatchBank.DrumBank=128;AlphaSynth.Bank.PatchBank.BankSize=128}),AlphaSynth.Bank.PatchAsset=function(n,t){this.Name=null;this.Patch=null;this.Name=n;this.Patch=t},AlphaSynth.Ds=AlphaSynth.Ds||{},AlphaSynth.Ds.LinkedList=function(){this.First=null;this.Length=0;this.Length=0},AlphaSynth.Ds.LinkedList.prototype={AddFirst:function(n){var t=new AlphaSynth.Ds.LinkedListNode;t.Value=n;this.First==null?this.InsertNodeToEmptyList(t):(this.InsertNodeBefore(this.First,t),this.First=t)},AddLast:function(n){var t=new AlphaSynth.Ds.LinkedListNode;t.Value=n;this.First==null?this.InsertNodeToEmptyList(t):this.InsertNodeBefore(this.First,t)},RemoveFirst:function(){if(this.First==null)return null;var n=this.First.Value;return this.Remove(this.First),n},RemoveLast:function(){if(this.First==null)return null;var n=this.First._prev!=null?this.First._prev.Value:null;return this.Remove(this.First._prev),n},Remove:function(n){n._next==n?this.First=null:(n._next._prev=n._prev,n._prev._next=n._next,this.First==n&&(this.First=n._next));n.Invalidate();this.Length--},InsertNodeBefore:function(n,t){t._next=n;t._prev=n._prev;n._prev._next=t;n._prev=t;t._list=this;this.Length++},InsertNodeToEmptyList:function(n){n._next=n;n._prev=n;n._list=this;this.First=n;this.Length++}},AlphaSynth.Ds.LinkedListNode=function(){this._list=null;this._next=null;this._prev=null;this.Value=null},AlphaSynth.Ds.LinkedListNode.prototype={get_Next:function(){return this._next==null||this._list.First==this._next?null:this._next},get_Prev:function(){return this._prev==null||this==this._list.First?null:this._prev},Invalidate:function(){this._list=null;this._next=null;this._prev=null}},AlphaSynth.Ds.CircularSampleBuffer=function(n){this._buffer=null;this._writePosition=0;this._readPosition=0;this._sampleCount=0;this._buffer=new Float32Array(n);this._writePosition=0;this._readPosition=0;this._sampleCount=0},AlphaSynth.Ds.CircularSampleBuffer.prototype={get_Count:function(){return this._sampleCount},Clear:function(){this._readPosition=0;this._writePosition=0;this._sampleCount=0;this._buffer=new Float32Array(this._buffer.length)},Write:function(n,t,i){var r=0,u;return i>this._buffer.length-this._sampleCount&&(i=this._buffer.length-this._sampleCount),u=Math.min(this._buffer.length-this._writePosition,i),this._buffer.set(n.subarray(t,t+u),this._writePosition),this._writePosition+=u,this._writePosition%=this._buffer.length,r+=u,r<i&&(this._buffer.set(n.subarray(t+r,t+r+i-r),this._writePosition),this._writePosition+=i-r,r=i),this._sampleCount+=r,r},Read:function(n,t,i){i>this._sampleCount&&(i=this._sampleCount);var r=0,u=Math.min(this._buffer.length-this._readPosition,i);return n.set(this._buffer.subarray(this._readPosition,this._readPosition+u),t),r+=u,this._readPosition+=u,this._readPosition%=this._buffer.length,r<i&&(n.set(this._buffer.subarray(this._readPosition,this._readPosition+i-r),t+r),this._readPosition+=i-r,r=i),this._sampleCount-=r,r}},AlphaSynth.IO=AlphaSynth.IO||{},AlphaSynth.IO.ByteBuffer=function(){this._buffer=null;this._capacity=0;this._position=0;this.Length=0},AlphaSynth.IO.ByteBuffer.prototype={get_Position:function(){return this._position},set_Position:function(n){this._position=n},GetBuffer:function(){return this._buffer},Reset:function(){this.set_Position(0)},Skip:function(n){this.set_Position(this.get_Position()+n)},SetCapacity:function(n){if(n!=this._capacity){if(n>0){var t=new Uint8Array(n);this.Length>0&&t.set(this._buffer.subarray(0,0+this.Length),0);this._buffer=t}else this._buffer=null;this._capacity=n}},ReadByte:function(){var t=this.Length-this.get_Position(),n;return t<=0?-1:(n=this._buffer[this.get_Position()],this.set_Position(this.get_Position()+1),n)},Read:function(n,t,i){var r=this.Length-this.get_Position(),u;if(r>i&&(r=i),r<=0)return 0;if(r<=8)for(u=r;--u>=0;)n[t+u]=this._buffer[this.get_Position()+u];else n.set(this._buffer.subarray(this.get_Position(),this.get_Position()+r),t);return this.set_Position(this.get_Position()+r),r},WriteByte:function(n){var t=new Uint8Array(1);t[0]=n;this.Write(t,0,1)},Write:function(n,t,i){var r=this.get_Position()+i,u;if(r>this.Length&&(r>this._capacity&&this.EnsureCapacity(r),this.Length=r),i<=8&&n!=this._buffer)for(u=i;--u>=0;)this._buffer[this.get_Position()+u]=n[t+u];else this._buffer.set(n.subarray(t,t+i),this.get_Position());this.set_Position(r)},EnsureCapacity:function(n){if(n>this._capacity){var t=n;t<256&&(t=256);t<this._capacity*2&&(t=this._capacity*2);this.SetCapacity(t)}},ToArray:function(){var n=new Uint8Array(this.Length);return n.set(this._buffer.subarray(0,0+this.Length),0),n}},AlphaSynth.IO.ByteBuffer.Empty=function(){return AlphaSynth.IO.ByteBuffer.WithCapactiy(0)},AlphaSynth.IO.ByteBuffer.WithCapactiy=function(n){var t=new AlphaSynth.IO.ByteBuffer;return t._buffer=new Uint8Array(n),t._capacity=n,t},AlphaSynth.IO.ByteBuffer.FromBuffer=function(n){var t=new AlphaSynth.IO.ByteBuffer;return t._buffer=n,t._capacity=t.Length=n.length,t},AlphaSynth.Midi=AlphaSynth.Midi||{},AlphaSynth.Midi.Event=AlphaSynth.Midi.Event||{},AlphaSynth.Midi.Event.MidiEvent=function(n,t,i,r){this.Message=0;this.DeltaTime=0;this.DeltaTime=n;this.Message=t|i<<8|r<<16},AlphaSynth.Midi.Event.MidiEvent.prototype={get_Channel:function(){return this.Message&15},get_Command:function(){return this.Message&240},get_Data1:function(){return(this.Message&65280)>>8},get_Data2:function(){return(this.Message&16711680)>>16}},AlphaSynth.Midi.Event.SystemCommonEvent=function(n,t,i,r){AlphaSynth.Midi.Event.MidiEvent.call(this,n,t,i,r)},AlphaSynth.Midi.Event.SystemCommonEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return this.Message&255}},$Inherit(AlphaSynth.Midi.Event.SystemCommonEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.SystemExclusiveEvent=function(n,t,i,r){this.Data=null;AlphaSynth.Midi.Event.SystemCommonEvent.call(this,n,t,i&255,i>>8);this.Data=r},AlphaSynth.Midi.Event.SystemExclusiveEvent.prototype={get_ManufacturerId:function(){return this.Message>>8}},$Inherit(AlphaSynth.Midi.Event.SystemExclusiveEvent,AlphaSynth.Midi.Event.SystemCommonEvent),AlphaSynth.Midi.Event.SystemCommonTypeEnum={SystemExclusive:240,MtcQuarterFrame:241,SongPosition:242,SongSelect:243,TuneRequest:246,SystemExclusive2:247},AlphaSynth.Midi.Event.RealTimeTypeEnum={MidiClock:248,MidiTick:249,MidiStart:250,MidiContinue:252,MidiStop:253,ActiveSense:254,Reset:255},AlphaSynth.Midi.Event.RealTimeEvent=function(n,t,i,r){AlphaSynth.Midi.Event.MidiEvent.call(this,n,t,i,r)},AlphaSynth.Midi.Event.RealTimeEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return this.Message&255}},$Inherit(AlphaSynth.Midi.Event.RealTimeEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MidiEventTypeEnum={NoteOff:128,NoteOn:144,NoteAftertouch:160,Controller:176,ProgramChange:192,ChannelAftertouch:208,PitchBend:224,Meta:255},AlphaSynth.Midi.Event.ControllerTypeEnum={BankSelectCoarse:0,ModulationCoarse:1,BreathControllerCoarse:2,FootControllerCoarse:4,PortamentoTimeCoarse:5,DataEntryCoarse:6,VolumeCoarse:7,BalanceCoarse:8,PanCoarse:10,ExpressionControllerCoarse:11,EffectControl1Coarse:12,EffectControl2Coarse:13,GeneralPurposeSlider1:16,GeneralPurposeSlider2:17,GeneralPurposeSlider3:18,GeneralPurposeSlider4:19,BankSelectFine:32,ModulationFine:33,BreathControllerFine:34,FootControllerFine:36,PortamentoTimeFine:37,DataEntryFine:38,VolumeFine:39,BalanceFine:40,PanFine:42,ExpressionControllerFine:43,EffectControl1Fine:44,EffectControl2Fine:45,HoldPedal:64,Portamento:65,SostenutoPedal:66,SoftPedal:67,LegatoPedal:68,Hold2Pedal:69,SoundVariation:70,SoundTimbre:71,SoundReleaseTime:72,SoundAttackTime:73,SoundBrightness:74,SoundControl6:75,SoundControl7:76,SoundControl8:77,SoundControl9:78,SoundControl10:79,GeneralPurposeButton1:80,GeneralPurposeButton2:81,GeneralPurposeButton3:82,GeneralPurposeButton4:83,EffectsLevel:91,TremuloLevel:92,ChorusLevel:93,CelesteLevel:94,PhaseLevel:95,DataButtonIncrement:96,DataButtonDecrement:97,NonRegisteredParameterFine:98,NonRegisteredParameterCourse:99,RegisteredParameterFine:100,RegisteredParameterCourse:101,AllSoundOff:120,ResetControllers:121,LocalKeyboard:122,AllNotesOff:123,OmniModeOff:124,OmniModeOn:125,MonoMode:126,PolyMode:127},AlphaSynth.Midi.Event.MetaEvent=function(n,t,i,r){AlphaSynth.Midi.Event.MidiEvent.call(this,n,t,i,r)},AlphaSynth.Midi.Event.MetaEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return this.Message&255},get_MetaStatus:function(){return this.get_Data1()}},$Inherit(AlphaSynth.Midi.Event.MetaEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MetaTextEvent=function(n,t,i,r){this.Text=null;AlphaSynth.Midi.Event.MetaEvent.call(this,n,t,i,0);this.Text=r},$Inherit(AlphaSynth.Midi.Event.MetaTextEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaNumberEvent=function(n,t,i,r){this.Value=0;AlphaSynth.Midi.Event.MetaEvent.call(this,n,t,i,0);this.Value=r},$Inherit(AlphaSynth.Midi.Event.MetaNumberEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaEventTypeEnum={SequenceNumber:0,TextEvent:1,CopyrightNotice:2,SequenceOrTrackName:3,InstrumentName:4,LyricText:5,MarkerText:6,CuePoint:7,PatchName:8,PortName:9,MidiChannel:32,MidiPort:33,EndOfTrack:47,Tempo:81,SmpteOffset:84,TimeSignature:88,KeySignature:89,SequencerSpecific:127},AlphaSynth.Midi.Event.MetaDataEvent=function(n,t,i,r){this.Data=null;AlphaSynth.Midi.Event.MetaEvent.call(this,n,t,i,0);this.Data=r},$Inherit(AlphaSynth.Midi.Event.MetaDataEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.MidiTrack=function(n,t,i,r){this.Instruments=null;this.DrumInstruments=null;this.ActiveChannels=null;this.MidiEvents=null;this.NoteOnCount=0;this.EndTime=0;this.Instruments=n;this.DrumInstruments=t;this.ActiveChannels=i;this.MidiEvents=r;this.NoteOnCount=0;this.EndTime=0},AlphaSynth.Midi.MidiHelper=function(){},$StaticConstructor(function(){AlphaSynth.Midi.MidiHelper.MicroSecondsPerMinute=6e7;AlphaSynth.Midi.MidiHelper.MinChannel=0;AlphaSynth.Midi.MidiHelper.MaxChannel=15;AlphaSynth.Midi.MidiHelper.DrumChannel=9}),AlphaSynth.Midi.MidiFile=function(){this.Division=0;this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack;this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat;this.Tracks=null;this.Division=0;this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack;this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},AlphaSynth.Midi.MidiFile.prototype={CombineTracks:function(){for(var o,f,h,n,l,i=this.MergeTracks(),t=new Array(this.Tracks.length),r=0;r<this.Tracks.length;r++)for(t[r]=new Array(this.Tracks[r].MidiEvents.length),o=0,f=0;f<this.Tracks[r].MidiEvents.length;f++)t[r][f]=this.Tracks[r].MidiEvents[f],o+=t[r][f].DeltaTime,t[r][f].DeltaTime=o;var s=0,c=0,e=2147483647,u=new Int32Array(t.length);for(AlphaSynth.Platform.TypeUtils.ClearIntArray(u);s<i.MidiEvents.length;){for(n=0;n<t.length;n++){while(u[n]<t[n].length&&t[n][u[n]].DeltaTime==c)i.MidiEvents[s]=t[n][u[n]],s++,u[n]++;u[n]<t[n].length&&t[n][u[n]].DeltaTime<e&&(e=t[n][u[n]].DeltaTime)}c=e;e=2147483647}for(i.EndTime=i.MidiEvents[i.MidiEvents.length-1].DeltaTime,h=0,n=0;n<i.MidiEvents.length;n++)l=i.MidiEvents[n].DeltaTime,i.MidiEvents[n].DeltaTime-=h,h=l;this.Tracks=[i];this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack},MergeTracks:function(){for(var n,i,e,o=0,s=0,r=[],u=[],f=[],t=0;t<this.Tracks.length;t++){for(o+=this.Tracks[t].MidiEvents.length,s+=this.Tracks[t].NoteOnCount,n=0;n<this.Tracks[t].Instruments.length;n++)i=this.Tracks[t].Instruments[n],Array.prototype.indexOf.call(r,i)==-1&&r.push(i);for(n=0;n<this.Tracks[t].DrumInstruments.length;n++)i=this.Tracks[t].DrumInstruments[n],Array.prototype.indexOf.call(u,i)==-1&&u.push(i);for(n=0;n<this.Tracks[t].ActiveChannels.length;n++)i=this.Tracks[t].ActiveChannels[n],Array.prototype.indexOf.call(f,i)==-1&&f.push(i)}return e=new AlphaSynth.Midi.MidiTrack(r.slice(0),u.slice(0),f.slice(0),new Array(o)),e.NoteOnCount=s,e},Load:function(n){if(!this.FindHead(n,500))throw $CreateException(new System.Exception.ctor$$String("Invalid midi file : MThd chunk could not be found."),new Error);this.ReadHeader(n);for(var t=0;t<this.Tracks.length;t++)this.Tracks[t]=this.ReadTrack(n)},FindHead:function(n,t){for(var i=0;t>0;){switch(n.ReadByte()){case 77:i=1;break;case 84:i=i==1?2:0;break;case 104:i=i==2?3:0;break;case 100:if(i==3)return!0;i=0}t--}return!1},ReadHeader:function(n){if(AlphaSynth.Util.IOHelper.ReadInt32BE(n)!=6)throw $CreateException(new System.Exception.ctor$$String("Midi header is invalid."),new Error);this.TrackFormat=AlphaSynth.Util.IOHelper.ReadInt16BE(n);this.Tracks=new Array(AlphaSynth.Util.IOHelper.ReadInt16BE(n));var t=AlphaSynth.Util.IOHelper.ReadInt16BE(n);this.Division=t&32767;this.TimingStandard=(t&32768)>0?AlphaSynth.Midi.MidiTimeFormat.FramesPerSecond:AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},ReadTrack:function(n){for(var f=[],e=[],s=[],i=[],u=0,a=0,c,l,o,r,t,h;AlphaSynth.Util.IOHelper.Read8BitChars(n,4)!="MTrk";)for(c=AlphaSynth.Util.IOHelper.ReadInt32BE(n);c>0;)c--,n.ReadByte();for(l=AlphaSynth.Util.IOHelper.ReadInt32BE(n)+n.get_Position(),o=0;n.get_Position()<l;)if(r=AlphaSynth.Midi.MidiFile.ReadVariableLength(n),a+=r,t=n.ReadByte(),t>=128&&t<=239)o=t,i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(n,r,t,n.ReadByte())),u=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],f,e,s,u);else if(t>=240&&t<=247)o=0,i.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(n,r,t));else if(t>=248&&t<=255)i.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(n,r,t));else if(o==0){while((t&128)!=128)t=n.ReadByte();t>=128&&t<=239?(o=t,i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(n,r,t,n.ReadByte())),u=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],f,e,s,u)):t>=240&&t<=247?i.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(n,r,t)):t>=248&&t<=255&&i.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(n,r,t))}else i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(n,r,o,t)),u=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],f,e,s,u);if(n.get_Position()!=l)throw $CreateException(new System.Exception.ctor$$String("The track length was invalid for the current MTrk chunk."),new Error);return Array.prototype.indexOf.call(s,9)!=-1?Array.prototype.indexOf.call(e,0)==-1&&e.push(0):Array.prototype.indexOf.call(f,0)==-1&&f.push(0),h=new AlphaSynth.Midi.MidiTrack(f.slice(0),e.slice(0),s.slice(0),i.slice(0)),h.NoteOnCount=u,h.EndTime=a,h}},AlphaSynth.Midi.MidiFile.ReadMetaMessage=function(n,t,i){var r=n.ReadByte(),u,f,e;switch(r){case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceNumber:if(u=n.ReadByte(),u==0)return new AlphaSynth.Midi.Event.MetaNumberEvent(t,i,r,-1);if(u==2)return new AlphaSynth.Midi.Event.MetaNumberEvent(t,i,r,AlphaSynth.Util.IOHelper.ReadInt16BE(n));throw $CreateException(new System.Exception.ctor$$String("Invalid sequence number event."),new Error);case AlphaSynth.Midi.Event.MetaEventTypeEnum.TextEvent:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.CopyrightNotice:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceOrTrackName:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.InstrumentName:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.LyricText:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.MarkerText:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.CuePoint:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.PatchName:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.PortName:return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,AlphaSynth.Midi.MidiFile.ReadString(n));case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiChannel:if(n.ReadByte()!=1)throw $CreateException(new System.Exception.ctor$$String("Invalid midi channel event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiPort:if(n.ReadByte()!=1)throw $CreateException(new System.Exception.ctor$$String("Invalid midi port event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.EndOfTrack:return new AlphaSynth.Midi.Event.MetaEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.Tempo:if(n.ReadByte()!=3)throw $CreateException(new System.Exception.ctor$$String("Invalid tempo event. Expected size of 3."),new Error);return new AlphaSynth.Midi.Event.MetaNumberEvent(t,i,r,n.ReadByte()<<16|n.ReadByte()<<8|n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SmpteOffset:if(n.ReadByte()!=5)throw $CreateException(new System.Exception.ctor$$String("Invalid smpte event. Expected size of 5."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,n.ReadByte()+":"+n.ReadByte()+":"+n.ReadByte()+":"+n.ReadByte()+":"+n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.TimeSignature:if(n.ReadByte()!=4)throw $CreateException(new System.Exception.ctor$$String("Invalid time signature event. Expected size of 4."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,n.ReadByte()+":"+n.ReadByte()+":"+n.ReadByte()+":"+n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.KeySignature:if(n.ReadByte()!=2)throw $CreateException(new System.Exception.ctor$$String("Invalid key signature event. Expected size of 2."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(t,i,r,n.ReadByte()+":"+n.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequencerSpecific:return f=AlphaSynth.Midi.MidiFile.ReadVariableLength(n),e=AlphaSynth.Util.IOHelper.ReadByteArray(n,f),new AlphaSynth.Midi.Event.MetaDataEvent(t,i,r,e)}throw $CreateException(new System.Exception.ctor$$String("Not a valid meta message Status: "+i+" Meta: "+r),new Error);},AlphaSynth.Midi.MidiFile.ReadRealTimeMessage=function(n,t,i){switch(i){case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiClock:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiTick:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStart:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiContinue:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStop:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.ActiveSense:return new AlphaSynth.Midi.Event.RealTimeEvent(t,i,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.Reset:return AlphaSynth.Midi.MidiFile.ReadMetaMessage(n,t,i);default:throw $CreateException(new System.Exception.ctor$$String("The real time message was invalid or unsupported : "+i),new Error);}},AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage=function(n,t,i){var r,f,u;switch(i){case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive2:case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive:if(r=AlphaSynth.Util.IOHelper.ReadInt16BE(n),r==0)r=AlphaSynth.Util.IOHelper.ReadInt16BE(n);else if(r==247)return null;for(f=[],u=n.ReadByte();u!=247;)f.push(u),u=n.ReadByte();return new AlphaSynth.Midi.Event.SystemExclusiveEvent(t,i,r,f.slice(0));case AlphaSynth.Midi.Event.SystemCommonTypeEnum.MtcQuarterFrame:return new AlphaSynth.Midi.Event.SystemCommonEvent(t,i,n.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongPosition:return new AlphaSynth.Midi.Event.SystemCommonEvent(t,i,n.ReadByte(),n.ReadByte());case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongSelect:return new AlphaSynth.Midi.Event.SystemCommonEvent(t,i,n.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.TuneRequest:return new AlphaSynth.Midi.Event.SystemCommonEvent(t,i,0,0);default:throw $CreateException(new System.Exception.ctor$$String("The system common message was invalid or unsupported : "+i),new Error);}},AlphaSynth.Midi.MidiFile.ReadVoiceMessage=function(n,t,i,r){switch(i&240){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:var u=n.ReadByte();return u==0&&(i=i&15|128),new AlphaSynth.Midi.Event.MidiEvent(t,i,r,u);case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteAftertouch:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,n.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,0);case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,0);case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:return new AlphaSynth.Midi.Event.MidiEvent(t,i,r,n.ReadByte());default:throw $CreateException(new System.Exception.ctor$$String("The status provided was not that of a voice message."),new Error);}},AlphaSynth.Midi.MidiFile.TrackVoiceStats=function(n,t,i,r,u){var f,e;return n.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn?(f=n.get_Channel(),Array.prototype.indexOf.call(r,f)==-1&&r.push(f),u++):n.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange&&(f=n.get_Channel(),e=n.get_Data1(),f==9?Array.prototype.indexOf.call(i,e)==-1&&i.push(e):Array.prototype.indexOf.call(t,e)==-1&&t.push(e)),u},AlphaSynth.Midi.MidiFile.ReadVariableLength=function(n){var t=0,i;do i=n.ReadByte(),t=t<<7,t=t|i&127;while((i&128)==128);return t},AlphaSynth.Midi.MidiFile.ReadString=function(n){var t=AlphaSynth.Midi.MidiFile.ReadVariableLength(n);return AlphaSynth.Util.IOHelper.Read8BitChars(n,t)},AlphaSynth.Midi.MidiTrackFormat={SingleTrack:0,MultiTrack:1,MultiSong:2},AlphaSynth.Midi.MidiTimeFormat={TicksPerBeat:0,FramesPerSecond:1},AlphaSynth.Player.SynthPlayerState={Stopped:0,Playing:1,Paused:2},AlphaSynth.Player.SynthPlayer=function(){this._tickPosition=0;this._timePosition=0;this._playbackSpeed=0;this.PositionChanged=null;this.PlayerStateChanged=null;this.Finished=null;this.SoundFontLoad=null;this.SoundFontLoaded=null;this.SoundFontLoadFailed=null;this.MidiLoad=null;this.MidiLoaded=null;this.MidiLoadFailed=null;this.ReadyForPlay=null;this.Output=null;this.Synth=null;this.Sequencer=null;this.State=AlphaSynth.Player.SynthPlayerState.Stopped;this.IsSoundFontLoaded=!1;this.IsMidiLoaded=!1;AlphaSynth.Util.Logger.Debug("Initializing player");this.State=AlphaSynth.Player.SynthPlayerState.Stopped;this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State));AlphaSynth.Util.Logger.Debug("Opening output");this.Output=AlphaSynth.Platform.Platform.CreateOutput();AlphaSynth.Util.Logger.Debug("Creating synthesizer");this.Synth=new AlphaSynth.Synthesis.Synthesizer(this.Output.get_SampleRate(),2,441,3,100);this.Sequencer=new AlphaSynth.Sequencer.MidiFileSequencer(this.Synth);this.Sequencer.AddFinishedListener($CreateDelegate(this.Output,this.Output.SequencerFinished));this.Output.add_Finished($CreateAnonymousDelegate(this,function(){this.Stop();AlphaSynth.Util.Logger.Debug("Finished playback");this.OnFinished()}));this.Output.add_SampleRequest($CreateAnonymousDelegate(this,function(){this.Sequencer.FillMidiEventQueue();this.Synth.Synthesize();this.Output.AddSamples(this.Synth.SampleBuffer)}));this.Output.add_PositionChanged($CreateAnonymousDelegate(this,function(n){this.FirePositionChanged(n)}));this.Output.Open()},AlphaSynth.Player.SynthPlayer.prototype={get_TickPosition:function(){return this._tickPosition},set_TickPosition:function(n){this.set_TimePosition(this.Sequencer.TicksToMillis(n)/this.Sequencer.PlaybackSpeed|0)},get_MasterVolume:function(){return this.Synth.get_MasterVolume()},set_MasterVolume:function(n){this.Synth.set_MasterVolume(n)},get_TimePosition:function(){return this._timePosition},set_TimePosition:function(n){AlphaSynth.Util.Logger.Debug("Seeking to position "+n+"ms");this.State==AlphaSynth.Player.SynthPlayerState.Playing&&(this.Sequencer.Pause(),this.Output.Pause());this.Sequencer.Seek(n);this.Output.Seek(n);this.State==AlphaSynth.Player.SynthPlayerState.Playing&&(this.Sequencer.Play(),this.Output.Play())},get_PlaybackSpeed:function(){return this._playbackSpeed},set_PlaybackSpeed:function(n){this._playbackSpeed=AlphaSynth.Synthesis.SynthHelper.ClampF(n,.125,8);this.Sequencer.PlaybackSpeed=this._playbackSpeed;this.Output.SetPlaybackSpeed(this._playbackSpeed)},get_IsReady:function(){return this.IsSoundFontLoaded&&this.IsMidiLoaded},Play:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Starting playback"),this.Sequencer.Play(),this.Output.Play(),this.State=AlphaSynth.Player.SynthPlayerState.Playing,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)))},Pause:function(){this.State==AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Pausing playback"),this.Sequencer.Pause(),this.Output.Pause(),this.State=AlphaSynth.Player.SynthPlayerState.Paused,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)))},PlayPause:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Playing&&this.get_IsReady()?this.Play():this.Pause()},Stop:function(){this.State!=AlphaSynth.Player.SynthPlayerState.Stopped&&this.get_IsReady()&&(AlphaSynth.Util.Logger.Debug("Stopping playback"),this.Sequencer.Stop(),this.Synth.Stop(),this.Output.Stop(),this.State=AlphaSynth.Player.SynthPlayerState.Stopped,this.OnPlayerStateChanged(new AlphaSynth.Player.PlayerStateChangedEventArgs(this.State)),this.FirePositionChanged(0))},LoadSoundFontUrl:function(n){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){AlphaSynth.Util.Logger.Info("Start loading soundfont from url "+n);var t=new AlphaSynth.Util.UrlLoader;t.Url=n;t.Method="GET";t.Complete=$CreateDelegate(this,this.LoadSoundFontBytes);t.Progress=$CreateDelegate(this,this.OnLoaderSoundFontLoad);try{t.Load()}catch(i){AlphaSynth.Util.Logger.Error("Could not load soundfont from url: "+i)}}},LoadSoundFontBytes:function(n){var i,t;if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){i=AlphaSynth.IO.ByteBuffer.FromBuffer(n);try{AlphaSynth.Util.Logger.Info("Loading soundfont from bytes");t=new AlphaSynth.Bank.PatchBank;t.LoadSf2(i);this.Synth.LoadBank(t);this.IsSoundFontLoaded=!0;this.OnSoundFontLoaded();AlphaSynth.Util.Logger.Info("soundFont successfully loaded");this.get_IsReady()&&this.OnReadyForPlay()}catch(r){AlphaSynth.Util.Logger.Error("Could not load soundfont from bytes "+r);this.IsSoundFontLoaded=!1;this.Synth.UnloadBank();this.OnSoundFontLoadFailed()}}},LoadMidiUrl:function(n){if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){AlphaSynth.Util.Logger.Info("Start loading midi from url "+n);var t=new AlphaSynth.Util.UrlLoader;t.Url=n;t.Method="GET";t.Complete=$CreateDelegate(this,this.LoadMidiBytes);t.Progress=$CreateDelegate(this,this.OnLoaderMidiLoad);try{t.Load()}catch(i){AlphaSynth.Util.Logger.Error("Could not load midi from url: "+i)}}},LoadMidiBytes:function(n){var i,t;if(this.State==AlphaSynth.Player.SynthPlayerState.Stopped){i=AlphaSynth.IO.ByteBuffer.FromBuffer(n);try{AlphaSynth.Util.Logger.Info("Loading midi from bytes");t=new AlphaSynth.Midi.MidiFile;t.Load(i);this.Sequencer.LoadMidi(t);this.IsMidiLoaded=!0;this.OnMidiLoaded();AlphaSynth.Util.Logger.Info("Midi successfully loaded");this.get_IsReady()&&this.OnReadyForPlay();this.FirePositionChanged(0)}catch(r){AlphaSynth.Util.Logger.Error("Could not load midi from bytes "+r);this.IsMidiLoaded=!1;this.Sequencer.UnloadMidi();this.OnMidiLoadFailed()}}},OnLoaderSoundFontLoad:function(n,t){AlphaSynth.Util.Logger.Debug("Soundfont downloading: "+n+"/"+t+" bytes");this.OnSoundFontLoad(new AlphaSynth.Player.ProgressEventArgs(n,t))},OnLoaderMidiLoad:function(n,t){AlphaSynth.Util.Logger.Debug("Midi downloading: "+n+"/"+t+" bytes");this.OnMidiLoad(new AlphaSynth.Player.ProgressEventArgs(n,t))},FirePositionChanged:function(n){var t=(this.Sequencer.EndTime/this.Synth.SampleRate|0)*1e3,i=n,u=this.Sequencer.MillisToTicks(t),r=this.Sequencer.MillisToTicks(i);this._tickPosition=r;this._timePosition=i;AlphaSynth.Util.Logger.Debug("Position changed: (time: "+i+"/"+t+", tick: "+r+"/"+t+")");this.OnPositionChanged(new AlphaSynth.Player.PositionChangedEventArgs(i,t,r,u))},add_PositionChanged:function(n){this.PositionChanged=$CombineDelegates(this.PositionChanged,n)},remove_PositionChanged:function(n){this.PositionChanged=$RemoveDelegate(this.PositionChanged,n)},OnPositionChanged:function(n){var t=this.PositionChanged;t!=null&&t(this,n)},add_PlayerStateChanged:function(n){this.PlayerStateChanged=$CombineDelegates(this.PlayerStateChanged,n)},remove_PlayerStateChanged:function(n){this.PlayerStateChanged=$RemoveDelegate(this.PlayerStateChanged,n)},OnPlayerStateChanged:function(n){var t=this.PlayerStateChanged;t!=null&&t(this,n)},add_Finished:function(n){this.Finished=$CombineDelegates(this.Finished,n)},remove_Finished:function(n){this.Finished=$RemoveDelegate(this.Finished,n)},OnFinished:function(){var n=this.Finished;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_SoundFontLoad:function(n){this.SoundFontLoad=$CombineDelegates(this.SoundFontLoad,n)},remove_SoundFontLoad:function(n){this.SoundFontLoad=$RemoveDelegate(this.SoundFontLoad,n)},OnSoundFontLoad:function(n){var t=this.SoundFontLoad;t!=null&&t(this,n)},add_SoundFontLoaded:function(n){this.SoundFontLoaded=$CombineDelegates(this.SoundFontLoaded,n)},remove_SoundFontLoaded:function(n){this.SoundFontLoaded=$RemoveDelegate(this.SoundFontLoaded,n)},OnSoundFontLoaded:function(){var n=this.SoundFontLoaded;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_SoundFontLoadFailed:function(n){this.SoundFontLoadFailed=$CombineDelegates(this.SoundFontLoadFailed,n)},remove_SoundFontLoadFailed:function(n){this.SoundFontLoadFailed=$RemoveDelegate(this.SoundFontLoadFailed,n)},OnSoundFontLoadFailed:function(){var n=this.SoundFontLoadFailed;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_MidiLoad:function(n){this.MidiLoad=$CombineDelegates(this.MidiLoad,n)},remove_MidiLoad:function(n){this.MidiLoad=$RemoveDelegate(this.MidiLoad,n)},OnMidiLoad:function(n){var t=this.MidiLoad;t!=null&&t(this,n)},add_MidiLoaded:function(n){this.MidiLoaded=$CombineDelegates(this.MidiLoaded,n)},remove_MidiLoaded:function(n){this.MidiLoaded=$RemoveDelegate(this.MidiLoaded,n)},OnMidiLoaded:function(){var n=this.MidiLoaded;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_MidiLoadFailed:function(n){this.MidiLoadFailed=$CombineDelegates(this.MidiLoadFailed,n)},remove_MidiLoadFailed:function(n){this.MidiLoadFailed=$RemoveDelegate(this.MidiLoadFailed,n)},OnMidiLoadFailed:function(){var n=this.MidiLoadFailed;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)},add_ReadyForPlay:function(n){this.ReadyForPlay=$CombineDelegates(this.ReadyForPlay,n)},remove_ReadyForPlay:function(n){this.ReadyForPlay=$RemoveDelegate(this.ReadyForPlay,n)},OnReadyForPlay:function(){var n=this.ReadyForPlay;n!=null&&n(this,AlphaSynth.Player.EmptyEventArgs.Instance)}},AlphaSynth.Player.EmptyEventArgs=function(){},$StaticConstructor(function(){AlphaSynth.Player.EmptyEventArgs.Instance=new AlphaSynth.Player.EmptyEventArgs}),AlphaSynth.Player.ProgressEventArgs=function(n,t){this.Loaded=0;this.Total=0;this.Loaded=n;this.Total=t},AlphaSynth.Player.PlayerStateChangedEventArgs=function(n){this.State=AlphaSynth.Player.SynthPlayerState.Stopped;this.State=n},AlphaSynth.Player.PositionChangedEventArgs=function(n,t,i,r){this.CurrentTime=0;this.EndTime=0;this.CurrentTick=0;this.EndTick=0;this.CurrentTime=n;this.EndTime=t;this.CurrentTick=i;this.EndTick=r},AlphaSynth.Sequencer=AlphaSynth.Sequencer||{},AlphaSynth.Sequencer.MidiFileSequencer=function(n){this._synthData=null;this._tempoChanges=null;this._finished=null;this._blockList=null;this._eventIndex=0;this._division=0;this.Synth=null;this.IsPlaying=!1;this.CurrentTempo=0;this.CurrentTime=0;this.EndTime=0;this.PlaybackSpeed=0;this.Synth=n;this._eventIndex=0;this._division=0;this.PlaybackSpeed=1;this.IsPlaying=!1;this._blockList=new Array(16);this._finished=[];n.AddMidiMessageProcessed($CreateDelegate(this,this.MidiEventProcessed))},AlphaSynth.Sequencer.MidiFileSequencer.prototype={get_IsMidiLoaded:function(){return this._synthData!=null},AddFinishedListener:function(n){this._finished.push(n)},FireFinished:function(){for(var t,n=0;n<this._finished.length;n++)t=this._finished[n],t!=null&&t()},LoadMidi:function(n){return this.IsPlaying?!1:(this.LoadMidiFile(n),!0)},UnloadMidi:function(){return this.IsPlaying?!1:(this._synthData=null,!0)},Play:function(){this.IsPlaying||this._synthData==null||(this.IsPlaying=!0)},Pause:function(){this.IsPlaying=!1},Stop:function(){this.IsPlaying=!1;this.CurrentTime=0;this._eventIndex=0},IsChannelMuted:function(n){return this._blockList[n]},MuteAllChannels:function(){for(var n=0;n<this._blockList.length;n++)this._blockList[n]=!0},UnMuteAllChannels:function(){for(var n=0;n<this._blockList.length;n++)this._blockList[n]=!1},SetMute:function(n,t){this._blockList[n]=t},Seek:function(n){var t=this.Synth.SampleRate*(n/1e3)|0;t>this.CurrentTime?this.SilentProcess(t-this.CurrentTime):t<this.CurrentTime&&(this.CurrentTime=0,this._eventIndex=0,this.Synth.NoteOffAll(!0),this.Synth.ResetPrograms(),this.Synth.ResetSynthControls(),this.SilentProcess(t))},FillMidiEventQueue:function(){var t,i,n;if(this.IsPlaying&&this.Synth.MidiEventQueue.Length==0){if(this.CurrentTime>=this.EndTime){this.CurrentTime=0;this._eventIndex=0;this.IsPlaying=!1;this.Synth.NoteOffAll(!0);this.Synth.ResetPrograms();this.Synth.ResetSynthControls();this.FireFinished();return}for(t=this.Synth.MicroBufferSize*this.PlaybackSpeed|0,i=this.CurrentTime+t*this.Synth.MicroBufferCount,n=0;n<this.Synth.MicroBufferCount;n++)for(this.CurrentTime+=t;this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this.CurrentTime;)this._synthData[this._eventIndex].Event.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn&&this._blockList[this._synthData[this._eventIndex].Event.get_Channel()]||(this.Synth.MidiEventQueue.AddFirst(this._synthData[this._eventIndex]),this.Synth.MidiEventCounts[n]++),this._eventIndex++}},LoadMidiFile:function(n){var i,r,t,o;this._tempoChanges=[];i=120;(n.Tracks.length>1||n.Tracks[0].EndTime==0)&&n.CombineTracks();this._synthData=new Array(n.Tracks[0].MidiEvents.length);this._division=n.Division;this._eventIndex=0;this.CurrentTime=0;this.CurrentTempo=i|0;var u=0,f=0,e=0;for(r=0;r<n.Tracks[0].MidiEvents.length;r++)t=n.Tracks[0].MidiEvents[r],this._synthData[r]=new AlphaSynth.Synthesis.SynthEvent(t),f+=t.DeltaTime,e+=t.DeltaTime*(6e4/(i*n.Division)),u+=this.Synth.SampleRate*t.DeltaTime*(60/(i*n.Division)),this._synthData[r].Delta=u|0,this.IsTempoMessage(t.get_Command(),t.get_Data1())&&(o=t,i=6e7/o.Value|0,this._tempoChanges.push(new AlphaSynth.Sequencer.MidiFileSequencerTempoChange(i,f,e|0)));this.EndTime=this._synthData[this._synthData.length-1].Delta},MidiEventProcessed:function(n){if(this.IsTempoMessage(n.get_Command(),n.get_Data1())){var t=n;this.CurrentTempo=6e7/t.Value|0}},IsTempoMessage:function(n,t){return n==AlphaSynth.Midi.Event.MidiEventTypeEnum.Meta&&t==81},MillisToTicks:function(n){for(var t,r=0,u=120,f=0,i=0;i<this._tempoChanges.length;i++){if(t=this._tempoChanges[i],n<t.Time)break;r=t.Ticks;u=t.Bpm;f=t.Time}return n-=f,r+(n/(6e4/(u*this._division))|0)},TicksToMillis:function(n){for(var t,r=0,u=120,f=0,i=0;i<this._tempoChanges.length;i++){if(t=this._tempoChanges[i],n<t.Ticks)break;r=t.Time;u=t.Bpm;f=t.Ticks}return n-=f,r+(n*(6e4/(u*this._division))|0)},SilentProcess:function(n){if(!(n<=0)){while(this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this.CurrentTime+n){if(this._synthData[this._eventIndex].Event.get_Command()!=AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn){var t=this._synthData[this._eventIndex];this.Synth.ProcessMidiMessage(t.Event)}this._eventIndex++}this.CurrentTime+=n}}},AlphaSynth.Sequencer.MidiFileSequencerTempoChange=function(n,t,i){this.Bpm=0;this.Ticks=0;this.Time=0;this.Bpm=n;this.Ticks=t;this.Time=i},AlphaSynth.Sf2=AlphaSynth.Sf2||{},AlphaSynth.Sf2.Chunks=AlphaSynth.Sf2.Chunks||{},AlphaSynth.Sf2.Chunks.Chunk=function(n,t){this.Id=null;this.Size=0;this.Id=n;this.Size=t},AlphaSynth.Sf2.Chunks.ZoneChunk=function(n,t,i){var r,f,u;for(this._zoneData=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),this._zoneData=new Array(t/4|0),r=null,f=0;f<this._zoneData.length;f++)u=new AlphaSynth.Sf2.Chunks.RawZoneData,u.GeneratorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),u.ModulatorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),r!=null&&(r.GeneratorCount=u.GeneratorIndex-r.GeneratorIndex&65535,r.ModulatorCount=u.ModulatorIndex-r.ModulatorIndex&65535),this._zoneData[f]=u,r=u},AlphaSynth.Sf2.Chunks.ZoneChunk.prototype={ToZones:function(n,t){for(var i,r,f=new Array(this._zoneData.length-1),u=0;u<f.length;u++)i=this._zoneData[u],r=new AlphaSynth.Sf2.Zone,r.Generators=new Array(i.GeneratorCount),AlphaSynth.Platform.Std.ArrayCopy(t,i.GeneratorIndex,r.Generators,0,i.GeneratorCount),r.Modulators=new Array(i.ModulatorCount),AlphaSynth.Platform.Std.ArrayCopy(n,i.ModulatorIndex,r.Modulators,0,i.ModulatorCount),f[u]=r;return f}},$Inherit(AlphaSynth.Sf2.Chunks.ZoneChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawZoneData=function(){this.GeneratorIndex=0;this.ModulatorIndex=0;this.GeneratorCount=0;this.ModulatorCount=0},AlphaSynth.Sf2.Chunks.SampleHeaderChunk=function(n,t,i){if(this.SampleHeaders=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),t%46!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The sample header chunk was invalid."),new Error);this.SampleHeaders=new Array(t/46-1|0);for(var r=0;r<this.SampleHeaders.length;r++)this.SampleHeaders[r]=new AlphaSynth.Sf2.SampleHeader(i);new AlphaSynth.Sf2.SampleHeader(i)},$Inherit(AlphaSynth.Sf2.Chunks.SampleHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.PresetHeaderChunk=function(n,t,i){var u,f,r;if(this._rawPresets=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),t%38!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);for(this._rawPresets=new Array(t/38|0),u=null,f=0;f<this._rawPresets.length;f++)r=new AlphaSynth.Sf2.Chunks.RawPreset,r.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(i,20),r.PatchNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),r.BankNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),r.StartPresetZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),r.Library=AlphaSynth.Util.IOHelper.ReadInt32LE(i),r.Genre=AlphaSynth.Util.IOHelper.ReadInt32LE(i),r.Morphology=AlphaSynth.Util.IOHelper.ReadInt32LE(i),u!=null&&(u.EndPresetZoneIndex=r.StartPresetZoneIndex-1&65535),this._rawPresets[f]=r,u=r},AlphaSynth.Sf2.Chunks.PresetHeaderChunk.prototype={ToPresets:function(n){for(var i,t,u=new Array(this._rawPresets.length-1),r=0;r<u.length;r++)i=this._rawPresets[r],t=new AlphaSynth.Sf2.PresetHeader,t.BankNumber=i.BankNumber,t.Genre=i.Genre,t.Library=i.Library,t.Morphology=i.Morphology,t.Name=i.Name,t.PatchNumber=i.PatchNumber,t.Zones=new Array(i.EndPresetZoneIndex-i.StartPresetZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(n,i.StartPresetZoneIndex,t.Zones,0,t.Zones.length),u[r]=t;return u}},$Inherit(AlphaSynth.Sf2.Chunks.PresetHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawPreset=function(){this.Name=null;this.PatchNumber=0;this.BankNumber=0;this.StartPresetZoneIndex=0;this.EndPresetZoneIndex=0;this.Library=0;this.Genre=0;this.Morphology=0},AlphaSynth.Sf2.Chunks.ModulatorChunk=function(n,t,i){if(this.Modulators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),t%10!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid."),new Error);this.Modulators=new Array((t/10|0)-1);for(var r=0;r<this.Modulators.length;r++)this.Modulators[r]=new AlphaSynth.Sf2.Modulator(i);new AlphaSynth.Sf2.Modulator(i)},$Inherit(AlphaSynth.Sf2.Chunks.ModulatorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.InstrumentChunk=function(n,t,i){var u,f,r;if(this._rawInstruments=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),t%22!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);for(this._rawInstruments=new Array(t/22|0),u=null,f=0;f<this._rawInstruments.length;f++)r=new AlphaSynth.Sf2.Chunks.RawInstrument,r.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(i,20),r.StartInstrumentZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(i),u!=null&&(u.EndInstrumentZoneIndex=r.StartInstrumentZoneIndex-1&65535),this._rawInstruments[f]=r,u=r},AlphaSynth.Sf2.Chunks.InstrumentChunk.prototype={ToInstruments:function(n){for(var i,t,u=new Array(this._rawInstruments.length-1),r=0;r<u.length;r++)i=this._rawInstruments[r],t=new AlphaSynth.Sf2.Instrument,t.Name=i.Name,t.Zones=new Array(i.EndInstrumentZoneIndex-i.StartInstrumentZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(n,i.StartInstrumentZoneIndex,t.Zones,0,t.Zones.length),u[r]=t;return u}},$Inherit(AlphaSynth.Sf2.Chunks.InstrumentChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawInstrument=function(){this.Name=null;this.StartInstrumentZoneIndex=0;this.EndInstrumentZoneIndex=0},AlphaSynth.Sf2.Chunks.GeneratorChunk=function(n,t,i){if(this.Generators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,n,t),t%4!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid"),new Error);this.Generators=new Array(t/4-1|0);for(var r=0;r<this.Generators.length;r++)this.Generators[r]=new AlphaSynth.Sf2.Generator(i);new AlphaSynth.Sf2.Generator(i)},$Inherit(AlphaSynth.Sf2.Chunks.GeneratorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Modulator=function(n){this._sourceModulationData=null;this._destinationGenerator=0;this._amount=0;this._sourceModulationAmount=null;this._sourceTransform=0;this._sourceModulationData=new AlphaSynth.Sf2.ModulatorType(n);this._destinationGenerator=AlphaSynth.Util.IOHelper.ReadUInt16LE(n);this._amount=AlphaSynth.Util.IOHelper.ReadInt16LE(n);this._sourceModulationAmount=new AlphaSynth.Sf2.ModulatorType(n);this._sourceTransform=AlphaSynth.Util.IOHelper.ReadUInt16LE(n)},AlphaSynth.Sf2.Zone=function(){this.Modulators=null;this.Generators=null},AlphaSynth.Sf2.SoundFontSampleData=function(n){var u,t,o,i,e,r,f;if(this.BitsPerSample=0,this.SampleData=null,u=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),t=AlphaSynth.Util.IOHelper.ReadInt32LE(n),u.toLowerCase()!="list")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find sdta LIST chunk."),new Error);if(o=n.get_Position()+t,u=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),u.toLowerCase()!="sdta")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type sdta."),new Error);for(this.BitsPerSample=0,i=null;n.get_Position()<o;){e=AlphaSynth.Util.IOHelper.Read8BitChars(n,4);t=AlphaSynth.Util.IOHelper.ReadInt32LE(n);switch(e.toLowerCase()){case"smpl":this.BitsPerSample=16;i=AlphaSynth.Util.IOHelper.ReadByteArray(n,t);break;case"sm24":if(i==null||t!=Math.ceil(this.SampleData.length/2))n.Skip(t);else for(this.BitsPerSample=24,r=0;r<this.SampleData.length;r++)f=new Uint8Array(3),f[0]=n.ReadByte(),f[1]=i[2*r],f[2]=i[2*r+1];t%2==1&&n.ReadByte()!=0&&n.set_Position(n.get_Position()-1);break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unknown chunk id: "+e+"."),new Error);}}if(this.BitsPerSample==16)this.SampleData=i;else if(this.BitsPerSample!=24)throw $CreateException(new System.Exception.ctor$$String("Only 16 and 24 bit samples are supported."),new Error);},AlphaSynth.Sf2.SoundFontPresets=function(n){var t,i,r,a,v;if(this.SampleHeaders=null,this.PresetHeaders=null,this.Instruments=null,t=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),i=AlphaSynth.Util.IOHelper.ReadInt32LE(n),t.toLowerCase()!="list")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find pdta LIST chunk."),new Error);if(r=n.get_Position()+i,t=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),t.toLowerCase()!="pdta")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type pdta."),new Error);for(var u=null,f=null,e=null,o=null,s=null,h=null,c=null,l=null;n.get_Position()<r;){t=AlphaSynth.Util.IOHelper.Read8BitChars(n,4);i=AlphaSynth.Util.IOHelper.ReadInt32LE(n);switch(t.toLowerCase()){case"phdr":c=new AlphaSynth.Sf2.Chunks.PresetHeaderChunk(t,i,n);break;case"pbag":s=new AlphaSynth.Sf2.Chunks.ZoneChunk(t,i,n);break;case"pmod":u=new AlphaSynth.Sf2.Chunks.ModulatorChunk(t,i,n).Modulators;break;case"pgen":f=new AlphaSynth.Sf2.Chunks.GeneratorChunk(t,i,n).Generators;break;case"inst":l=new AlphaSynth.Sf2.Chunks.InstrumentChunk(t,i,n);break;case"ibag":h=new AlphaSynth.Sf2.Chunks.ZoneChunk(t,i,n);break;case"imod":e=new AlphaSynth.Sf2.Chunks.ModulatorChunk(t,i,n).Modulators;break;case"igen":o=new AlphaSynth.Sf2.Chunks.GeneratorChunk(t,i,n).Generators;break;case"shdr":this.SampleHeaders=new AlphaSynth.Sf2.Chunks.SampleHeaderChunk(t,i,n).SampleHeaders;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unrecognized sub chunk: "+t),new Error);}}a=s.ToZones(u,f);this.PresetHeaders=c.ToPresets(a);v=h.ToZones(e,o);this.Instruments=l.ToInstruments(v)},AlphaSynth.Sf2.SoundFontInfo=function(n){var i,t,r;if(this.RomVersionMajor=0,this.RomVersionMinor=0,this.SfVersionMajor=0,this.SfVersionMinor=0,this.SoundEngine=null,this.BankName=null,this.DataRom=null,this.CreationDate=null,this.Author=null,this.TargetProduct=null,this.Copyright=null,this.Comments=null,this.Tools=null,this.Tools="",this.Comments="",this.Copyright="",this.TargetProduct="",this.Author="",this.DataRom="",this.CreationDate="",this.BankName="",this.SoundEngine="",i=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),t=AlphaSynth.Util.IOHelper.ReadInt32LE(n),i.toLowerCase()!="list")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find INFO LIST chunk."),new Error);if(r=n.get_Position()+t,i=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),i.toLowerCase()!="info")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type INFO."),new Error);while(n.get_Position()<r){i=AlphaSynth.Util.IOHelper.Read8BitChars(n,4);t=AlphaSynth.Util.IOHelper.ReadInt32LE(n);switch(i.toLowerCase()){case"ifil":this.SfVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(n);this.SfVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(n);break;case"isng":this.SoundEngine=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"inam":this.BankName=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"irom":this.DataRom=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"iver":this.RomVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(n);this.RomVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(n);break;case"icrd":this.CreationDate=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"ieng":this.Author=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"iprd":this.TargetProduct=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"icop":this.Copyright=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"icmt":this.Comments=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;case"isft":this.Tools=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,t);break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The Chunk: "+i+" was not expected."),new Error);}}},AlphaSynth.Sf2.SoundFont=function(){this.Info=null;this.SampleData=null;this.Presets=null},AlphaSynth.Sf2.SoundFont.prototype={Load:function(n){var t=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),i=AlphaSynth.Util.IOHelper.ReadInt32LE(n);if(t.toLowerCase()!="riff")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find RIFF header."),new Error);if(t=AlphaSynth.Util.IOHelper.Read8BitChars(n,4),t.toLowerCase()!="sfbk")throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Riff type is invalid."),new Error);AlphaSynth.Util.Logger.Debug("Reading info chunk");this.Info=new AlphaSynth.Sf2.SoundFontInfo(n);AlphaSynth.Util.Logger.Debug("Reading sampledata chunk");this.SampleData=new AlphaSynth.Sf2.SoundFontSampleData(n);AlphaSynth.Util.Logger.Debug("Reading preset chunk");this.Presets=new AlphaSynth.Sf2.SoundFontPresets(n)}},AlphaSynth.Sf2.Sf2Region=function(){this.Generators=null;this.Generators=new Int16Array(61)},AlphaSynth.Sf2.Sf2Region.prototype={ApplyDefaultValues:function(){this.Generators[0]=0;this.Generators[1]=0;this.Generators[2]=0;this.Generators[3]=0;this.Generators[4]=0;this.Generators[5]=0;this.Generators[6]=0;this.Generators[7]=0;this.Generators[8]=13500;this.Generators[9]=0;this.Generators[10]=0;this.Generators[11]=0;this.Generators[12]=0;this.Generators[13]=0;this.Generators[15]=0;this.Generators[16]=0;this.Generators[17]=0;this.Generators[21]=-12e3;this.Generators[22]=0;this.Generators[23]=-12e3;this.Generators[24]=0;this.Generators[25]=-12e3;this.Generators[26]=-12e3;this.Generators[27]=-12e3;this.Generators[28]=-12e3;this.Generators[29]=0;this.Generators[30]=-12e3;this.Generators[31]=0;this.Generators[32]=0;this.Generators[33]=-12e3;this.Generators[34]=-12e3;this.Generators[35]=-12e3;this.Generators[36]=-12e3;this.Generators[37]=0;this.Generators[38]=-12e3;this.Generators[39]=0;this.Generators[40]=0;this.Generators[43]=32512;this.Generators[44]=32512;this.Generators[45]=0;this.Generators[46]=-1;this.Generators[47]=-1;this.Generators[48]=0;this.Generators[50]=0;this.Generators[51]=0;this.Generators[52]=0;this.Generators[54]=0;this.Generators[56]=100;this.Generators[57]=0;this.Generators[58]=-1}},AlphaSynth.Sf2.SampleHeader=function(n){this.Name=null;this.Start=0;this.End=0;this.StartLoop=0;this.EndLoop=0;this.SampleRate=0;this.RootKey=0;this.Tune=0;this.SampleLink=0;this.SoundFontSampleLink=AlphaSynth.Sf2.SFSampleLink.MonoSample;this.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,20);this.Start=AlphaSynth.Util.IOHelper.ReadInt32LE(n);this.End=AlphaSynth.Util.IOHelper.ReadInt32LE(n);this.StartLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(n);this.EndLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(n);this.SampleRate=AlphaSynth.Util.IOHelper.ReadInt32LE(n);this.RootKey=n.ReadByte();this.Tune=AlphaSynth.Platform.TypeUtils.ToInt16(n.ReadByte());this.SampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(n);this.SoundFontSampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(n)},AlphaSynth.Sf2.PresetHeader=function(){this.Name=null;this.PatchNumber=0;this.BankNumber=0;this.Library=0;this.Genre=0;this.Morphology=0;this.Zones=null},AlphaSynth.Sf2.ModulatorType=function(n){this._controllerSource=0;this.Polarity=AlphaSynth.Sf2.PolarityEnum.Unipolar;this.Direction=AlphaSynth.Sf2.DirectionEnum.MinToMax;this.SourceType=0;this.IsMidiContinuousController=!1;var t=AlphaSynth.Util.IOHelper.ReadUInt16LE(n);this.Polarity=(t&512)==512?AlphaSynth.Sf2.PolarityEnum.Bipolar:AlphaSynth.Sf2.PolarityEnum.Unipolar;this.Direction=(t&256)==256?AlphaSynth.Sf2.DirectionEnum.MaxToMin:AlphaSynth.Sf2.DirectionEnum.MinToMax;this.IsMidiContinuousController=(t&128)==128;this.SourceType=(t&64512)>>10;this._controllerSource=t&127},AlphaSynth.Sf2.Instrument=function(){this.Name=null;this.Zones=null},AlphaSynth.Sf2.Generator=function(n){this._rawAmount=0;this.GeneratorType=AlphaSynth.Sf2.GeneratorEnum.StartAddressOffset;this.GeneratorType=AlphaSynth.Util.IOHelper.ReadUInt16LE(n);this._rawAmount=AlphaSynth.Util.IOHelper.ReadUInt16LE(n)},AlphaSynth.Sf2.Generator.prototype={get_AmountInt16:function(){return AlphaSynth.Platform.TypeUtils.ToInt16(this._rawAmount)},set_AmountInt16:function(n){this._rawAmount=n&65535},get_LowByteAmount:function(){return this._rawAmount&255},set_LowByteAmount:function(n){this._rawAmount=(this._rawAmount&65280)+(n&255)&65535},get_HighByteAmount:function(){return(this._rawAmount&65280)>>8&255},set_HighByteAmount:function(n){this._rawAmount=(this._rawAmount&255)+((n&255)<<8)&65535}},AlphaSynth.Sf2.SFSampleLink={MonoSample:1,RightSample:2,LeftSample:4,LinkedSample:8,RomMonoSample:32769,RomRightSample:32770,RomLeftSample:32772,RomLinkedSample:32776},AlphaSynth.Sf2.GeneratorEnum={StartAddressOffset:0,EndAddressOffset:1,StartLoopAddressOffset:2,EndLoopAddressOffset:3,StartAddressCoarseOffset:4,ModulationLFOToPitch:5,VibratoLFOToPitch:6,ModulationEnvelopeToPitch:7,InitialFilterCutoffFrequency:8,InitialFilterQ:9,ModulationLFOToFilterCutoffFrequency:10,ModulationEnvelopeToFilterCutoffFrequency:11,EndAddressCoarseOffset:12,ModulationLFOToVolume:13,Unused1:14,ChorusEffectsSend:15,ReverbEffectsSend:16,Pan:17,Unused2:18,Unused3:19,Unused4:20,DelayModulationLFO:21,FrequencyModulationLFO:22,DelayVibratoLFO:23,FrequencyVibratoLFO:24,DelayModulationEnvelope:25,AttackModulationEnvelope:26,HoldModulationEnvelope:27,DecayModulationEnvelope:28,SustainModulationEnvelope:29,ReleaseModulationEnvelope:30,KeyNumberToModulationEnvelopeHold:31,KeyNumberToModulationEnvelopeDecay:32,DelayVolumeEnvelope:33,AttackVolumeEnvelope:34,HoldVolumeEnvelope:35,DecayVolumeEnvelope:36,SustainVolumeEnvelope:37,ReleaseVolumeEnvelope:38,KeyNumberToVolumeEnvelopeHold:39,KeyNumberToVolumeEnvelopeDecay:40,Instrument:41,Reserved1:42,KeyRange:43,VelocityRange:44,StartLoopAddressCoarseOffset:45,KeyNumber:46,Velocity:47,InitialAttenuation:48,Reserved2:49,EndLoopAddressCoarseOffset:50,CoarseTune:51,FineTune:52,SampleID:53,SampleModes:54,Reserved3:55,ScaleTuning:56,ExclusiveClass:57,OverridingRootKey:58,Unused5:59,UnusedEnd:60},AlphaSynth.Sf2.TransformEnum={Linear:0,AbsoluteValue:2},AlphaSynth.Sf2.ControllerSourceEnum={NoController:0,NoteOnVelocity:2,NoteOnKeyNumber:3,PolyPressure:10,ChannelPressure:13,PitchWheel:14,PitchWheelSensitivity:16,Link:127},AlphaSynth.Sf2.DirectionEnum={MinToMax:0,MaxToMin:1},AlphaSynth.Sf2.PolarityEnum={Unipolar:0,Bipolar:1},AlphaSynth.Sf2.SourceTypeEnum={Linear:0,Concave:1,Convex:2,Switch:3},AlphaSynth.Synthesis=AlphaSynth.Synthesis||{},AlphaSynth.Synthesis.CCValue=function(n,t){this._coarseValue=0;this._fineValue=0;this._combined=0;this._coarseValue=n;this._fineValue=t;this._combined=0;this.UpdateCombined()},AlphaSynth.Synthesis.CCValue=function(n){this._coarseValue=0;this._fineValue=0;this._combined=0;this._coarseValue=0;this._fineValue=0;this._combined=n;this.UpdateCoarseFinePair()},AlphaSynth.Synthesis.CCValue.prototype={get_Coarse:function(){return this._coarseValue},set_Coarse:function(n){this._coarseValue=n;this.UpdateCombined()},get_Fine:function(){return this._fineValue},set_Fine:function(n){this._fineValue=n;this.UpdateCombined()},get_Combined:function(){return this._combined},set_Combined:function(n){this._combined=n;this.UpdateCoarseFinePair()},UpdateCombined:function(){this._combined=AlphaSynth.Platform.TypeUtils.IsLittleEndian?this._coarseValue<<7|this._fineValue|0:this._fineValue<<7|this._coarseValue|0},UpdateCoarseFinePair:function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian?(this._coarseValue=this._combined>>7,this._fineValue=this._combined&127):(this._fineValue=this._combined>>7,this._coarseValue=this._combined&127)}},AlphaSynth.Synthesis.SynthParameters=function(n){this.Program=0;this.BankSelect=0;this.ChannelAfterTouch=0;this.Pan=null;this.Volume=null;this.Expression=null;this.ModRange=null;this.PitchBend=null;this.PitchBendRangeCoarse=0;this.PitchBendRangeFine=0;this.MasterCoarseTune=0;this.MasterFineTune=null;this.HoldPedal=!1;this.LegatoPedal=!1;this.Rpn=null;this.Synth=null;this.CurrentVolume=0;this.CurrentPitch=0;this.CurrentMod=0;this.CurrentPan=null;this.Synth=n;this.Pan=new AlphaSynth.Synthesis.CCValue(0);this.Volume=new AlphaSynth.Synthesis.CCValue(0);this.Expression=new AlphaSynth.Synthesis.CCValue(0);this.ModRange=new AlphaSynth.Synthesis.CCValue(0);this.PitchBend=new AlphaSynth.Synthesis.CCValue(0);this.MasterFineTune=new AlphaSynth.Synthesis.CCValue(0);this.Rpn=new AlphaSynth.Synthesis.CCValue(0);this.CurrentPan=new AlphaSynth.Bank.Components.PanComponent;this.ResetControllers()},AlphaSynth.Synthesis.SynthParameters.prototype={ResetControllers:function(){this.Program=0;this.BankSelect=0;this.ChannelAfterTouch=0;this.Pan.set_Combined(8192);this.Volume.set_Fine(0);this.Volume.set_Coarse(100);this.Expression.set_Combined(16383);this.ModRange.set_Combined(0);this.PitchBend.set_Combined(8192);this.PitchBendRangeCoarse=2;this.PitchBendRangeFine=0;this.MasterCoarseTune=0;this.MasterFineTune.set_Combined(8192);this.HoldPedal=!1;this.LegatoPedal=!1;this.Rpn.set_Combined(16383);this.UpdateCurrentPan();this.UpdateCurrentPitch();this.UpdateCurrentVolumeFromExpression()},UpdateCurrentPitch:function(){this.CurrentPitch=(this.PitchBend.get_Combined()-8192)/8192*(100*this.PitchBendRangeCoarse+this.PitchBendRangeFine)|0},UpdateCurrentMod:function(){this.CurrentMod=100*(this.ModRange.get_Combined()/16383)|0},UpdateCurrentPan:function(){var n=1.5707963267949*(this.Pan.get_Combined()/16383);this.CurrentPan.Left=Math.cos(n);this.CurrentPan.Right=Math.sin(n)},UpdateCurrentVolumeFromVolume:function(){this.CurrentVolume=this.Volume.get_Combined()/16383;this.CurrentVolume*=this.CurrentVolume;this.CurrentVolume=1},UpdateCurrentVolumeFromExpression:function(){this.CurrentVolume=this.Expression.get_Combined()/16383;this.CurrentVolume*=this.CurrentVolume}},AlphaSynth.Synthesis.VoiceParameters=function(){this.mix1=0;this.mix2=0;this.Channel=0;this.Note=0;this.Velocity=0;this.NoteOffPending=!1;this.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped;this.PitchOffset=0;this.VolOffset=0;this.BlockBuffer=null;this.PData=null;this.SynthParams=null;this.GeneratorParams=null;this.Envelopes=null;this.Filters=null;this.Lfos=null;this.BlockBuffer=new Float32Array(64);this.PData=new Array(4);this.GeneratorParams=new Array(4);this.Envelopes=new Array(4);this.Filters=new Array(4);this.Lfos=new Array(4);for(var n=0;n<4;n++)this.GeneratorParams[n]=new AlphaSynth.Bank.Components.Generators.GeneratorParameters,this.Envelopes[n]=new AlphaSynth.Bank.Components.Envelope,this.Filters[n]=new AlphaSynth.Bank.Components.Filter,this.Lfos[n]=new AlphaSynth.Bank.Components.Lfo},AlphaSynth.Synthesis.VoiceParameters.prototype={get_CombinedVolume:function(){return this.mix1+this.mix2},Reset:function(){this.NoteOffPending=!1;this.PitchOffset=0;this.VolOffset=0;for(var n=0;n<this.PData.length;n++)this.PData[n]=new DataView(new ArrayBuffer(8));this.mix1=0;this.mix2=0},MixMonoToMonoInterp:function(n,t){for(var r=(t-this.mix1)/64,i=0;i<this.BlockBuffer.length;i++)this.mix1+=r,this.SynthParams.Synth.SampleBuffer[n+i]+=this.BlockBuffer[i]*this.mix1;this.mix1=t},MixMonoToStereoInterp:function(n,t,i){for(var u=(t-this.mix1)/64,f=(i-this.mix2)/64,r=0;r<this.BlockBuffer.length;r++)this.mix1+=u,this.mix2+=f,this.SynthParams.Synth.SampleBuffer[n]+=this.BlockBuffer[r]*this.mix1,this.SynthParams.Synth.SampleBuffer[n+1]+=this.BlockBuffer[r]*this.mix2,n+=2;this.mix1=t;this.mix2=i},MixStereoToStereoInterp:function(n,t,i){for(var u=(t-this.mix1)/64,f=(i-this.mix2)/64,r=0;r<this.BlockBuffer.length;r++)this.mix1+=u,this.mix2+=f,this.SynthParams.Synth.SampleBuffer[n+r]+=this.BlockBuffer[r]*this.mix1,r++,this.SynthParams.Synth.SampleBuffer[n+r]+=this.BlockBuffer[r]*this.mix2;this.mix1=t;this.mix2=i}},AlphaSynth.Synthesis.VoiceStealingMethod={Oldest:0,Quietest:1},AlphaSynth.Synthesis.VoiceNode=function(){this.Value=null;this.Next=null},AlphaSynth.Synthesis.VoiceManager=function(n){var i,t;for(this._voicePool=null,this._vNodes=null,this.StealingMethod=AlphaSynth.Synthesis.VoiceStealingMethod.Oldest,this.Polyphony=0,this.FreeVoices=null,this.ActiveVoices=null,this.Registry=null,this.StealingMethod=AlphaSynth.Synthesis.VoiceStealingMethod.Quietest,this.Polyphony=n,this._voicePool=new Array(n),this._vNodes=new AlphaSynth.Ds.LinkedList,this.FreeVoices=new AlphaSynth.Ds.LinkedList,this.ActiveVoices=new AlphaSynth.Ds.LinkedList,t=0;t<n;t++)i=new AlphaSynth.Synthesis.Voice,this._voicePool[t]=i,this._vNodes.AddLast(new AlphaSynth.Synthesis.VoiceNode),this.FreeVoices.AddLast(i);for(this.Registry=new Array(16),t=0;t<this.Registry.length;t++)this.Registry[t]=new Array(128)},AlphaSynth.Synthesis.VoiceManager.prototype={GetFreeVoice:function(){if(this.FreeVoices.Length>0){var n=this.FreeVoices.First.Value;return this.FreeVoices.RemoveFirst(),n}switch(this.StealingMethod){case AlphaSynth.Synthesis.VoiceStealingMethod.Oldest:return this.StealOldest();case AlphaSynth.Synthesis.VoiceStealingMethod.Quietest:return this.StealQuietestVoice();default:return null}},AddToRegistry:function(n){var t=this._vNodes.RemoveLast();t.Value=n;t.Next=this.Registry[n.VoiceParams.Channel][n.VoiceParams.Note];this.Registry[n.VoiceParams.Channel][n.VoiceParams.Note]=t},RemoveFromRegistry:function(n,t){for(var i=this.Registry[n][t];i!=null;)this._vNodes.AddLast(i),i=i.Next;this.Registry[n][t]=null},RemoveVoiceFromRegistry:function(n){var t=this.Registry[n.VoiceParams.Channel][n.VoiceParams.Note],i;if(t!=null)if(t.Value==n)this.Registry[n.VoiceParams.Channel][n.VoiceParams.Note]=t.Next,this._vNodes.AddLast(t);else for(i=t,t=t.Next;t!=null;){if(t.Value==n){i.Next=t.Next;this._vNodes.AddLast(t);return}i=t;t=t.Next}},ClearRegistry:function(){for(var n=this.ActiveVoices.First,t;n!=null;){for(t=this.Registry[n.Value.VoiceParams.Channel][n.Value.VoiceParams.Note];t!=null;)this._vNodes.AddLast(t),t=t.Next;this.Registry[n.Value.VoiceParams.Channel][n.Value.VoiceParams.Note]=null;n=n.get_Next()}},UnloadPatches:function(){for(var n,t=0,i=this._voicePool,u=i.length,r=i[t];t<u;t++,r=i[t])for(r.Configure(0,0,0,null,null),n=this._vNodes.First;n!=null;)n.Value.Value=null,n=n.get_Next()},StealOldest:function(){for(var n=this.ActiveVoices.First;n!=null&&n.Value.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing;)n=n.get_Next();return n==null&&(n=this.ActiveVoices.First),this.RemoveVoiceFromRegistry(n.Value),this.ActiveVoices.Remove(n),n.Value.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,n.Value},StealQuietestVoice:function(){for(var r=1e3,n=null,t=this.ActiveVoices.First,i;t!=null;)t.Value.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(i=t.Value.VoiceParams.get_CombinedVolume(),i<r&&(n=t,r=i)),t=t.get_Next();return n==null&&(n=this.ActiveVoices.First),this.RemoveVoiceFromRegistry(n.Value),this.ActiveVoices.Remove(n),n.Value.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,n.Value}},AlphaSynth.Synthesis.VoiceStateEnum={Stopped:0,Stopping:1,Playing:2},AlphaSynth.Synthesis.Voice=function(){this.Patch=null;this.VoiceParams=null;this.VoiceParams=new AlphaSynth.Synthesis.VoiceParameters},AlphaSynth.Synthesis.Voice.prototype={Start:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Start(this.VoiceParams)&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Playing)},Stop:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopping,this.Patch.Stop(this.VoiceParams))},StopImmediately:function(){this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped},Process:function(n,t){this.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Process(this.VoiceParams,n,t)},Configure:function(n,t,i,r,u){this.VoiceParams.Reset();this.VoiceParams.Channel=n;this.VoiceParams.Note=t;this.VoiceParams.Velocity=i;this.VoiceParams.SynthParams=u;this.Patch=r}},AlphaSynth.Synthesis.SynthHelper=function(){},AlphaSynth.Synthesis.SynthHelper.ClampD=function(n,t,i){return n<=t?t:n>=i?i:n},AlphaSynth.Synthesis.SynthHelper.ClampF=function(n,t,i){return n<=t?t:n>=i?i:n},AlphaSynth.Synthesis.SynthHelper.ClampI=function(n,t,i){return n<=t?t:n>=i?i:n},AlphaSynth.Synthesis.SynthHelper.ClampS=function(n,t,i){return n<=t?t:n>=i?i:n},AlphaSynth.Synthesis.SynthHelper.NearestPowerOfTwo=function(n){return Math.pow(2,Math.Round(Math.Log(n,2)))},AlphaSynth.Synthesis.SynthHelper.SamplesFromTime=function(n,t){return n*t},AlphaSynth.Synthesis.SynthHelper.TimeFromSamples=function(n,t){return t/n},AlphaSynth.Synthesis.SynthHelper.DBtoLinear=function(n){return Math.pow(10,n/20)},AlphaSynth.Synthesis.SynthHelper.LineartoDB=function(n){return 20*(Math.log(n)/Math.LN10)},AlphaSynth.Synthesis.SynthHelper.FrequencyToKey=function(n,t){return 12*Math.Log(n/440,2)+t},AlphaSynth.Synthesis.SynthHelper.KeyToFrequency=function(n,t){return Math.pow(2,(n-t)/12)*440},AlphaSynth.Synthesis.SynthHelper.SemitoneToPitch=function(n){return n<-127?n=-127:n>127&&(n=127),AlphaSynth.Util.Tables.SemitoneTable(127+n)},AlphaSynth.Synthesis.SynthHelper.CentsToPitch=function(n){var t=n/100|0;return n-=t*100,t<-127?t=-127:t>127&&(t=127),AlphaSynth.Util.Tables.SemitoneTable(127+t)*AlphaSynth.Util.Tables.CentTable(100+n)},AlphaSynth.Synthesis.SynthEvent=function(n){this.Event=null;this.Delta=0;this.Event=n},AlphaSynth.Synthesis.Synthesizer=function(n,t,i,r,u){var e,o,f;if(this._voiceManager=null,this._synthChannels=null,this._masterVolume=0,this._synthGain=0,this._midiMessageProcessed=null,this._layerList=null,this.MidiEventQueue=null,this.MidiEventCounts=null,this.SampleBuffer=null,this.AudioChannels=0,this.LittleEndian=!1,this.SoundBank=null,this.SampleRate=0,this.MicroBufferSize=0,this.MicroBufferCount=0,e=8e3,o=96e3,n<e||n>o)throw $CreateException(new System.Exception.ctor$$String("Invalid paramater: (sampleRate) Valid ranges are "+e+" to "+o),new Error);if(t<1||t>2)throw $CreateException(new System.Exception.ctor$$String("Invalid paramater: (audioChannels) Valid ranges are 1 to 2"),new Error);for(this._midiMessageProcessed=[],this._synthGain=.35,this._masterVolume=1,this.SampleRate=n,this.AudioChannels=t,this.MicroBufferSize=AlphaSynth.Synthesis.SynthHelper.ClampI(i,.001*n|0,.05*n|0),this.MicroBufferSize=Math.ceil(this.MicroBufferSize/64)*64|0,this.MicroBufferCount=Math.max(1,r),this.SampleBuffer=new Float32Array(this.MicroBufferSize*this.MicroBufferCount*t),this.LittleEndian=!0,this._synthChannels=new Array(16),f=0;f<this._synthChannels.length;f++)this._synthChannels[f]=new AlphaSynth.Synthesis.SynthParameters(this);this._voiceManager=new AlphaSynth.Synthesis.VoiceManager(AlphaSynth.Synthesis.SynthHelper.ClampI(u,5,250));this.MidiEventQueue=new AlphaSynth.Ds.LinkedList;this.MidiEventCounts=new Int32Array(this.MicroBufferCount);this._layerList=new Array(15);this._midiMessageProcessed=[];this.ResetSynthControls()},AlphaSynth.Synthesis.Synthesizer.prototype={get_MasterVolume:function(){return this._masterVolume},set_MasterVolume:function(n){this._masterVolume=AlphaSynth.Synthesis.SynthHelper.ClampF(n,0,10)},get_MixGain:function(){return this._synthGain},set_MixGain:function(n){this._synthGain=AlphaSynth.Synthesis.SynthHelper.ClampF(n,.5,1)},get_VoiceStealMethod:function(){return this._voiceManager.StealingMethod},set_VoiceStealMethod:function(n){this._voiceManager.StealingMethod=n},get_ActiveVoices:function(){return this._voiceManager.ActiveVoices.Length},get_FreeVoices:function(){return this._voiceManager.FreeVoices.Length},get_RawBufferSize:function(){return this.SampleBuffer.length*2},get_WorkingBufferSize:function(){return this.SampleBuffer.length},get_Polyphony:function(){return this._voiceManager.Polyphony},LoadBank:function(n){this.UnloadBank();this.SoundBank=n},UnloadBank:function(){this.SoundBank!=null&&(this.NoteOffAll(!0),this._voiceManager.UnloadPatches(),this.SoundBank=null)},Stop:function(){this.ResetSynthControls();this.ResetPrograms();this.NoteOffAll(!0)},ResetSynthControls:function(){for(var n=0;n<this._synthChannels.length;n++)this._synthChannels[n].ResetControllers();this._synthChannels[9].BankSelect=128;this.ReleaseAllHoldPedals()},ResetPrograms:function(){for(var n=0;n<this._synthChannels.length;n++)this._synthChannels[n].Program=0},GetProgramName:function(n){var t=this.GetProgram(n);return t==null?"null":t.Name},GetProgram:function(n){if(this.SoundBank!=null){var t=this._synthChannels[n],i=this.SoundBank.GetPatchByNumber(t.BankSelect,t.Program);if(i!=null)return i}return null},SetAudioChannelCount:function(n){n=AlphaSynth.Synthesis.SynthHelper.ClampI(n,1,2);this.AudioChannels!=n&&(this.AudioChannels=n,this.SampleBuffer=new Float32Array(this.MicroBufferSize*this.MicroBufferCount*this.AudioChannels))},Synthesize:function(){this.SampleBuffer=new Float32Array(this.SampleBuffer.length);this.FillWorkingBuffer()},GetChannelVolume:function(n){return this._synthChannels[n].Volume.get_Combined()/16383},GetChannelExpression:function(n){return this._synthChannels[n].Expression.get_Combined()/16383},GetChannelPan:function(n){return(this._synthChannels[n].Pan.get_Combined()-8192)/8192},GetChannelPitchBend:function(n){return(this._synthChannels[n].PitchBend.get_Combined()-8192)/8192},GetChannelHoldPedalStatus:function(n){return this._synthChannels[n].HoldPedal},FillWorkingBuffer:function(){for(var u,f,n,t,i=0,r=0;r<this.MicroBufferCount;r++){if(this.MidiEventQueue.Length>0)for(u=0;u<this.MidiEventCounts[r];u++)f=this.MidiEventQueue.RemoveLast(),this.ProcessMidiMessage(f.Event);for(n=this._voiceManager.ActiveVoices.First;n!=null;)n.Value.Process(i,i+this.MicroBufferSize*this.AudioChannels),n.Value.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped?(t=n,n=n.get_Next(),this._voiceManager.RemoveVoiceFromRegistry(t.Value),this._voiceManager.ActiveVoices.Remove(t),this._voiceManager.FreeVoices.AddFirst(t.Value)):n=n.get_Next();i+=this.MicroBufferSize*this.AudioChannels}AlphaSynth.Platform.TypeUtils.ClearIntArray(this.MidiEventCounts)},NoteOn:function(n,t,i){var c=this._synthChannels[n],s=this.SoundBank.GetPatchByNumber(c.BankSelect,c.Program),e,h,o,u,f,r;if(s!=null){if(e=s.FindPatches(n,t,i,this._layerList),this._voiceManager.Registry[n][t]!=null){for(u=this._voiceManager.Registry[n][t];u!=null;)u.Value.Stop(),u=u.Next;this._voiceManager.RemoveFromRegistry(n,t)}for(r=0;r<e;r++){for(h=!0,o=r-1;o>=0;o--)if(this._layerList[r].ExclusiveGroupTarget==this._layerList[o].ExclusiveGroupTarget){h=!1;break}if(this._layerList[r].ExclusiveGroupTarget!=0&&h)for(u=this._voiceManager.ActiveVoices.First;u!=null;)this._layerList[r].ExclusiveGroupTarget==u.Value.Patch.ExclusiveGroup&&(u.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(u.Value)),u=u.get_Next()}for(r=0;r<e;r++){if(f=this._voiceManager.GetFreeVoice(),f==null)break;f.Configure(n,t,i,this._layerList[r],this._synthChannels[n]);this._voiceManager.AddToRegistry(f);this._voiceManager.ActiveVoices.AddLast(f);f.Start()}for(r=0;r<e;r++)this._layerList[r]=null}},NoteOff:function(n,t){var i;if(this._synthChannels[n].HoldPedal)for(i=this._voiceManager.Registry[n][t];i!=null;)i.Value.VoiceParams.NoteOffPending=!0,i=i.Next;else{for(i=this._voiceManager.Registry[n][t];i!=null;)i.Value.Stop(),i=i.Next;this._voiceManager.RemoveFromRegistry(n,t)}},NoteOffAll:function(n){var t=this._voiceManager.ActiveVoices.First,r,i;if(n)for(this._voiceManager.ClearRegistry();t!=null;)t.Value.StopImmediately(),r=t,t=t.get_Next(),this._voiceManager.ActiveVoices.Remove(r),this._voiceManager.FreeVoices.AddFirst(r.Value);else while(t!=null)i=t.Value.VoiceParams,i.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this._synthChannels[i.Channel].HoldPedal?i.NoteOffPending=!0:(t.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(t.Value))),t=t.get_Next()},NoteOffAllChannel:function(n,t){for(var i=this._voiceManager.ActiveVoices.First,r;i!=null;)n==i.Value.VoiceParams.Channel&&(t?(i.Value.StopImmediately(),r=i,i=i.get_Next(),this._voiceManager.ActiveVoices.Remove(r),this._voiceManager.FreeVoices.AddFirst(r.Value)):(this._synthChannels[n].HoldPedal?i.Value.VoiceParams.NoteOffPending=!0:i.Value.Stop(),i=i.get_Next()))},ProcessMidiMessage:function(n){var u=n.get_Command(),t=n.get_Channel(),r=n.get_Data1(),i=n.get_Data2();switch(u){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:this.NoteOff(t,r);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:i==0?this.NoteOff(t,r):this.NoteOn(t,r,i);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:switch(r){case AlphaSynth.Midi.Event.ControllerTypeEnum.BankSelectCoarse:t==9&&(i+=128);this._synthChannels[t].BankSelect=this.SoundBank.IsBankLoaded(i)?i:t==9?128:0;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationCoarse:this._synthChannels[t].ModRange.set_Coarse(i);this._synthChannels[t].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationFine:this._synthChannels[t].ModRange.set_Fine(i);this._synthChannels[t].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeCoarse:this._synthChannels[t].Volume.set_Coarse(i);this._synthChannels[t].UpdateCurrentVolumeFromVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeFine:this._synthChannels[t].Volume.set_Fine(i);this._synthChannels[t].UpdateCurrentVolumeFromVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanCoarse:this._synthChannels[t].Pan.set_Coarse(i);this._synthChannels[t].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanFine:this._synthChannels[t].Pan.set_Fine(i);this._synthChannels[t].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerCoarse:this._synthChannels[t].Expression.set_Coarse(i);this._synthChannels[t].UpdateCurrentVolumeFromExpression();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerFine:this._synthChannels[t].Expression.set_Fine(i);this._synthChannels[t].UpdateCurrentVolumeFromExpression();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.HoldPedal:!this._synthChannels[t].HoldPedal||i>63||this.ReleaseHoldPedal(t);this._synthChannels[t].HoldPedal=i>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.LegatoPedal:this._synthChannels[t].LegatoPedal=i>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterCourse:this._synthChannels[t].Rpn.set_Combined(16383);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterFine:this._synthChannels[t].Rpn.set_Combined(16383);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterCourse:this._synthChannels[t].Rpn.set_Coarse(i);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterFine:this._synthChannels[t].Rpn.set_Fine(i);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.AllNotesOff:this.NoteOffAll(!1);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryCoarse:switch(this._synthChannels[t].Rpn.get_Combined()){case 0:this._synthChannels[t].PitchBendRangeCoarse=i;this._synthChannels[t].UpdateCurrentPitch();break;case 1:this._synthChannels[t].MasterFineTune.set_Coarse(i);break;case 2:this._synthChannels[t].MasterCoarseTune=i-64|0}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryFine:switch(this._synthChannels[t].Rpn.get_Combined()){case 0:this._synthChannels[t].PitchBendRangeFine=i;this._synthChannels[t].UpdateCurrentPitch();break;case 1:this._synthChannels[t].MasterFineTune.set_Fine(i)}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ResetControllers:this._synthChannels[t].Expression.set_Combined(16383);this._synthChannels[t].ModRange.set_Combined(0);this._synthChannels[t].HoldPedal&&this.ReleaseHoldPedal(t);this._synthChannels[t].HoldPedal=!1;this._synthChannels[t].LegatoPedal=!1;this._synthChannels[t].Rpn.set_Combined(16383);this._synthChannels[t].PitchBend.set_Combined(8192);this._synthChannels[t].ChannelAfterTouch=0;this._synthChannels[t].UpdateCurrentPitch();this._synthChannels[t].UpdateCurrentVolumeFromExpression();break;default:return}break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:this._synthChannels[t].Program=r;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:this._synthChannels[t].ChannelAfterTouch=i;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:this._synthChannels[t].PitchBend.set_Coarse(i);this._synthChannels[t].PitchBend.set_Fine(r);this._synthChannels[t].UpdateCurrentPitch()}this.FireMidiMessageProcessed(n)},AddMidiMessageProcessed:function(n){this._midiMessageProcessed.push(n)},FireMidiMessageProcessed:function(n){for(var i,t=0;t<this._midiMessageProcessed.length;t++)i=this._midiMessageProcessed[t],i!=null&&i(n)},ReleaseAllHoldPedals:function(){for(var n=this._voiceManager.ActiveVoices.First;n!=null;)n.Value.VoiceParams.NoteOffPending&&(n.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(n.Value)),n=n.get_Next()},ReleaseHoldPedal:function(n){for(var t=this._voiceManager.ActiveVoices.First;t!=null;)t.Value.VoiceParams.Channel==n&&t.Value.VoiceParams.NoteOffPending&&(t.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(t.Value)),t=t.get_Next()}},AlphaSynth.Util.PcmData=function(n,t,i){if(this.Data=null,this.Length=0,this.BytesPerSample=0,this.BytesPerSample=n/8|0,t.length%this.BytesPerSample!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid PCM format. The PCM data was an invalid size."),new Error);this.Data=t;this.Length=this.Data.length/this.BytesPerSample|0;AlphaSynth.Platform.TypeUtils.IsLittleEndian!=i&&AlphaSynth.Util.WaveHelper.SwapEndianess(this.Data,n)},AlphaSynth.Util.PcmData.prototype={get_BitsPerSample:function(){return this.BytesPerSample*8}},AlphaSynth.Util.PcmData.Create=function(n,t,i){switch(n){case 8:return new AlphaSynth.Util.PcmData8Bit(n,t,i);case 16:return new AlphaSynth.Util.PcmData16Bit(n,t,i);case 24:return new AlphaSynth.Util.PcmData24Bit(n,t,i);case 32:return new AlphaSynth.Util.PcmData32Bit(n,t,i);default:throw $CreateException(new System.Exception.ctor$$String("Invalid PCM format. "+n+"bit pcm data is not supported."),new Error);}},AlphaSynth.Util.PcmData8Bit=function(n,t,i){AlphaSynth.Util.PcmData.call(this,n,t,i)},AlphaSynth.Util.PcmData8Bit.prototype={get_Item:function(n){return this.Data[n]/255*2-1}},$Inherit(AlphaSynth.Util.PcmData8Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData16Bit=function(n,t,i){AlphaSynth.Util.PcmData.call(this,n,t,i)},AlphaSynth.Util.PcmData16Bit.prototype={get_Item:function(n){return n*=2,((this.Data[n]|this.Data[n+1]<<8)<<16>>16)/32768}},$Inherit(AlphaSynth.Util.PcmData16Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData24Bit=function(n,t,i){AlphaSynth.Util.PcmData.call(this,n,t,i)},AlphaSynth.Util.PcmData24Bit.prototype={get_Item:function(n){return n*=3,((this.Data[n]|this.Data[n+1]<<8|this.Data[n+2]<<16)<<12>>12)/8388608}},$Inherit(AlphaSynth.Util.PcmData24Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData32Bit=function(n,t,i){AlphaSynth.Util.PcmData.call(this,n,t,i)},AlphaSynth.Util.PcmData32Bit.prototype={get_Item:function(n){return n*=4,(this.Data[n]|this.Data[n+1]<<8|this.Data[n+2]<<16|this.Data[n+3]<<24)/2147484e3}},$Inherit(AlphaSynth.Util.PcmData32Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.Tables=function(){},$StaticConstructor(function(){AlphaSynth.Util.Tables._isInitialized=!1;AlphaSynth.Util.Tables._envelopeTables=null;AlphaSynth.Util.Tables._semitoneTable=null;AlphaSynth.Util.Tables._centTable=null;AlphaSynth.Util.Tables._sincTable=null}),AlphaSynth.Util.Tables.EnvelopeTables=function(n){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._envelopeTables[n]},AlphaSynth.Util.Tables.SemitoneTable=function(n){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._semitoneTable[n]},AlphaSynth.Util.Tables.CentTable=function(n){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._centTable[n]},AlphaSynth.Util.Tables.SincTable=function(n){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._sincTable[n]},AlphaSynth.Util.Tables.Init=function(){var n=64;AlphaSynth.Util.Tables._envelopeTables=new Array(4);AlphaSynth.Util.Tables._envelopeTables[0]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSustainTable(n));AlphaSynth.Util.Tables._envelopeTables[1]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateLinearTable(n));AlphaSynth.Util.Tables._envelopeTables[2]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateExponentialTable(n,.09));AlphaSynth.Util.Tables._envelopeTables[3]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSineTable(n));AlphaSynth.Util.Tables._centTable=AlphaSynth.Util.Tables.CreateCentTable();AlphaSynth.Util.Tables._semitoneTable=AlphaSynth.Util.Tables.CreateSemitoneTable();AlphaSynth.Util.Tables._sincTable=AlphaSynth.Util.Tables.CreateSincTable(16,64,.43,AlphaSynth.Util.Tables.HammingWindow);AlphaSynth.Util.Tables._isInitialized=!0},AlphaSynth.Util.Tables.CreateSquareTable=function(n,t){for(var u,i,f,e=new Float32Array(n),s=1/n,o=0,r=0;r<n;r++){for(u=0,i=1;i<t+1;i++)f=2*i-1,u+=Math.sin(6.28318530717958*f*o)/f;e[r]=AlphaSynth.Synthesis.SynthHelper.ClampF(1.27323954473516*u,-1,1);o+=s}return e},AlphaSynth.Util.Tables.CreateCentTable=function(){for(var t=new Float32Array(201),n=0;n<t.length;n++)t[n]=Math.pow(2,(n-100)/1200);return t},AlphaSynth.Util.Tables.CreateSemitoneTable=function(){for(var t=new Float32Array(255),n=0;n<t.length;n++)t[n]=Math.pow(2,(n-127)/12);return t},AlphaSynth.Util.Tables.CreateSustainTable=function(n){for(var i=new Float32Array(n),t=0;t<n;t++)i[t]=1;return i},AlphaSynth.Util.Tables.CreateLinearTable=function(n){for(var i=new Float32Array(n),t=0;t<n;t++)i[t]=t/(n-1);return i},AlphaSynth.Util.Tables.CreateExponentialTable=function(n,t){var r,u,i;for(t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,.001,.9),r=new Float32Array(n),u=0,i=0;i<n;i++)r[i]=u,u+=t*(1.58730158730159-u);for(i=0;i<n;i++)r[i]=r[i]/r[r.length-1];return r},AlphaSynth.Util.Tables.CreateSineTable=function(n){for(var i=new Float32Array(n),u=4.712389/(n-1),r=0,t=0;t<n;t++)i[t]=Math.abs(Math.sin(r)),r+=u;return i},AlphaSynth.Util.Tables.RemoveDenormals=function(n){for(var t=0;t<n.length;t++)Math.abs(n[t])<1e-38&&(n[t]=0);return n},AlphaSynth.Util.Tables.VonHannWindow=function(n,t){return.5-.5*Math.cos(6.28318530717958*(.5+n/t))},AlphaSynth.Util.Tables.HammingWindow=function(n,t){return.54-.46*Math.cos(6.28318530717958*n/t)},AlphaSynth.Util.Tables.BlackmanWindow=function(n,t){return.42659-.49656*Math.cos(6.28318530717958*n/t)+.076849*Math.cos(12.5663706143592*n/t)},AlphaSynth.Util.Tables.CreateSincTable=function(n,t,i,r){for(var f,o,u,s=(n/2|0)+1,h=new Float32Array(s*t),c=2*i,e=0;e<s;e++)for(f=0;f<t;f++)o=e+f/t,u=6.28318530717958*i*o,u=Math.abs(u)>1e-5?Math.sin(u)/u:1,h[e*64+f]=c*u*r(o,n);return h},AlphaSynth.Util.SynthConstants=function(){},$StaticConstructor(function(){AlphaSynth.Util.SynthConstants.InterpolationMode=AlphaSynth.Bank.Components.Generators.Interpolation.Linear;AlphaSynth.Util.SynthConstants.AudioChannels=2;AlphaSynth.Util.SynthConstants.Pi=3.14159265358979;AlphaSynth.Util.SynthConstants.TwoPi=6.28318530717958;AlphaSynth.Util.SynthConstants.HalfPi=1.5707963267949;AlphaSynth.Util.SynthConstants.InverseSqrtOfTwo=.707106781186;AlphaSynth.Util.SynthConstants.DefaultLfoFrequency=8;AlphaSynth.Util.SynthConstants.DefaultModDepth=100;AlphaSynth.Util.SynthConstants.DefaultPolyphony=40;AlphaSynth.Util.SynthConstants.MinPolyphony=5;AlphaSynth.Util.SynthConstants.MaxPolyphony=250;AlphaSynth.Util.SynthConstants.DefaultBlockSize=64;AlphaSynth.Util.SynthConstants.MaxBufferSize=.05;AlphaSynth.Util.SynthConstants.MinBufferSize=.001;AlphaSynth.Util.SynthConstants.DenormLimit=1e-38;AlphaSynth.Util.SynthConstants.NonAudible=1e-5;AlphaSynth.Util.SynthConstants.SincWidth=16;AlphaSynth.Util.SynthConstants.SincResolution=64;AlphaSynth.Util.SynthConstants.MaxVoiceComponents=4;AlphaSynth.Util.SynthConstants.DefaultChannelCount=16;AlphaSynth.Util.SynthConstants.DefaultKeyCount=128}),AlphaSynth.Util.IOHelper=function(){},AlphaSynth.Util.IOHelper.ReadInt32LE=function(n){var t=n.ReadByte(),i=n.ReadByte(),r=n.ReadByte(),u=n.ReadByte();return u<<24|r<<16|i<<8|t<<0},AlphaSynth.Util.IOHelper.ReadUInt16LE=function(n){var t=n.ReadByte(),i=n.ReadByte();return i<<8|t<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16LE=function(n){var t=n.ReadByte(),i=n.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(i<<8|t<<0)},AlphaSynth.Util.IOHelper.ReadInt32BE=function(n){var t=n.ReadByte(),i=n.ReadByte(),r=n.ReadByte(),u=n.ReadByte();return t<<24|i<<16|r<<8|u<<0},AlphaSynth.Util.IOHelper.ReadUInt16BE=function(n){var t=n.ReadByte(),i=n.ReadByte();return t<<8|i<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16BE=function(n){var t=n.ReadByte(),i=n.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(t<<8|i<<0)},AlphaSynth.Util.IOHelper.ReadByteArray=function(n,t){var i=new Uint8Array(t);return n.Read(i,0,t),i},AlphaSynth.Util.IOHelper.Read8BitChars=function(n,t){for(var i=[],r=0;r<t;r++)i.push(String.fromCharCode(n.ReadByte()));return i.join("")},AlphaSynth.Util.IOHelper.Read8BitString=function(n){for(var i=[],t=n.ReadByte();t!=0;)i.push(String.fromCharCode(t)),t=n.ReadByte();return i.join("")},AlphaSynth.Util.IOHelper.Read8BitStringLength=function(n,t){for(var u,f,e=[],i=-1,r=0;r<t;r++)u=n.ReadByte(),u==0&&i==-1&&(i=r),e.push(String.fromCharCode(u));return(f=e.join(""),i>=0)?f.substr(0,i):f},AlphaSynth.Util.IOHelper.ReadSInt8=function(n){var t=n.ReadByte();return((t&255)>>7)*-256+(t&255)},AlphaSynth.Util.IOHelper.ReadUInt32=function(n){var t=n.ReadByte(),i=n.ReadByte(),r=n.ReadByte(),u=n.ReadByte();return t<<24|i<<16|r<<8|u<<0},AlphaSynth.Util.IOHelper.ReadInt24=function(n,t){var i;return AlphaSynth.Platform.TypeUtils.IsLittleEndian?(i=n[t]|n[t+1]<<8|n[t+2]<<16,(i&8388608)==8388608&&(i=i|-16777216)):(i=n[t]<<16|n[t+1]<<8|n[t+2],(i&256)==256&&(i=i|255)),i},AlphaSynth.Util.IOHelper.ReadInt16=function(n,t){return AlphaSynth.Platform.TypeUtils.IsLittleEndian?AlphaSynth.Platform.TypeUtils.ToInt16(n[t]|n[t+1]<<8):AlphaSynth.Platform.TypeUtils.ToInt16(n[t]<<8|n[t+1])},AlphaSynth.Util.WaveHelper=function(){},AlphaSynth.Util.WaveHelper.SwapEndianess=function(n,t){var r,i;for(t/=8,r=new Uint8Array(t),i=0;i<n.length;i+=t)r.set(n.subarray(i,i+t),0),AlphaSynth.Platform.Std.Reverse(r),n.set(r.subarray(0,0+t),i)},i=0;i<$StaticConstructors.length;i++)$StaticConstructors[i]();(function(n){function o(n,t,i,r){var u,f,e;r!=null&&i.Ready&&(u=AlphaTab.Audio.Generator.MidiFileGenerator.GenerateMidiFile(r),n.data("alphaSynthTickCache",u.TickLookup),f=new AlphaTab.IO.ByteBuffer,u.WriteTo(f),e=f.ToArray(),i.LoadMidiBytes(e))}function s(n){return n.data("alphaSynthTickCache")}function f(n){return n.data("alphaSynthCursorCache")}var t=n.fn.alphaTab.fn,e;t.playerInit=function(n,i){var r=n.data("alphaSynth");if(!r){r=new AlphaSynth.Main.AlphaSynthApi;r.On("ready",function(u){r.Ready=u;u&&o(n,i,r,t.score(n,i))});n.data("alphaSynth",r);n.on("loaded",function(){o(n,i,r,t.score(n,i))})}return r};t.player=function(n){return n.data("alphaSynth")};var r=null,i=null,u=!1;t.playerCursorUpdateTick=function(n,i,r){requestAnimationFrame(function(){var e=s(n),f,u;e&&(f=t.tracks(n,i),f.length>0&&(u=e.FindBeat(f,r),u&&t.playerCursorUpdateBeat(n,i,u.CurrentBeat,u.NextBeat,u.Duration)))})};t.playerCursorSelectRange=function(t,i,r,u){var s=f(t),e,y,p,w,o,h,k,d,l,a,g,nt,v;if(s&&(e=i.cursorOptions.selectionWrapper,e.empty(),r!=null&&u!=null&&r.beat!=u.beat))if(r.bounds||(r.bounds=s.FindBeat(r.beat)),u.bounds||(u.bounds=s.FindBeat(u.beat)),y=r.beat.get_AbsoluteStart(),p=u.beat.get_AbsoluteStart(),p<y&&(w=r,r=u,u=w),o=r.bounds.RealBounds.X,h=u.bounds.RealBounds.X+u.bounds.RealBounds.W,u.beat.Index==u.beat.Voice.Beats.length-1&&(h=u.bounds.BarBounds.MasterBarBounds.RealBounds.X+u.bounds.BarBounds.MasterBarBounds.RealBounds.W),r.bounds.BarBounds.MasterBarBounds.StaveGroupBounds!=u.bounds.BarBounds.MasterBarBounds.StaveGroupBounds){var c=r.bounds.BarBounds.MasterBarBounds.StaveGroupBounds.VisualBounds.X,b=r.bounds.BarBounds.MasterBarBounds.StaveGroupBounds.VisualBounds.X+r.bounds.BarBounds.MasterBarBounds.StaveGroupBounds.VisualBounds.W,tt=n("<div><\/div>").css({position:"absolute",top:r.bounds.BarBounds.MasterBarBounds.VisualBounds.Y+"px",left:o+"px",width:b-o+"px",height:r.bounds.BarBounds.MasterBarBounds.VisualBounds.H+"px"});for(e.append(tt),k=r.bounds.BarBounds.MasterBarBounds.StaveGroupBounds.Index+1,d=u.bounds.BarBounds.MasterBarBounds.StaveGroupBounds.Index,l=k;l<d;l++)a=s.StaveGroups[l],g=n("<div><\/div>").css({position:"absolute",top:a.VisualBounds.Y+"px",left:c+"px",width:b-c+"px",height:a.VisualBounds.H+"px"}),e.append(g);nt=n("<div><\/div>").css({position:"absolute",top:u.bounds.BarBounds.MasterBarBounds.VisualBounds.Y+"px",left:c+"px",width:h-c+"px",height:u.bounds.BarBounds.MasterBarBounds.VisualBounds.H+"px"});e.append(nt)}else v=n("<div><\/div>"),v.css({position:"absolute",top:r.bounds.BarBounds.MasterBarBounds.VisualBounds.Y+"px",left:o+"px",width:h-o+"px",height:r.bounds.BarBounds.MasterBarBounds.VisualBounds.H+"px"}),e.append(v)};t.playerCursorUpdateBeat=function(t,i,r,e,o){var c,s,w,b,v,y,d,p;if(r!=null&&(c=f(t),c)){var g=i.cursorOptions.currentBeat,nt=i.cursorOptions.cursorCache,tt=i.cursorOptions.playerState;if(i.cursorOptions.currentBeat=r,i.cursorOptions.cursorCache=c,i.cursorOptions.playerState=playerState,r!=g||c!=nt||tt!=playerState){var ut=i.cursorOptions.cursors,it=i.cursorOptions.barCursor,l=i.cursorOptions.beatCursor,h=c.FindBeat(r);if(h&&(s=h.BarBounds.MasterBarBounds,it.css({top:s.VisualBounds.Y+"px",left:s.VisualBounds.X+"px",width:s.VisualBounds.W+"px",height:s.VisualBounds.H+"px"}),l.stop(!0,!1).css({top:s.VisualBounds.Y+"px",left:h.VisualBounds.X+"px",width:i.cursorOptions.beatCursorWidth+"px",height:s.VisualBounds.H+"px"}),n(".atHighlight").removeClass("atHighlight"),playerState==1&&(n(".b"+r.Id).addClass("atHighlight"),w=s.VisualBounds.X+s.VisualBounds.W,e&&(b=c.FindBeat(e),b.BarBounds.MasterBarBounds.StaveGroupBounds==s.StaveGroupBounds&&(w=b.VisualBounds.X)),l.animate({left:w+"px"},o,"linear"),!u))){var rt=n(i.cursorOptions.scrollElement),k=rt.offset(),a=t.offset();a={top:a.top-k.top,left:a.left-k.left};i.cursorOptions.autoScroll=="vertical"?(v=h.RealBounds.Y-a.top,v!=i.cursorOptions.lastScroll&&(i.cursorOptions.lastScroll=v,n(i.cursorOptions.scrollElement).animate({scrollTop:v+"px"},i.cursorOptions.scrollSpeed))):i.cursorOptions.autoScroll=="horizontal-bar"?(y=l.offset().left-h.VisualBounds.X,s.VisualBounds.X!=i.cursorOptions.lastScroll&&(p=y+h.RealBounds.X+i.cursorOptions.scrollOffset,i.cursorOptions.lastScroll=s.VisualBounds.X,n(i.cursorOptions.scrollElement).animate({scrollLeft:p+"px"},i.cursorOptions.scrollSpeed))):i.cursorOptions.autoScroll=="horizontal-offscreen"&&(y=l.offset().left-h.VisualBounds.X,d=n(i.cursorOptions.scrollElement).scrollLeft()+n(i.cursorOptions.scrollElement).width(),(s.VisualBounds.X+s.VisualBounds.W>=d||s.VisualBounds.X<n(i.cursorOptions.scrollElement).scrollLeft())&&(p=y+h.RealBounds.X+i.cursorOptions.scrollOffset,i.cursorOptions.lastScroll=s.VisualBounds.X,n(i.cursorOptions.scrollElement).animate({scrollLeft:p+"px"},i.cursorOptions.scrollSpeed)))}}}};e={autoScroll:"vertical",scrollSpeed:300,scrollOffset:0,scrollElement:"body",scrollAdjustment:0,beatCursorWidth:3,handleClick:!0};t.cursorOptions=function(t,i,r){if(r)i.cursorOptions=n.extend(e,r);else return i.cursorOptions};t.playerCursor=function(f,o,h){var l=f.data("alphaSynth"),a,b;if(!l)throw new Error('Initialize player with "playerInit" before you init the cursors');if(!f.data("alphaSynthCursor")){f.data("alphaSynthCursor",!0);o.cursorOptions=n.extend(e,h);var c=n('<div class="cursors"><\/div>'),v=n('<div class="selectionWrapper"><\/div>'),y=n('<div class="barCursor"><\/div>'),p=n('<div class="beatCursor"><\/div>'),w=n(".alphaTabSurface",f);f.css({position:"relative"});f.css({"text-align":"left"});c.css({position:"absolute","z-index":1e3,display:"inline","pointer-events":"none"});v.css({position:"absolute"});y.css({position:"absolute"});p.css({position:"absolute"});o.cursorOptions.cursors=c;o.cursorOptions.barCursor=y;o.cursorOptions.beatCursor=p;o.cursorOptions.selectionWrapper=v;f.prepend(c);c.prepend(y);c.prepend(p);c.prepend(v);a=0;b=0;f.on("post-rendered",function(){var n=t.renderer(f,o);f.data("alphaSynthCursorCache",n.BoundsLookup);t.playerCursorUpdateTick(f,o,a);c.css({position:"absolute","z-index":1e3,width:w.width(),height:w.height()})});if(l.On("positionChanged",function(n,i,r){a=r;console.log(r);setTimeout(function(){t.playerCursorUpdateTick(f,o,r)},0)}),l.On("playerStateChanged",function(n){b=n;setTimeout(function(){t.playerCursorUpdateTick(f,o,a)},0)}),o.cursorOptions.handleClick){n(o.CanvasElement).on("mousedown",function(e){if(e.which==1){e.preventDefault();var s=n(this).offset(),c=e.pageX-s.left,l=e.pageY-s.top,h=t.getBeatAtPos(f,o,c,l);h&&(r={beat:h},i=null,u=!0)}});n(o.CanvasElement).on("mousemove",function(e){if(u){var h=n(this).offset(),c=e.pageX-h.left,l=e.pageY-h.top,s=t.getBeatAtPos(f,o,c,l);s&&(i==null||i.beat!=s)&&(i={beat:s},t.playerCursorSelectRange(f,o,r,i))}});n(o.CanvasElement).on("mouseup",function(n){var c,a,v,e,h,y;n.preventDefault();i&&(c=r.beat.get_AbsoluteStart(),a=i.beat.get_AbsoluteStart(),a<c&&(v=r,r=i,i=v));e=s(f);h=e.GetMasterBarStart(r.beat.Voice.Bar.get_MasterBar());t.playerCursorUpdateBeat(f,o,r.beat);l.SetPositionTick(h+r.beat.Start);i&&r.beat!=i.beat?(y=e.GetMasterBarStart(i.beat.Voice.Bar.get_MasterBar()),l.SetPlaybackRange(h+r.beat.Start,y+i.beat.Start)):(r=null,l.SetPlaybackRange(-1,-1));t.playerCursorSelectRange(f,o,r,i);u=!1});f.on("post-rendered",function(){r&&t.playerCursorSelectRange(f,o,r,i)})}}};t.getBeatAtPos=function(n,t,i,r){var u=f(n);return u.GetBeatAtPos(i,r)}})(jQuery);